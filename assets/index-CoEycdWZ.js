(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();var Us=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(Us||{}),X_=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(X_||{}),xc=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(xc||{}),Rt=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(Rt||{}),ir=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(ir||{}),at=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(at||{}),vn=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(vn||{}),Et=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(Et||{}),dt=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(dt||{}),Sr=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(Sr||{}),ts=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(ts||{}),or=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(or||{}),Ye=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Ye||{}),tr=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(tr||{}),ld=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(ld||{}),yi=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(yi||{}),be=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(be||{}),ye=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(ye||{}),sr=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(sr||{});const jS={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},ft={ADAPTER:jS,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Yl=/iPhone/i,um=/iPod/i,cm=/iPad/i,dm=/\biOS-universal(?:.+)Mac\b/i,jl=/\bAndroid(?:.+)Mobile\b/i,fm=/Android/i,on=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,wa=/Silk/i,br=/Windows Phone/i,pm=/\bWindows(?:.+)ARM\b/i,mm=/BlackBerry/i,gm=/BB10/i,_m=/Opera Mini/i,ym=/\b(CriOS|Chrome)(?:.+)Mobile/i,vm=/Mobile(?:.+)Firefox\b/i,xm=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function KS(s){return function(t){return t.test(s)}}function bm(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var r=KS(e),n={apple:{phone:r(Yl)&&!r(br),ipod:r(um),tablet:!r(Yl)&&(r(cm)||xm(t))&&!r(br),universal:r(dm),device:(r(Yl)||r(um)||r(cm)||r(dm)||xm(t))&&!r(br)},amazon:{phone:r(on),tablet:!r(on)&&r(wa),device:r(on)||r(wa)},android:{phone:!r(br)&&r(on)||!r(br)&&r(jl),tablet:!r(br)&&!r(on)&&!r(jl)&&(r(wa)||r(fm)),device:!r(br)&&(r(on)||r(wa)||r(jl)||r(fm))||r(/\bokhttp\b/i)},windows:{phone:r(br),tablet:r(pm),device:r(br)||r(pm)},other:{blackberry:r(mm),blackberry10:r(gm),opera:r(_m),firefox:r(vm),chrome:r(ym),device:r(mm)||r(gm)||r(_m)||r(vm)||r(ym)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const ZS=bm.default??bm,Ar=ZS(globalThis.navigator);ft.RETINA_PREFIX=/@([0-9\.]+)x/;ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ud(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function JS(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var t=s.default;if(typeof t=="function"){var e=function i(){var r=!1;try{r=this instanceof i}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(s).forEach(function(i){var r=Object.getOwnPropertyDescriptor(s,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return s[i]}})}),e}var Kl={exports:{}},wm;function QS(){return wm||(wm=1,(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(c,f,g){this.fn=c,this.context=f,this.once=g||!1}function n(c,f,g,u,d){if(typeof g!="function")throw new TypeError("The listener must be a function");var m=new r(g,u||c,d),_=e?e+f:f;return c._events[_]?c._events[_].fn?c._events[_]=[c._events[_],m]:c._events[_].push(m):(c._events[_]=m,c._eventsCount++),c}function a(c,f){--c._eventsCount===0?c._events=new i:delete c._events[f]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var f=[],g,u;if(this._eventsCount===0)return f;for(u in g=this._events)t.call(g,u)&&f.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},l.prototype.listeners=function(f){var g=e?e+f:f,u=this._events[g];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,m=u.length,_=new Array(m);d<m;d++)_[d]=u[d].fn;return _},l.prototype.listenerCount=function(f){var g=e?e+f:f,u=this._events[g];return u?u.fn?1:u.length:0},l.prototype.emit=function(f,g,u,d,m,_){var x=e?e+f:f;if(!this._events[x])return!1;var v=this._events[x],b=arguments.length,S,T;if(v.fn){switch(v.once&&this.removeListener(f,v.fn,void 0,!0),b){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,g),!0;case 3:return v.fn.call(v.context,g,u),!0;case 4:return v.fn.call(v.context,g,u,d),!0;case 5:return v.fn.call(v.context,g,u,d,m),!0;case 6:return v.fn.call(v.context,g,u,d,m,_),!0}for(T=1,S=new Array(b-1);T<b;T++)S[T-1]=arguments[T];v.fn.apply(v.context,S)}else{var C=v.length,I;for(T=0;T<C;T++)switch(v[T].once&&this.removeListener(f,v[T].fn,void 0,!0),b){case 1:v[T].fn.call(v[T].context);break;case 2:v[T].fn.call(v[T].context,g);break;case 3:v[T].fn.call(v[T].context,g,u);break;case 4:v[T].fn.call(v[T].context,g,u,d);break;default:if(!S)for(I=1,S=new Array(b-1);I<b;I++)S[I-1]=arguments[I];v[T].fn.apply(v[T].context,S)}}return!0},l.prototype.on=function(f,g,u){return n(this,f,g,u,!1)},l.prototype.once=function(f,g,u){return n(this,f,g,u,!0)},l.prototype.removeListener=function(f,g,u,d){var m=e?e+f:f;if(!this._events[m])return this;if(!g)return a(this,m),this;var _=this._events[m];if(_.fn)_.fn===g&&(!d||_.once)&&(!u||_.context===u)&&a(this,m);else{for(var x=0,v=[],b=_.length;x<b;x++)(_[x].fn!==g||d&&!_[x].once||u&&_[x].context!==u)&&v.push(_[x]);v.length?this._events[m]=v.length===1?v[0]:v:a(this,m)}return this},l.prototype.removeAllListeners=function(f){var g;return f?(g=e?e+f:f,this._events[g]&&a(this,g)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=e,l.EventEmitter=l,s.exports=l})(Kl)),Kl.exports}var tA=QS();const rs=ud(tA);var Ta={exports:{}},Tm;function eA(){if(Tm)return Ta.exports;Tm=1,Ta.exports=s,Ta.exports.default=s;function s(R,F,P){P=P||2;var V=F&&F.length,L=V?F[0]*P:R.length,U=t(R,0,L,P,!0),z=[];if(!U||U.next===U.prev)return z;var $,rt,nt,ut,pt,gt,xt;if(V&&(U=c(R,F,U,P)),R.length>80*P){$=nt=R[0],rt=ut=R[1];for(var ot=P;ot<L;ot+=P)pt=R[ot],gt=R[ot+1],pt<$&&($=pt),gt<rt&&(rt=gt),pt>nt&&(nt=pt),gt>ut&&(ut=gt);xt=Math.max(nt-$,ut-rt),xt=xt!==0?32767/xt:0}return i(U,z,P,$,rt,xt,0),z}function t(R,F,P,V,L){var U,z;if(L===_t(R,F,P,V)>0)for(U=F;U<P;U+=V)z=H(U,R[U],R[U+1],z);else for(U=P-V;U>=F;U-=V)z=H(U,R[U],R[U+1],z);return z&&C(z,z.next)&&(K(z),z=z.next),z}function e(R,F){if(!R)return R;F||(F=R);var P=R,V;do if(V=!1,!P.steiner&&(C(P,P.next)||T(P.prev,P,P.next)===0)){if(K(P),P=F=P.prev,P===P.next)break;V=!0}else P=P.next;while(V||P!==F);return F}function i(R,F,P,V,L,U,z){if(R){!z&&U&&m(R,V,L,U);for(var $=R,rt,nt;R.prev!==R.next;){if(rt=R.prev,nt=R.next,U?n(R,V,L,U):r(R)){F.push(rt.i/P|0),F.push(R.i/P|0),F.push(nt.i/P|0),K(R),R=nt.next,$=nt.next;continue}if(R=nt,R===$){z?z===1?(R=a(e(R),F,P),i(R,F,P,V,L,U,2)):z===2&&l(R,F,P,V,L,U):i(e(R),F,P,V,L,U,1);break}}}}function r(R){var F=R.prev,P=R,V=R.next;if(T(F,P,V)>=0)return!1;for(var L=F.x,U=P.x,z=V.x,$=F.y,rt=P.y,nt=V.y,ut=L<U?L<z?L:z:U<z?U:z,pt=$<rt?$<nt?$:nt:rt<nt?rt:nt,gt=L>U?L>z?L:z:U>z?U:z,xt=$>rt?$>nt?$:nt:rt>nt?rt:nt,ot=V.next;ot!==F;){if(ot.x>=ut&&ot.x<=gt&&ot.y>=pt&&ot.y<=xt&&b(L,$,U,rt,z,nt,ot.x,ot.y)&&T(ot.prev,ot,ot.next)>=0)return!1;ot=ot.next}return!0}function n(R,F,P,V){var L=R.prev,U=R,z=R.next;if(T(L,U,z)>=0)return!1;for(var $=L.x,rt=U.x,nt=z.x,ut=L.y,pt=U.y,gt=z.y,xt=$<rt?$<nt?$:nt:rt<nt?rt:nt,ot=ut<pt?ut<gt?ut:gt:pt<gt?pt:gt,yt=$>rt?$>nt?$:nt:rt>nt?rt:nt,bt=ut>pt?ut>gt?ut:gt:pt>gt?pt:gt,Lt=x(xt,ot,F,P,V),Ft=x(yt,bt,F,P,V),vt=R.prevZ,At=R.nextZ;vt&&vt.z>=Lt&&At&&At.z<=Ft;){if(vt.x>=xt&&vt.x<=yt&&vt.y>=ot&&vt.y<=bt&&vt!==L&&vt!==z&&b($,ut,rt,pt,nt,gt,vt.x,vt.y)&&T(vt.prev,vt,vt.next)>=0||(vt=vt.prevZ,At.x>=xt&&At.x<=yt&&At.y>=ot&&At.y<=bt&&At!==L&&At!==z&&b($,ut,rt,pt,nt,gt,At.x,At.y)&&T(At.prev,At,At.next)>=0))return!1;At=At.nextZ}for(;vt&&vt.z>=Lt;){if(vt.x>=xt&&vt.x<=yt&&vt.y>=ot&&vt.y<=bt&&vt!==L&&vt!==z&&b($,ut,rt,pt,nt,gt,vt.x,vt.y)&&T(vt.prev,vt,vt.next)>=0)return!1;vt=vt.prevZ}for(;At&&At.z<=Ft;){if(At.x>=xt&&At.x<=yt&&At.y>=ot&&At.y<=bt&&At!==L&&At!==z&&b($,ut,rt,pt,nt,gt,At.x,At.y)&&T(At.prev,At,At.next)>=0)return!1;At=At.nextZ}return!0}function a(R,F,P){var V=R;do{var L=V.prev,U=V.next.next;!C(L,U)&&I(L,V,V.next,U)&&X(L,U)&&X(U,L)&&(F.push(L.i/P|0),F.push(V.i/P|0),F.push(U.i/P|0),K(V),K(V.next),V=R=U),V=V.next}while(V!==R);return e(V)}function l(R,F,P,V,L,U){var z=R;do{for(var $=z.next.next;$!==z.prev;){if(z.i!==$.i&&S(z,$)){var rt=Z(z,$);z=e(z,z.next),rt=e(rt,rt.next),i(z,F,P,V,L,U,0),i(rt,F,P,V,L,U,0);return}$=$.next}z=z.next}while(z!==R)}function c(R,F,P,V){var L=[],U,z,$,rt,nt;for(U=0,z=F.length;U<z;U++)$=F[U]*V,rt=U<z-1?F[U+1]*V:R.length,nt=t(R,$,rt,V,!1),nt===nt.next&&(nt.steiner=!0),L.push(v(nt));for(L.sort(f),U=0;U<L.length;U++)P=g(L[U],P);return P}function f(R,F){return R.x-F.x}function g(R,F){var P=u(R,F);if(!P)return F;var V=Z(P,R);return e(V,V.next),e(P,P.next)}function u(R,F){var P=F,V=R.x,L=R.y,U=-1/0,z;do{if(L<=P.y&&L>=P.next.y&&P.next.y!==P.y){var $=P.x+(L-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if($<=V&&$>U&&(U=$,z=P.x<P.next.x?P:P.next,$===V))return z}P=P.next}while(P!==F);if(!z)return null;var rt=z,nt=z.x,ut=z.y,pt=1/0,gt;P=z;do V>=P.x&&P.x>=nt&&V!==P.x&&b(L<ut?V:U,L,nt,ut,L<ut?U:V,L,P.x,P.y)&&(gt=Math.abs(L-P.y)/(V-P.x),X(P,R)&&(gt<pt||gt===pt&&(P.x>z.x||P.x===z.x&&d(z,P)))&&(z=P,pt=gt)),P=P.next;while(P!==rt);return z}function d(R,F){return T(R.prev,R,F.prev)<0&&T(F.next,R,R.next)<0}function m(R,F,P,V){var L=R;do L.z===0&&(L.z=x(L.x,L.y,F,P,V)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==R);L.prevZ.nextZ=null,L.prevZ=null,_(L)}function _(R){var F,P,V,L,U,z,$,rt,nt=1;do{for(P=R,R=null,U=null,z=0;P;){for(z++,V=P,$=0,F=0;F<nt&&($++,V=V.nextZ,!!V);F++);for(rt=nt;$>0||rt>0&&V;)$!==0&&(rt===0||!V||P.z<=V.z)?(L=P,P=P.nextZ,$--):(L=V,V=V.nextZ,rt--),U?U.nextZ=L:R=L,L.prevZ=U,U=L;P=V}U.nextZ=null,nt*=2}while(z>1);return R}function x(R,F,P,V,L){return R=(R-P)*L|0,F=(F-V)*L|0,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,F=(F|F<<8)&16711935,F=(F|F<<4)&252645135,F=(F|F<<2)&858993459,F=(F|F<<1)&1431655765,R|F<<1}function v(R){var F=R,P=R;do(F.x<P.x||F.x===P.x&&F.y<P.y)&&(P=F),F=F.next;while(F!==R);return P}function b(R,F,P,V,L,U,z,$){return(L-z)*(F-$)>=(R-z)*(U-$)&&(R-z)*(V-$)>=(P-z)*(F-$)&&(P-z)*(U-$)>=(L-z)*(V-$)}function S(R,F){return R.next.i!==F.i&&R.prev.i!==F.i&&!B(R,F)&&(X(R,F)&&X(F,R)&&tt(R,F)&&(T(R.prev,R,F.prev)||T(R,F.prev,F))||C(R,F)&&T(R.prev,R,R.next)>0&&T(F.prev,F,F.next)>0)}function T(R,F,P){return(F.y-R.y)*(P.x-F.x)-(F.x-R.x)*(P.y-F.y)}function C(R,F){return R.x===F.x&&R.y===F.y}function I(R,F,P,V){var L=E(T(R,F,P)),U=E(T(R,F,V)),z=E(T(P,V,R)),$=E(T(P,V,F));return!!(L!==U&&z!==$||L===0&&k(R,P,F)||U===0&&k(R,V,F)||z===0&&k(P,R,V)||$===0&&k(P,F,V))}function k(R,F,P){return F.x<=Math.max(R.x,P.x)&&F.x>=Math.min(R.x,P.x)&&F.y<=Math.max(R.y,P.y)&&F.y>=Math.min(R.y,P.y)}function E(R){return R>0?1:R<0?-1:0}function B(R,F){var P=R;do{if(P.i!==R.i&&P.next.i!==R.i&&P.i!==F.i&&P.next.i!==F.i&&I(P,P.next,R,F))return!0;P=P.next}while(P!==R);return!1}function X(R,F){return T(R.prev,R,R.next)<0?T(R,F,R.next)>=0&&T(R,R.prev,F)>=0:T(R,F,R.prev)<0||T(R,R.next,F)<0}function tt(R,F){var P=R,V=!1,L=(R.x+F.x)/2,U=(R.y+F.y)/2;do P.y>U!=P.next.y>U&&P.next.y!==P.y&&L<(P.next.x-P.x)*(U-P.y)/(P.next.y-P.y)+P.x&&(V=!V),P=P.next;while(P!==R);return V}function Z(R,F){var P=new j(R.i,R.x,R.y),V=new j(F.i,F.x,F.y),L=R.next,U=F.prev;return R.next=F,F.prev=R,P.next=L,L.prev=P,V.next=P,P.prev=V,U.next=V,V.prev=U,V}function H(R,F,P,V){var L=new j(R,F,P);return V?(L.next=V.next,L.prev=V,V.next.prev=L,V.next=L):(L.prev=L,L.next=L),L}function K(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function j(R,F,P){this.i=R,this.x=F,this.y=P,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}s.deviation=function(R,F,P,V){var L=F&&F.length,U=L?F[0]*P:R.length,z=Math.abs(_t(R,0,U,P));if(L)for(var $=0,rt=F.length;$<rt;$++){var nt=F[$]*P,ut=$<rt-1?F[$+1]*P:R.length;z-=Math.abs(_t(R,nt,ut,P))}var pt=0;for($=0;$<V.length;$+=3){var gt=V[$]*P,xt=V[$+1]*P,ot=V[$+2]*P;pt+=Math.abs((R[gt]-R[ot])*(R[xt+1]-R[gt+1])-(R[gt]-R[xt])*(R[ot+1]-R[gt+1]))}return z===0&&pt===0?0:Math.abs((pt-z)/z)};function _t(R,F,P,V){for(var L=0,U=F,z=P-V;U<P;U+=V)L+=(R[z]-R[U])*(R[U+1]+R[z+1]),z=U;return L}return s.flatten=function(R){for(var F=R[0][0].length,P={vertices:[],holes:[],dimensions:F},V=0,L=0;L<R.length;L++){for(var U=0;U<R[L].length;U++)for(var z=0;z<F;z++)P.vertices.push(R[L][U][z]);L>0&&(V+=R[L-1].length,P.holes.push(V))}return P},Ta.exports}var iA=eA();const rA=ud(iA);var xs={},fo={exports:{}};var sA=fo.exports,Sm;function nA(){return Sm||(Sm=1,(function(s,t){(function(e){var i=t&&!t.nodeType&&t,r=s&&!s.nodeType&&s,n=typeof si=="object"&&si;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,l=2147483647,c=36,f=1,g=26,u=38,d=700,m=72,_=128,x="-",v=/^xn--/,b=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=c-f,I=Math.floor,k=String.fromCharCode,E;function B(L){throw new RangeError(T[L])}function X(L,U){for(var z=L.length,$=[];z--;)$[z]=U(L[z]);return $}function tt(L,U){var z=L.split("@"),$="";z.length>1&&($=z[0]+"@",L=z[1]),L=L.replace(S,".");var rt=L.split("."),nt=X(rt,U).join(".");return $+nt}function Z(L){for(var U=[],z=0,$=L.length,rt,nt;z<$;)rt=L.charCodeAt(z++),rt>=55296&&rt<=56319&&z<$?(nt=L.charCodeAt(z++),(nt&64512)==56320?U.push(((rt&1023)<<10)+(nt&1023)+65536):(U.push(rt),z--)):U.push(rt);return U}function H(L){return X(L,function(U){var z="";return U>65535&&(U-=65536,z+=k(U>>>10&1023|55296),U=56320|U&1023),z+=k(U),z}).join("")}function K(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:c}function j(L,U){return L+22+75*(L<26)-((U!=0)<<5)}function _t(L,U,z){var $=0;for(L=z?I(L/d):L>>1,L+=I(L/U);L>C*g>>1;$+=c)L=I(L/C);return I($+(C+1)*L/(L+u))}function R(L){var U=[],z=L.length,$,rt=0,nt=_,ut=m,pt,gt,xt,ot,yt,bt,Lt,Ft,vt;for(pt=L.lastIndexOf(x),pt<0&&(pt=0),gt=0;gt<pt;++gt)L.charCodeAt(gt)>=128&&B("not-basic"),U.push(L.charCodeAt(gt));for(xt=pt>0?pt+1:0;xt<z;){for(ot=rt,yt=1,bt=c;xt>=z&&B("invalid-input"),Lt=K(L.charCodeAt(xt++)),(Lt>=c||Lt>I((l-rt)/yt))&&B("overflow"),rt+=Lt*yt,Ft=bt<=ut?f:bt>=ut+g?g:bt-ut,!(Lt<Ft);bt+=c)vt=c-Ft,yt>I(l/vt)&&B("overflow"),yt*=vt;$=U.length+1,ut=_t(rt-ot,$,ot==0),I(rt/$)>l-nt&&B("overflow"),nt+=I(rt/$),rt%=$,U.splice(rt++,0,nt)}return H(U)}function F(L){var U,z,$,rt,nt,ut,pt,gt,xt,ot,yt,bt=[],Lt,Ft,vt,At;for(L=Z(L),Lt=L.length,U=_,z=0,nt=m,ut=0;ut<Lt;++ut)yt=L[ut],yt<128&&bt.push(k(yt));for($=rt=bt.length,rt&&bt.push(x);$<Lt;){for(pt=l,ut=0;ut<Lt;++ut)yt=L[ut],yt>=U&&yt<pt&&(pt=yt);for(Ft=$+1,pt-U>I((l-z)/Ft)&&B("overflow"),z+=(pt-U)*Ft,U=pt,ut=0;ut<Lt;++ut)if(yt=L[ut],yt<U&&++z>l&&B("overflow"),yt==U){for(gt=z,xt=c;ot=xt<=nt?f:xt>=nt+g?g:xt-nt,!(gt<ot);xt+=c)At=gt-ot,vt=c-ot,bt.push(k(j(ot+At%vt,0))),gt=I(At/vt);bt.push(k(j(gt,0))),nt=_t(z,Ft,$==rt),z=0,++$}++z,++U}return bt.join("")}function P(L){return tt(L,function(U){return v.test(U)?R(U.slice(4).toLowerCase()):U})}function V(L){return tt(L,function(U){return b.test(U)?"xn--"+F(U):U})}if(a={version:"1.4.1",ucs2:{decode:Z,encode:H},decode:R,encode:F,toASCII:V,toUnicode:P},i&&r)if(s.exports==i)r.exports=a;else for(E in a)a.hasOwnProperty(E)&&(i[E]=a[E]);else e.punycode=a})(sA)})(fo,fo.exports)),fo.exports}var Zl,Am;function Dn(){return Am||(Am=1,Zl=TypeError),Zl}const oA={},aA=Object.freeze(Object.defineProperty({__proto__:null,default:oA},Symbol.toStringTag,{value:"Module"})),hA=JS(aA);var Jl,Em;function Th(){if(Em)return Jl;Em=1;var s=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=s&&t&&typeof t.get=="function"?t.get:null,i=s&&Map.prototype.forEach,r=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=r&&n&&typeof n.get=="function"?n.get:null,l=r&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,f=c?WeakMap.prototype.has:null,g=typeof WeakSet=="function"&&WeakSet.prototype,u=g?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,m=d?WeakRef.prototype.deref:null,_=Boolean.prototype.valueOf,x=Object.prototype.toString,v=Function.prototype.toString,b=String.prototype.match,S=String.prototype.slice,T=String.prototype.replace,C=String.prototype.toUpperCase,I=String.prototype.toLowerCase,k=RegExp.prototype.test,E=Array.prototype.concat,B=Array.prototype.join,X=Array.prototype.slice,tt=Math.floor,Z=typeof BigInt=="function"?BigInt.prototype.valueOf:null,H=Object.getOwnPropertySymbols,K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,j=typeof Symbol=="function"&&typeof Symbol.iterator=="object",_t=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===j||!0)?Symbol.toStringTag:null,R=Object.prototype.propertyIsEnumerable,F=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(W){return W.__proto__}:null);function P(W,q){if(W===1/0||W===-1/0||W!==W||W&&W>-1e3&&W<1e3||k.call(/e/,q))return q;var qt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof W=="number"){var ee=W<0?-tt(-W):tt(W);if(ee!==W){var ie=String(ee),Nt=S.call(q,ie.length+1);return T.call(ie,qt,"$&_")+"."+T.call(T.call(Nt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return T.call(q,qt,"$&_")}var V=hA,L=V.custom,U=Ft(L)?L:null,z={__proto__:null,double:'"',single:"'"},$={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Jl=function W(q,qt,ee,ie){var Nt=qt||{};if(jt(Nt,"quoteStyle")&&!jt(z,Nt.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(jt(Nt,"maxStringLength")&&(typeof Nt.maxStringLength=="number"?Nt.maxStringLength<0&&Nt.maxStringLength!==1/0:Nt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Ti=jt(Nt,"customInspect")?Nt.customInspect:!0;if(typeof Ti!="boolean"&&Ti!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(jt(Nt,"indent")&&Nt.indent!==null&&Nt.indent!=="	"&&!(parseInt(Nt.indent,10)===Nt.indent&&Nt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(jt(Nt,"numericSeparator")&&typeof Nt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var ur=Nt.numericSeparator;if(typeof q>"u")return"undefined";if(q===null)return"null";if(typeof q=="boolean")return q?"true":"false";if(typeof q=="string")return Dr(q,Nt);if(typeof q=="number"){if(q===0)return 1/0/q>0?"0":"-0";var Be=String(q);return ur?P(q,Be):Be}if(typeof q=="bigint"){var Vi=String(q)+"n";return ur?P(q,Vi):Vi}var Nn=typeof Nt.depth>"u"?5:Nt.depth;if(typeof ee>"u"&&(ee=0),ee>=Nn&&Nn>0&&typeof q=="object")return pt(q)?"[Array]":"[Object]";var cr=kn(Nt,ee);if(typeof ie>"u")ie=[];else if(Ve(ie,q)>=0)return"[Circular]";function je(Or,Xs,kh){if(Xs&&(ie=X.call(ie),ie.push(Xs)),kh){var Do={depth:Nt.depth};return jt(Nt,"quoteStyle")&&(Do.quoteStyle=Nt.quoteStyle),W(Or,Do,ee+1,ie)}return W(Or,Nt,ee+1,ie)}if(typeof q=="function"&&!xt(q)){var Mo=Rr(q),Io=Br(q,je);return"[Function"+(Mo?": "+Mo:" (anonymous)")+"]"+(Io.length>0?" { "+B.call(Io,", ")+" }":"")}if(Ft(q)){var Vs=j?T.call(String(q),/^(Symbol\(.*\))_[^)]*$/,"$1"):K.call(q);return typeof q=="object"&&!j?lr(Vs):Vs}if(Bh(q)){for(var ls="<"+I.call(String(q.nodeName)),us=q.attributes||[],Ws=0;Ws<us.length;Ws++)ls+=" "+us[Ws].name+"="+rt(nt(us[Ws].value),"double",Nt);return ls+=">",q.childNodes&&q.childNodes.length&&(ls+="..."),ls+="</"+I.call(String(q.nodeName))+">",ls}if(pt(q)){if(q.length===0)return"[]";var Un=Br(q,je);return cr&&!On(Un)?"["+hs(Un,cr)+"]":"[ "+B.call(Un,", ")+" ]"}if(ot(q)){var Gn=Br(q,je);return!("cause"in Error.prototype)&&"cause"in q&&!R.call(q,"cause")?"{ ["+String(q)+"] "+B.call(E.call("[cause]: "+je(q.cause),Gn),", ")+" }":Gn.length===0?"["+String(q)+"]":"{ ["+String(q)+"] "+B.call(Gn,", ")+" }"}if(typeof q=="object"&&Ti){if(U&&typeof q[U]=="function"&&V)return V(q,{depth:Nn-ee});if(Ti!=="symbol"&&typeof q.inspect=="function")return q.inspect()}if(le(q)){var Po=[];return i&&i.call(q,function(Or,Xs){Po.push(je(Xs,q,!0)+" => "+je(Or,q))}),Hs("Map",e.call(q),Po,cr)}if(Fr(q)){var Ro=[];return l&&l.call(q,function(Or){Ro.push(je(Or,q))}),Hs("Set",a.call(q),Ro,cr)}if(oi(q))return as("WeakMap");if(os(q))return as("WeakSet");if(wi(q))return as("WeakRef");if(bt(q))return lr(je(Number(q)));if(vt(q))return lr(je(Z.call(q)));if(Lt(q))return lr(_.call(q));if(yt(q))return lr(je(String(q)));if(typeof window<"u"&&q===window)return"{ [object Window] }";if(typeof globalThis<"u"&&q===globalThis||typeof si<"u"&&q===si)return"{ [object globalThis] }";if(!gt(q)&&!xt(q)){var Hn=Br(q,je),Fo=F?F(q)===Object.prototype:q instanceof Object||q.constructor===Object,Vn=q instanceof Object?"":"null prototype",Wn=!Fo&&_t&&Object(q)===q&&_t in q?S.call(fe(q),8,-1):Vn?"Object":"",Oh=Fo||typeof q.constructor!="function"?"":q.constructor.name?q.constructor.name+" ":"",Xn=Oh+(Wn||Vn?"["+B.call(E.call([],Wn||[],Vn||[]),": ")+"] ":"");return Hn.length===0?Xn+"{}":cr?Xn+"{"+hs(Hn,cr)+"}":Xn+"{ "+B.call(Hn,", ")+" }"}return String(q)};function rt(W,q,qt){var ee=qt.quoteStyle||q,ie=z[ee];return ie+W+ie}function nt(W){return T.call(String(W),/"/g,"&quot;")}function ut(W){return!_t||!(typeof W=="object"&&(_t in W||typeof W[_t]<"u"))}function pt(W){return fe(W)==="[object Array]"&&ut(W)}function gt(W){return fe(W)==="[object Date]"&&ut(W)}function xt(W){return fe(W)==="[object RegExp]"&&ut(W)}function ot(W){return fe(W)==="[object Error]"&&ut(W)}function yt(W){return fe(W)==="[object String]"&&ut(W)}function bt(W){return fe(W)==="[object Number]"&&ut(W)}function Lt(W){return fe(W)==="[object Boolean]"&&ut(W)}function Ft(W){if(j)return W&&typeof W=="object"&&W instanceof Symbol;if(typeof W=="symbol")return!0;if(!W||typeof W!="object"||!K)return!1;try{return K.call(W),!0}catch{}return!1}function vt(W){if(!W||typeof W!="object"||!Z)return!1;try{return Z.call(W),!0}catch{}return!1}var At=Object.prototype.hasOwnProperty||function(W){return W in this};function jt(W,q){return At.call(W,q)}function fe(W){return x.call(W)}function Rr(W){if(W.name)return W.name;var q=b.call(v.call(W),/^function\s*([\w$]+)/);return q?q[1]:null}function Ve(W,q){if(W.indexOf)return W.indexOf(q);for(var qt=0,ee=W.length;qt<ee;qt++)if(W[qt]===q)return qt;return-1}function le(W){if(!e||!W||typeof W!="object")return!1;try{e.call(W);try{a.call(W)}catch{return!0}return W instanceof Map}catch{}return!1}function oi(W){if(!f||!W||typeof W!="object")return!1;try{f.call(W,f);try{u.call(W,u)}catch{return!0}return W instanceof WeakMap}catch{}return!1}function wi(W){if(!m||!W||typeof W!="object")return!1;try{return m.call(W),!0}catch{}return!1}function Fr(W){if(!a||!W||typeof W!="object")return!1;try{a.call(W);try{e.call(W)}catch{return!0}return W instanceof Set}catch{}return!1}function os(W){if(!u||!W||typeof W!="object")return!1;try{u.call(W,u);try{f.call(W,f)}catch{return!0}return W instanceof WeakSet}catch{}return!1}function Bh(W){return!W||typeof W!="object"?!1:typeof HTMLElement<"u"&&W instanceof HTMLElement?!0:typeof W.nodeName=="string"&&typeof W.getAttribute=="function"}function Dr(W,q){if(W.length>q.maxStringLength){var qt=W.length-q.maxStringLength,ee="... "+qt+" more character"+(qt>1?"s":"");return Dr(S.call(W,0,q.maxStringLength),q)+ee}var ie=$[q.quoteStyle||"single"];ie.lastIndex=0;var Nt=T.call(T.call(W,ie,"\\$1"),/[\x00-\x1f]/g,Lr);return rt(Nt,"single",q)}function Lr(W){var q=W.charCodeAt(0),qt={8:"b",9:"t",10:"n",12:"f",13:"r"}[q];return qt?"\\"+qt:"\\x"+(q<16?"0":"")+C.call(q.toString(16))}function lr(W){return"Object("+W+")"}function as(W){return W+" { ? }"}function Hs(W,q,qt,ee){var ie=ee?hs(qt,ee):B.call(qt,", ");return W+" ("+q+") {"+ie+"}"}function On(W){for(var q=0;q<W.length;q++)if(Ve(W[q],`
`)>=0)return!1;return!0}function kn(W,q){var qt;if(W.indent==="	")qt="	";else if(typeof W.indent=="number"&&W.indent>0)qt=B.call(Array(W.indent+1)," ");else return null;return{base:qt,prev:B.call(Array(q+1),qt)}}function hs(W,q){if(W.length===0)return"";var qt=`
`+q.prev+q.base;return qt+B.call(W,","+qt)+`
`+q.prev}function Br(W,q){var qt=pt(W),ee=[];if(qt){ee.length=W.length;for(var ie=0;ie<W.length;ie++)ee[ie]=jt(W,ie)?q(W[ie],W):""}var Nt=typeof H=="function"?H(W):[],Ti;if(j){Ti={};for(var ur=0;ur<Nt.length;ur++)Ti["$"+Nt[ur]]=Nt[ur]}for(var Be in W)jt(W,Be)&&(qt&&String(Number(Be))===Be&&Be<W.length||j&&Ti["$"+Be]instanceof Symbol||(k.call(/[^\w$]/,Be)?ee.push(q(Be,W)+": "+q(W[Be],W)):ee.push(Be+": "+q(W[Be],W))));if(typeof H=="function")for(var Vi=0;Vi<Nt.length;Vi++)R.call(W,Nt[Vi])&&ee.push("["+q(Nt[Vi])+"]: "+q(W[Nt[Vi]],W));return ee}return Jl}var Ql,Cm;function lA(){if(Cm)return Ql;Cm=1;var s=Th(),t=Dn(),e=function(l,c,f){for(var g=l,u;(u=g.next)!=null;g=u)if(u.key===c)return g.next=u.next,f||(u.next=l.next,l.next=u),u},i=function(l,c){if(l){var f=e(l,c);return f&&f.value}},r=function(l,c,f){var g=e(l,c);g?g.value=f:l.next={key:c,next:l.next,value:f}},n=function(l,c){return l?!!e(l,c):!1},a=function(l,c){if(l)return e(l,c,!0)};return Ql=function(){var c,f={assert:function(g){if(!f.has(g))throw new t("Side channel does not contain "+s(g))},delete:function(g){var u=c&&c.next,d=a(c,g);return d&&u&&u===d&&(c=void 0),!!d},get:function(g){return i(c,g)},has:function(g){return n(c,g)},set:function(g,u){c||(c={next:void 0}),r(c,g,u)}};return f},Ql}var tu,Mm;function $_(){return Mm||(Mm=1,tu=Object),tu}var eu,Im;function uA(){return Im||(Im=1,eu=Error),eu}var iu,Pm;function cA(){return Pm||(Pm=1,iu=EvalError),iu}var ru,Rm;function dA(){return Rm||(Rm=1,ru=RangeError),ru}var su,Fm;function fA(){return Fm||(Fm=1,su=ReferenceError),su}var nu,Dm;function pA(){return Dm||(Dm=1,nu=SyntaxError),nu}var ou,Lm;function mA(){return Lm||(Lm=1,ou=URIError),ou}var au,Bm;function gA(){return Bm||(Bm=1,au=Math.abs),au}var hu,Om;function _A(){return Om||(Om=1,hu=Math.floor),hu}var lu,km;function yA(){return km||(km=1,lu=Math.max),lu}var uu,Nm;function vA(){return Nm||(Nm=1,uu=Math.min),uu}var cu,Um;function xA(){return Um||(Um=1,cu=Math.pow),cu}var du,Gm;function bA(){return Gm||(Gm=1,du=Math.round),du}var fu,Hm;function wA(){return Hm||(Hm=1,fu=Number.isNaN||function(t){return t!==t}),fu}var pu,Vm;function TA(){if(Vm)return pu;Vm=1;var s=wA();return pu=function(e){return s(e)||e===0?e:e<0?-1:1},pu}var mu,Wm;function SA(){return Wm||(Wm=1,mu=Object.getOwnPropertyDescriptor),mu}var gu,Xm;function z_(){if(Xm)return gu;Xm=1;var s=SA();if(s)try{s([],"length")}catch{s=null}return gu=s,gu}var _u,$m;function AA(){if($m)return _u;$m=1;var s=Object.defineProperty||!1;if(s)try{s({},"a",{value:1})}catch{s=!1}return _u=s,_u}var yu,zm;function EA(){return zm||(zm=1,yu=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var r=42;t[e]=r;for(var n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var a=Object.getOwnPropertySymbols(t);if(a.length!==1||a[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(t,e);if(l.value!==r||l.enumerable!==!0)return!1}return!0}),yu}var vu,qm;function CA(){if(qm)return vu;qm=1;var s=typeof Symbol<"u"&&Symbol,t=EA();return vu=function(){return typeof s!="function"||typeof Symbol!="function"||typeof s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},vu}var xu,Ym;function q_(){return Ym||(Ym=1,xu=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),xu}var bu,jm;function Y_(){if(jm)return bu;jm=1;var s=$_();return bu=s.getPrototypeOf||null,bu}var wu,Km;function MA(){if(Km)return wu;Km=1;var s="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,i="[object Function]",r=function(c,f){for(var g=[],u=0;u<c.length;u+=1)g[u]=c[u];for(var d=0;d<f.length;d+=1)g[d+c.length]=f[d];return g},n=function(c,f){for(var g=[],u=f,d=0;u<c.length;u+=1,d+=1)g[d]=c[u];return g},a=function(l,c){for(var f="",g=0;g<l.length;g+=1)f+=l[g],g+1<l.length&&(f+=c);return f};return wu=function(c){var f=this;if(typeof f!="function"||t.apply(f)!==i)throw new TypeError(s+f);for(var g=n(arguments,1),u,d=function(){if(this instanceof u){var b=f.apply(this,r(g,arguments));return Object(b)===b?b:this}return f.apply(c,r(g,arguments))},m=e(0,f.length-g.length),_=[],x=0;x<m;x++)_[x]="$"+x;if(u=Function("binder","return function ("+a(_,",")+"){ return binder.apply(this,arguments); }")(d),f.prototype){var v=function(){};v.prototype=f.prototype,u.prototype=new v,v.prototype=null}return u},wu}var Tu,Zm;function Sh(){if(Zm)return Tu;Zm=1;var s=MA();return Tu=Function.prototype.bind||s,Tu}var Su,Jm;function cd(){return Jm||(Jm=1,Su=Function.prototype.call),Su}var Au,Qm;function j_(){return Qm||(Qm=1,Au=Function.prototype.apply),Au}var Eu,tg;function IA(){return tg||(tg=1,Eu=typeof Reflect<"u"&&Reflect&&Reflect.apply),Eu}var Cu,eg;function PA(){if(eg)return Cu;eg=1;var s=Sh(),t=j_(),e=cd(),i=IA();return Cu=i||s.call(e,t),Cu}var Mu,ig;function K_(){if(ig)return Mu;ig=1;var s=Sh(),t=Dn(),e=cd(),i=PA();return Mu=function(n){if(n.length<1||typeof n[0]!="function")throw new t("a function is required");return i(s,e,n)},Mu}var Iu,rg;function RA(){if(rg)return Iu;rg=1;var s=K_(),t=z_(),e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var i=!!e&&t&&t(Object.prototype,"__proto__"),r=Object,n=r.getPrototypeOf;return Iu=i&&typeof i.get=="function"?s([i.get]):typeof n=="function"?function(l){return n(l==null?l:r(l))}:!1,Iu}var Pu,sg;function FA(){if(sg)return Pu;sg=1;var s=q_(),t=Y_(),e=RA();return Pu=s?function(r){return s(r)}:t?function(r){if(!r||typeof r!="object"&&typeof r!="function")throw new TypeError("getProto: not an object");return t(r)}:e?function(r){return e(r)}:null,Pu}var Ru,ng;function DA(){if(ng)return Ru;ng=1;var s=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Sh();return Ru=e.call(s,t),Ru}var Fu,og;function dd(){if(og)return Fu;og=1;var s,t=$_(),e=uA(),i=cA(),r=dA(),n=fA(),a=pA(),l=Dn(),c=mA(),f=gA(),g=_A(),u=yA(),d=vA(),m=xA(),_=bA(),x=TA(),v=Function,b=function(xt){try{return v('"use strict"; return ('+xt+").constructor;")()}catch{}},S=z_(),T=AA(),C=function(){throw new l},I=S?(function(){try{return arguments.callee,C}catch{try{return S(arguments,"callee").get}catch{return C}}})():C,k=CA()(),E=FA(),B=Y_(),X=q_(),tt=j_(),Z=cd(),H={},K=typeof Uint8Array>"u"||!E?s:E(Uint8Array),j={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?s:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?s:ArrayBuffer,"%ArrayIteratorPrototype%":k&&E?E([][Symbol.iterator]()):s,"%AsyncFromSyncIteratorPrototype%":s,"%AsyncFunction%":H,"%AsyncGenerator%":H,"%AsyncGeneratorFunction%":H,"%AsyncIteratorPrototype%":H,"%Atomics%":typeof Atomics>"u"?s:Atomics,"%BigInt%":typeof BigInt>"u"?s:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?s:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?s:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?s:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":i,"%Float16Array%":typeof Float16Array>"u"?s:Float16Array,"%Float32Array%":typeof Float32Array>"u"?s:Float32Array,"%Float64Array%":typeof Float64Array>"u"?s:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?s:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":H,"%Int8Array%":typeof Int8Array>"u"?s:Int8Array,"%Int16Array%":typeof Int16Array>"u"?s:Int16Array,"%Int32Array%":typeof Int32Array>"u"?s:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":k&&E?E(E([][Symbol.iterator]())):s,"%JSON%":typeof JSON=="object"?JSON:s,"%Map%":typeof Map>"u"?s:Map,"%MapIteratorPrototype%":typeof Map>"u"||!k||!E?s:E(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":S,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?s:Promise,"%Proxy%":typeof Proxy>"u"?s:Proxy,"%RangeError%":r,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?s:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?s:Set,"%SetIteratorPrototype%":typeof Set>"u"||!k||!E?s:E(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?s:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":k&&E?E(""[Symbol.iterator]()):s,"%Symbol%":k?Symbol:s,"%SyntaxError%":a,"%ThrowTypeError%":I,"%TypedArray%":K,"%TypeError%":l,"%Uint8Array%":typeof Uint8Array>"u"?s:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?s:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?s:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?s:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?s:WeakMap,"%WeakRef%":typeof WeakRef>"u"?s:WeakRef,"%WeakSet%":typeof WeakSet>"u"?s:WeakSet,"%Function.prototype.call%":Z,"%Function.prototype.apply%":tt,"%Object.defineProperty%":T,"%Object.getPrototypeOf%":B,"%Math.abs%":f,"%Math.floor%":g,"%Math.max%":u,"%Math.min%":d,"%Math.pow%":m,"%Math.round%":_,"%Math.sign%":x,"%Reflect.getPrototypeOf%":X};if(E)try{null.error}catch(xt){var _t=E(E(xt));j["%Error.prototype%"]=_t}var R=function xt(ot){var yt;if(ot==="%AsyncFunction%")yt=b("async function () {}");else if(ot==="%GeneratorFunction%")yt=b("function* () {}");else if(ot==="%AsyncGeneratorFunction%")yt=b("async function* () {}");else if(ot==="%AsyncGenerator%"){var bt=xt("%AsyncGeneratorFunction%");bt&&(yt=bt.prototype)}else if(ot==="%AsyncIteratorPrototype%"){var Lt=xt("%AsyncGenerator%");Lt&&E&&(yt=E(Lt.prototype))}return j[ot]=yt,yt},F={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},P=Sh(),V=DA(),L=P.call(Z,Array.prototype.concat),U=P.call(tt,Array.prototype.splice),z=P.call(Z,String.prototype.replace),$=P.call(Z,String.prototype.slice),rt=P.call(Z,RegExp.prototype.exec),nt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,ut=/\\(\\)?/g,pt=function(ot){var yt=$(ot,0,1),bt=$(ot,-1);if(yt==="%"&&bt!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(bt==="%"&&yt!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var Lt=[];return z(ot,nt,function(Ft,vt,At,jt){Lt[Lt.length]=At?z(jt,ut,"$1"):vt||Ft}),Lt},gt=function(ot,yt){var bt=ot,Lt;if(V(F,bt)&&(Lt=F[bt],bt="%"+Lt[0]+"%"),V(j,bt)){var Ft=j[bt];if(Ft===H&&(Ft=R(bt)),typeof Ft>"u"&&!yt)throw new l("intrinsic "+ot+" exists, but is not available. Please file an issue!");return{alias:Lt,name:bt,value:Ft}}throw new a("intrinsic "+ot+" does not exist!")};return Fu=function(ot,yt){if(typeof ot!="string"||ot.length===0)throw new l("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof yt!="boolean")throw new l('"allowMissing" argument must be a boolean');if(rt(/^%?[^%]*%?$/,ot)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var bt=pt(ot),Lt=bt.length>0?bt[0]:"",Ft=gt("%"+Lt+"%",yt),vt=Ft.name,At=Ft.value,jt=!1,fe=Ft.alias;fe&&(Lt=fe[0],U(bt,L([0,1],fe)));for(var Rr=1,Ve=!0;Rr<bt.length;Rr+=1){var le=bt[Rr],oi=$(le,0,1),wi=$(le,-1);if((oi==='"'||oi==="'"||oi==="`"||wi==='"'||wi==="'"||wi==="`")&&oi!==wi)throw new a("property names with quotes must have matching quotes");if((le==="constructor"||!Ve)&&(jt=!0),Lt+="."+le,vt="%"+Lt+"%",V(j,vt))At=j[vt];else if(At!=null){if(!(le in At)){if(!yt)throw new l("base intrinsic for "+ot+" exists, but the property is not available.");return}if(S&&Rr+1>=bt.length){var Fr=S(At,le);Ve=!!Fr,Ve&&"get"in Fr&&!("originalValue"in Fr.get)?At=Fr.get:At=At[le]}else Ve=V(At,le),At=At[le];Ve&&!jt&&(j[vt]=At)}}return At},Fu}var Du,ag;function Z_(){if(ag)return Du;ag=1;var s=dd(),t=K_(),e=t([s("%String.prototype.indexOf%")]);return Du=function(r,n){var a=s(r,!!n);return typeof a=="function"&&e(r,".prototype.")>-1?t([a]):a},Du}var Lu,hg;function J_(){if(hg)return Lu;hg=1;var s=dd(),t=Z_(),e=Th(),i=Dn(),r=s("%Map%",!0),n=t("Map.prototype.get",!0),a=t("Map.prototype.set",!0),l=t("Map.prototype.has",!0),c=t("Map.prototype.delete",!0),f=t("Map.prototype.size",!0);return Lu=!!r&&function(){var u,d={assert:function(m){if(!d.has(m))throw new i("Side channel does not contain "+e(m))},delete:function(m){if(u){var _=c(u,m);return f(u)===0&&(u=void 0),_}return!1},get:function(m){if(u)return n(u,m)},has:function(m){return u?l(u,m):!1},set:function(m,_){u||(u=new r),a(u,m,_)}};return d},Lu}var Bu,lg;function LA(){if(lg)return Bu;lg=1;var s=dd(),t=Z_(),e=Th(),i=J_(),r=Dn(),n=s("%WeakMap%",!0),a=t("WeakMap.prototype.get",!0),l=t("WeakMap.prototype.set",!0),c=t("WeakMap.prototype.has",!0),f=t("WeakMap.prototype.delete",!0);return Bu=n?function(){var u,d,m={assert:function(_){if(!m.has(_))throw new r("Side channel does not contain "+e(_))},delete:function(_){if(n&&_&&(typeof _=="object"||typeof _=="function")){if(u)return f(u,_)}else if(i&&d)return d.delete(_);return!1},get:function(_){return n&&_&&(typeof _=="object"||typeof _=="function")&&u?a(u,_):d&&d.get(_)},has:function(_){return n&&_&&(typeof _=="object"||typeof _=="function")&&u?c(u,_):!!d&&d.has(_)},set:function(_,x){n&&_&&(typeof _=="object"||typeof _=="function")?(u||(u=new n),l(u,_,x)):i&&(d||(d=i()),d.set(_,x))}};return m}:i,Bu}var Ou,ug;function BA(){if(ug)return Ou;ug=1;var s=Dn(),t=Th(),e=lA(),i=J_(),r=LA(),n=r||i||e;return Ou=function(){var l,c={assert:function(f){if(!c.has(f))throw new s("Side channel does not contain "+t(f))},delete:function(f){return!!l&&l.delete(f)},get:function(f){return l&&l.get(f)},has:function(f){return!!l&&l.has(f)},set:function(f,g){l||(l=n()),l.set(f,g)}};return c},Ou}var ku,cg;function fd(){if(cg)return ku;cg=1;var s=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return ku={default:e.RFC3986,formatters:{RFC1738:function(i){return s.call(i,t,"+")},RFC3986:function(i){return String(i)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},ku}var Nu,dg;function Q_(){if(dg)return Nu;dg=1;var s=fd(),t=Object.prototype.hasOwnProperty,e=Array.isArray,i=(function(){for(var v=[],b=0;b<256;++b)v.push("%"+((b<16?"0":"")+b.toString(16)).toUpperCase());return v})(),r=function(b){for(;b.length>1;){var S=b.pop(),T=S.obj[S.prop];if(e(T)){for(var C=[],I=0;I<T.length;++I)typeof T[I]<"u"&&C.push(T[I]);S.obj[S.prop]=C}}},n=function(b,S){for(var T=S&&S.plainObjects?{__proto__:null}:{},C=0;C<b.length;++C)typeof b[C]<"u"&&(T[C]=b[C]);return T},a=function v(b,S,T){if(!S)return b;if(typeof S!="object"&&typeof S!="function"){if(e(b))b.push(S);else if(b&&typeof b=="object")(T&&(T.plainObjects||T.allowPrototypes)||!t.call(Object.prototype,S))&&(b[S]=!0);else return[b,S];return b}if(!b||typeof b!="object")return[b].concat(S);var C=b;return e(b)&&!e(S)&&(C=n(b,T)),e(b)&&e(S)?(S.forEach(function(I,k){if(t.call(b,k)){var E=b[k];E&&typeof E=="object"&&I&&typeof I=="object"?b[k]=v(E,I,T):b.push(I)}else b[k]=I}),b):Object.keys(S).reduce(function(I,k){var E=S[k];return t.call(I,k)?I[k]=v(I[k],E,T):I[k]=E,I},C)},l=function(b,S){return Object.keys(S).reduce(function(T,C){return T[C]=S[C],T},b)},c=function(v,b,S){var T=v.replace(/\+/g," ");if(S==="iso-8859-1")return T.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(T)}catch{return T}},f=1024,g=function(b,S,T,C,I){if(b.length===0)return b;var k=b;if(typeof b=="symbol"?k=Symbol.prototype.toString.call(b):typeof b!="string"&&(k=String(b)),T==="iso-8859-1")return escape(k).replace(/%u[0-9a-f]{4}/gi,function(K){return"%26%23"+parseInt(K.slice(2),16)+"%3B"});for(var E="",B=0;B<k.length;B+=f){for(var X=k.length>=f?k.slice(B,B+f):k,tt=[],Z=0;Z<X.length;++Z){var H=X.charCodeAt(Z);if(H===45||H===46||H===95||H===126||H>=48&&H<=57||H>=65&&H<=90||H>=97&&H<=122||I===s.RFC1738&&(H===40||H===41)){tt[tt.length]=X.charAt(Z);continue}if(H<128){tt[tt.length]=i[H];continue}if(H<2048){tt[tt.length]=i[192|H>>6]+i[128|H&63];continue}if(H<55296||H>=57344){tt[tt.length]=i[224|H>>12]+i[128|H>>6&63]+i[128|H&63];continue}Z+=1,H=65536+((H&1023)<<10|X.charCodeAt(Z)&1023),tt[tt.length]=i[240|H>>18]+i[128|H>>12&63]+i[128|H>>6&63]+i[128|H&63]}E+=tt.join("")}return E},u=function(b){for(var S=[{obj:{o:b},prop:"o"}],T=[],C=0;C<S.length;++C)for(var I=S[C],k=I.obj[I.prop],E=Object.keys(k),B=0;B<E.length;++B){var X=E[B],tt=k[X];typeof tt=="object"&&tt!==null&&T.indexOf(tt)===-1&&(S.push({obj:k,prop:X}),T.push(tt))}return r(S),b},d=function(b){return Object.prototype.toString.call(b)==="[object RegExp]"},m=function(b){return!b||typeof b!="object"?!1:!!(b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b))},_=function(b,S){return[].concat(b,S)},x=function(b,S){if(e(b)){for(var T=[],C=0;C<b.length;C+=1)T.push(S(b[C]));return T}return S(b)};return Nu={arrayToObject:n,assign:l,combine:_,compact:u,decode:c,encode:g,isBuffer:m,isRegExp:d,maybeMap:x,merge:a},Nu}var Uu,fg;function OA(){if(fg)return Uu;fg=1;var s=BA(),t=Q_(),e=fd(),i=Object.prototype.hasOwnProperty,r={brackets:function(v){return v+"[]"},comma:"comma",indices:function(v,b){return v+"["+b+"]"},repeat:function(v){return v}},n=Array.isArray,a=Array.prototype.push,l=function(x,v){a.apply(x,n(v)?v:[v])},c=Date.prototype.toISOString,f=e.default,g={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:f,formatter:e.formatters[f],indices:!1,serializeDate:function(v){return c.call(v)},skipNulls:!1,strictNullHandling:!1},u=function(v){return typeof v=="string"||typeof v=="number"||typeof v=="boolean"||typeof v=="symbol"||typeof v=="bigint"},d={},m=function x(v,b,S,T,C,I,k,E,B,X,tt,Z,H,K,j,_t,R,F){for(var P=v,V=F,L=0,U=!1;(V=V.get(d))!==void 0&&!U;){var z=V.get(v);if(L+=1,typeof z<"u"){if(z===L)throw new RangeError("Cyclic object value");U=!0}typeof V.get(d)>"u"&&(L=0)}if(typeof X=="function"?P=X(b,P):P instanceof Date?P=H(P):S==="comma"&&n(P)&&(P=t.maybeMap(P,function(vt){return vt instanceof Date?H(vt):vt})),P===null){if(I)return B&&!_t?B(b,g.encoder,R,"key",K):b;P=""}if(u(P)||t.isBuffer(P)){if(B){var $=_t?b:B(b,g.encoder,R,"key",K);return[j($)+"="+j(B(P,g.encoder,R,"value",K))]}return[j(b)+"="+j(String(P))]}var rt=[];if(typeof P>"u")return rt;var nt;if(S==="comma"&&n(P))_t&&B&&(P=t.maybeMap(P,B)),nt=[{value:P.length>0?P.join(",")||null:void 0}];else if(n(X))nt=X;else{var ut=Object.keys(P);nt=tt?ut.sort(tt):ut}var pt=E?String(b).replace(/\./g,"%2E"):String(b),gt=T&&n(P)&&P.length===1?pt+"[]":pt;if(C&&n(P)&&P.length===0)return gt+"[]";for(var xt=0;xt<nt.length;++xt){var ot=nt[xt],yt=typeof ot=="object"&&ot&&typeof ot.value<"u"?ot.value:P[ot];if(!(k&&yt===null)){var bt=Z&&E?String(ot).replace(/\./g,"%2E"):String(ot),Lt=n(P)?typeof S=="function"?S(gt,bt):gt:gt+(Z?"."+bt:"["+bt+"]");F.set(v,L);var Ft=s();Ft.set(d,F),l(rt,x(yt,Lt,S,T,C,I,k,E,S==="comma"&&_t&&n(P)?null:B,X,tt,Z,H,K,j,_t,R,Ft))}}return rt},_=function(v){if(!v)return g;if(typeof v.allowEmptyArrays<"u"&&typeof v.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof v.encodeDotInKeys<"u"&&typeof v.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(v.encoder!==null&&typeof v.encoder<"u"&&typeof v.encoder!="function")throw new TypeError("Encoder has to be a function.");var b=v.charset||g.charset;if(typeof v.charset<"u"&&v.charset!=="utf-8"&&v.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var S=e.default;if(typeof v.format<"u"){if(!i.call(e.formatters,v.format))throw new TypeError("Unknown format option provided.");S=v.format}var T=e.formatters[S],C=g.filter;(typeof v.filter=="function"||n(v.filter))&&(C=v.filter);var I;if(v.arrayFormat in r?I=v.arrayFormat:"indices"in v?I=v.indices?"indices":"repeat":I=g.arrayFormat,"commaRoundTrip"in v&&typeof v.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var k=typeof v.allowDots>"u"?v.encodeDotInKeys===!0?!0:g.allowDots:!!v.allowDots;return{addQueryPrefix:typeof v.addQueryPrefix=="boolean"?v.addQueryPrefix:g.addQueryPrefix,allowDots:k,allowEmptyArrays:typeof v.allowEmptyArrays=="boolean"?!!v.allowEmptyArrays:g.allowEmptyArrays,arrayFormat:I,charset:b,charsetSentinel:typeof v.charsetSentinel=="boolean"?v.charsetSentinel:g.charsetSentinel,commaRoundTrip:!!v.commaRoundTrip,delimiter:typeof v.delimiter>"u"?g.delimiter:v.delimiter,encode:typeof v.encode=="boolean"?v.encode:g.encode,encodeDotInKeys:typeof v.encodeDotInKeys=="boolean"?v.encodeDotInKeys:g.encodeDotInKeys,encoder:typeof v.encoder=="function"?v.encoder:g.encoder,encodeValuesOnly:typeof v.encodeValuesOnly=="boolean"?v.encodeValuesOnly:g.encodeValuesOnly,filter:C,format:S,formatter:T,serializeDate:typeof v.serializeDate=="function"?v.serializeDate:g.serializeDate,skipNulls:typeof v.skipNulls=="boolean"?v.skipNulls:g.skipNulls,sort:typeof v.sort=="function"?v.sort:null,strictNullHandling:typeof v.strictNullHandling=="boolean"?v.strictNullHandling:g.strictNullHandling}};return Uu=function(x,v){var b=x,S=_(v),T,C;typeof S.filter=="function"?(C=S.filter,b=C("",b)):n(S.filter)&&(C=S.filter,T=C);var I=[];if(typeof b!="object"||b===null)return"";var k=r[S.arrayFormat],E=k==="comma"&&S.commaRoundTrip;T||(T=Object.keys(b)),S.sort&&T.sort(S.sort);for(var B=s(),X=0;X<T.length;++X){var tt=T[X],Z=b[tt];S.skipNulls&&Z===null||l(I,m(Z,tt,k,E,S.allowEmptyArrays,S.strictNullHandling,S.skipNulls,S.encodeDotInKeys,S.encode?S.encoder:null,S.filter,S.sort,S.allowDots,S.serializeDate,S.format,S.formatter,S.encodeValuesOnly,S.charset,B))}var H=I.join(S.delimiter),K=S.addQueryPrefix===!0?"?":"";return S.charsetSentinel&&(S.charset==="iso-8859-1"?K+="utf8=%26%2310003%3B&":K+="utf8=%E2%9C%93&"),H.length>0?K+H:""},Uu}var Gu,pg;function kA(){if(pg)return Gu;pg=1;var s=Q_(),t=Object.prototype.hasOwnProperty,e=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:s.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},r=function(d){return d.replace(/&#(\d+);/g,function(m,_){return String.fromCharCode(parseInt(_,10))})},n=function(d,m,_){if(d&&typeof d=="string"&&m.comma&&d.indexOf(",")>-1)return d.split(",");if(m.throwOnLimitExceeded&&_>=m.arrayLimit)throw new RangeError("Array limit exceeded. Only "+m.arrayLimit+" element"+(m.arrayLimit===1?"":"s")+" allowed in an array.");return d},a="utf8=%26%2310003%3B",l="utf8=%E2%9C%93",c=function(m,_){var x={__proto__:null},v=_.ignoreQueryPrefix?m.replace(/^\?/,""):m;v=v.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var b=_.parameterLimit===1/0?void 0:_.parameterLimit,S=v.split(_.delimiter,_.throwOnLimitExceeded?b+1:b);if(_.throwOnLimitExceeded&&S.length>b)throw new RangeError("Parameter limit exceeded. Only "+b+" parameter"+(b===1?"":"s")+" allowed.");var T=-1,C,I=_.charset;if(_.charsetSentinel)for(C=0;C<S.length;++C)S[C].indexOf("utf8=")===0&&(S[C]===l?I="utf-8":S[C]===a&&(I="iso-8859-1"),T=C,C=S.length);for(C=0;C<S.length;++C)if(C!==T){var k=S[C],E=k.indexOf("]="),B=E===-1?k.indexOf("="):E+1,X,tt;B===-1?(X=_.decoder(k,i.decoder,I,"key"),tt=_.strictNullHandling?null:""):(X=_.decoder(k.slice(0,B),i.decoder,I,"key"),tt=s.maybeMap(n(k.slice(B+1),_,e(x[X])?x[X].length:0),function(H){return _.decoder(H,i.decoder,I,"value")})),tt&&_.interpretNumericEntities&&I==="iso-8859-1"&&(tt=r(String(tt))),k.indexOf("[]=")>-1&&(tt=e(tt)?[tt]:tt);var Z=t.call(x,X);Z&&_.duplicates==="combine"?x[X]=s.combine(x[X],tt):(!Z||_.duplicates==="last")&&(x[X]=tt)}return x},f=function(d,m,_,x){var v=0;if(d.length>0&&d[d.length-1]==="[]"){var b=d.slice(0,-1).join("");v=Array.isArray(m)&&m[b]?m[b].length:0}for(var S=x?m:n(m,_,v),T=d.length-1;T>=0;--T){var C,I=d[T];if(I==="[]"&&_.parseArrays)C=_.allowEmptyArrays&&(S===""||_.strictNullHandling&&S===null)?[]:s.combine([],S);else{C=_.plainObjects?{__proto__:null}:{};var k=I.charAt(0)==="["&&I.charAt(I.length-1)==="]"?I.slice(1,-1):I,E=_.decodeDotInKeys?k.replace(/%2E/g,"."):k,B=parseInt(E,10);!_.parseArrays&&E===""?C={0:S}:!isNaN(B)&&I!==E&&String(B)===E&&B>=0&&_.parseArrays&&B<=_.arrayLimit?(C=[],C[B]=S):E!=="__proto__"&&(C[E]=S)}S=C}return S},g=function(m,_,x,v){if(m){var b=x.allowDots?m.replace(/\.([^.[]+)/g,"[$1]"):m,S=/(\[[^[\]]*])/,T=/(\[[^[\]]*])/g,C=x.depth>0&&S.exec(b),I=C?b.slice(0,C.index):b,k=[];if(I){if(!x.plainObjects&&t.call(Object.prototype,I)&&!x.allowPrototypes)return;k.push(I)}for(var E=0;x.depth>0&&(C=T.exec(b))!==null&&E<x.depth;){if(E+=1,!x.plainObjects&&t.call(Object.prototype,C[1].slice(1,-1))&&!x.allowPrototypes)return;k.push(C[1])}if(C){if(x.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+x.depth+" and strictDepth is true");k.push("["+b.slice(C.index)+"]")}return f(k,_,x,v)}},u=function(m){if(!m)return i;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.decodeDotInKeys<"u"&&typeof m.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(m.decoder!==null&&typeof m.decoder<"u"&&typeof m.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof m.throwOnLimitExceeded<"u"&&typeof m.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var _=typeof m.charset>"u"?i.charset:m.charset,x=typeof m.duplicates>"u"?i.duplicates:m.duplicates;if(x!=="combine"&&x!=="first"&&x!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var v=typeof m.allowDots>"u"?m.decodeDotInKeys===!0?!0:i.allowDots:!!m.allowDots;return{allowDots:v,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:typeof m.allowPrototypes=="boolean"?m.allowPrototypes:i.allowPrototypes,allowSparse:typeof m.allowSparse=="boolean"?m.allowSparse:i.allowSparse,arrayLimit:typeof m.arrayLimit=="number"?m.arrayLimit:i.arrayLimit,charset:_,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:i.charsetSentinel,comma:typeof m.comma=="boolean"?m.comma:i.comma,decodeDotInKeys:typeof m.decodeDotInKeys=="boolean"?m.decodeDotInKeys:i.decodeDotInKeys,decoder:typeof m.decoder=="function"?m.decoder:i.decoder,delimiter:typeof m.delimiter=="string"||s.isRegExp(m.delimiter)?m.delimiter:i.delimiter,depth:typeof m.depth=="number"||m.depth===!1?+m.depth:i.depth,duplicates:x,ignoreQueryPrefix:m.ignoreQueryPrefix===!0,interpretNumericEntities:typeof m.interpretNumericEntities=="boolean"?m.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:typeof m.parameterLimit=="number"?m.parameterLimit:i.parameterLimit,parseArrays:m.parseArrays!==!1,plainObjects:typeof m.plainObjects=="boolean"?m.plainObjects:i.plainObjects,strictDepth:typeof m.strictDepth=="boolean"?!!m.strictDepth:i.strictDepth,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:i.strictNullHandling,throwOnLimitExceeded:typeof m.throwOnLimitExceeded=="boolean"?m.throwOnLimitExceeded:!1}};return Gu=function(d,m){var _=u(m);if(d===""||d===null||typeof d>"u")return _.plainObjects?{__proto__:null}:{};for(var x=typeof d=="string"?c(d,_):d,v=_.plainObjects?{__proto__:null}:{},b=Object.keys(x),S=0;S<b.length;++S){var T=b[S],C=g(T,x[T],_,typeof d=="string");v=s.merge(v,C,_)}return _.allowSparse===!0?v:s.compact(v)},Gu}var Hu,mg;function NA(){if(mg)return Hu;mg=1;var s=OA(),t=kA(),e=fd();return Hu={formats:e,parse:t,stringify:s},Hu}var gg;function UA(){if(gg)return xs;gg=1;var s=nA();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var e=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,r=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(n),l=["'"].concat(a),c=["%","/","?",";","#"].concat(l),f=["/","?","#"],g=255,u=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},_={javascript:!0,"javascript:":!0},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=NA();function b(I,k,E){if(I&&typeof I=="object"&&I instanceof t)return I;var B=new t;return B.parse(I,k,E),B}t.prototype.parse=function(I,k,E){if(typeof I!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof I);var B=I.indexOf("?"),X=B!==-1&&B<I.indexOf("#")?"?":"#",tt=I.split(X),Z=/\\/g;tt[0]=tt[0].replace(Z,"/"),I=tt.join(X);var H=I;if(H=H.trim(),!E&&I.split("#").length===1){var K=r.exec(H);if(K)return this.path=H,this.href=H,this.pathname=K[1],K[2]?(this.search=K[2],k?this.query=v.parse(this.search.substr(1)):this.query=this.search.substr(1)):k&&(this.search="",this.query={}),this}var j=e.exec(H);if(j){j=j[0];var _t=j.toLowerCase();this.protocol=_t,H=H.substr(j.length)}if(E||j||H.match(/^\/\/[^@/]+@[^@/]+/)){var R=H.substr(0,2)==="//";R&&!(j&&_[j])&&(H=H.substr(2),this.slashes=!0)}if(!_[j]&&(R||j&&!x[j])){for(var F=-1,P=0;P<f.length;P++){var V=H.indexOf(f[P]);V!==-1&&(F===-1||V<F)&&(F=V)}var L,U;F===-1?U=H.lastIndexOf("@"):U=H.lastIndexOf("@",F),U!==-1&&(L=H.slice(0,U),H=H.slice(U+1),this.auth=decodeURIComponent(L)),F=-1;for(var P=0;P<c.length;P++){var V=H.indexOf(c[P]);V!==-1&&(F===-1||V<F)&&(F=V)}F===-1&&(F=H.length),this.host=H.slice(0,F),H=H.slice(F),this.parseHost(),this.hostname=this.hostname||"";var z=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!z)for(var $=this.hostname.split(/\./),P=0,rt=$.length;P<rt;P++){var nt=$[P];if(nt&&!nt.match(u)){for(var ut="",pt=0,gt=nt.length;pt<gt;pt++)nt.charCodeAt(pt)>127?ut+="x":ut+=nt[pt];if(!ut.match(u)){var xt=$.slice(0,P),ot=$.slice(P+1),yt=nt.match(d);yt&&(xt.push(yt[1]),ot.unshift(yt[2])),ot.length&&(H="/"+ot.join(".")+H),this.hostname=xt.join(".");break}}}this.hostname.length>g?this.hostname="":this.hostname=this.hostname.toLowerCase(),z||(this.hostname=s.toASCII(this.hostname));var bt=this.port?":"+this.port:"",Lt=this.hostname||"";this.host=Lt+bt,this.href+=this.host,z&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),H[0]!=="/"&&(H="/"+H))}if(!m[_t])for(var P=0,rt=l.length;P<rt;P++){var Ft=l[P];if(H.indexOf(Ft)!==-1){var vt=encodeURIComponent(Ft);vt===Ft&&(vt=escape(Ft)),H=H.split(Ft).join(vt)}}var At=H.indexOf("#");At!==-1&&(this.hash=H.substr(At),H=H.slice(0,At));var jt=H.indexOf("?");if(jt!==-1?(this.search=H.substr(jt),this.query=H.substr(jt+1),k&&(this.query=v.parse(this.query)),H=H.slice(0,jt)):k&&(this.search="",this.query={}),H&&(this.pathname=H),x[_t]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var bt=this.pathname||"",fe=this.search||"";this.path=bt+fe}return this.href=this.format(),this};function S(I){return typeof I=="string"&&(I=b(I)),I instanceof t?I.format():t.prototype.format.call(I)}t.prototype.format=function(){var I=this.auth||"";I&&(I=encodeURIComponent(I),I=I.replace(/%3A/i,":"),I+="@");var k=this.protocol||"",E=this.pathname||"",B=this.hash||"",X=!1,tt="";this.host?X=I+this.host:this.hostname&&(X=I+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(X+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(tt=v.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var Z=this.search||tt&&"?"+tt||"";return k&&k.substr(-1)!==":"&&(k+=":"),this.slashes||(!k||x[k])&&X!==!1?(X="//"+(X||""),E&&E.charAt(0)!=="/"&&(E="/"+E)):X||(X=""),B&&B.charAt(0)!=="#"&&(B="#"+B),Z&&Z.charAt(0)!=="?"&&(Z="?"+Z),E=E.replace(/[?#]/g,function(H){return encodeURIComponent(H)}),Z=Z.replace("#","%23"),k+X+E+Z+B};function T(I,k){return b(I,!1,!0).resolve(k)}t.prototype.resolve=function(I){return this.resolveObject(b(I,!1,!0)).format()};function C(I,k){return I?b(I,!1,!0).resolveObject(k):k}return t.prototype.resolveObject=function(I){if(typeof I=="string"){var k=new t;k.parse(I,!1,!0),I=k}for(var E=new t,B=Object.keys(this),X=0;X<B.length;X++){var tt=B[X];E[tt]=this[tt]}if(E.hash=I.hash,I.href==="")return E.href=E.format(),E;if(I.slashes&&!I.protocol){for(var Z=Object.keys(I),H=0;H<Z.length;H++){var K=Z[H];K!=="protocol"&&(E[K]=I[K])}return x[E.protocol]&&E.hostname&&!E.pathname&&(E.pathname="/",E.path=E.pathname),E.href=E.format(),E}if(I.protocol&&I.protocol!==E.protocol){if(!x[I.protocol]){for(var j=Object.keys(I),_t=0;_t<j.length;_t++){var R=j[_t];E[R]=I[R]}return E.href=E.format(),E}if(E.protocol=I.protocol,!I.host&&!_[I.protocol]){for(var rt=(I.pathname||"").split("/");rt.length&&!(I.host=rt.shift()););I.host||(I.host=""),I.hostname||(I.hostname=""),rt[0]!==""&&rt.unshift(""),rt.length<2&&rt.unshift(""),E.pathname=rt.join("/")}else E.pathname=I.pathname;if(E.search=I.search,E.query=I.query,E.host=I.host||"",E.auth=I.auth,E.hostname=I.hostname||I.host,E.port=I.port,E.pathname||E.search){var F=E.pathname||"",P=E.search||"";E.path=F+P}return E.slashes=E.slashes||I.slashes,E.href=E.format(),E}var V=E.pathname&&E.pathname.charAt(0)==="/",L=I.host||I.pathname&&I.pathname.charAt(0)==="/",U=L||V||E.host&&I.pathname,z=U,$=E.pathname&&E.pathname.split("/")||[],rt=I.pathname&&I.pathname.split("/")||[],nt=E.protocol&&!x[E.protocol];if(nt&&(E.hostname="",E.port=null,E.host&&($[0]===""?$[0]=E.host:$.unshift(E.host)),E.host="",I.protocol&&(I.hostname=null,I.port=null,I.host&&(rt[0]===""?rt[0]=I.host:rt.unshift(I.host)),I.host=null),U=U&&(rt[0]===""||$[0]==="")),L)E.host=I.host||I.host===""?I.host:E.host,E.hostname=I.hostname||I.hostname===""?I.hostname:E.hostname,E.search=I.search,E.query=I.query,$=rt;else if(rt.length)$||($=[]),$.pop(),$=$.concat(rt),E.search=I.search,E.query=I.query;else if(I.search!=null){if(nt){E.host=$.shift(),E.hostname=E.host;var ut=E.host&&E.host.indexOf("@")>0?E.host.split("@"):!1;ut&&(E.auth=ut.shift(),E.hostname=ut.shift(),E.host=E.hostname)}return E.search=I.search,E.query=I.query,(E.pathname!==null||E.search!==null)&&(E.path=(E.pathname?E.pathname:"")+(E.search?E.search:"")),E.href=E.format(),E}if(!$.length)return E.pathname=null,E.search?E.path="/"+E.search:E.path=null,E.href=E.format(),E;for(var pt=$.slice(-1)[0],gt=(E.host||I.host||$.length>1)&&(pt==="."||pt==="..")||pt==="",xt=0,ot=$.length;ot>=0;ot--)pt=$[ot],pt==="."?$.splice(ot,1):pt===".."?($.splice(ot,1),xt++):xt&&($.splice(ot,1),xt--);if(!U&&!z)for(;xt--;xt)$.unshift("..");U&&$[0]!==""&&(!$[0]||$[0].charAt(0)!=="/")&&$.unshift(""),gt&&$.join("/").substr(-1)!=="/"&&$.push("");var yt=$[0]===""||$[0]&&$[0].charAt(0)==="/";if(nt){E.hostname=yt?"":$.length?$.shift():"",E.host=E.hostname;var ut=E.host&&E.host.indexOf("@")>0?E.host.split("@"):!1;ut&&(E.auth=ut.shift(),E.hostname=ut.shift(),E.host=E.hostname)}return U=U||E.host&&$.length,U&&!yt&&$.unshift(""),$.length>0?E.pathname=$.join("/"):(E.pathname=null,E.path=null),(E.pathname!==null||E.search!==null)&&(E.path=(E.pathname?E.pathname:"")+(E.search?E.search:"")),E.auth=I.auth||E.auth,E.slashes=E.slashes||I.slashes,E.href=E.format(),E},t.prototype.parseHost=function(){var I=this.host,k=i.exec(I);k&&(k=k[0],k!==":"&&(this.port=k.substr(1)),I=I.substr(0,I.length-k.length)),I&&(this.hostname=I)},xs.parse=b,xs.resolve=T,xs.resolveObject=C,xs.format=S,xs.Url=t,xs}var Vu=UA();const _g={};function Ht(s,t,e=3){if(_g[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(i))),_g[t]=!0}const pd={get parse(){return Ht("7.3.0","utils.url.parse is deprecated, use native URL API instead."),Vu.parse},get format(){return Ht("7.3.0","utils.url.format is deprecated, use native URL API instead."),Vu.format},get resolve(){return Ht("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),Vu.resolve}};function Mi(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function oo(s){return s.split("?")[0].split("#")[0]}function GA(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function HA(s,t,e){return s.replace(new RegExp(GA(t),"g"),e)}function VA(s,t){let e="",i=0,r=-1,n=0,a=-1;for(let l=0;l<=s.length;++l){if(l<s.length)a=s.charCodeAt(l);else{if(a===47)break;a=47}if(a===47){if(!(r===l-1||n===1))if(r!==l-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const c=e.lastIndexOf("/");if(c!==e.length-1){c===-1?(e="",i=0):(e=e.slice(0,c),i=e.length-1-e.lastIndexOf("/")),r=l,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,r=l,n=0;continue}}}else e.length>0?e+=`/${s.slice(r+1,l)}`:e=s.slice(r+1,l),i=l-r-1;r=l,n=0}else a===46&&n!==-1?++n:n=-1}return e}const Ae={toPosix(s){return HA(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Mi(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(Mi(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=oo(this.toPosix(t??ft.ADAPTER.getBaseUrl())),r=oo(this.toPosix(e??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?Ae.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(Mi(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=VA(s),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return Mi(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(Mi(i),i.length>0)if(t===void 0)t=i;else{const r=s[e-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(Mi(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,r=!0;const n=this.getProtocol(s),a=s;s=s.slice(n.length);for(let l=s.length-1;l>=1;--l)if(t=s.charCodeAt(l),t===47){if(!r){i=l;break}}else r=!1;return i===-1?e?"/":this.isUrl(a)?n+s:n:e&&i===1?"//":n+s.slice(0,i)},rootname(s){Mi(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){Mi(s),t&&Mi(t),s=oo(this.toPosix(s));let e=0,i=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let a=t.length-1,l=-1;for(n=s.length-1;n>=0;--n){const c=s.charCodeAt(n);if(c===47){if(!r){e=n+1;break}}else l===-1&&(r=!1,l=n+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(i=n):(a=-1,i=l))}return e===i?i=l:i===-1&&(i=s.length),s.slice(e,i)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!r){e=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":s.slice(e,i)},extname(s){Mi(s),s=oo(this.toPosix(s));let t=-1,e=0,i=-1,r=!0,n=0;for(let a=s.length-1;a>=0;--a){const l=s.charCodeAt(a);if(l===47){if(!r){e=a+1;break}continue}i===-1&&(r=!1,i=a+1),l===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){Mi(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=oo(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let r;t.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let n=-1,a=0,l=-1,c=!0,f=s.length-1,g=0;for(;f>=r;--f){if(e=s.charCodeAt(f),e===47){if(!c){a=f+1;break}continue}l===-1&&(c=!1,l=f+1),e===46?n===-1?n=f:g!==1&&(g=1):n!==-1&&(g=-1)}return n===-1||l===-1||g===0||g===1&&n===l-1&&n===a+1?l!==-1&&(a===0&&i?t.base=t.name=s.slice(1,l):t.base=t.name=s.slice(a,l)):(a===0&&i?(t.name=s.slice(1,n),t.base=s.slice(1,l)):(t.name=s.slice(a,n),t.base=s.slice(a,l)),t.ext=s.slice(n,l)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let Wu;async function WA(){return Wu??(Wu=(async()=>{const s=document.createElement("canvas").getContext("webgl");if(!s)return Ye.UNPACK;const t=await new Promise(n=>{const a=document.createElement("video");a.onloadeddata=()=>n(a),a.onerror=()=>n(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return Ye.UNPACK;const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);const i=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,i),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t);const r=new Uint8Array(4);return s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,r),s.deleteFramebuffer(i),s.deleteTexture(e),s.getExtension("WEBGL_lose_context")?.loseContext(),r[0]<=r[3]?Ye.PMA:Ye.UNPACK})()),Wu}let Xu;function XA(){return typeof Xu>"u"&&(Xu=(function(){const s={stencil:!0,failIfMajorPerformanceCaveat:ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ft.ADAPTER.getWebGLRenderingContext())return!1;const t=ft.ADAPTER.createCanvas();let e=t.getContext("webgl",s)||t.getContext("experimental-webgl",s);const i=!!e?.getContextAttributes()?.stencil;if(e){const r=e.getExtension("WEBGL_lose_context");r&&r.loseContext()}return e=null,i}catch{return!1}})()),Xu}var $A={grad:.9,turn:360,rad:360/(2*Math.PI)},wr=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},Se=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},vi=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},ty=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},yg=function(s){return{r:vi(s.r,0,255),g:vi(s.g,0,255),b:vi(s.b,0,255),a:vi(s.a)}},$u=function(s){return{r:Se(s.r),g:Se(s.g),b:Se(s.b),a:Se(s.a,3)}},zA=/^#([0-9a-f]{3,8})$/i,Sa=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},ey=function(s){var t=s.r,e=s.g,i=s.b,r=s.a,n=Math.max(t,e,i),a=n-Math.min(t,e,i),l=a?n===t?(e-i)/a:n===e?2+(i-t)/a:4+(t-e)/a:0;return{h:60*(l<0?l+6:l),s:n?a/n*100:0,v:n/255*100,a:r}},iy=function(s){var t=s.h,e=s.s,i=s.v,r=s.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),a=i*(1-e),l=i*(1-(t-n)*e),c=i*(1-(1-t+n)*e),f=n%6;return{r:255*[i,l,a,a,c,i][f],g:255*[c,i,i,l,a,a][f],b:255*[a,a,c,i,i,l][f],a:r}},vg=function(s){return{h:ty(s.h),s:vi(s.s,0,100),l:vi(s.l,0,100),a:vi(s.a)}},xg=function(s){return{h:Se(s.h),s:Se(s.s),l:Se(s.l),a:Se(s.a,3)}},bg=function(s){return iy((e=(t=s).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},wo=function(s){return{h:(t=ey(s)).h,s:(r=(200-(e=t.s))*(i=t.v)/100)>0&&r<200?e*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,e,i,r},qA=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,YA=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,jA=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,KA=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bc={string:[[function(s){var t=zA.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?Se(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?Se(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=jA.exec(s)||KA.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:yg({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=qA.exec(s)||YA.exec(s);if(!t)return null;var e,i,r=vg({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*($A[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return bg(r)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,i=s.b,r=s.a,n=r===void 0?1:r;return wr(t)&&wr(e)&&wr(i)?yg({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null},"rgb"],[function(s){var t=s.h,e=s.s,i=s.l,r=s.a,n=r===void 0?1:r;if(!wr(t)||!wr(e)||!wr(i))return null;var a=vg({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return bg(a)},"hsl"],[function(s){var t=s.h,e=s.s,i=s.v,r=s.a,n=r===void 0?1:r;if(!wr(t)||!wr(e)||!wr(i))return null;var a=(function(l){return{h:ty(l.h),s:vi(l.s,0,100),v:vi(l.v,0,100),a:vi(l.a)}})({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return iy(a)},"hsv"]]},wg=function(s,t){for(var e=0;e<t.length;e++){var i=t[e][0](s);if(i)return[i,t[e][1]]}return[null,void 0]},ZA=function(s){return typeof s=="string"?wg(s.trim(),bc.string):typeof s=="object"&&s!==null?wg(s,bc.object):[null,void 0]},zu=function(s,t){var e=wo(s);return{h:e.h,s:vi(e.s+100*t,0,100),l:e.l,a:e.a}},qu=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Tg=function(s,t){var e=wo(s);return{h:e.h,s:e.s,l:vi(e.l+100*t,0,100),a:e.a}},wc=(function(){function s(t){this.parsed=ZA(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return Se(qu(this.rgba),2)},s.prototype.isDark=function(){return qu(this.rgba)<.5},s.prototype.isLight=function(){return qu(this.rgba)>=.5},s.prototype.toHex=function(){return t=$u(this.rgba),e=t.r,i=t.g,r=t.b,a=(n=t.a)<1?Sa(Se(255*n)):"","#"+Sa(e)+Sa(i)+Sa(r)+a;var t,e,i,r,n,a},s.prototype.toRgb=function(){return $u(this.rgba)},s.prototype.toRgbString=function(){return t=$u(this.rgba),e=t.r,i=t.g,r=t.b,(n=t.a)<1?"rgba("+e+", "+i+", "+r+", "+n+")":"rgb("+e+", "+i+", "+r+")";var t,e,i,r,n},s.prototype.toHsl=function(){return xg(wo(this.rgba))},s.prototype.toHslString=function(){return t=xg(wo(this.rgba)),e=t.h,i=t.s,r=t.l,(n=t.a)<1?"hsla("+e+", "+i+"%, "+r+"%, "+n+")":"hsl("+e+", "+i+"%, "+r+"%)";var t,e,i,r,n},s.prototype.toHsv=function(){return t=ey(this.rgba),{h:Se(t.h),s:Se(t.s),v:Se(t.v),a:Se(t.a,3)};var t},s.prototype.invert=function(){return qi({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),qi(zu(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),qi(zu(this.rgba,-t))},s.prototype.grayscale=function(){return qi(zu(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),qi(Tg(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),qi(Tg(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?qi({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Se(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=wo(this.rgba);return typeof t=="number"?qi({h:t,s:e.s,l:e.l,a:e.a}):Se(e.h)},s.prototype.isEqual=function(t){return this.toHex()===qi(t).toHex()},s})(),qi=function(s){return s instanceof wc?s:new wc(s)},Sg=[],JA=function(s){s.forEach(function(t){Sg.indexOf(t)<0&&(t(wc,bc),Sg.push(t))})};function QA(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in e)i[e[r]]=r;var n={};s.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var l,c,f=i[this.toHex()];if(f)return f;if(a?.closest){var g=this.toRgb(),u=1/0,d="black";if(!n.length)for(var m in e)n[m]=new s(e[m]).toRgb();for(var _ in e){var x=(l=g,c=n[_],Math.pow(l.r-c.r,2)+Math.pow(l.g-c.g,2)+Math.pow(l.b-c.b,2));x<u&&(u=x,d=_)}return d}},t.string.push([function(a){var l=a.toLowerCase(),c=l==="transparent"?"#0000":e[l];return c?new s(c).toRgb():null},"name"])}JA([QA]);const un=class Ya{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Ya)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((r,n)=>r===e[n]);if(t!==null&&e!==null){const r=Object.keys(t),n=Object.keys(e);return r.length!==n.length?!1:r.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,r]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t??[];const[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,r,n]=Ya.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,r,n]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}normalize(t){let e,i,r,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,i=(a>>8&255)/255,r=(a&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,n=255]=t,e/=255,i/=255,r/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const l=Ya.HEX_PATTERN.exec(t);l&&(t=`#${l[2]}`)}const a=qi(t);a.isValid()&&({r:e,g:i,b:r,a:n}=a.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,n)=>{t[n]=Math.min(Math.max(r,e),i)}),t)}};un.shared=new un,un.temp=new un,un.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let oe=un;function tE(s){return Ht("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),oe.shared.setValue(s).toHex()}function eE(s){return Ht("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),oe.shared.setValue(s).toNumber()}function iE(){const s=[],t=[];for(let i=0;i<32;i++)s[i]=i,t[i]=i;s[Rt.NORMAL_NPM]=Rt.NORMAL,s[Rt.ADD_NPM]=Rt.ADD,s[Rt.SCREEN_NPM]=Rt.SCREEN,t[Rt.NORMAL]=Rt.NORMAL_NPM,t[Rt.ADD]=Rt.ADD_NPM,t[Rt.SCREEN]=Rt.SCREEN_NPM;const e=[];return e.push(t),e.push(s),e}const ry=iE();function sy(s,t){return ry[t?1:0][s]}function rE(s,t=null){const e=s*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,r=0;i<e;i+=6,r+=4)t[i+0]=r+0,t[i+1]=r+1,t[i+2]=r+2,t[i+3]=r+0,t[i+4]=r+2,t[i+5]=r+3;return t}function ny(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function sh(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Ag(s){return!(s&s-1)&&!!s}function Eg(s){let t=(s>65535?1:0)<<4;s>>>=t;let e=(s>255?1:0)<<3;return s>>>=e,t|=e,e=(s>15?1:0)<<2,s>>>=e,t|=e,e=(s>3?1:0)<<1,s>>>=e,t|=e,t|s>>1}function xn(s,t,e){const i=s.length;let r;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(r=t;r<n;++r)s[r]=s[r+e];s.length=n}function Jr(s){return s===0?0:s<0?-1:1}let sE=0;function ks(){return++sE}const Tc=class{constructor(s,t,e,i){this.left=s,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Tc.EMPTY=new Tc(0,0,0,0);let Cg=Tc;const Mg={},Yi=Object.create(null),zr=Object.create(null);class nE{constructor(t,e,i){this._canvas=ft.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||ft.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Ig(s,t,e){for(let i=0,r=4*e*t;i<t;++i,r+=4)if(s[r+3]!==0)return!1;return!0}function Pg(s,t,e,i,r){const n=4*t;for(let a=i,l=i*n+4*e;a<=r;++a,l+=n)if(s[l+3]!==0)return!1;return!0}function oE(s){const{width:t,height:e}=s,i=s.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const r=i.getImageData(0,0,t,e).data;let n=0,a=0,l=t-1,c=e-1;for(;a<e&&Ig(r,t,a);)++a;if(a===e)return Cg.EMPTY;for(;Ig(r,t,c);)--c;for(;Pg(r,t,n,a,c);)++n;for(;Pg(r,t,l,a,c);)--l;return++l,++c,new Cg(n,a,l,c)}function aE(s){const t=oE(s),{width:e,height:i}=t;let r=null;if(!t.isEmpty()){const n=s.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:r}}function hE(s,t=globalThis.location){if(s.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Mr(s,t=1){const e=ft.RETINA_PREFIX?.exec(s);return e?parseFloat(e[1]):t}var lt=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(lt||{});const Sc=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Rg=(s,t)=>Sc(s).priority??t,wt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Sc).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...s){return s.map(Sc).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e]?.(t):(r[e]=r[e]||[],r[e]?.push(t))})}),this},handle(s,t,e){const i=this._addHandlers,r=this._removeHandlers;if(i[s]||r[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,r[s]=e;const n=this._queue;return n[s]&&(n[s]?.forEach(a=>t(a)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,n)=>Rg(n,e)-Rg(r,e)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})}};class Ac{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const lE=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function uE(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function cE(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=lE.replace(/%forloop%/gi,uE(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}return s}const Yu=0,ju=1,Ku=2,Zu=3,Ju=4,Qu=5;class ar{constructor(){this.data=0,this.blendMode=Rt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Yu)}set blend(t){!!(this.data&1<<Yu)!==t&&(this.data^=1<<Yu)}get offsets(){return!!(this.data&1<<ju)}set offsets(t){!!(this.data&1<<ju)!==t&&(this.data^=1<<ju)}get culling(){return!!(this.data&1<<Ku)}set culling(t){!!(this.data&1<<Ku)!==t&&(this.data^=1<<Ku)}get depthTest(){return!!(this.data&1<<Zu)}set depthTest(t){!!(this.data&1<<Zu)!==t&&(this.data^=1<<Zu)}get depthMask(){return!!(this.data&1<<Qu)}set depthMask(t){!!(this.data&1<<Qu)!==t&&(this.data^=1<<Qu)}get clockwiseFrontFace(){return!!(this.data&1<<Ju)}set clockwiseFrontFace(t){!!(this.data&1<<Ju)!==t&&(this.data^=1<<Ju)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Rt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new ar;return t.depthTest=!1,t.blend=!0,t}}ar.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Ec=[];function oy(s,t){if(!s)return null;let e="";if(typeof s=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);i&&(e=i[1].toLowerCase())}for(let i=Ec.length-1;i>=0;--i){const r=Ec[i];if(r.test&&r.test(s,e))return new r(s,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class ki{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,r,n,a,l,c){if(arguments.length>8)throw new Error("max arguments reached");const{name:f,items:g}=this;this._aliasCount++;for(let u=0,d=g.length;u<d;u++)g[u][f](t,e,i,r,n,a,l,c);return g===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(ki.prototype,{dispatch:{value:ki.prototype.emit},run:{value:ki.prototype.emit}});class To{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new ki("setRealSize"),this.onUpdate=new ki("update"),this.onError=new ki("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Ah extends To{constructor(t,e){const{width:i,height:r}=e||{};if(!i||!r)throw new Error("BufferResource width or height invalid");super(i,r),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const r=t.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ye.UNPACK);const n=e.realWidth,a=e.realHeight;return i.width===n&&i.height===a?r.texSubImage2D(e.target,0,0,0,n,a,e.format,i.type,this.data):(i.width=n,i.height=a,r.texImage2D(e.target,0,i.internalFormat,n,a,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const dE={scaleMode:Sr.NEAREST,alphaMode:Ye.NPM},Cc=class cn extends rs{constructor(t=null,e=null){super(),e=Object.assign({},cn.defaultOptions,e);const{alphaMode:i,mipmap:r,anisotropicLevel:n,scaleMode:a,width:l,height:c,wrapMode:f,format:g,type:u,target:d,resolution:m,resourceOptions:_}=e;t&&!(t instanceof To)&&(t=oy(t,_),t.internal=!0),this.resolution=m||ft.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((c||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=n,this._wrapMode=f,this._scaleMode=a,this.format=g,this.type=u,this.target=d,this.alphaMode=i,this.uid=ks(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&c>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ag(this.realWidth)&&Ag(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete zr[this.cacheId],delete Yi[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),cn.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=ft.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let n=null;if(r)n=t;else{if(!t._pixiId){const l=e?.pixiIdPrefix||"pixiid";t._pixiId=`${l}_${ks()}`}n=t._pixiId}let a=zr[n];if(r&&i&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new cn(t,e),a.cacheId=n,cn.addToCache(a,n)),a}static fromBuffer(t,e,i,r){t=t||new Float32Array(e*i*4);const n=new Ah(t,{width:e,height:i,...r?.resourceOptions});let a,l;return t instanceof Float32Array?(a=at.RGBA,l=Et.FLOAT):t instanceof Int32Array?(a=at.RGBA_INTEGER,l=Et.INT):t instanceof Uint32Array?(a=at.RGBA_INTEGER,l=Et.UNSIGNED_INT):t instanceof Int16Array?(a=at.RGBA_INTEGER,l=Et.SHORT):t instanceof Uint16Array?(a=at.RGBA_INTEGER,l=Et.UNSIGNED_SHORT):t instanceof Int8Array?(a=at.RGBA,l=Et.BYTE):(a=at.RGBA,l=Et.UNSIGNED_BYTE),n.internal=!0,new cn(n,Object.assign({},dE,{type:l,format:a},r))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),zr[e]&&zr[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),zr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=zr[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete zr[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete zr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Cc.defaultOptions={mipmap:or.POW2,anisotropicLevel:0,scaleMode:Sr.LINEAR,wrapMode:ts.CLAMP,alphaMode:Ye.UNPACK,target:vn.TEXTURE_2D,format:at.RGBA,type:Et.UNSIGNED_BYTE},Cc._globalBatch=0;let Ot=Cc;class Mc{constructor(){this.texArray=null,this.blend=0,this.type=ir.TRIANGLES,this.start=0,this.size=0,this.data=null}}let fE=0;class _e{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=fE++,this.disposeRunner=new ki("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?sr.ELEMENT_ARRAY_BUFFER:sr.ARRAY_BUFFER}get index(){return this.type===sr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new _e(t)}}class nh{constructor(t,e=0,i=!1,r=Et.FLOAT,n,a,l,c=1){this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=n,this.start=a,this.instance=l,this.divisor=c}destroy(){this.buffer=null}static from(t,e,i,r,n){return new nh(t,e,i,r,n)}}const pE={Float32Array,Uint32Array,Int32Array,Uint8Array};function mE(s,t){let e=0,i=0;const r={};for(let c=0;c<s.length;c++)i+=t[c],e+=s[c].length;const n=new ArrayBuffer(e*4);let a=null,l=0;for(let c=0;c<s.length;c++){const f=t[c],g=s[c],u=ny(g);r[u]||(r[u]=new pE[u](n)),a=r[u];for(let d=0;d<g.length;d++){const m=(d/f|0)*i+l,_=d%f;a[m+_]=g[d]}l+=f}return new Float32Array(n)}const Fg={5126:4,5123:2,5121:1};let gE=0;const _E={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class es{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=gE++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ki("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,r=!1,n,a,l,c=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof _e||(e instanceof Array&&(e=new Float32Array(e)),e=new _e(e));const f=t.split("|");if(f.length>1){for(let u=0;u<f.length;u++)this.addAttribute(f[u],e,i,r,n);return this}let g=this.buffers.indexOf(e);return g===-1&&(this.buffers.push(e),g=this.buffers.length-1),this.attributes[t]=new nh(g,i,r,n,a,l,c),this.instanced=this.instanced||c,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof _e||(t instanceof Array&&(t=new Uint16Array(t)),t=new _e(t)),t.type=sr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new _e;let r;for(r in this.attributes){const n=this.attributes[r],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*Fg[n.type]/4),n.buffer=0}for(i.data=mE(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new es;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new _e(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new nh(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=sr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new es,i=[],r=[],n=[];let a;for(let l=0;l<t.length;l++){a=t[l];for(let c=0;c<a.buffers.length;c++)r[c]=r[c]||0,r[c]+=a.buffers[c].data.length,n[c]=0}for(let l=0;l<a.buffers.length;l++)i[l]=new _E[ny(a.buffers[l].data)](r[l]),e.buffers[l]=new _e(i[l]);for(let l=0;l<t.length;l++){a=t[l];for(let c=0;c<a.buffers.length;c++)i[c].set(a.buffers[c].data,n[c]),n[c]+=a.buffers[c].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=sr.ELEMENT_ARRAY_BUFFER;let l=0,c=0,f=0,g=0;for(let u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){g=u;break}for(const u in a.attributes){const d=a.attributes[u];(d.buffer|0)===g&&(c+=d.size*Fg[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let m=0;m<d.length;m++)e.indexBuffer.data[m+f]+=l;l+=t[u].buffers[g].data.length/c,f+=d.length}}return e}}class ay extends es{constructor(t=!1){super(),this._buffer=new _e(null,t,!1),this._indexBuffer=new _e(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Et.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Et.FLOAT).addAttribute("aColor",this._buffer,4,!0,Et.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Et.FLOAT).addIndex(this._indexBuffer)}}const oh=Math.PI*2,yE=180/Math.PI,vE=Math.PI/180;var Re=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(Re||{});class zt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new zt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}zt.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Aa=[new zt,new zt,new zt,new zt];class Dt{constructor(t=0,e=0,i=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=Re.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Dt(0,0,0,0)}clone(){return new Dt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const B=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=B)return!1;const X=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>X}const i=this.left,r=this.right,n=this.top,a=this.bottom;if(r<=i||a<=n)return!1;const l=Aa[0].set(t.left,t.top),c=Aa[1].set(t.left,t.bottom),f=Aa[2].set(t.right,t.top),g=Aa[3].set(t.right,t.bottom);if(f.x<=l.x||c.y<=l.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(l,l),e.apply(c,c),e.apply(f,f),e.apply(g,g),Math.max(l.x,c.x,f.x,g.x)<=i||Math.min(l.x,c.x,f.x,g.x)>=r||Math.max(l.y,c.y,f.y,g.y)<=n||Math.min(l.y,c.y,f.y,g.y)>=a))return!1;const d=u*(c.y-l.y),m=u*(l.x-c.x),_=d*i+m*n,x=d*r+m*n,v=d*i+m*a,b=d*r+m*a;if(Math.max(_,x,v,b)<=d*l.x+m*l.y||Math.min(_,x,v,b)>=d*g.x+m*g.y)return!1;const S=u*(l.y-f.y),T=u*(f.x-l.x),C=S*i+T*n,I=S*r+T*n,k=S*i+T*a,E=S*r+T*a;return!(Math.max(C,I,k,E)<=S*l.x+T*l.y||Math.min(C,I,k,E)>=S*g.x+T*g.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this}}Dt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Eh{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Re.CIRC}clone(){return new Eh(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=i}getBounds(){return new Dt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Eh.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Ch{constructor(t=0,e=0,i=0,r=0){this.x=t,this.y=e,this.width=i,this.height=r,this.type=Re.ELIP}clone(){return new Ch(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,r=(e-this.y)/this.height;return i*=i,r*=r,i+r<=1}getBounds(){return new Dt(this.x-this.width,this.y-this.height,this.width,this.height)}}Ch.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Bs{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let r=0,n=e.length;r<n;r++)i.push(e[r].x,e[r].y);e=i}this.points=e,this.type=Re.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Bs(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const r=this.points.length/2;for(let n=0,a=r-1;n<r;a=n++){const l=this.points[n*2],c=this.points[n*2+1],f=this.points[a*2],g=this.points[a*2+1];c>e!=g>e&&t<(f-l)*((e-c)/(g-c))+l&&(i=!i)}return i}}Bs.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((s,t)=>`${s}, ${t}`,"")}]`};class Mh{constructor(t=0,e=0,i=0,r=0,n=20){this.x=t,this.y=e,this.width=i,this.height=r,this.radius=n,this.type=Re.RREC}clone(){return new Mh(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),n=e-(this.y+i);const a=i*i;if(r*r+n*n<=a||(r=t-(this.x+this.width-i),r*r+n*n<=a)||(n=e-(this.y+this.height-i),r*r+n*n<=a)||(r=t-(this.x+i),r*r+n*n<=a))return!0}return!1}}Mh.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class te{constructor(t=1,e=0,i=0,r=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,n,a){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new zt;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new zt;const i=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return e.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,a=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,e,i,r,n,a,l,c,f){return this.a=Math.cos(l+f)*n,this.b=Math.sin(l+f)*n,this.c=-Math.sin(l-c)*a,this.d=Math.cos(l-c)*a,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,n=this.d,a=t.pivot,l=-Math.atan2(-r,n),c=Math.atan2(i,e),f=Math.abs(l+c);return f<1e-5||Math.abs(oh-f)<1e-5?(t.rotation=c,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=l,t.skew.y=c),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(a.x*e+a.y*r),t.position.y=this.ty+(a.x*i+a.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,a=t*r-e*i;return this.a=r/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-r*n)/a,this.ty=-(t*this.ty-e*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new te;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new te}static get TEMP_MATRIX(){return new te}}te.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Es=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Cs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ms=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Is=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ic=[],hy=[],Ea=Math.sign;function xE(){for(let s=0;s<16;s++){const t=[];Ic.push(t);for(let e=0;e<16;e++){const i=Ea(Es[s]*Es[e]+Ms[s]*Cs[e]),r=Ea(Cs[s]*Es[e]+Is[s]*Cs[e]),n=Ea(Es[s]*Ms[e]+Ms[s]*Is[e]),a=Ea(Cs[s]*Ms[e]+Is[s]*Is[e]);for(let l=0;l<16;l++)if(Es[l]===i&&Cs[l]===r&&Ms[l]===n&&Is[l]===a){t.push(l);break}}}for(let s=0;s<16;s++){const t=new te;t.set(Es[s],Cs[s],Ms[s],Is[s],0,0),hy.push(t)}}xE();const ce={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Es[s],uY:s=>Cs[s],vX:s=>Ms[s],vY:s=>Is[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>Ic[s][t],sub:(s,t)=>Ic[s][ce.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?ce.S:ce.N:Math.abs(t)*2<=Math.abs(s)?s>0?ce.E:ce.W:t>0?s>0?ce.SE:ce.SW:s>0?ce.NE:ce.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const r=hy[ce.inv(t)];r.tx=e,r.ty=i,s.append(r)}};class rr{constructor(t,e,i=0,r=0){this._x=i,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new rr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}rr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Pc=class{constructor(){this.worldTransform=new te,this.localTransform=new te,this.position=new rr(this.onChange,this,0,0),this.scale=new rr(this.onChange,this,1,1),this.pivot=new rr(this.onChange,this,0,0),this.skew=new rr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const e=s.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};Pc.IDENTITY=new Pc;let Ih=Pc;Ih.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var bE=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,wE=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Dg(s,t,e){const i=s.createShader(t);return s.shaderSource(i,e),s.compileShader(i),i}function tc(s){const t=new Array(s);for(let e=0;e<t.length;e++)t[e]=!1;return t}function ly(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return tc(2*t);case"bvec3":return tc(3*t);case"bvec4":return tc(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const bn=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,t)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,t)=>s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,t)=>s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,t)=>s.type==="vec3"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],TE={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},SE={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function AE(s,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in s.uniforms){const r=t[i];if(!r){s.uniforms[i]?.group===!0&&(s.uniforms[i].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}const n=s.uniforms[i];let a=!1;for(let l=0;l<bn.length;l++)if(bn[l].test(r,n)){e.push(bn[l].code(i,n)),a=!0;break}if(!a){const l=(r.size===1&&!r.isArray?TE:SE)[r.type].replace("location",`ud["${i}"].location`);e.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const uy={};let Ca=uy;function EE(){if(Ca===uy||Ca?.isContextLost()){const s=ft.ADAPTER.createCanvas();let t;ft.PREFER_ENV>=Us.WEBGL2&&(t=s.getContext("webgl2",{})),t||(t=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ca=t}return Ca}let Ma;function CE(){if(!Ma){Ma=yi.MEDIUM;const s=EE();if(s&&s.getShaderPrecisionFormat){const t=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);t&&(Ma=t.precision?yi.HIGH:yi.MEDIUM)}}return Ma}function Lg(s,t){const e=s.getShaderSource(t).split(`
`).map((f,g)=>`${g}: ${f}`),i=s.getShaderInfoLog(t),r=i.split(`
`),n={},a=r.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!n[f]?(n[f]=!0,!0):!1),l=[""];a.forEach(f=>{e[f-1]=`%c${e[f-1]}%c`,l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const c=e.join(`
`);l[0]=c,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...l),console.groupEnd()}function ME(s,t,e,i){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||Lg(s,e),s.getShaderParameter(i,s.COMPILE_STATUS)||Lg(s,i),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}const IE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function cy(s){return IE[s]}let Ia=null;const Bg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function dy(s,t){if(!Ia){const e=Object.keys(Bg);Ia={};for(let i=0;i<e.length;++i){const r=e[i];Ia[s[r]]=Bg[r]}}return Ia[t]}function Og(s,t,e){if(s.substring(0,9)!=="precision"){let i=t;return t===yi.HIGH&&e!==yi.HIGH&&(i=yi.MEDIUM),`precision ${i} float;
${s}`}else if(e!==yi.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let ao;function PE(){if(typeof ao=="boolean")return ao;try{ao=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ao=!1}return ao}let RE=0;const Pa={},Rc=class dn{constructor(t,e,i="pixi-shader",r={}){this.extra={},this.id=RE++,this.vertexSrc=t||dn.defaultVertexSrc,this.fragmentSrc=e||dn.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Pa[i]?(Pa[i]++,i+=`-${Pa[i]}`):Pa[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Og(this.vertexSrc,dn.defaultVertexPrecision,yi.HIGH),this.fragmentSrc=Og(this.fragmentSrc,dn.defaultFragmentPrecision,CE())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return wE}static get defaultFragmentSrc(){return bE}static from(t,e,i){const r=t+e;let n=Mg[r];return n||(Mg[r]=n=new dn(t,e,i)),n}};Rc.defaultVertexPrecision=yi.HIGH,Rc.defaultFragmentPrecision=Ar.apple.device?yi.HIGH:yi.MEDIUM;let Er=Rc,FE=0;class Ni{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=FE++,this.static=!!e,this.ubo=!!i,t instanceof _e?(this.buffer=t,this.buffer.type=sr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new _e(new Float32Array(1)),this.buffer.type=sr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new Ni(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new Ni(t,e,i)}static uboFrom(t,e){return new Ni(t,e??!0,!0)}}class nr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Ni?this.uniformGroup=e:this.uniformGroup=new Ni(e):this.uniformGroup=new Ni({}),this.disposeRunner=new ki("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const r=e.uniforms[i];if(r.group===!0&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const r=Er.from(t,e);return new nr(r,i)}}class DE{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=Ni.from({uSamplers:i},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Er(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new te,default:this.defaultGroupCache[t]};return new nr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Fc{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function LE(){return!Ar.apple.device}function BE(s){let t=!0;const e=ft.ADAPTER.getNavigator();if(Ar.tablet||Ar.phone){if(Ar.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(Ar.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?s:4}class Ph{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var OE=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,kE=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const po=class Ri extends Ph{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=ay,this.vertexSize=6,this.state=ar.for2d(),this.size=Ri.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??BE(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??LE(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Ht("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return kE}static get defaultFragmentTemplate(){return OE}setShaderGenerator({vertex:t=Ri.defaultVertexSrc,fragment:e=Ri.defaultFragmentTemplate}={}){this.shaderGenerator=new DE(t,e)}contextChange(){const t=this.renderer.gl;ft.PREFER_ENV===Us.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Ri.defaultMaxTextures),this.maxTextures=cE(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Ri,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Mc);for(;e.length<r;)e.push(new Fc);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=Ri._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let l=++Ot._globalBatch,c=0,f=i[0],g=0;r.copyBoundTextures(n,e);for(let u=0;u<this._bufferSize;++u){const d=t[u];t[u]=null,d._batchEnabled!==l&&(f.count>=e&&(r.boundArray(f,n,l,e),this.buildDrawCalls(f,g,u),g=u,f=i[++c],++l),d._batchEnabled=l,d.touched=a,f.elements[f.count++]=d)}f.count>0&&(r.boundArray(f,n,l,e),this.buildDrawCalls(f,g,this._bufferSize),++c,++l);for(let u=0;u<n.length;u++)n[u]=null;Ot._globalBatch=l}buildDrawCalls(t,e,i){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:a,vertexSize:l}=this,c=Ri._drawCallPool;let f=this._dcIndex,g=this._aIndex,u=this._iIndex,d=c[f];d.start=this._iIndex,d.texArray=t;for(let m=e;m<i;++m){const _=r[m],x=_._texture.baseTexture,v=ry[x.alphaMode?1:0][_.blendMode];r[m]=null,e<m&&d.blend!==v&&(d.size=u-d.start,e=m,d=c[++f],d.texArray=t,d.start=u),this.packInterleavedGeometry(_,n,a,g,u),g+=_.vertexData.length/2*l,u+=_.indices.length,d.blend=v}e<i&&(d.size=u-d.start,++f),this._dcIndex=f,this._aIndex=g,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Ri.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,r=Ri._drawCallPool;let n=null;for(let a=0;a<t;a++){const{texArray:l,type:c,size:f,start:g,blend:u}=r[a];n!==l&&(n=l,this.bindAndClearTexArray(l)),this.state.blendMode=u,i.set(this.state),e.drawElements(c,f,e.UNSIGNED_SHORT,g*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ri.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=sh(Math.ceil(t/8)),i=Eg(e),r=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new Ac(r*this.vertexSize*4)),n}getIndexBuffer(t){const e=sh(Math.ceil(t/12)),i=Eg(e),r=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(r)),n}packInterleavedGeometry(t,e,i,r,n){const{uint32View:a,float32View:l}=e,c=r/this.vertexSize,f=t.uvs,g=t.indices,u=t.vertexData,d=t._texture.baseTexture._batchLocation,m=Math.min(t.worldAlpha,1),_=oe.shared.setValue(t._tintRGB).toPremultiplied(m,t._texture.baseTexture.alphaMode>0);for(let x=0;x<u.length;x+=2)l[r++]=u[x],l[r++]=u[x+1],l[r++]=f[x],l[r++]=f[x+1],a[r++]=_,l[r++]=d;for(let x=0;x<g.length;x++)i[n++]=c+g[x]}};po.defaultBatchSize=4096,po.extension={name:"batch",type:lt.RendererPlugin},po._drawCallPool=[],po._textureArrayPool=[];let Ps=po;wt.add(Ps);var NE=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,UE=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Dc=class mo extends nr{constructor(t,e,i){const r=Er.from(t||mo.defaultVertexSrc,e||mo.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=mo.defaultResolution,this.multisample=mo.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ar}apply(t,e,i,r,n){t.applyFilter(this,e,i,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return UE}static get defaultFragmentSrc(){return NE}};Dc.defaultResolution=1,Dc.defaultMultisample=ye.NONE;let Ge=Dc;class ah{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new oe(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:r}=t,n=i??e;n!==void 0&&(this.color=n),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}ah.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},ah.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"background"};wt.add(ah);class fy{constructor(t){this.renderer=t,this.emptyRenderer=new Ph(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,i,r){const{elements:n,ids:a,count:l}=t;let c=0;for(let f=0;f<l;f++){const g=n[f],u=g._batchLocation;if(u>=0&&u<r&&e[u]===g){a[f]=u;continue}for(;c<r;){const d=e[c];if(d&&d._batchEnabled===i&&d._batchLocation===c){c++;continue}a[f]=c,g._batchLocation=c,e[c]=g;break}}}destroy(){this.renderer=null}}fy.extension={type:lt.RendererSystem,name:"batch"};wt.add(fy);let kg=0;class hh{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=kg++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=kg++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(ft.PREFER_ENV>=Us.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}hh.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},hh.extension={type:lt.RendererSystem,name:"context"};wt.add(hh);class Lc{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ki("disposeFramebuffer"),this.multisample=ye.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Ot(null,{scaleMode:Sr.NEAREST,resolution:1,mipmap:or.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Ot(null,{scaleMode:Sr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:or.OFF,format:at.DEPTH_COMPONENT,type:Et.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const r=this.colorTextures[i],n=r.resolution;r.setSize(t/n,e/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class py extends Ot{constructor(t={}){if(typeof t=="number"){const e=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];t={width:e,height:i,scaleMode:r,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=ye.NONE),super(null,t),this.mipmap=or.OFF,this.valid=!0,this._clear=new oe([0,0,0,0]),this.framebuffer=new Lc(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ir extends To{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,r=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(i,r),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=hE(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,r){const n=t.gl,a=e.realWidth,l=e.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ye.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&i.width===a&&i.height===l?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,r):(i.width=a,i.height=l,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,r)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class my extends Ir{constructor(t,e){if(e=e||{},typeof t=="string"){const i=new Image;Ir.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??ft.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(r=>r.blob()).then(r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ye.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let r=!0;const n=e._glTextures;for(const a in n){const l=n[a];if(l!==i&&l.dirtyId!==e.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class md{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const r=e.width,n=e.height;if(i){const a=t.width/2/r,l=t.height/2/n,c=t.x/r+a,f=t.y/n+l;i=ce.add(i,ce.NW),this.x0=c+a*ce.uX(i),this.y0=f+l*ce.uY(i),i=ce.add(i,2),this.x1=c+a*ce.uX(i),this.y1=f+l*ce.uY(i),i=ce.add(i,2),this.x2=c+a*ce.uX(i),this.y2=f+l*ce.uY(i),i=ce.add(i,2),this.x3=c+a*ce.uX(i),this.y3=f+l*ce.uY(i)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}md.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Ng=new md;function Ra(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class ct extends rs{constructor(t,e,i,r,n,a,l){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Dt(0,0,1,1)),t instanceof ct&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this.destroyed=!1,this._uvs=Ng,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new zt(a.x,a.y):new zt(0,0),this.defaultBorders=l,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Yi[e.url]&&ct.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ct.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new ct(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Ng&&(this._uvs=new md),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=ft.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let n=null;if(r)n=t;else if(t instanceof Ot){if(!t.cacheId){const l=e?.pixiIdPrefix||"pixiid";t.cacheId=`${l}-${ks()}`,Ot.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const l=e?.pixiIdPrefix||"pixiid";t._pixiId=`${l}_${ks()}`}n=t._pixiId}let a=Yi[n];if(r&&i&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof Ot)?(e.resolution||(e.resolution=Mr(t)),a=new ct(new Ot(t,e)),a.baseTexture.cacheId=n,Ot.addToCache(a.baseTexture,n),ct.addToCache(a,n)):!a&&t instanceof Ot&&(a=new ct(t),ct.addToCache(a,n)),a}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),r=ct.from(t,Object.assign({resourceOptions:i},e),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then(()=>Promise.resolve(r))}static fromBuffer(t,e,i,r){return new ct(Ot.fromBuffer(t,e,i,r))}static fromLoader(t,e,i,r){const n=new Ot(t,Object.assign({scaleMode:Ot.defaultOptions.scaleMode,resolution:Mr(e)},r)),{resource:a}=n;a instanceof my&&(a.url=e);const l=new ct(n);return i||(i=e),Ot.addToCache(l.baseTexture,i),ct.addToCache(l,i),i!==e&&(Ot.addToCache(l.baseTexture,e),ct.addToCache(l,e)),l.baseTexture.valid?Promise.resolve(l):new Promise(c=>{l.baseTexture.once("loaded",()=>c(l))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Yi[e]&&Yi[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Yi[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Yi[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Yi[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Yi[t.textureCacheIds[e]]===t&&delete Yi[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:r,height:n}=t,a=e+r>this.baseTexture.width,l=i+n>this.baseTexture.height;if(a||l){const c=a&&l?"and":"or",f=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,g=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${f} ${c} ${g}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return ct._EMPTY||(ct._EMPTY=new ct(new Ot),Ra(ct._EMPTY),Ra(ct._EMPTY.baseTexture)),ct._EMPTY}static get WHITE(){if(!ct._WHITE){const t=ft.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),ct._WHITE=new ct(Ot.from(t)),Ra(ct._WHITE),Ra(ct._WHITE.baseTexture)}return ct._WHITE}}class Gs extends ct{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const r=this.baseTexture.resolution,n=Math.round(t*r)/r,a=Math.round(e*r)/r;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Gs(new py(t))}}class gy{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=ye.NONE){const r=new py(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Gs(r)}getOptimalTexture(t,e,i=1,r=ye.NONE){let n;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=sh(t),e=sh(e),n=((t&65535)<<16|e&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,r)),a.filterPoolKey=n,a.setResolution(i),a}getFilterTexture(t,e,i){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||ye.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}gy.SCREEN_KEY=-1;class GE extends es{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class _y extends es{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new _e(this.vertices),this.uvBuffer=new _e(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class HE{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ye.NONE,this.sourceFrame=new Dt,this.destinationFrame=new Dt,this.bindingSourceFrame=new Dt,this.bindingDestinationFrame=new Dt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Fa=[new zt,new zt,new zt,new zt],ec=new te;class yy{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new gy,this.statePool=[],this.quad=new GE,this.quadUv=new _y,this.tempRect=new Dt,this.activeState={},this.globalUniforms=new Ni({outputFrame:new Dt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new HE,a=i.renderTexture;let l,c;if(a.current){const v=a.current;l=v.resolution,c=v.multisample}else l=i.resolution,c=i.multisample;let f=e[0].resolution||l,g=e[0].multisample??c,u=e[0].padding,d=e[0].autoFit,m=e[0].legacy??!0;for(let v=1;v<e.length;v++){const b=e[v];f=Math.min(f,b.resolution||l),g=Math.min(g,b.multisample??c),u=this.useMaxPadding?Math.max(u,b.padding):u+b.padding,d=d&&b.autoFit,m=m||(b.legacy??!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),r.push(n),n.resolution=f,n.multisample=g,n.legacy=m,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(u);const _=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(ec.copyFrom(i.projection.transform).invert(),_),d?(n.sourceFrame.fit(_),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(_)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,f,g),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const x=this.tempRect;x.x=0,x.y=0,x.width=n.sourceFrame.width,x.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,x),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const n=r.inputSize,a=r.inputPixel,l=r.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],l[0]=.5*a[2],l[1]=.5*a[3],l[2]=e.sourceFrame.width*n[2]-.5*a[2],l[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){const f=r.filterArea;f[0]=e.destinationFrame.width,f[1]=e.destinationFrame.height,f[2]=e.sourceFrame.x,f[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const c=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,c.renderTexture,tr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let f=e.renderTexture,g=this.getOptimalFilterTexture(f.width,f.height,e.resolution);g.filterFrame=f.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&e.multisample>1&&(g=this.getOptimalFilterTexture(f.width,f.height,e.resolution),g.filterFrame=f.filterFrame),i[u].apply(this,f,g,tr.CLEAR,e);const d=f;f=g,g=d}i[u].apply(this,f,c.renderTexture,tr.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(f),this.returnFilterTexture(g)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=tr.CLEAR){const{renderTexture:i,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,i.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=r.stateId&1||this.forceClear;(e===tr.CLEAR||e===tr.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,r){const n=this.renderer;n.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(ir.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(ir.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:r}=this.activeState,{orig:n}=e._texture,a=t.set(r.width,0,0,r.height,i.x,i.y),l=e.worldTransform.copyTo(te.TEMP_MATRIX);return l.invert(),a.prepend(l),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,r=ye.NONE){return this.texturePool.getOptimalTexture(t,e,i,r)}getFilterTexture(t,e,i){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||ye.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Fa[0],r=Fa[1],n=Fa[2],a=Fa[3];i.set(e.left,e.top),r.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(i,i),t.apply(r,r),t.apply(n,n),t.apply(a,a);const l=Math.min(i.x,r.x,n.x,a.x),c=Math.min(i.y,r.y,n.y,a.y),f=Math.max(i.x,r.x,n.x,a.x),g=Math.max(i.y,r.y,n.y,a.y);e.x=l,e.y=c,e.width=f-l,e.height=g-c}roundFrame(t,e,i,r,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){const{a,b:l,c,d:f}=n;if((Math.abs(l)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(f)>1e-4))return}n=n?ec.copyFrom(n):ec.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}yy.extension={type:lt.RendererSystem,name:"filter"};wt.add(yy);class VE{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ye.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const WE=new Dt;class vy{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Lc(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Dt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;ft.PREFER_ENV===Us.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=r=>e.drawBuffersWEBGL(r):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:r}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const l=t.colorTextures[a];this.renderer.texture.unbind(l.parentTextureArray||l)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>i,l=e.height>>i,c=a/e.width;this.setViewport(e.x*c,e.y*c,a,l)}else{const a=t.width>>i,l=t.height>>i;this.setViewport(0,0,a,l)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,r){const n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),(n.width!==i||n.height!==r||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=r,this.gl.viewport(t,e,i,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,r,n=xc.COLOR|xc.DEPTH){const{gl:a}=this;a.clearColor(t,e,i,r),a.clear(n)}initFramebuffer(t){const{gl:e}=this,i=new VE(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let a;this.renderer.context.webGLVersion===1?a=e.DEPTH_STENCIL:t.depth&&t.stencil?a=e.DEPTH24_STENCIL8:t.depth?a=e.DEPTH_COMPONENT24:a=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,a,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,a,t.width,t.height)}const r=t.colorTextures;let n=r.length;e.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const l=r[a],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),a===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;i.drawBuffers||(a=Math.min(a,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer():r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const l=[];for(let c=0;c<a;c++){const f=n[c],g=f.parentTextureArray||f;this.renderer.texture.bind(g,0),c===0&&r.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,g._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+c,f.target,g._glTextures[this.CONTEXT_UID].texture,e),l.push(i.COLOR_ATTACHMENT0+c))}if(l.length>1&&i.drawBuffers(l),t.depthTexture&&this.writeDepthTexture){const c=t.depthTexture;this.renderer.texture.bind(c,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){r.stencil=r.stencil||i.createRenderbuffer();let c,f;this.renderer.context.webGLVersion===1?(c=i.DEPTH_STENCIL_ATTACHMENT,f=i.DEPTH_STENCIL):t.depth&&t.stencil?(c=i.DEPTH_STENCIL_ATTACHMENT,f=i.DEPTH24_STENCIL8):t.depth?(c=i.DEPTH_ATTACHMENT,f=i.DEPTH_COMPONENT24):(c=i.STENCIL_ATTACHMENT,f=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,f,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,f,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,c,i.RENDERBUFFER,r.stencil)}else r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=ye.NONE;if(t<=1||e===null)return i;for(let r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return i===1&&(i=ye.NONE),i}blit(t,e,i){const{current:r,renderer:n,gl:a,CONTEXT_UID:l}=this;if(n.context.webGLVersion!==2||!r)return;const c=r.glFramebuffers[l];if(!c)return;if(!t){if(!c.msaaBuffer)return;const g=r.colorTextures[0];if(!g)return;c.blitFramebuffer||(c.blitFramebuffer=new Lc(r.width,r.height),c.blitFramebuffer.addColorTexture(0,g)),t=c.blitFramebuffer,t.colorTextures[0]!==g&&(t.colorTextures[0]=g,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||(e=WE,e.width=r.width,e.height=r.height),i||(i=e);const f=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,c.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,f?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,r=t.height,n=this.gl,a=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let l,c;this.renderer.context.webGLVersion===1?(l=n.DEPTH_STENCIL_ATTACHMENT,c=n.DEPTH_STENCIL):t.depth?(l=n.DEPTH_STENCIL_ATTACHMENT,c=n.DEPTH24_STENCIL8):(l=n.STENCIL_ATTACHMENT,c=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,c,i,r):n.renderbufferStorage(n.RENDERBUFFER,c,i,r),n.framebufferRenderbuffer(n.FRAMEBUFFER,l,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Dt}destroy(){this.renderer=null}}vy.extension={type:lt.RendererSystem,name:"framebuffer"};wt.add(vy);const ic={5126:4,5123:2,5121:1};class xy{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;ft.PREFER_ENV===Us.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=r=>i.bindVertexArrayOES(r),t.deleteVertexArray=r=>i.deleteVertexArrayOES(r)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(r,n)=>i.vertexAttribDivisorANGLE(r,n),t.drawElementsInstanced=(r,n,a,l,c)=>i.drawElementsInstancedANGLE(r,n,a,l,c),t.drawArraysInstanced=(r,n,a,l)=>i.drawArraysInstancedANGLE(r,n,a,l)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const a=r[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const r=t.buffers[i];e.update(r)}}checkCompatibility(t,e){const i=t.attributes,r=e.attributeData;for(const n in r)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const i=t.attributes,r=e.attributeData,n=["g",t.id];for(const a in i)r[a]&&n.push(a,r[a].location);return n.join("-")}initGeometryVao(t,e,i=!0){const r=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,l=e.program;l.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,l);const c=this.getSignature(t,l),f=t.glVertexArrayObjects[this.CONTEXT_UID];let g=f[c];if(g)return f[l.id]=g,g;const u=t.buffers,d=t.attributes,m={},_={};for(const x in u)m[x]=0,_[x]=0;for(const x in d)!d[x].size&&l.attributeData[x]?d[x].size=l.attributeData[x].size:d[x].size||console.warn(`PIXI Geometry attribute '${x}' size cannot be determined (likely the bound shader does not have the attribute)`),m[d[x].buffer]+=d[x].size*ic[d[x].type];for(const x in d){const v=d[x],b=v.size;v.stride===void 0&&(m[v.buffer]===b*ic[v.type]?v.stride=0:v.stride=m[v.buffer]),v.start===void 0&&(v.start=_[v.buffer],_[v.buffer]+=b*ic[v.type])}g=r.createVertexArray(),r.bindVertexArray(g);for(let x=0;x<u.length;x++){const v=u[x];a.bind(v),i&&v._glBuffers[n].refCount++}return this.activateVao(t,l),f[l.id]=g,f[c]=g,r.bindVertexArray(null),a.unbind(sr.ARRAY_BUFFER),g}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!i){if(a)for(let l=0;l<n.length;l++){const c=n[l]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!e&&a.dispose(n[l],e))}if(!e){for(const l in i)if(l[0]==="g"){const c=i[l];this._activeVao===c&&this.unbind(),r.deleteVertexArray(c)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,l=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let c=null;for(const f in l){const g=l[f],u=a[g.buffer],d=u._glBuffers[r];if(e.attributeData[f]){c!==d&&(n.bind(u),c=d);const m=e.attributeData[f].location;if(i.enableVertexAttribArray(m),i.vertexAttribPointer(m,g.size,g.type||i.FLOAT,g.normalized,g.stride,g.start),g.instance)if(this.hasInstance)i.vertexAttribDivisor(m,g.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,r){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const l=a.indexBuffer.data.BYTES_PER_ELEMENT,c=l===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,c,(i||0)*l,r||1):n.drawElements(t,e||a.indexBuffer.data.length,c,(i||0)*l):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,i,e||a.getSize(),r||1):n.drawArrays(t,i,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}xy.extension={type:lt.RendererSystem,name:"geometry"};wt.add(xy);const Ug=new te;class by{constructor(t,e){this._texture=t,this.mapCoord=new te,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];e[r]=n*i.a+a*i.c+i.tx,e[r+1]=n*i.b+a*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const r=e.orig,n=e.trim;n&&(Ug.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ug));const a=e.baseTexture,l=this.uClampFrame,c=this.clampMargin/a.resolution,f=this.clampOffset;return l[0]=(e._frame.x+c+f)/a.width,l[1]=(e._frame.y+c+f)/a.height,l[2]=(e._frame.x+e._frame.width-c+f)/a.width,l[3]=(e._frame.y+e._frame.height-c+f)/a.height,this.uClampOffset[0]=f/a.realWidth,this.uClampOffset[1]=f/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var XE=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,$E=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class zE extends Ge{constructor(t,e,i){let r=null;typeof t!="string"&&e===void 0&&i===void 0&&(r=t,t=void 0,e=void 0,i=void 0),super(t||$E,e||XE,i),this.maskSprite=r,this.maskMatrix=new te}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,r){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new by(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))}}class qE{constructor(t=null){this.type=be.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ge.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=be.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class wy{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const n=this.maskDataPool.pop()||new qE;n.pooled=!0,n.maskObject=e,i=n}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i._colorMask=r?r._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==be.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case be.SCISSOR:this.renderer.scissor.push(i);break;case be.STENCIL:this.renderer.stencil.push(i);break;case be.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case be.COLOR:this.pushColorMask(i);break}i.type===be.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case be.SCISSOR:this.renderer.scissor.pop(e);break;case be.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case be.SPRITE:this.popSpriteMask(e);break;case be.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===be.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=be.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=be.SCISSOR:t.type=be.STENCIL:t.type=be.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new zE])),r[0].resolution=t.resolution,r[0].multisample=t.multisample,r[0].maskSprite=e;const n=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,r),i.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}wy.extension={type:lt.RendererSystem,name:"mask"};wt.add(wy);class Ty{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==i&&(r===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Gg=new te,Hg=[],Sy=class ja extends Ty{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:r}=this,n=r.renderTexture,a=i.getBounds(!0,Hg.pop()??new Dt);this.roundFrameToPixels(a,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),e&&a.fit(e),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:r,d:n}=t;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||ja.isMatrixRotated(e.worldTransform)||ja.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,r,n){ja.isMatrixRotated(n)||(n=n?Gg.copyFrom(n):Gg.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Hg.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Sy.extension={type:lt.RendererSystem,name:"scissor"};let YE=Sy;wt.add(YE);class Ay extends Ty{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,r=t._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,r,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=i?i._colorMask:15;r!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(i._colorMask=r,e.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ay.extension={type:lt.RendererSystem,name:"stencil"};wt.add(Ay);class Ey{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ht("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Ht("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Ht("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Ey.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"_plugin"};wt.add(Ey);class Cy{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new te,this.transform=null}update(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,i,r){const n=this.projectionMatrix,a=r?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}Cy.extension={type:lt.RendererSystem,name:"projection"};wt.add(Cy);const jE=new Ih,Vg=new Dt;class My{constructor(t){this.renderer=t,this._tempMatrix=new te}generateTexture(t,e){const{region:i,...r}=e||{},n=i?.copyTo(Vg)||t.getLocalBounds(Vg,!0),a=r.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),r.width=n.width,r.height=n.height,r.resolution=a,r.multisample??(r.multisample=this.renderer.multisample);const l=Gs.create(r);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const c=t.transform;return t.transform=jE,this.renderer.render(t,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=c,l}destroy(){}}My.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"textureGenerator"};wt.add(My);const bs=new Dt,ho=new Dt;class Iy{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Dt,this.destinationFrame=new Dt,this.viewportFrame=new Dt}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const r=this.renderer;this.current=t;let n,a,l;t?(n=t.baseTexture,l=n.resolution,e||(bs.width=t.frame.width,bs.height=t.frame.height,e=bs),i||(ho.x=t.frame.x,ho.y=t.frame.y,ho.width=e.width,ho.height=e.height,i=ho),a=n.framebuffer):(l=r.resolution,e||(bs.width=r._view.screen.width,bs.height=r._view.screen.height,e=bs),i||(i=bs,i.width=e.width,i.height=e.height));const c=this.viewportFrame;c.x=i.x*l,c.y=i.y*l,c.width=i.width*l,c.height=i.height*l,t||(c.y=r.view.height-(c.y+c.height)),c.ceil(),this.renderer.framebuffer.bind(a,c),this.renderer.projection.update(i,e,l,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=oe.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,l=n.width!==a.width||n.height!==a.height;if(l){let{x:c,y:f,width:g,height:u}=this.viewportFrame;c=Math.round(c),f=Math.round(f),g=Math.round(g),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(c,f,g,u)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,e),l&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Iy.extension={type:lt.RendererSystem,name:"renderTexture"};wt.add(Iy);class KE{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function ZE(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const n=t.getActiveAttrib(s,r);if(n.name.startsWith("gl_"))continue;const a=dy(t,n.type),l={type:a,name:n.name,size:cy(a),location:t.getAttribLocation(s,n.name)};e[n.name]=l}return e}function JE(s,t){const e={},i=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const n=t.getActiveUniform(s,r),a=n.name.replace(/\[.*?\]$/,""),l=!!n.name.match(/\[.*?\]$/),c=dy(t,n.type);e[a]={name:a,index:r,type:c,size:n.size,isArray:l,value:ly(c,n.size)}}return e}function QE(s,t){const e=Dg(s,s.VERTEX_SHADER,t.vertexSrc),i=Dg(s,s.FRAGMENT_SHADER,t.fragmentSrc),r=s.createProgram();s.attachShader(r,e),s.attachShader(r,i);const n=t.extra?.transformFeedbackVaryings;if(n&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(r,n.names,n.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(r),s.getProgramParameter(r,s.LINK_STATUS)||ME(s,r,e,i),t.attributeData=ZE(r,s),t.uniformData=JE(r,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((c,f)=>c>f?1:-1);for(let c=0;c<l.length;c++)t.attributeData[l[c]].location=c,s.bindAttribLocation(r,c,l[c]);s.linkProgram(r)}s.deleteShader(e),s.deleteShader(i);const a={};for(const l in t.uniformData){const c=t.uniformData[l];a[l]={location:s.getUniformLocation(r,l),value:ly(c.type,c.size)}}return new KE(r,a)}function tC(s,t,e,i,r){e.buffer.update(r)}const eC={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Py={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function iC(s){const t=s.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,i=0,r=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=Py[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,i%e!==0&&i<16){const l=i%e%16;i+=l,r+=l}i+e>16?(r=Math.ceil(r/16)*16,a.offset=r,r+=e,i=e):(a.offset=r,i+=e,r+=e)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function rC(s,t){const e=[];for(const i in s)t[i]&&e.push(t[i]);return e.sort((i,r)=>i.index-r.index),e}function sC(s,t){if(!s.autoManage)return{size:0,syncFunc:tC};const e=rC(s.uniforms,t),{uboElements:i,size:r}=iC(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<i.length;a++){const l=i[a],c=s.uniforms[l.data.name],f=l.data.name;let g=!1;for(let u=0;u<bn.length;u++){const d=bn[u];if(d.codeUbo&&d.test(l.data,c)){n.push(`offset = ${l.offset/4};`,bn[u].codeUbo(l.data.name,c)),g=!0;break}}if(!g)if(l.data.size>1){const u=cy(l.data.type),d=Math.max(Py[l.data.type]/16,1),m=u/d,_=(4-m%4)%4;n.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${l.offset/4};

                t = 0;

                for(var i=0; i < ${l.data.size*d}; i++)
                {
                    for(var j = 0; j < ${m}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${_};
                }

                `)}else{const u=eC[l.data.type];n.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${l.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let nC=0;const Da={textureCount:0,uboCount:0};class Ry{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=nC++}systemCheck(){if(!PE())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(Da.textureCount=0,Da.uboCount=0,this.syncUniformGroup(t.uniformGroup,Da)),r}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=AE(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const r=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),r(i.uniformData,t.uniforms,this.renderer,Da,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let l=this._uboCache[a];if(l||(l=this._uboCache[a]=sC(t,this.shader.program.uniformData)),t.autoManage){const c=new Float32Array(l.size/4);t.buffer.update(c)}return e.uniformGroups[t.id]=l.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const r=t.uniforms,n=[`${i}-`];for(const a in r)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,r=QE(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Ry.extension={type:lt.RendererSystem,name:"shader"};wt.add(Ry);class lh{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}lh.defaultOptions={hello:!1},lh.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"startup"};wt.add(lh);function oC(s,t=[]){return t[Rt.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.ADD]=[s.ONE,s.ONE],t[Rt.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.NONE]=[0,0],t[Rt.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t[Rt.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Rt.SRC_IN]=[s.DST_ALPHA,s.ZERO],t[Rt.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],t[Rt.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[Rt.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],t[Rt.DST_IN]=[s.ZERO,s.SRC_ALPHA],t[Rt.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],t[Rt.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],t[Rt.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[Rt.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],t}const aC=0,hC=1,lC=2,uC=3,cC=4,dC=5,Fy=class Bc{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Rt.NONE,this._blendEq=!1,this.map=[],this.map[aC]=this.setBlend,this.map[hC]=this.setOffset,this.map[lC]=this.setCullFace,this.map[uC]=this.setDepthTest,this.map[cC]=this.setFrontFace,this.map[dC]=this.setDepthMask,this.checks=[],this.defaultState=new ar,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=oC(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Bc.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Bc.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Fy.extension={type:lt.RendererSystem,name:"state"};let fC=Fy;wt.add(fC);class pC extends rs{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(r=>t.systems[r]),i=[...e,...Object.keys(t.systems).filter(r=>!e.includes(r))];for(const r of i)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach(e=>{this.runners[e]=new ki(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const r in this.runners)this.runners[r].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(r=>{const n=i.find(a=>this._systemsHash[a]===r);r[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const go=class Ka{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ka.defaultMaxIdle,this.checkCountMax=Ka.defaultCheckCountMax,this.mode=Ka.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==ld.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let r=0;r<e.length;r++){const n=e[r];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[r]=null,i=!0)}if(i){let r=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[r++]=e[n]);e.length=r}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}};go.defaultMode=ld.AUTO,go.defaultMaxIdle=3600,go.defaultCheckCountMax=600,go.extension={type:lt.RendererSystem,name:"textureGC"};let Rs=go;wt.add(Rs);class rc{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Et.UNSIGNED_BYTE,this.internalFormat=at.RGBA,this.samplerType=0}}function mC(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[s.RGB]:dt.FLOAT,[s.RGBA]:dt.FLOAT,[s.ALPHA]:dt.FLOAT,[s.LUMINANCE]:dt.FLOAT,[s.LUMINANCE_ALPHA]:dt.FLOAT,[s.R8]:dt.FLOAT,[s.R8_SNORM]:dt.FLOAT,[s.RG8]:dt.FLOAT,[s.RG8_SNORM]:dt.FLOAT,[s.RGB8]:dt.FLOAT,[s.RGB8_SNORM]:dt.FLOAT,[s.RGB565]:dt.FLOAT,[s.RGBA4]:dt.FLOAT,[s.RGB5_A1]:dt.FLOAT,[s.RGBA8]:dt.FLOAT,[s.RGBA8_SNORM]:dt.FLOAT,[s.RGB10_A2]:dt.FLOAT,[s.RGB10_A2UI]:dt.FLOAT,[s.SRGB8]:dt.FLOAT,[s.SRGB8_ALPHA8]:dt.FLOAT,[s.R16F]:dt.FLOAT,[s.RG16F]:dt.FLOAT,[s.RGB16F]:dt.FLOAT,[s.RGBA16F]:dt.FLOAT,[s.R32F]:dt.FLOAT,[s.RG32F]:dt.FLOAT,[s.RGB32F]:dt.FLOAT,[s.RGBA32F]:dt.FLOAT,[s.R11F_G11F_B10F]:dt.FLOAT,[s.RGB9_E5]:dt.FLOAT,[s.R8I]:dt.INT,[s.R8UI]:dt.UINT,[s.R16I]:dt.INT,[s.R16UI]:dt.UINT,[s.R32I]:dt.INT,[s.R32UI]:dt.UINT,[s.RG8I]:dt.INT,[s.RG8UI]:dt.UINT,[s.RG16I]:dt.INT,[s.RG16UI]:dt.UINT,[s.RG32I]:dt.INT,[s.RG32UI]:dt.UINT,[s.RGB8I]:dt.INT,[s.RGB8UI]:dt.UINT,[s.RGB16I]:dt.INT,[s.RGB16UI]:dt.UINT,[s.RGB32I]:dt.INT,[s.RGB32UI]:dt.UINT,[s.RGBA8I]:dt.INT,[s.RGBA8UI]:dt.UINT,[s.RGBA16I]:dt.INT,[s.RGBA16UI]:dt.UINT,[s.RGBA32I]:dt.INT,[s.RGBA32UI]:dt.UINT,[s.DEPTH_COMPONENT16]:dt.FLOAT,[s.DEPTH_COMPONENT24]:dt.FLOAT,[s.DEPTH_COMPONENT32F]:dt.FLOAT,[s.DEPTH_STENCIL]:dt.FLOAT,[s.DEPTH24_STENCIL8]:dt.FLOAT,[s.DEPTH32F_STENCIL8]:dt.FLOAT}:t={[s.RGB]:dt.FLOAT,[s.RGBA]:dt.FLOAT,[s.ALPHA]:dt.FLOAT,[s.LUMINANCE]:dt.FLOAT,[s.LUMINANCE_ALPHA]:dt.FLOAT,[s.DEPTH_STENCIL]:dt.FLOAT},t}function gC(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[Et.UNSIGNED_BYTE]:{[at.RGBA]:s.RGBA8,[at.RGB]:s.RGB8,[at.RG]:s.RG8,[at.RED]:s.R8,[at.RGBA_INTEGER]:s.RGBA8UI,[at.RGB_INTEGER]:s.RGB8UI,[at.RG_INTEGER]:s.RG8UI,[at.RED_INTEGER]:s.R8UI,[at.ALPHA]:s.ALPHA,[at.LUMINANCE]:s.LUMINANCE,[at.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[Et.BYTE]:{[at.RGBA]:s.RGBA8_SNORM,[at.RGB]:s.RGB8_SNORM,[at.RG]:s.RG8_SNORM,[at.RED]:s.R8_SNORM,[at.RGBA_INTEGER]:s.RGBA8I,[at.RGB_INTEGER]:s.RGB8I,[at.RG_INTEGER]:s.RG8I,[at.RED_INTEGER]:s.R8I},[Et.UNSIGNED_SHORT]:{[at.RGBA_INTEGER]:s.RGBA16UI,[at.RGB_INTEGER]:s.RGB16UI,[at.RG_INTEGER]:s.RG16UI,[at.RED_INTEGER]:s.R16UI,[at.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[Et.SHORT]:{[at.RGBA_INTEGER]:s.RGBA16I,[at.RGB_INTEGER]:s.RGB16I,[at.RG_INTEGER]:s.RG16I,[at.RED_INTEGER]:s.R16I},[Et.UNSIGNED_INT]:{[at.RGBA_INTEGER]:s.RGBA32UI,[at.RGB_INTEGER]:s.RGB32UI,[at.RG_INTEGER]:s.RG32UI,[at.RED_INTEGER]:s.R32UI,[at.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[Et.INT]:{[at.RGBA_INTEGER]:s.RGBA32I,[at.RGB_INTEGER]:s.RGB32I,[at.RG_INTEGER]:s.RG32I,[at.RED_INTEGER]:s.R32I},[Et.FLOAT]:{[at.RGBA]:s.RGBA32F,[at.RGB]:s.RGB32F,[at.RG]:s.RG32F,[at.RED]:s.R32F,[at.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[Et.HALF_FLOAT]:{[at.RGBA]:s.RGBA16F,[at.RGB]:s.RGB16F,[at.RG]:s.RG16F,[at.RED]:s.R16F},[Et.UNSIGNED_SHORT_5_6_5]:{[at.RGB]:s.RGB565},[Et.UNSIGNED_SHORT_4_4_4_4]:{[at.RGBA]:s.RGBA4},[Et.UNSIGNED_SHORT_5_5_5_1]:{[at.RGBA]:s.RGB5_A1},[Et.UNSIGNED_INT_2_10_10_10_REV]:{[at.RGBA]:s.RGB10_A2,[at.RGBA_INTEGER]:s.RGB10_A2UI},[Et.UNSIGNED_INT_10F_11F_11F_REV]:{[at.RGB]:s.R11F_G11F_B10F},[Et.UNSIGNED_INT_5_9_9_9_REV]:{[at.RGB]:s.RGB9_E5},[Et.UNSIGNED_INT_24_8]:{[at.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[Et.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[at.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:t={[Et.UNSIGNED_BYTE]:{[at.RGBA]:s.RGBA,[at.RGB]:s.RGB,[at.ALPHA]:s.ALPHA,[at.LUMINANCE]:s.LUMINANCE,[at.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[Et.UNSIGNED_SHORT_5_6_5]:{[at.RGB]:s.RGB},[Et.UNSIGNED_SHORT_4_4_4_4]:{[at.RGBA]:s.RGBA},[Et.UNSIGNED_SHORT_5_5_5_1]:{[at.RGBA]:s.RGBA}},t}class Dy{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ot,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=gC(t),this.samplerTypes=mC(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};const i=new rc(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new rc(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:r}=this;if(i)for(let n=t-1;n>=0;--n){const a=e[n];a&&a._glTextures[r].samplerType!==dt.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new rc(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??dt.FLOAT,this.webGLVersion===2&&t.type===Et.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==dt.FLOAT&&(this.hasIntegerTextures=!0);else{const r=t.realWidth,n=t.realHeight,a=i.gl;(e.width!==r||e.height!==n||e.dirtyId<0)&&(e.width=r,e.height=n,a.texImage2D(t.target,0,e.internalFormat,r,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const r=this.managedTextures.indexOf(t);r!==-1&&xn(this.managedTextures,r,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===or.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=ts.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==or.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Sr.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===Sr.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Sr.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Sr.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Dy.extension={type:lt.RendererSystem,name:"texture"};wt.add(Dy);class Ly{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:r}=this;e&&r.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:r}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[r]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const l=t.buffers[a];l&&(i.buffer.update(l),l._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,l._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const l=t.buffers[a];if(!l)continue;const c=l._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!e&&n.dispose(l,e))}i&&(e||r.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Ly.extension={type:lt.RendererSystem,name:"transformFeedback"};wt.add(Ly);class uh{constructor(t){this.renderer=t}init(t){this.screen=new Dt(0,0,t.width,t.height),this.element=t.view||ft.ADAPTER.createCanvas(),this.resolution=t.resolution||ft.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=i,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",i,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}uh.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},uh.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"_view"};wt.add(uh);ft.PREFER_ENV=Us.WEBGL2;ft.STRICT_TEXTURE_CACHE=!1;ft.RENDER_OPTIONS={...hh.defaultOptions,...ah.defaultOptions,...uh.defaultOptions,...lh.defaultOptions};Object.defineProperties(ft,{WRAP_MODE:{get(){return Ot.defaultOptions.wrapMode},set(s){Ht("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Ot.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return Ot.defaultOptions.scaleMode},set(s){Ht("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Ot.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return Ot.defaultOptions.mipmap},set(s){Ht("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Ot.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return Ot.defaultOptions.anisotropicLevel},set(s){Ht("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Ot.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return Ht("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ge.defaultResolution},set(s){Ge.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return Ht("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ge.defaultMultisample},set(s){Ge.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return Ps.defaultMaxTextures},set(s){Ht("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ps.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return Ps.defaultBatchSize},set(s){Ht("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ps.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return Ps.canUploadSameBuffer},set(s){Ht("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ps.canUploadSameBuffer=s}},GC_MODE:{get(){return Rs.defaultMode},set(s){Ht("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Rs.defaultMode=s}},GC_MAX_IDLE:{get(){return Rs.defaultMaxIdle},set(s){Ht("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Rs.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return Rs.defaultCheckCountMax},set(s){Ht("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Rs.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return Er.defaultVertexPrecision},set(s){Ht("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Er.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return Er.defaultFragmentPrecision},set(s){Ht("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Er.defaultFragmentPrecision=s}}});var Ns=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Ns||{});class sc{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const By=class ii{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new sc(null,null,1/0),this.deltaMS=1/ii.targetFPMS,this.elapsedMS=1/ii.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Ns.NORMAL){return this._addListener(new sc(t,e,i))}addOnce(t,e,i=Ns.NORMAL){return this._addListener(new sc(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ii.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,ii.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ii._shared){const t=ii._shared=new ii;t.autoStart=!0,t._protected=!0}return ii._shared}static get system(){if(!ii._system){const t=ii._system=new ii;t.autoStart=!0,t._protected=!0}return ii._system}};By.targetFPMS=.06;let He=By;Object.defineProperties(ft,{TARGET_FPMS:{get(){return He.targetFPMS},set(s){Ht("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),He.targetFPMS=s}}});class Oy{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Ns.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?He.shared:new He,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Oy.extension=lt.Application;wt.add(Oy);const ky=[];wt.handleByList(lt.Renderer,ky);function _C(s){for(const t of ky)if(t.test(s))return new t(s);throw new Error("Unable to auto-detect a suitable renderer.")}var yC=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,vC=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const xC=yC,Ny=vC;class Uy{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=ye.HIGH?this.multisample=ye.HIGH:e>=ye.MEDIUM?this.multisample=ye.MEDIUM:e>=ye.LOW?this.multisample=ye.LOW:this.multisample=ye.NONE}destroy(){}}Uy.extension={type:lt.RendererSystem,name:"_multisample"};wt.add(Uy);class bC{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Gy{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,i){const{gl:r,CONTEXT_UID:n}=this;i=i||0;const a=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,a.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new bC(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Gy.extension={type:lt.RendererSystem,name:"buffer"};wt.add(Gy);class Hy{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let r,n,a,l;if(e&&(r=e.renderTexture,n=e.clear,a=e.transform,l=e.skipUpdateTransform),this.renderingToScreen=!r,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(r||(this.lastObjectRendered=t),!l){const c=t.enableTempParent();t.updateTransform(),t.disableTempParent(c)}i.renderTexture.bind(r),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),r&&(e.blit&&i.framebuffer.blit(),r.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Hy.extension={type:lt.RendererSystem,name:"objectRenderer"};wt.add(Hy);const Za=class Oc extends pC{constructor(t){super(),this.type=X_.WEBGL,t=Object.assign({},ft.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ni({projectionMatrix:new te},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Oc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Ht("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Oc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:XA()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ht("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ht("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ht("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ht("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Ht("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Ht("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Ht("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Ht("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Za.extension={type:lt.Renderer,priority:1},Za.__plugins={},Za.__systems={};let gd=Za;wt.handleByMap(lt.RendererPlugin,gd.__plugins);wt.handleByMap(lt.RendererSystem,gd.__systems);wt.add(gd);class Vy extends To{constructor(t,e){const{width:i,height:r}=e||{};super(i,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new Ot;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof To?this.addResourceAt(t[i],i):this.addResourceAt(oy(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}}class wC extends Vy{constructor(t,e){const{width:i,height:r}=e||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:i,height:r}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=vn.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:r,itemDirtyIds:n,items:a}=this,{gl:l}=t;i.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,r,0,e.format,i.type,null);for(let c=0;c<r;c++){const f=a[c];n[c]<f.dirtyId&&(n[c]=f.dirtyId,f.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,c,f.resource.width,f.resource.height,1,e.format,i.type,f.resource.source))}return!0}}class TC extends Ir{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Wy=class _o extends Vy{constructor(t,e){const{width:i,height:r,autoLoad:n,linkBaseTexture:a}=e||{};if(t&&t.length!==_o.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let l=0;l<_o.SIDES;l++)this.items[l].target=vn.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=a!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=vn.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=vn.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const r=this.itemDirtyIds;for(let n=0;n<_o.SIDES;n++){const a=this.items[n];(r[n]<a.dirtyId||i.dirtyId<e.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,i),r[n]=a.dirtyId):r[n]<-1&&(t.gl.texImage2D(a.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),r[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===_o.SIDES}};Wy.SIDES=6;let SC=Wy;class _n extends Ir{constructor(t,e){e=e||{};let i,r,n;typeof t=="string"?(i=_n.EMPTY,r=t,n=!0):(i=t,r=null,n=!1),super(i),this.url=r,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await ft.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ye.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return _n._EMPTY=_n._EMPTY??ft.ADAPTER.createCanvas(0,0),_n._EMPTY}}const kc=class Ja extends Ir{constructor(t,e){e=e||{},super(ft.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Ja.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Ir.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,n=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*e,n=this._overrideHeight||this._overrideWidth/e*i),r=Math.round(r),n=Math.round(n);const a=this.source;a.width=r,a.height=n,a._pixiId=`canvas_${ks()}`,a.getContext("2d").drawImage(t,0,0,e,i,0,0,r,n),this._resolve(),this._resolve=null}}static getSize(t){const e=Ja.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Ja.SVG_XML.test(t)}};kc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,kc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Nc=kc;class AC extends Ir{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const Uc=class Gc extends Ir{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const r=t[0].src||t[0];Ir.crossOrigin(i,r,e.crossorigin);for(let n=0;n<t.length;++n){const a=document.createElement("source");let{src:l,mime:c}=t[n];if(l=l||t[n],l.startsWith("data:"))c=l.slice(5,l.indexOf(";"));else if(!l.startsWith("blob:")){const f=l.split("?").shift().toLowerCase(),g=f.slice(f.lastIndexOf(".")+1);c=c||Gc.MIME_TYPES[g]||`video/${g}`}a.src=l,c&&(a.type=c),i.appendChild(a)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=He.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(He.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(He.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(He.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Gc.TYPES.includes(e)}};Uc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Uc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Xy=Uc;Ec.push(_n,my,TC,Xy,AC,Nc,Ah,SC,wC);class ch{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Dt.EMPTY:(t=t||new Dt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:r,c:n,d:a,tx:l,ty:c}=t,f=i*e.x+n*e.y+l,g=r*e.x+a*e.y+c;this.minX=Math.min(this.minX,f),this.maxX=Math.max(this.maxX,f),this.minY=Math.min(this.minY,g),this.maxY=Math.max(this.maxY,g)}addQuad(t){let e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,a=t[0],l=t[1];e=a<e?a:e,i=l<i?l:i,r=a>r?a:r,n=l>n?l:n,a=t[2],l=t[3],e=a<e?a:e,i=l<i?l:i,r=a>r?a:r,n=l>n?l:n,a=t[4],l=t[5],e=a<e?a:e,i=l<i?l:i,r=a>r?a:r,n=l>n?l:n,a=t[6],l=t[7],e=a<e?a:e,i=l<i?l:i,r=a>r?a:r,n=l>n?l:n,this.minX=e,this.minY=i,this.maxX=r,this.maxY=n}addFrame(t,e,i,r,n){this.addFrameMatrix(t.worldTransform,e,i,r,n)}addFrameMatrix(t,e,i,r,n){const a=t.a,l=t.b,c=t.c,f=t.d,g=t.tx,u=t.ty;let d=this.minX,m=this.minY,_=this.maxX,x=this.maxY,v=a*e+c*i+g,b=l*e+f*i+u;d=v<d?v:d,m=b<m?b:m,_=v>_?v:_,x=b>x?b:x,v=a*r+c*i+g,b=l*r+f*i+u,d=v<d?v:d,m=b<m?b:m,_=v>_?v:_,x=b>x?b:x,v=a*e+c*n+g,b=l*e+f*n+u,d=v<d?v:d,m=b<m?b:m,_=v>_?v:_,x=b>x?b:x,v=a*r+c*n+g,b=l*r+f*n+u,d=v<d?v:d,m=b<m?b:m,_=v>_?v:_,x=b>x?b:x,this.minX=d,this.minY=m,this.maxX=_,this.maxY=x}addVertexData(t,e,i){let r=this.minX,n=this.minY,a=this.maxX,l=this.maxY;for(let c=e;c<i;c+=2){const f=t[c],g=t[c+1];r=f<r?f:r,n=g<n?g:n,a=f>a?f:a,l=g>l?g:l}this.minX=r,this.minY=n,this.maxX=a,this.maxY=l}addVertices(t,e,i,r){this.addVerticesMatrix(t.worldTransform,e,i,r)}addVerticesMatrix(t,e,i,r,n=0,a=n){const l=t.a,c=t.b,f=t.c,g=t.d,u=t.tx,d=t.ty;let m=this.minX,_=this.minY,x=this.maxX,v=this.maxY;for(let b=i;b<r;b+=2){const S=e[b],T=e[b+1],C=l*S+f*T+u,I=g*T+c*S+d;m=Math.min(m,C-n),x=Math.max(x,C+n),_=Math.min(_,I-a),v=Math.max(v,I+a)}this.minX=m,this.minY=_,this.maxX=x,this.maxY=v}addBounds(t){const e=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&r<=a){const l=this.minX,c=this.minY,f=this.maxX,g=this.maxY;this.minX=i<l?i:l,this.minY=r<c?r:c,this.maxX=n>f?n:f,this.maxY=a>g?a:g}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&r<=a){const l=this.minX,c=this.minY,f=this.maxX,g=this.maxY;this.minX=i<l?i:l,this.minY=r<c?r:c,this.maxX=n>f?n:f,this.maxY=a>g?a:g}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,r,n,a){t-=n,e-=a,i+=n,r+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r}}class de extends rs{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ih,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ch,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(de.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Dt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Dt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ch);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,r){return e&&(t=e.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,r=1,n=0,a=0,l=0,c=0,f=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n,this.skew.x=a,this.skew.y=l,this.pivot.x=c,this.pivot.y=f,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new EC),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*yE}set angle(t){this.transform.rotation=t*vE}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class EC extends de{constructor(){super(...arguments),this.sortDirty=null}}de.prototype.displayObjectUpdateTransform=de.prototype.updateTransform;const CC=new te;function MC(s,t){return s.zIndex===t.zIndex?s._lastSortedIndex-t._lastSortedIndex:s.zIndex-t.zIndex}const $y=class Hc extends de{constructor(){super(),this.children=[],this.sortableChildren=Hc.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);xn(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,xn(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,xn(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,r=e,n=r-i;let a;if(n>0&&n<=r){a=this.children.splice(i,n);for(let l=0;l<a.length;++l)a[l].parent=null,a[l].transform&&(a[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let l=0;l<a.length;++l)a[l].emit("removed",this),this.emit("childRemoved",a[l],this,l);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const r=this.children[e];r._lastSortedIndex=e,!t&&r.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(MC),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let r=0,n=this.children.length;r<n;++r){const a=this.children[r];a.visible&&a.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==Hc.prototype._render&&(i=this.getBounds(!0));const n=t.projection.transform;if(n&&(r?(r=CC.copyFrom(r),r.prepend(n)):r=n),i&&e.intersects(i,r))this._render(t);else if(this.cullArea)return;for(let a=0,l=this.children.length;a<l;++a){const c=this.children[a],f=c.cullable;c.cullable=f||!this.cullArea,c.render(t),c.cullable=f}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}const r=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==be.NONE));if(r&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,a=this.children.length;n<a;++n)this.children[n].render(t)}r&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<i.length;++r)i[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};$y.defaultSortableChildren=!1;let Ee=$y;Ee.prototype.containerUpdateTransform=Ee.prototype.updateTransform;Object.defineProperties(ft,{SORTABLE_CHILDREN:{get(){return Ee.defaultSortableChildren},set(s){Ht("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ee.defaultSortableChildren=s}}});const lo=new zt,IC=new Uint16Array([0,1,2,0,2,3]);class hr extends Ee{constructor(t){super(),this._anchor=new rr(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new oe(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Rt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||ct.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=IC,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ft.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Jr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Jr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,r=e.b,n=e.c,a=e.d,l=e.tx,c=e.ty,f=this.vertexData,g=t.trim,u=t.orig,d=this._anchor;let m=0,_=0,x=0,v=0;if(g?(_=g.x-d._x*u.width,m=_+g.width,v=g.y-d._y*u.height,x=v+g.height):(_=-d._x*u.width,m=_+u.width,v=-d._y*u.height,x=v+u.height),f[0]=i*_+n*v+l,f[1]=a*v+r*_+c,f[2]=i*m+n*v+l,f[3]=a*v+r*m+c,f[4]=i*m+n*x+l,f[5]=a*x+r*m+c,f[6]=i*_+n*x+l,f[7]=a*x+r*_+c,this._roundPixels){const b=ft.RESOLUTION;for(let S=0;S<f.length;++S)f[S]=Math.round(f[S]*b)/b}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,r=this._anchor,n=this.transform.worldTransform,a=n.a,l=n.b,c=n.c,f=n.d,g=n.tx,u=n.ty,d=-r._x*i.width,m=d+i.width,_=-r._y*i.height,x=_+i.height;if(e[0]=a*d+c*_+g,e[1]=f*_+l*d+u,e[2]=a*m+c*_+g,e[3]=f*_+l*m+u,e[4]=a*m+c*x+g,e[5]=f*x+l*m+u,e[6]=a*d+c*x+g,e[7]=f*x+l*d+u,this._roundPixels){const v=ft.RESOLUTION;for(let b=0;b<e.length;++b)e[b]=Math.round(e[b]*v)/v}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new ch),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Dt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,lo);const e=this._texture.orig.width,i=this._texture.orig.height,r=-e*this.anchor.x;let n=0;return lo.x>=r&&lo.x<r+e&&(n=-i*this.anchor.y,lo.y>=n&&lo.y<n+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){const e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof ct?t:ct.from(t,e);return new hr(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Jr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Jr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||ct.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const zy=new te;de.prototype._cacheAsBitmap=!1;de.prototype._cacheData=null;de.prototype._cacheAsBitmapResolution=null;de.prototype._cacheAsBitmapMultisample=null;class PC{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(de.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(s){s!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(s){s!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(s){if(this._cacheAsBitmap===s)return;this._cacheAsBitmap=s;let t;s?(this._cacheData||(this._cacheData=new PC),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});de.prototype._renderCached=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(s),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(s))};de.prototype._initCachedDisplayObject=function(s){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,s.batch.flush();const e=this.getLocalBounds(new Dt,!0);if(this.filters?.length){const d=this.filters[0].padding;e.pad(d)}const i=this.cacheAsBitmapResolution||s.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const r=s.renderTexture.current,n=s.renderTexture.sourceFrame.clone(),a=s.renderTexture.destinationFrame.clone(),l=s.projection.transform,c=Gs.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??s.multisample}),f=`cacheAsBitmap_${ks()}`;this._cacheData.textureCacheId=f,Ot.addToCache(c.baseTexture,f),ct.addToCache(c,f);const g=this.transform.localTransform.copyTo(zy).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,s.render(this,{renderTexture:c,clear:!0,transform:g,skipUpdateTransform:!1}),s.framebuffer.blit(),s.projection.transform=l,s.renderTexture.bind(r,n,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new hr(c);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};de.prototype._renderCachedCanvas=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(s),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(s))};de.prototype._initCachedDisplayObjectCanvas=function(s){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new Dt,!0),e=this.alpha;this.alpha=1;const i=s.canvasContext.activeContext,r=s._projTransform,n=this.cacheAsBitmapResolution||s.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);const a=Gs.create({width:t.width,height:t.height,resolution:n}),l=`cacheAsBitmap_${ks()}`;this._cacheData.textureCacheId=l,Ot.addToCache(a.baseTexture,l),ct.addToCache(a,l);const c=zy;this.transform.localTransform.copyTo(c),c.invert(),c.tx-=t.x,c.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,s.render(this,{renderTexture:a,clear:!0,transform:c,skipUpdateTransform:!1}),s.canvasContext.activeContext=i,s._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const f=new hr(a);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(t.x/t.width),f.anchor.y=-(t.y/t.height),f.alpha=e,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=s._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)};de.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};de.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};de.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ot.removeFromCache(this._cacheData.textureCacheId),ct.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};de.prototype._cacheAsBitmapDestroy=function(s){this.cacheAsBitmap=!1,this.destroy(s)};de.prototype.name=null;Ee.prototype.getChildByName=function(s,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===s)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){const r=this.children[e];if(!r.getChildByName)continue;const n=r.getChildByName(s,!0);if(n)return n}return null};de.prototype.getGlobalPosition=function(s=new zt,t=!1){return this.parent?this.parent.toGlobal(this.position,s,t):(s.x=this.position.x,s.y=this.position.y),s};var RC=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class FC extends Ge{constructor(t=1){super(xC,RC,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const DC={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},LC=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function BC(s){const t=DC[s],e=t.length;let i=LC,r="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let l=0;l<s;l++){let c=n.replace("%index%",l.toString());a=l,l>=e&&(a=s-l-1),c=c.replace("%value%",t[a].toString()),r+=c,r+=`
`}return i=i.replace("%blur%",r),i=i.replace("%size%",s.toString()),i}const OC=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function kC(s,t){const e=Math.ceil(s/2);let i=OC,r="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<s;a++){let l=n.replace("%index%",a.toString());l=l.replace("%sampleIndex%",`${a-(e-1)}.0`),r+=l,r+=`
`}return i=i.replace("%blur%",r),i=i.replace("%size%",s.toString()),i}class Vc extends Ge{constructor(t,e=8,i=4,r=Ge.defaultResolution,n=5){const a=kC(n,t),l=BC(n);super(a,l),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,r);else{const n=t.getFilterTexture(),a=t.renderer;let l=e,c=n;this.state.blend=!1,t.applyFilter(this,l,c,tr.CLEAR);for(let f=1;f<this.passes-1;f++){t.bindAndClear(l,tr.BLIT),this.uniforms.uSampler=c;const g=c;c=l,l=g,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,c,i,r),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class NC extends Ge{constructor(t=8,e=4,i=Ge.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Vc(!0,t,e,i,r),this.blurYFilter=new Vc(!1,t,e,i,r),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,r){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const l=t.getFilterTexture();this.blurXFilter.apply(t,e,l,tr.CLEAR),this.blurYFilter.apply(t,l,i,r),t.returnFilterTexture(l)}else a?this.blurYFilter.apply(t,e,i,r):this.blurXFilter.apply(t,e,i,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var UC=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Wc extends Ge{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Ny,UC,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,r,n]=oe.shared.setValue(t).toArray(),a=[i,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),r=Math.sin(t),n=Math.sqrt,a=1/3,l=n(a),c=i+(1-i)*a,f=a*(1-i)-l*r,g=a*(1-i)+l*r,u=a*(1-i)+l*r,d=i+a*(1-i),m=a*(1-i)-l*r,_=a*(1-i)-l*r,x=a*(1-i)+l*r,v=i+a*(1-i),b=[c,f,g,0,0,u,d,m,0,0,_,x,v,0,0,0,0,0,1,0];this._loadMatrix(b,e)}contrast(t,e){const i=(t||0)+1,r=-.5*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const i=t*2/3+1,r=(i-1)*-.5,n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,r,n){t=t||.2,e=e||.15,i=i||16770432,r=r||3375104;const a=oe.shared,[l,c,f]=a.setValue(i).toArray(),[g,u,d]=a.setValue(r).toArray(),m=[.3,.59,.11,0,0,l,c,f,t,0,g,u,d,e,0,l-g,c-u,f-d,0,0];this._loadMatrix(m,n)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Wc.prototype.grayscale=Wc.prototype.greyscale;var GC=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,HC=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class VC extends Ge{constructor(t,e){const i=new te;t.renderable=!1,super(HC,GC,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new zt(e,e)}apply(t,e,i,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,a=Math.sqrt(n.a*n.a+n.b*n.b),l=Math.sqrt(n.c*n.c+n.d*n.d);a!==0&&l!==0&&(this.uniforms.rotation[0]=n.a/a,this.uniforms.rotation[1]=n.b/a,this.uniforms.rotation[2]=n.c/l,this.uniforms.rotation[3]=n.d/l),t.applyFilter(this,e,i,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var WC=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,XC=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class $C extends Ge{constructor(){super(XC,WC)}}var zC=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class qC extends Ge{constructor(t=.5,e=Math.random()){super(Ny,zC,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Wg={AlphaFilter:FC,BlurFilter:NC,BlurFilterPass:Vc,ColorMatrixFilter:Wc,DisplacementFilter:VC,FXAAFilter:$C,NoiseFilter:qC};Object.entries(Wg).forEach(([s,t])=>{Object.defineProperty(Wg,s,{get(){return Ht("7.1.0",`filters.${s} has moved to ${s}`),t}})});class YC{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(He.system.add(this.tickerUpdate,this,Ns.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(He.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Zr=new YC;class Eo{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Eo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new zt,this.page=new zt,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,r,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class dh extends Eo{constructor(){super(...arguments),this.client=new zt,this.movement=new zt,this.offset=new zt,this.global=new zt,this.screen=new zt}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,n,a,l,c,f,g,u,d,m,_,x){throw new Error("Method not implemented.")}}class Fi extends dh{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class wn extends dh{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}wn.DOM_DELTA_PIXEL=0,wn.DOM_DELTA_LINE=1,wn.DOM_DELTA_PAGE=2;const jC=2048,KC=new zt,nc=new zt;class ZC{constructor(t){this.dispatch=new rs,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,r)=>i.priority-r.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,r=e.length;i<r;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Zr.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",r=this[i](this.rootTarget,this.rootTarget.eventMode,KC.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,n=i.length-1;r<n;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(e)?e:[e];for(let n=i.length-1;n>=0;n--)r.forEach(a=>{t.currentTarget=i[n],this.notifyTarget(t,a)})}propagationPath(t){const e=[t];for(let i=0;i<jC&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,r,n,a=!1){let l=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Zr.pauseUpdate=!1),t.interactiveChildren&&t.children){const g=t.children;for(let u=g.length-1;u>=0;u--){const d=g[u],m=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,r,n,a||n(t,i));if(m){if(m.length>0&&!m[m.length-1].parent)continue;const _=t.isInteractive();(m.length>0||_)&&(_&&this._allInteractiveElements.push(t),m.push(t)),this._hitElements.length===0&&(this._hitElements=m),l=!0}}}const c=this._isInteractive(e),f=t.isInteractive();return c&&f&&this._allInteractiveElements.push(t),a||this._hitElements.length>0?null:l?this._hitElements:c&&!n(t,i)&&r(t,i)?f?[t]:[]:null}hitTestRecursive(t,e,i,r,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Zr.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let f=c.length-1;f>=0;f--){const g=c[f],u=this.hitTestRecursive(g,this._isInteractive(e)?e:g.eventMode,i,r,n);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}const a=this._isInteractive(e),l=t.isInteractive();return a&&r(t,i)?l?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,nc),!t.hitArea.contains(nc.x,nc.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;const i=`on${e}`;t.currentTarget[i]?.(t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Fi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const r=e.button===2;this.dispatchEvent(e,r?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Fi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType==="mouse"||e.pointerType==="pen",r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.overTargets);if(r.overTargets?.length>0&&n!==e.target){const c=t.type==="mousemove"?"mouseout":"pointerout",f=this.createPointerEvent(t,c,n);if(this.dispatchEvent(f,"pointerout"),i&&this.dispatchEvent(f,"mouseout"),!e.composedPath().includes(n)){const g=this.createPointerEvent(t,"pointerleave",n);for(g.eventPhase=g.AT_TARGET;g.target&&!e.composedPath().includes(g.target);)g.currentTarget=g.target,this.notifyTarget(g),i&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(f)}if(n!==e.target){const c=t.type==="mousemove"?"mouseover":"pointerover",f=this.clonePointerEvent(e,c);this.dispatchEvent(f,"pointerover"),i&&this.dispatchEvent(f,"mouseover");let g=n?.parent;for(;g&&g!==this.rootTarget.parent&&g!==e.target;)g=g.parent;if(!g||g===this.rootTarget.parent){const u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==n&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(f)}const a=[],l=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(e,"pointermove"),l&&a.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),l&&a.push("globaltouchmove")),i&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),l&&a.push("globalmousemove"),this.cursor=e.target?.cursor),a.length>0&&this.all(e,a),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Fi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),r=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=i.target?.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Fi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",r=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");const a=this.createPointerEvent(t,"pointerleave",r);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Fi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.dispatchEvent(i,l?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]);let a=n;if(n&&!i.composedPath().includes(n)){let l=n;for(;l&&!i.composedPath().includes(l);){if(i.currentTarget=l,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const c=i.button===2;this.notifyTarget(i,c?"rightupoutside":"mouseupoutside")}l=l.parent}delete r.pressTargetsByButton[t.button],a=l}if(a){const l=this.clonePointerEvent(i,"click");l.target=a,l.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:l.target,timeStamp:e});const c=r.clicksByButton[t.button];if(c.target===l.target&&e-c.timeStamp<200?++c.clickCount:c.clickCount=1,c.target=l.target,c.timeStamp=e,l.detail=c.clickCount,l.pointerType==="mouse"){const f=l.button===2;this.dispatchEvent(l,f?"rightclick":"click")}else l.pointerType==="touch"&&this.dispatchEvent(l,"tap");this.dispatchEvent(l,"pointertap"),this.freeEvent(l)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Fi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(i){let n=i;for(;n;)r.currentTarget=n,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch"?this.notifyTarget(r,"touchendoutside"):(r.pointerType==="mouse"||r.pointerType==="pen")&&this.notifyTarget(r,r.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof wn)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const r=this.allocateEvent(Fi);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],typeof e=="string"&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(wn);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Fi);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Fi&&e instanceof Fi&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof dh&&e instanceof dh&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let r=0,n=i.length;r<n&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeListener(e,i[r].fn,void 0,!0),i[r].fn.call(i[r].context,t)}}const JC=1,QC={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Xc=class $c{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new ZC(null),Zr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Fi(null),this.rootWheelEvent=new wn(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...$c.defaultEventFeatures},{set:(e,i,r)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=r),e[i]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,$c._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,r=e.length;i<r;i++){const n=e[i],a=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Zr.pointerMoved();const e=this.normalizeToPointerData(t);for(let i=0,r=e.length;i<r;i++){const n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let n=0,a=r.length;n<a;n++){const l=this.bootstrapEvent(this.rootPointerEvent,r[n]);l.type+=i,this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let i=0,r=e.length;i<r;i++){const n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Zr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Zr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Zr.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const r=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*n,t.y=(i-r.top)*(this.domElement.height/r.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,r=t.changedTouches.length;i<r;i++){const n=t.changedTouches[i];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=JC),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=QC[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Xc.extension={name:"events",type:[lt.RendererSystem,lt.CanvasRendererSystem]},Xc.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let zc=Xc;wt.add(zc);function Xg(s){return s==="dynamic"||s==="static"}const tM={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Xg(zc.defaultEventMode)},set interactive(s){Ht("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=s,this.eventMode=s?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??zc.defaultEventMode},set eventMode(s){this._internalInteractive=Xg(s),this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,r=typeof e=="object"?e.signal:void 0,n=typeof e=="object"?e.once===!0:!1,a=typeof t=="function"?void 0:t;s=i?`${s}capture`:s;const l=typeof t=="function"?t:t.handleEvent,c=this;r&&r.addEventListener("abort",()=>{c.off(s,l,a)}),n?c.once(s,l,a):c.on(s,l,a)},removeEventListener(s,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,r=typeof t=="function"?void 0:t;s=i?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.off(s,t,r)},dispatchEvent(s){if(!(s instanceof Eo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};de.mixin(tM);const eM={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};de.mixin(eM);const iM=9,La=100,rM=0,sM=0,$g=2,zg=1,nM=-1e3,oM=-1e3,aM=2;class qy{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Ar.tablet||Ar.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${La}px`,e.style.height=`${La}px`,e.style.position="absolute",e.style.top=`${rM}px`,e.style.left=`${sM}px`,e.style.zIndex=$g.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${zg}px`,t.style.height=`${zg}px`,t.style.position="absolute",t.style.top=`${nM}px`,t.style.left=`${oM}px`,t.style.zIndex=aM.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(Ar.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:r,height:n}=this.renderer.view.getBoundingClientRect(),{width:a,height:l,resolution:c}=this.renderer,f=r/a*c,g=n/l*c;let u=this.div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${a}px`,u.style.height=`${l}px`;for(let d=0;d<this.children.length;d++){const m=this.children[d];if(m.renderId!==this.renderId)m._accessibleActive=!1,xn(this.children,d,1),this.div.removeChild(m._accessibleDiv),this.pool.push(m._accessibleDiv),m._accessibleDiv=null,d--;else{u=m._accessibleDiv;let _=m.hitArea;const x=m.worldTransform;m.hitArea?(u.style.left=`${(x.tx+_.x*x.a)*f}px`,u.style.top=`${(x.ty+_.y*x.d)*g}px`,u.style.width=`${_.width*x.a*f}px`,u.style.height=`${_.height*x.d*g}px`):(_=m.getBounds(),this.capHitArea(_),u.style.left=`${_.x*f}px`,u.style.top=`${_.y*g}px`,u.style.width=`${_.width*f}px`,u.style.height=`${_.height*g}px`,u.title!==m.accessibleTitle&&m.accessibleTitle!==null&&(u.title=m.accessibleTitle),u.getAttribute("aria-label")!==m.accessibleHint&&m.accessibleHint!==null&&u.setAttribute("aria-label",m.accessibleHint)),(m.accessibleTitle!==u.title||m.tabIndex!==u.tabIndex)&&(u.title=m.accessibleTitle,u.tabIndex=m.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${La}px`,e.style.height=`${La}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=$g.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,r=this.renderer.events.rootBoundary,n=Object.assign(new Eo(r),{target:i});r.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>r.dispatchEvent(n,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===iM&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}qy.extension={name:"accessibility",type:[lt.RendererPlugin,lt.CanvasRendererPlugin]};wt.add(qy);const Yy=class qc{constructor(t){this.stage=new Ee,t=Object.assign({forceCanvas:!1},t),this.renderer=_C(t),qc._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){const i=qc._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Yy._plugins=[];let jy=Yy;wt.handleByList(lt.Application,jy._plugins);class Ky{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;e=r,i=n}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ky.extension=lt.Application;wt.add(Ky);const qg={loader:lt.LoadParser,resolver:lt.ResolveParser,cache:lt.CacheParser,detection:lt.DetectionParser};wt.handle(lt.Asset,s=>{const t=s.ref;Object.entries(qg).filter(([e])=>!!t[e]).forEach(([e,i])=>wt.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(qg).filter(e=>!!t[e]).forEach(e=>wt.remove(t[e]))});class hM{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ln(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function ss(s,t){const e=s.split("?")[0],i=Ae.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Oi=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(i=>typeof i=="string"||e?t(i):i):s),Yc=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s};function Zy(s,t,e,i,r){const n=t[e];for(let a=0;a<n.length;a++){const l=n[a];e<t.length-1?Zy(s.replace(i[e],l),t,e+1,i,r):r.push(s.replace(i[e],l))}}function lM(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const r=[];e.forEach(n=>{const a=n.substring(1,n.length-1).split(",");r.push(a)}),Zy(s,r,0,e,i)}else i.push(s);return i}const fh=s=>!Array.isArray(s);class uM{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Oi(t);let r;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(e)){r=c.getCacheableAssets(i,e);break}}r||(r={},i.forEach(l=>{r[l]=e}));const n=Object.keys(r),a={cacheKeys:n,keys:i};if(i.forEach(l=>{this._cacheMap.set(l,a)}),n.forEach(l=>{this._cache.has(l)&&this._cache.get(l)!==e&&console.warn("[Cache] already has key:",l),this._cache.set(l,r[l])}),e instanceof ct){const l=e;i.forEach(c=>{l.baseTexture!==ct.EMPTY.baseTexture&&Ot.addToCache(l.baseTexture,c),ct.addToCache(l,c)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const Ds=new uM;class cM{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let r=null,n=null;if(e.loadParser&&(n=this._parserHash[e.loadParser],n||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!n){for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.load&&l.test?.(t,e,this)){n=l;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,e,this),i.parser=n;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];l.parse&&l.parse&&await l.testParse?.(r,e,this)&&(r=await l.parse(r,e,this)||r,i.parser=l)}return r})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const r={},n=fh(t),a=Oi(t,f=>({alias:[f],src:f})),l=a.length,c=a.map(async f=>{const g=Ae.toAbsolute(f.src);if(!r[f.src])try{this.promiseCache[g]||(this.promiseCache[g]=this._getLoadPromiseAndParser(g,f)),r[f.src]=await this.promiseCache[g].promise,e&&e(++i/l)}catch(u){throw delete this.promiseCache[g],delete r[f.src],new Error(`[Loader.load] Failed to load ${g}.
${u}`)}});return await Promise.all(c),n?r[a[0].src]:r}async unload(t){const e=Oi(t,i=>({alias:[i],src:i})).map(async i=>{const r=Ae.toAbsolute(i.src),n=this.promiseCache[r];if(n){const a=await n.promise;delete this.promiseCache[r],n.parser?.unload?.(a,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Gi=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(Gi||{});const dM=".json",fM="application/json",pM={extension:{type:lt.LoadParser,priority:Gi.Low},name:"loadJson",test(s){return Ln(s,fM)||ss(s,dM)},async load(s){return await(await ft.ADAPTER.fetch(s)).json()}};wt.add(pM);const mM=".txt",gM="text/plain",_M={name:"loadTxt",extension:{type:lt.LoadParser,priority:Gi.Low},test(s){return Ln(s,gM)||ss(s,mM)},async load(s){return await(await ft.ADAPTER.fetch(s)).text()}};wt.add(_M);const yM=["normal","bold","100","200","300","400","500","600","700","800","900"],vM=[".ttf",".otf",".woff",".woff2"],xM=["font/ttf","font/otf","font/woff","font/woff2"],bM=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function wM(s){const t=Ae.extname(s),e=Ae.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let i=e.length>0;for(const n of e)if(!n.match(bM)){i=!1;break}let r=e.join(" ");return i||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}const TM=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function SM(s){return TM.test(s)?s:encodeURI(s)}const AM={extension:{type:lt.LoadParser,priority:Gi.Low},name:"loadWebFont",test(s){return Ln(s,xM)||ss(s,vM)},async load(s,t){const e=ft.ADAPTER.getFontFaceSet();if(e){const i=[],r=t.data?.family??wM(s),n=t.data?.weights?.filter(l=>yM.includes(l))??["normal"],a=t.data??{};for(let l=0;l<n.length;l++){const c=n[l],f=new FontFace(r,`url(${SM(s)})`,{...a,weight:c});await f.load(),e.add(f),i.push(f)}return i.length===1?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(t=>ft.ADAPTER.getFontFaceSet().delete(t))}};wt.add(AM);const EM=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let Tn=null,jc=class{constructor(){Tn||(Tn=URL.createObjectURL(new Blob([EM],{type:"application/javascript"}))),this.worker=new Worker(Tn)}};jc.revokeObjectURL=function(){Tn&&(URL.revokeObjectURL(Tn),Tn=null)};const CM=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let Sn=null;class Jy{constructor(){Sn||(Sn=URL.createObjectURL(new Blob([CM],{type:"application/javascript"}))),this.worker=new Worker(Sn)}}Jy.revokeObjectURL=function(){Sn&&(URL.revokeObjectURL(Sn),Sn=null)};let Yg=0,oc;class MM{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new jc;e.addEventListener("message",i=>{e.terminate(),jc.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){oc===void 0&&(oc=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<oc&&(this._createdWorkers++,t=new Jy().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((r,n)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Yg]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Yg++,id:i})}}const jg=new MM;function Co(s,t,e){s.resource.internal=!0;const i=new ct(s),r=()=>{delete t.promiseCache[e],Ds.has(e)&&Ds.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),r())}),i.once("destroyed",()=>{s.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),i}const IM=[".jpeg",".jpg",".png",".webp",".avif"],PM=["image/jpeg","image/png","image/webp","image/avif"];async function RM(s){const t=await ft.ADAPTER.fetch(s);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const Rh={name:"loadTextures",extension:{type:lt.LoadParser,priority:Gi.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return Ln(s,PM)||ss(s,IM)},async load(s,t,e){const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let r;i?this.config.preferWorkers&&await jg.isImageBitmapSupported()?r=await jg.loadImageBitmap(s):r=await RM(s):r=await new Promise((l,c)=>{const f=new Image;f.crossOrigin=this.config.crossOrigin,f.src=s,f.complete?l(f):(f.onload=()=>l(f),f.onerror=g=>c(g))});const n={...t.data};n.resolution??(n.resolution=Mr(s)),i&&n.resourceOptions?.ownsImageBitmap===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const a=new Ot(r,n);return a.resource.src=s,Co(a,e,s)},unload(s){s.destroy(!0)}};wt.add(Rh);const FM=".svg",DM="image/svg+xml",LM={extension:{type:lt.LoadParser,priority:Gi.High},name:"loadSVG",test(s){return Ln(s,DM)||ss(s,FM)},async testParse(s){return Nc.test(s)},async parse(s,t,e){const i=new Nc(s,t?.data?.resourceOptions);await i.load();const r=new Ot(i,{resolution:Mr(s),...t?.data});return r.resource.src=t.src,Co(r,e,t.src)},async load(s,t){return(await ft.ADAPTER.fetch(s)).text()},unload:Rh.unload};wt.add(LM);const BM=[".mp4",".m4v",".webm",".ogv"],OM=["video/mp4","video/webm","video/ogg"],kM={name:"loadVideo",extension:{type:lt.LoadParser,priority:Gi.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(s){return Ln(s,OM)||ss(s,BM)},async load(s,t,e){let i;const r=await(await ft.ADAPTER.fetch(s)).blob(),n=URL.createObjectURL(r);try{const a={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},l=new Xy(n,a);await l.load();const c=new Ot(l,{alphaMode:await WA(),resolution:Mr(s),...t?.data});c.resource.src=s,i=Co(c,e,s),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(a){throw URL.revokeObjectURL(n),a}return i},unload(s){s.destroy(!0)}};wt.add(kM);class NM{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,name:i,src:r,srcs:n}=t;return Oi(e||i||r||n,a=>typeof a=="string"?a:Array.isArray(a)?a.map(l=>l?.src??l?.srcs??l):a?.src||a?.srcs?a.src??a.srcs:a,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(r=>{const n=r.src??r.srcs,a=r.alias??r.name;let l;if(typeof a=="string"){const c=this._createBundleAssetId(t,a);i.push(c),l=[a,c]}else{const c=a.map(f=>this._createBundleAssetId(t,f));i.push(...c),l=[...a,...c]}this.add({...r,alias:l,src:n})}):Object.keys(e).forEach(r=>{const n=[r,this._createBundleAssetId(t,r)];if(typeof e[r]=="string")this.add({alias:n,src:e[r]});else if(Array.isArray(e[r]))this.add({alias:n,src:e[r]});else{const a=e[r],l=a.src??a.srcs;this.add({...a,alias:n,src:Array.isArray(l)?l:[l]})}i.push(...n)}),this._bundles[t]=i}add(t,e,i,r,n){const a=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(Ht("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),a.push({alias:t,src:e,data:i,format:r,loadParser:n})):Array.isArray(t)?a.push(...t):a.push(t);let l;l=c=>{this.hasKey(c)&&console.warn(`[Resolver] already has key: ${c} overwriting`)},Oi(a).forEach(c=>{const{src:f,srcs:g}=c;let{data:u,format:d,loadParser:m}=c;const _=Oi(f||g).map(b=>typeof b=="string"?lM(b):Array.isArray(b)?b:[b]),x=this.getAlias(c);Array.isArray(x)?x.forEach(l):l(x);const v=[];_.forEach(b=>{b.forEach(S=>{let T={};if(typeof S!="object"){T.src=S;for(let C=0;C<this._parsers.length;C++){const I=this._parsers[C];if(I.test(S)){T=I.parse(S);break}}}else u=S.data??u,d=S.format??d,m=S.loadParser??m,T={...T,...S};if(!x)throw new Error(`[Resolver] alias is undefined for this asset: ${T.src}`);T=this.buildResolvedAsset(T,{aliases:x,data:u,format:d,loadParser:m}),v.push(T)})}),x.forEach(b=>{this._assetMap[b]=v})})}resolveBundle(t){const e=fh(t);t=Oi(t);const i={};return t.forEach(r=>{const n=this._bundles[r];if(n){const a=this.resolve(n),l={};for(const c in a){const f=a[c];l[this._extractAssetIdFromBundle(r,c)]=f}i[r]=l}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const r in e)i[r]=e[r].src;return i}return e.src}resolve(t){const e=fh(t);t=Oi(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const a=n[0],l=this._getPreferredOrder(n);l?.priority.forEach(c=>{l.params[c].forEach(f=>{const g=n.filter(u=>u[c]?u[c]===f:!1);g.length&&(n=g)})}),this._resolverHash[r]=n[0]??a}else this._resolverHash[r]=this.buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:r,loadParser:n,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=Ae.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=n??t.loadParser,t.format=a??t.format??Ae.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class UM{constructor(){this._detections=[],this._initialized=!1,this.resolver=new NM,this.loader=new cM,this.cache=Ds,this._backgroundLoader=new hM(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}const e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,r=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,r,n){this.resolver.add(t,e,i,r,n)}async load(t,e){this._initialized||await this.init();const i=fh(t),r=Oi(t).map(l=>{if(typeof l!="string"){const c=this.resolver.getAlias(l);return c.some(f=>!this.resolver.hasKey(f))&&this.add(l),Array.isArray(c)?c[0]:c}return this.resolver.hasKey(l)||this.add({alias:l,src:l}),l}),n=this.resolver.resolve(r),a=await this._mapLoadToResolve(n,e);return i?a[r[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},a=Object.keys(r);let l=0,c=0;const f=()=>{e?.(++l/c)},g=a.map(u=>{const d=r[u];return c+=Object.keys(d).length,this._mapLoadToResolve(d,f).then(m=>{n[u]=m})});return await Promise.all(g),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ds.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Ds.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const a={};return i.forEach((l,c)=>{const f=n[l.src],g=[l.src];l.alias&&g.push(...l.alias),a[r[c]]=f,Ds.set(g,f)}),a}async unload(t){this._initialized||await this.init();const e=Oi(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Oi(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{Ds.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,r)=>e.indexOf(i)===r),e}get detections(){return this._detections}get preferWorkers(){return Rh.config.preferWorkers}set preferWorkers(t){Ht("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Bi=new UM;wt.handleByList(lt.LoadParser,Bi.loader.parsers).handleByList(lt.ResolveParser,Bi.resolver.parsers).handleByList(lt.CacheParser,Bi.cache.parsers).handleByList(lt.DetectionParser,Bi.detections);const GM={extension:lt.CacheParser,test:s=>Array.isArray(s)&&s.every(t=>t instanceof ct),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((r,n)=>{e[i+(n===0?"":n+1)]=r})}),e}};wt.add(GM);async function Qy(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const HM={extension:{type:lt.DetectionParser,priority:1},test:async()=>Qy("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")};wt.add(HM);const VM={extension:{type:lt.DetectionParser,priority:0},test:async()=>Qy("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};wt.add(VM);const Kg=["png","jpg","jpeg"],WM={extension:{type:lt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...Kg],remove:async s=>s.filter(t=>!Kg.includes(t))};wt.add(WM);const XM="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function _d(s){return XM?!1:document.createElement("video").canPlayType(s)!==""}const $M={extension:{type:lt.DetectionParser,priority:0},test:async()=>_d("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")};wt.add($M);const zM={extension:{type:lt.DetectionParser,priority:0},test:async()=>_d("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")};wt.add(zM);const qM={extension:{type:lt.DetectionParser,priority:0},test:async()=>_d("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")};wt.add(qM);const YM={extension:lt.ResolveParser,test:Rh.test,parse:s=>({resolution:parseFloat(ft.RETINA_PREFIX.exec(s)?.[1]??"1"),format:Ae.extname(s).slice(1),src:s})};wt.add(YM);var Pe=(s=>(s[s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",s[s.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",s[s.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",s[s.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",s[s.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",s[s.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",s[s.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",s[s.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",s[s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",s[s.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",s[s.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",s[s.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",s[s.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",s[s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",s[s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",s[s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",s))(Pe||{});const ph={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let ji,fn;function Zg(){fn={bptc:ji.getExtension("EXT_texture_compression_bptc"),astc:ji.getExtension("WEBGL_compressed_texture_astc"),etc:ji.getExtension("WEBGL_compressed_texture_etc"),s3tc:ji.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ji.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:ji.getExtension("WEBGL_compressed_texture_pvrtc")||ji.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:ji.getExtension("WEBGL_compressed_texture_etc1"),atc:ji.getExtension("WEBGL_compressed_texture_atc")}}const jM={extension:{type:lt.DetectionParser,priority:2},test:async()=>{const s=ft.ADAPTER.createCanvas().getContext("webgl");return s?(ji=s,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async s=>{fn||Zg();const t=[];for(const e in fn)fn[e]&&t.push(e);return[...t,...s]},remove:async s=>(fn||Zg(),s.filter(t=>!(t in fn)))};wt.add(jM);class KM extends Ah{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,r;typeof t=="string"?(i=t,r=new Uint8Array):(i=null,r=t),super(r,e),this.origin=i,this.buffer=r?new Ac(r):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Ac(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Os extends KM{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Os._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Os._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;r.pixelStorei(r.UNPACK_ALIGNMENT,4);for(let n=0,a=this.levels;n<a;n++){const{levelID:l,levelWidth:c,levelHeight:f,levelBuffer:g}=this._levelBuffers[n];r.compressedTexImage2D(r.TEXTURE_2D,l,this.format,c,f,0,g)}return!0}onBlobLoaded(){this._levelBuffers=Os._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,i,r,n,a,l){const c=new Array(i);let f=t.byteOffset,g=a,u=l,d=g+r-1&~(r-1),m=u+n-1&~(n-1),_=d*m*ph[e];for(let x=0;x<i;x++)c[x]={levelID:x,levelWidth:i>1?g:d,levelHeight:i>1?u:m,levelBuffer:new Uint8Array(t.buffer,f,_)},f+=_,g=g>>1||1,u=u>>1||1,d=g+r-1&~(r-1),m=u+n-1&~(n-1),_=d*m*ph[e];return c}}const ac=4,Ba=124,ZM=32,Jg=20,JM=542327876,Oa={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},QM={FOURCC:2},ka={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},tI=1,eI=2,iI=4,rI=64,sI=512,nI=131072,oI=827611204,aI=861165636,hI=894720068,lI=808540228,uI=4,cI={[oI]:Pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[aI]:Pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[hI]:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT},dI={70:Pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Pe.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Pe.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Pe.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Pe.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function fI(s){const t=new Uint32Array(s);if(t[0]!==JM)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(s,0,Ba/Uint32Array.BYTES_PER_ELEMENT),i=e[Oa.HEIGHT],r=e[Oa.WIDTH],n=e[Oa.MIPMAP_COUNT],a=new Uint32Array(s,Oa.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,ZM/Uint32Array.BYTES_PER_ELEMENT),l=a[tI];if(l&iI){const c=a[QM.FOURCC];if(c!==lI){const S=cI[c],T=ac+Ba,C=new Uint8Array(s,T);return[new Os(C,{format:S,width:r,height:i,levels:n})]}const f=ac+Ba,g=new Uint32Array(t.buffer,f,Jg/Uint32Array.BYTES_PER_ELEMENT),u=g[ka.DXGI_FORMAT],d=g[ka.RESOURCE_DIMENSION],m=g[ka.MISC_FLAG],_=g[ka.ARRAY_SIZE],x=dI[u];if(x===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(m===uI)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const v=new Array,b=ac+Ba+Jg;if(_===1)v.push(new Uint8Array(s,b));else{const S=ph[x];let T=0,C=r,I=i;for(let E=0;E<n;E++){const B=Math.max(1,C+3&-4),X=Math.max(1,I+3&-4),tt=B*X*S;T+=tt,C=C>>>1,I=I>>>1}let k=b;for(let E=0;E<_;E++)v.push(new Uint8Array(s,k,T)),k+=T}return v.map(S=>new Os(S,{format:x,width:r,height:i,levels:n}))}throw l&rI?new Error("DDSParser does not support uncompressed texture data."):l&sI?new Error("DDSParser does not supported YUV uncompressed texture data."):l&nI?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&eI?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Qg=[171,75,84,88,32,49,49,187,13,10,26,10],pI=67305985,Ii={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Kc=64,t_={[Et.UNSIGNED_BYTE]:1,[Et.UNSIGNED_SHORT]:2,[Et.INT]:4,[Et.UNSIGNED_INT]:4,[Et.FLOAT]:4,[Et.HALF_FLOAT]:8},mI={[at.RGBA]:4,[at.RGB]:3,[at.RG]:2,[at.RED]:1,[at.LUMINANCE]:1,[at.LUMINANCE_ALPHA]:2,[at.ALPHA]:1},gI={[Et.UNSIGNED_SHORT_4_4_4_4]:2,[Et.UNSIGNED_SHORT_5_5_5_1]:2,[Et.UNSIGNED_SHORT_5_6_5]:2};function _I(s,t,e=!1){const i=new DataView(t);if(!yI(s,i))return null;const r=i.getUint32(Ii.ENDIANNESS,!0)===pI,n=i.getUint32(Ii.GL_TYPE,r),a=i.getUint32(Ii.GL_FORMAT,r),l=i.getUint32(Ii.GL_INTERNAL_FORMAT,r),c=i.getUint32(Ii.PIXEL_WIDTH,r),f=i.getUint32(Ii.PIXEL_HEIGHT,r)||1,g=i.getUint32(Ii.PIXEL_DEPTH,r)||1,u=i.getUint32(Ii.NUMBER_OF_ARRAY_ELEMENTS,r)||1,d=i.getUint32(Ii.NUMBER_OF_FACES,r),m=i.getUint32(Ii.NUMBER_OF_MIPMAP_LEVELS,r),_=i.getUint32(Ii.BYTES_OF_KEY_VALUE_DATA,r);if(f===0||g!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const x=4,v=4,b=c+3&-4,S=f+3&-4,T=new Array(u);let C=c*f;n===0&&(C=b*S);let I;if(n!==0?t_[n]?I=t_[n]*mI[a]:I=gI[n]:I=ph[l],I===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const k=e?xI(i,_,r):null;let E=C*I,B=c,X=f,tt=b,Z=S,H=Kc+_;for(let K=0;K<m;K++){const j=i.getUint32(H,r);let _t=H+4;for(let R=0;R<u;R++){let F=T[R];F||(F=T[R]=new Array(m)),F[K]={levelID:K,levelWidth:m>1||n!==0?B:tt,levelHeight:m>1||n!==0?X:Z,levelBuffer:new Uint8Array(t,_t,E)},_t+=E}H+=j+4,H=H%4!==0?H+4-H%4:H,B=B>>1||1,X=X>>1||1,tt=B+x-1&-4,Z=X+v-1&-4,E=tt*Z*I}return n!==0?{uncompressed:T.map(K=>{let j=K[0].levelBuffer,_t=!1;return n===Et.FLOAT?j=new Float32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4):n===Et.UNSIGNED_INT?(_t=!0,j=new Uint32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4)):n===Et.INT&&(_t=!0,j=new Int32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4)),{resource:new Ah(j,{width:K[0].levelWidth,height:K[0].levelHeight}),type:n,format:_t?vI(a):a}}),kvData:k}:{compressed:T.map(K=>new Os(null,{format:l,width:c,height:f,levels:m,levelBuffers:K})),kvData:k}}function yI(s,t){for(let e=0;e<Qg.length;e++)if(t.getUint8(e)!==Qg[e])return console.error(`${s} is not a valid *.ktx file!`),!1;return!0}function vI(s){switch(s){case at.RGBA:return at.RGBA_INTEGER;case at.RGB:return at.RGB_INTEGER;case at.RG:return at.RG_INTEGER;case at.RED:return at.RED_INTEGER;default:return s}}function xI(s,t,e){const i=new Map;let r=0;for(;r<t;){const n=s.getUint32(Kc+r,e),a=Kc+r+4,l=3-(n+3)%4;if(n===0||n>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let c=0;for(;c<n&&s.getUint8(a+c)!==0;c++);if(c===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const f=new TextDecoder().decode(new Uint8Array(s.buffer,a,c)),g=new DataView(s.buffer,a+c+1,n-c-1);i.set(f,g),r+=4+n+l}return i}const bI={extension:{type:lt.LoadParser,priority:Gi.High},name:"loadDDS",test(s){return ss(s,".dds")},async load(s,t,e){const i=await(await ft.ADAPTER.fetch(s)).arrayBuffer(),r=fI(i).map(n=>{const a=new Ot(n,{mipmap:or.OFF,alphaMode:Ye.NO_PREMULTIPLIED_ALPHA,resolution:Mr(s),...t.data});return Co(a,e,s)});return r.length===1?r[0]:r},unload(s){Array.isArray(s)?s.forEach(t=>t.destroy(!0)):s.destroy(!0)}};wt.add(bI);const wI={extension:{type:lt.LoadParser,priority:Gi.High},name:"loadKTX",test(s){return ss(s,".ktx")},async load(s,t,e){const i=await(await ft.ADAPTER.fetch(s)).arrayBuffer(),{compressed:r,uncompressed:n,kvData:a}=_I(s,i),l=r??n,c={mipmap:or.OFF,alphaMode:Ye.NO_PREMULTIPLIED_ALPHA,resolution:Mr(s),...t.data},f=l.map(g=>{l===n&&Object.assign(c,{type:g.type,format:g.format});const u=g.resource??g,d=new Ot(u,c);return d.ktxKeyValueData=a,Co(d,e,s)});return f.length===1?f[0]:f},unload(s){Array.isArray(s)?s.forEach(t=>t.destroy(!0)):s.destroy(!0)}};wt.add(wI);const TI=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],SI={extension:lt.ResolveParser,test:s=>{const t=Ae.extname(s).slice(1);return["basis","ktx","dds"].includes(t)},parse:s=>{const t=s.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const i=t.pop();if(TI.includes(i))return{resolution:parseFloat(ft.RETINA_PREFIX.exec(s)?.[1]??"1"),format:i,src:s}}return{resolution:parseFloat(ft.RETINA_PREFIX.exec(s)?.[1]??"1"),format:e,src:s}}};wt.add(SI);const Na=new Dt,AI=4,tv=class yo{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,r){const n=new Image;return n.src=await this.base64(t,e,i,r),n}async base64(t,e,i,r){const n=this.canvas(t,r);if(n.toBlob!==void 0)return new Promise((a,l)=>{n.toBlob(c=>{if(!c){l(new Error("ICanvas.toBlob failed!"));return}const f=new FileReader;f.onload=()=>a(f.result),f.onerror=l,f.readAsDataURL(c)},e,i)});if(n.toDataURL!==void 0)return n.toDataURL(e,i);if(n.convertToBlob!==void 0){const a=await n.convertToBlob({type:e,quality:i});return new Promise((l,c)=>{const f=new FileReader;f.onload=()=>l(f.result),f.onerror=c,f.readAsDataURL(a)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:r,height:n,flipY:a,premultipliedAlpha:l}=this._rawPixels(t,e);a&&yo._flipY(i,r,n),l&&yo._unpremultiplyAlpha(i);const c=new nE(r,n,1),f=new ImageData(new Uint8ClampedArray(i.buffer),r,n);return c.context.putImageData(f,0,0),c.canvas}pixels(t,e){const{pixels:i,width:r,height:n,flipY:a,premultipliedAlpha:l}=this._rawPixels(t,e);return a&&yo._flipY(i,r,n),l&&yo._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let r,n=!1,a=!1,l,c=!1;t&&(t instanceof Gs?l=t:(l=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),c=!0,e&&(Na.width=e.width,Na.height=e.height,e=Na)));const f=i.gl;if(l){if(r=l.baseTexture.resolution,e=e??l.frame,n=!1,a=l.baseTexture.alphaMode>0&&l.baseTexture.format===at.RGBA,!c){i.renderTexture.bind(l);const m=l.framebuffer.glFramebuffers[i.CONTEXT_UID];m.blitFramebuffer&&i.framebuffer.bind(m.blitFramebuffer)}}else r=i.resolution,e||(e=Na,e.width=i.width/r,e.height=i.height/r),n=!0,a=this._rendererPremultipliedAlpha,i.renderTexture.bind();const g=Math.max(Math.round(e.width*r),1),u=Math.max(Math.round(e.height*r),1),d=new Uint8Array(AI*g*u);return f.readPixels(Math.round(e.x*r),Math.round(e.y*r),g,u,f.RGBA,f.UNSIGNED_BYTE,d),c&&l?.destroy(!0),{pixels:d,width:g,height:u,flipY:n,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(t,e,i){const r=e<<2,n=i>>1,a=new Uint8Array(r);for(let l=0;l<n;l++){const c=l*r,f=(i-l-1)*r;a.set(t.subarray(c,c+r)),t.copyWithin(c,f,f+r),t.set(a,f)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const r=t[i+3];if(r!==0){const n=255.001/r;t[i]=t[i]*n+.5,t[i+1]=t[i+1]*n+.5,t[i+2]=t[i+2]*n+.5}}}};tv.extension={name:"extract",type:lt.RendererSystem};let EI=tv;wt.add(EI);const mh={build(s){const t=s.points;let e,i,r,n,a,l;if(s.type===Re.CIRC){const _=s.shape;e=_.x,i=_.y,a=l=_.radius,r=n=0}else if(s.type===Re.ELIP){const _=s.shape;e=_.x,i=_.y,a=_.width,l=_.height,r=n=0}else{const _=s.shape,x=_.width/2,v=_.height/2;e=_.x+x,i=_.y+v,a=l=Math.max(0,Math.min(_.radius,Math.min(x,v))),r=x-a,n=v-l}if(!(a>=0&&l>=0&&r>=0&&n>=0)){t.length=0;return}const c=Math.ceil(2.3*Math.sqrt(a+l)),f=c*8+(r?4:0)+(n?4:0);if(t.length=f,f===0)return;if(c===0){t.length=8,t[0]=t[6]=e+r,t[1]=t[3]=i+n,t[2]=t[4]=e-r,t[5]=t[7]=i-n;return}let g=0,u=c*4+(r?2:0)+2,d=u,m=f;{const _=r+a,x=n,v=e+_,b=e-_,S=i+x;if(t[g++]=v,t[g++]=S,t[--u]=S,t[--u]=b,n){const T=i-x;t[d++]=b,t[d++]=T,t[--m]=T,t[--m]=v}}for(let _=1;_<c;_++){const x=Math.PI/2*(_/c),v=r+Math.cos(x)*a,b=n+Math.sin(x)*l,S=e+v,T=e-v,C=i+b,I=i-b;t[g++]=S,t[g++]=C,t[--u]=C,t[--u]=T,t[d++]=T,t[d++]=I,t[--m]=I,t[--m]=S}{const _=r,x=n+l,v=e+_,b=e-_,S=i+x,T=i-x;t[g++]=v,t[g++]=S,t[--m]=T,t[--m]=v,r&&(t[g++]=b,t[g++]=S,t[--m]=T,t[--m]=b)}},triangulate(s,t){const e=s.points,i=t.points,r=t.indices;if(e.length===0)return;let n=i.length/2;const a=n;let l,c;if(s.type!==Re.RREC){const g=s.shape;l=g.x,c=g.y}else{const g=s.shape;l=g.x+g.width/2,c=g.y+g.height/2}const f=s.matrix;i.push(s.matrix?f.a*l+f.c*c+f.tx:l,s.matrix?f.b*l+f.d*c+f.ty:c),n++,i.push(e[0],e[1]);for(let g=2;g<e.length;g+=2)i.push(e[g],e[g+1]),r.push(n++,a,n);r.push(a+1,a,n)}};function e_(s,t=!1){const e=s.length;if(e<6)return;let i=0;for(let r=0,n=s[e-2],a=s[e-1];r<e;r+=2){const l=s[r],c=s[r+1];i+=(l-n)*(c+a),n=l,a=c}if(!t&&i>0||t&&i<=0){const r=e/2;for(let n=r+r%2;n<e;n+=2){const a=e-n-2,l=e-n-1,c=n,f=n+1;[s[a],s[c]]=[s[c],s[a]],[s[l],s[f]]=[s[f],s[l]]}}}const ev={build(s){s.points=s.shape.points.slice()},triangulate(s,t){let e=s.points;const i=s.holes,r=t.points,n=t.indices;if(e.length>=6){e_(e,!1);const a=[];for(let f=0;f<i.length;f++){const g=i[f];e_(g.points,!0),a.push(e.length/2),e=e.concat(g.points)}const l=rA(e,a,2);if(!l)return;const c=r.length/2;for(let f=0;f<l.length;f+=3)n.push(l[f]+c),n.push(l[f+1]+c),n.push(l[f+2]+c);for(let f=0;f<e.length;f++)r.push(e[f])}}},CI={build(s){const t=s.shape,e=t.x,i=t.y,r=t.width,n=t.height,a=s.points;a.length=0,r>=0&&n>=0&&a.push(e,i,e+r,i,e+r,i+n,e,i+n)},triangulate(s,t){const e=s.points,i=t.points;if(e.length===0)return;const r=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},MI={build(s){mh.build(s)},triangulate(s,t){mh.triangulate(s,t)}};var gi=(s=>(s.MITER="miter",s.BEVEL="bevel",s.ROUND="round",s))(gi||{}),Qr=(s=>(s.BUTT="butt",s.ROUND="round",s.SQUARE="square",s))(Qr||{});const Fn={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(s,t=20){if(!this.adaptive||!s||isNaN(s))return t;let e=Math.ceil(s/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class i_{static curveTo(t,e,i,r,n,a){const l=a[a.length-2],c=a[a.length-1]-e,f=l-t,g=r-e,u=i-t,d=Math.abs(c*u-f*g);if(d<1e-8||n===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const m=c*c+f*f,_=g*g+u*u,x=c*g+f*u,v=n*Math.sqrt(m)/d,b=n*Math.sqrt(_)/d,S=v*x/m,T=b*x/_,C=v*u+b*f,I=v*g+b*c,k=f*(b+S),E=c*(b+S),B=u*(v+T),X=g*(v+T),tt=Math.atan2(E-I,k-C),Z=Math.atan2(X-I,B-C);return{cx:C+t,cy:I+e,radius:n,startAngle:tt,endAngle:Z,anticlockwise:f*g>u*c}}static arc(t,e,i,r,n,a,l,c,f){const g=l-a,u=Fn._segmentsCount(Math.abs(g)*n,Math.ceil(Math.abs(g)/oh)*40),d=g/(u*2),m=d*2,_=Math.cos(d),x=Math.sin(d),v=u-1,b=v%1/v;for(let S=0;S<=v;++S){const T=S+b*S,C=d+a+m*T,I=Math.cos(C),k=-Math.sin(C);f.push((_*I+x*k)*n+i,(_*-k+x*I)*n+r)}}}class II{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class yd{static curveLength(t,e,i,r,n,a,l,c){let f=0,g=0,u=0,d=0,m=0,_=0,x=0,v=0,b=0,S=0,T=0,C=t,I=e;for(let k=1;k<=10;++k)g=k/10,u=g*g,d=u*g,m=1-g,_=m*m,x=_*m,v=x*t+3*_*g*i+3*m*u*n+d*l,b=x*e+3*_*g*r+3*m*u*a+d*c,S=C-v,T=I-b,C=v,I=b,f+=Math.sqrt(S*S+T*T);return f}static curveTo(t,e,i,r,n,a,l){const c=l[l.length-2],f=l[l.length-1];l.length-=2;const g=Fn._segmentsCount(yd.curveLength(c,f,t,e,i,r,n,a));let u=0,d=0,m=0,_=0,x=0;l.push(c,f);for(let v=1,b=0;v<=g;++v)b=v/g,u=1-b,d=u*u,m=d*u,_=b*b,x=_*b,l.push(m*c+3*d*b*t+3*u*_*i+x*n,m*f+3*d*b*e+3*u*_*r+x*a)}}function r_(s,t,e,i,r,n,a,l){const c=s-e*r,f=t-i*r,g=s+e*n,u=t+i*n;let d,m;a?(d=i,m=-e):(d=-i,m=e);const _=c+d,x=f+m,v=g+d,b=u+m;return l.push(_,x,v,b),2}function ws(s,t,e,i,r,n,a,l){const c=e-s,f=i-t;let g=Math.atan2(c,f),u=Math.atan2(r-s,n-t);l&&g<u?g+=Math.PI*2:!l&&g>u&&(u+=Math.PI*2);let d=g;const m=u-g,_=Math.abs(m),x=Math.sqrt(c*c+f*f),v=(15*_*Math.sqrt(x)/Math.PI>>0)+1,b=m/v;if(d+=b,l){a.push(s,t,e,i);for(let S=1,T=d;S<v;S++,T+=b)a.push(s,t,s+Math.sin(T)*x,t+Math.cos(T)*x);a.push(s,t,r,n)}else{a.push(e,i,s,t);for(let S=1,T=d;S<v;S++,T+=b)a.push(s+Math.sin(T)*x,t+Math.cos(T)*x,s,t);a.push(r,n,s,t)}return v*2}function PI(s,t){const e=s.shape;let i=s.points||e.points.slice();const r=t.closePointEps;if(i.length===0)return;const n=s.lineStyle,a=new zt(i[0],i[1]),l=new zt(i[i.length-2],i[i.length-1]),c=e.type!==Re.POLY||e.closeStroke,f=Math.abs(a.x-l.x)<r&&Math.abs(a.y-l.y)<r;if(c){i=i.slice(),f&&(i.pop(),i.pop(),l.set(i[i.length-2],i[i.length-1]));const F=(a.x+l.x)*.5,P=(l.y+a.y)*.5;i.unshift(F,P),i.push(F,P)}const g=t.points,u=i.length/2;let d=i.length;const m=g.length/2,_=n.width/2,x=_*_,v=n.miterLimit*n.miterLimit;let b=i[0],S=i[1],T=i[2],C=i[3],I=0,k=0,E=-(S-C),B=b-T,X=0,tt=0,Z=Math.sqrt(E*E+B*B);E/=Z,B/=Z,E*=_,B*=_;const H=n.alignment,K=(1-H)*2,j=H*2;c||(n.cap===Qr.ROUND?d+=ws(b-E*(K-j)*.5,S-B*(K-j)*.5,b-E*K,S-B*K,b+E*j,S+B*j,g,!0)+2:n.cap===Qr.SQUARE&&(d+=r_(b,S,E,B,K,j,!0,g))),g.push(b-E*K,S-B*K,b+E*j,S+B*j);for(let F=1;F<u-1;++F){b=i[(F-1)*2],S=i[(F-1)*2+1],T=i[F*2],C=i[F*2+1],I=i[(F+1)*2],k=i[(F+1)*2+1],E=-(S-C),B=b-T,Z=Math.sqrt(E*E+B*B),E/=Z,B/=Z,E*=_,B*=_,X=-(C-k),tt=T-I,Z=Math.sqrt(X*X+tt*tt),X/=Z,tt/=Z,X*=_,tt*=_;const P=T-b,V=S-C,L=T-I,U=k-C,z=P*L+V*U,$=V*L-U*P,rt=$<0;if(Math.abs($)<.001*Math.abs(z)){g.push(T-E*K,C-B*K,T+E*j,C+B*j),z>=0&&(n.join===gi.ROUND?d+=ws(T,C,T-E*K,C-B*K,T-X*K,C-tt*K,g,!1)+4:d+=2,g.push(T-X*j,C-tt*j,T+X*K,C+tt*K));continue}const nt=(-E+b)*(-B+C)-(-E+T)*(-B+S),ut=(-X+I)*(-tt+C)-(-X+T)*(-tt+k),pt=(P*ut-L*nt)/$,gt=(U*nt-V*ut)/$,xt=(pt-T)*(pt-T)+(gt-C)*(gt-C),ot=T+(pt-T)*K,yt=C+(gt-C)*K,bt=T-(pt-T)*j,Lt=C-(gt-C)*j,Ft=Math.min(P*P+V*V,L*L+U*U),vt=rt?K:j,At=Ft+vt*vt*x,jt=xt<=At;let fe=n.join;if(fe===gi.MITER&&xt/x>v&&(fe=gi.BEVEL),jt)switch(fe){case gi.MITER:{g.push(ot,yt,bt,Lt);break}case gi.BEVEL:{rt?g.push(ot,yt,T+E*j,C+B*j,ot,yt,T+X*j,C+tt*j):g.push(T-E*K,C-B*K,bt,Lt,T-X*K,C-tt*K,bt,Lt),d+=2;break}case gi.ROUND:{rt?(g.push(ot,yt,T+E*j,C+B*j),d+=ws(T,C,T+E*j,C+B*j,T+X*j,C+tt*j,g,!0)+4,g.push(ot,yt,T+X*j,C+tt*j)):(g.push(T-E*K,C-B*K,bt,Lt),d+=ws(T,C,T-E*K,C-B*K,T-X*K,C-tt*K,g,!1)+4,g.push(T-X*K,C-tt*K,bt,Lt));break}}else{switch(g.push(T-E*K,C-B*K,T+E*j,C+B*j),fe){case gi.MITER:{rt?g.push(bt,Lt,bt,Lt):g.push(ot,yt,ot,yt),d+=2;break}case gi.ROUND:{rt?d+=ws(T,C,T+E*j,C+B*j,T+X*j,C+tt*j,g,!0)+2:d+=ws(T,C,T-E*K,C-B*K,T-X*K,C-tt*K,g,!1)+2;break}}g.push(T-X*K,C-tt*K,T+X*j,C+tt*j),d+=2}}b=i[(u-2)*2],S=i[(u-2)*2+1],T=i[(u-1)*2],C=i[(u-1)*2+1],E=-(S-C),B=b-T,Z=Math.sqrt(E*E+B*B),E/=Z,B/=Z,E*=_,B*=_,g.push(T-E*K,C-B*K,T+E*j,C+B*j),c||(n.cap===Qr.ROUND?d+=ws(T-E*(K-j)*.5,C-B*(K-j)*.5,T-E*K,C-B*K,T+E*j,C+B*j,g,!1)+2:n.cap===Qr.SQUARE&&(d+=r_(T,C,E,B,K,j,!1,g)));const _t=t.indices,R=Fn.epsilon*Fn.epsilon;for(let F=m;F<d+m-2;++F)b=g[F*2],S=g[F*2+1],T=g[(F+1)*2],C=g[(F+1)*2+1],I=g[(F+2)*2],k=g[(F+2)*2+1],!(Math.abs(b*(C-k)+T*(k-S)+I*(S-C))<R)&&_t.push(F,F+1,F+2)}function RI(s,t){let e=0;const i=s.shape,r=s.points||i.points,n=i.type!==Re.POLY||i.closeStroke;if(r.length===0)return;const a=t.points,l=t.indices,c=r.length/2,f=a.length/2;let g=f;for(a.push(r[0],r[1]),e=1;e<c;e++)a.push(r[e*2],r[e*2+1]),l.push(g,g+1),g++;n&&l.push(g,f)}function s_(s,t){s.lineStyle.native?RI(s,t):PI(s,t)}class vd{static curveLength(t,e,i,r,n,a){const l=t-2*i+n,c=e-2*r+a,f=2*i-2*t,g=2*r-2*e,u=4*(l*l+c*c),d=4*(l*f+c*g),m=f*f+g*g,_=2*Math.sqrt(u+d+m),x=Math.sqrt(u),v=2*u*x,b=2*Math.sqrt(m),S=d/x;return(v*_+x*d*(_-b)+(4*m*u-d*d)*Math.log((2*x+S+_)/(S+b)))/(4*v)}static curveTo(t,e,i,r,n){const a=n[n.length-2],l=n[n.length-1],c=Fn._segmentsCount(vd.curveLength(a,l,t,e,i,r));let f=0,g=0;for(let u=1;u<=c;++u){const d=u/c;f=a+(t-a)*d,g=l+(e-l)*d,n.push(f+(t+(i-t)*d-f)*d,g+(e+(r-e)*d-g)*d)}}}const hc={[Re.POLY]:ev,[Re.CIRC]:mh,[Re.ELIP]:mh,[Re.RECT]:CI,[Re.RREC]:MI},n_=[],Ua=[];class gh{constructor(t,e=null,i=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=r,this.type=t.type}clone(){return new gh(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const an=new zt,iv=class rv extends ay{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ch,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ua.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),n_.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,r=null){const n=new gh(t,e,i,r);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new gh(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const r=e[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,an):an.copyFrom(t),r.shape.contains(an.x,an.y))){let n=!1;if(r.holes){for(let a=0;a<r.holes.length;a++)if(r.holes[a].shape.contains(an.x,an.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,r=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],r=i.style);for(let c=this.shapeIndex;c<e.length;c++){this.shapeIndex++;const f=e[c],g=f.fillStyle,u=f.lineStyle;hc[f.type].build(f),f.matrix&&this.transformPoints(f.points,f.matrix),(g.visible||u.visible)&&this.processHoles(f.holes);for(let d=0;d<2;d++){const m=d===0?g:u;if(!m.visible)continue;const _=m.texture.baseTexture,x=this.indices.length,v=this.points.length/2;_.wrapMode=ts.REPEAT,d===0?this.processFill(f):this.processLine(f);const b=this.points.length/2-v;b!==0&&(i&&!this._compareStyles(r,m)&&(i.end(x,v),i=null),i||(i=n_.pop()||new II,i.begin(m,x,v),this.batches.push(i),r=m),this.addUvs(this.points,t,m.texture,v,b,m.matrix))}}const n=this.indices.length,a=this.points.length/2;if(i&&i.end(n,a),this.batches.length===0){this.batchable=!0;return}const l=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const i=this.graphicsData[t],r=i.fillStyle,n=i.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const r=t[e];for(let n=0;n<r.size;n++){const a=r.start+n;this.indicesUint16[a]=this.indicesUint16[a]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<rv.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++Ot._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),Ua.push(this.drawCalls[u]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let r=Ua.pop();r||(r=new Mc,r.texArray=new Fc),r.texArray.count=0,r.start=0,r.size=0,r.type=ir.TRIANGLES;let n=0,a=null,l=0,c=!1,f=ir.TRIANGLES,g=0;this.drawCalls.push(r);for(let u=0;u<this.batches.length;u++){const d=this.batches[u],m=8,_=d.style,x=_.texture.baseTexture;c!==!!_.native&&(c=!!_.native,f=c?ir.LINES:ir.TRIANGLES,a=null,n=m,t++),a!==x&&(a=x,x._batchEnabled!==t&&(n===m&&(t++,n=0,r.size>0&&(r=Ua.pop(),r||(r=new Mc,r.texArray=new Fc),this.drawCalls.push(r)),r.start=g,r.size=0,r.texArray.count=0,r.type=f),x.touched=1,x._batchEnabled=t,x._batchLocation=n,x.wrapMode=ts.REPEAT,r.texArray.elements[r.texArray.count++]=x,n++)),r.size+=d.size,g+=d.size,l=x._batchLocation,this.addColors(e,_.color,_.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,l,d.attribSize,d.attribStart)}Ot._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,n=new ArrayBuffer(t.length*3*4),a=new Float32Array(n),l=new Uint32Array(n);let c=0;for(let f=0;f<t.length/2;f++)a[c++]=t[f*2],a[c++]=t[f*2+1],a[c++]=e[f*2],a[c++]=e[f*2+1],l[c++]=i[f],a[c++]=r[f];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?ev.triangulate(t,this):hc[t.type].triangulate(t,this)}processLine(t){s_(t,this);for(let e=0;e<t.holes.length;e++)s_(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];hc[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const r=t[i*2],n=t[i*2+1];t[i*2]=e.a*r+e.c*n+e.tx,t[i*2+1]=e.b*r+e.d*n+e.ty}}addColors(t,e,i,r,n=0){const a=oe.shared.setValue(e).toLittleEndianNumber(),l=oe.shared.setValue(a).toPremultiplied(i);t.length=Math.max(t.length,n+r);for(let c=0;c<r;c++)t[n+c]=l}addTextureIds(t,e,i,r=0){t.length=Math.max(t.length,r+i);for(let n=0;n<i;n++)t[r+n]=e}addUvs(t,e,i,r,n,a=null){let l=0;const c=e.length,f=i.frame;for(;l<n;){let u=t[(r+l)*2],d=t[(r+l)*2+1];if(a){const m=a.a*u+a.c*d+a.tx;d=a.b*u+a.d*d+a.ty,u=m}l++,e.push(u/f.width,d/f.height)}const g=i.baseTexture;(f.width<g.width||f.height<g.height)&&this.adjustUvs(e,i,c,n)}adjustUvs(t,e,i,r){const n=e.baseTexture,a=1e-6,l=i+r*2,c=e.frame,f=c.width/n.width,g=c.height/n.height;let u=c.x/c.width,d=c.y/c.height,m=Math.floor(t[i]+a),_=Math.floor(t[i+1]+a);for(let x=i+2;x<l;x+=2)m=Math.min(m,Math.floor(t[x]+a)),_=Math.min(_,Math.floor(t[x+1]+a));u-=m,d-=_;for(let x=i;x<l;x+=2)t[x]=(t[x]+u)*f,t[x+1]=(t[x+1]+d)*g}};iv.BATCHABLE_SIZE=100;let FI=iv;class Fh{constructor(){this.color=16777215,this.alpha=1,this.texture=ct.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Fh;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=ct.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class xd extends Fh{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Qr.BUTT,this.join=gi.MITER,this.miterLimit=10}clone(){const t=new xd;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Qr.BUTT,this.join=gi.MITER,this.miterLimit=10}}const lc={},Zc=class Qa extends Ee{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Fh,this._lineStyle=new xd,this._matrix=null,this._holeMode=!1,this.state=ar.for2d(),this._geometry=t||new FI,this._geometry.refCount++,this._transformID=-1,this._tintColor=new oe(16777215),this.blendMode=Rt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Qa(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,r=.5,n=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:r,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:ct.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Qr.BUTT,join:gi.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Bs,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Bs,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,r=i[i.length-2],n=i[i.length-1];return(r!==t||n!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,r){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),vd.curveTo(t,e,i,r,n),this}bezierCurveTo(t,e,i,r,n,a){return this._initCurve(),yd.curveTo(t,e,i,r,n,a,this.currentPath.points),this}arcTo(t,e,i,r,n){this._initCurve(t,e);const a=this.currentPath.points,l=i_.curveTo(t,e,i,r,n,a);if(l){const{cx:c,cy:f,radius:g,startAngle:u,endAngle:d,anticlockwise:m}=l;this.arc(c,f,g,u,d,m)}return this}arc(t,e,i,r,n,a=!1){if(r===n)return this;if(!a&&n<=r?n+=oh:a&&r<=n&&(r+=oh),n-r===0)return this;const l=t+Math.cos(r)*i,c=e+Math.sin(r)*i,f=this._geometry.closePointEps;let g=this.currentPath?this.currentPath.points:null;if(g){const u=Math.abs(g[g.length-2]-l),d=Math.abs(g[g.length-1]-c);u<f&&d<f||g.push(l,c)}else this.moveTo(l,c),g=this.currentPath.points;return i_.arc(l,c,t,e,i,r,n,a,g),this}beginFill(t=0,e){return this.beginTextureFill({texture:ct.WHITE,color:t,alpha:e})}normalizeColor(t){const e=oe.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:ct.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,r){return this.drawShape(new Dt(t,e,i,r))}drawRoundedRect(t,e,i,r,n){return this.drawShape(new Mh(t,e,i,r,n))}drawCircle(t,e,i){return this.drawShape(new Eh(t,e,i))}drawEllipse(t,e,i,r){return this.drawShape(new Ch(t,e,i,r))}drawPolygon(...t){let e,i=!0;const r=t[0];r.points?(i=r.closeStroke,e=r.points):Array.isArray(t[0])?e=t[0]:e=t;const n=new Bs(e);return n.closeStroke=i,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===Re.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let r=0;r<i;r++){const n=t.batches[r],a=n.style.color,l=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),c=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),f=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),g={vertexData:l,blendMode:e,indices:f,uvs:c,_batchRGB:oe.shared.setValue(a).toRgbArray(),_tintRGB:a,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=g}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,r=this.worldAlpha,n=e.uniforms,a=i.drawCalls;n.translationMatrix=this.transform.worldTransform,oe.shared.setValue(this._tintColor).premultiply(r).toArray(n.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let l=0,c=a.length;l<c;l++)this._renderDrawCallDirect(t,i.drawCalls[l])}_renderDrawCallDirect(t,e){const{texArray:i,type:r,size:n,start:a}=e,l=i.count;for(let c=0;c<l;c++)t.texture.bind(i.elements[c],c);t.geometry.draw(r,n,a)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!lc[i]){const{maxTextures:r}=t.plugins[i],n=new Int32Array(r);for(let c=0;c<r;c++)n[c]=c;const a={tint:new Float32Array([1,1,1,1]),translationMatrix:new te,default:Ni.from({uSamplers:n},!0)},l=t.plugins[i]._shader.program;lc[i]=new nr(l,a)}e=lc[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:r,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,i,r,n)}containsPoint(t){return this.worldTransform.applyInverse(t,Qa._TEMP_POINT),this._geometry.containsPoint(Qa._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=oe.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,r=e.b,n=e.c,a=e.d,l=e.tx,c=e.ty,f=this._geometry.points,g=this.vertexData;let u=0;for(let d=0;d<f.length;d+=2){const m=f[d],_=f[d+1];g[u++]=i*m+n*_+l,g[u++]=a*_+r*m+c}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Zc.curves=Fn,Zc._TEMP_POINT=new zt;let Ui=Zc;class DI{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const uc=new zt,o_=new Bs,sv=class nv extends Ee{constructor(t,e,i,r=ir.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||ar.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ft.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ir.TRIANGLES&&e.length<nv.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const r=this.transform.worldTransform,n=r.a,a=r.b,l=r.c,c=r.d,f=r.tx,g=r.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const m=e[d*2],_=e[d*2+1];u[d*2]=n*m+l*_+f,u[d*2+1]=a*m+c*_+g}if(this._roundPixels){const d=ft.RESOLUTION;for(let m=0;m<u.length;++m)u[m]=Math.round(u[m]*d)/d}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new DI(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,uc);const e=this.geometry.getBuffer("aVertexPosition").data,i=o_.points,r=this.geometry.getIndex().data,n=r.length,a=this.drawMode===4?3:1;for(let l=0;l+2<n;l+=a){const c=r[l]*2,f=r[l+1]*2,g=r[l+2]*2;if(i[0]=e[c],i[1]=e[c+1],i[2]=e[f],i[3]=e[f+1],i[4]=e[g],i[5]=e[g+1],o_.contains(uc.x,uc.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};sv.BATCHABLE_SIZE=100;let a_=sv;class LI extends es{constructor(t,e,i){super();const r=new _e(t),n=new _e(e,!0),a=new _e(i,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,Et.FLOAT).addAttribute("aTextureCoord",n,2,!1,Et.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var BI=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,OI=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class h_ extends nr{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:te.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||Er.from(OI,BI),i),this._colorDirty=!1,this.uvMatrix=new by(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new oe(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;oe.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class l_{constructor(t,e,i){this.geometry=new es,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||Et.FLOAT,offset:n.offset},e[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new _e(rE(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const l=this.dynamicProperties[a];l.offset=e,e+=l.size,this.dynamicStride+=l.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new _e(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const l=this.staticProperties[a];l.offset=r,r+=l.size,this.staticStride+=l.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new _e(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const l=this.dynamicProperties[a];t.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===Et.UNSIGNED_BYTE,l.type,this.dynamicStride*4,l.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const l=this.staticProperties[a];t.addAttribute(l.attributeName,this.staticBuffer,0,l.type===Et.UNSIGNED_BYTE,l.type,this.staticStride*4,l.offset*4)}}uploadDynamic(t,e,i){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(t,e,i,n.type===Et.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(t,e,i,n.type===Et.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var kI=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,NI=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ov extends Ph{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new te,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Et.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=nr.from(NI,kI,{}),this.state=ar.for2d()}render(t){const e=t.children,i=t._maxSize,r=t._batchSize,n=this.renderer;let a=e.length;if(a===0)return;a>i&&!t.autoResize&&(a=i);let l=t._buffers;l||(l=t._buffers=this.generateBuffers(t));const c=e[0]._texture.baseTexture,f=c.alphaMode>0;this.state.blendMode=sy(t.blendMode,f),n.state.set(this.state);const g=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=oe.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,f).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=c,this.renderer.shader.bind(this.shader);let d=!1;for(let m=0,_=0;m<a;m+=r,_+=1){let x=a-m;x>r&&(x=r),_>=l.length&&l.push(this._generateOneMoreBuffer(t));const v=l[_];v.uploadDynamic(e,m,x);const b=t._bufferUpdateIDs[_]||0;d=d||v._updateID<b,d&&(v._updateID=t._updateID,v.uploadStatic(e,m,x)),n.geometry.bind(v.geometry),g.drawElements(g.TRIANGLES,x*6,g.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,r=t._batchSize,n=t._properties;for(let a=0;a<i;a+=r)e.push(new l_(this.properties,n,r));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new l_(this.properties,i,e)}uploadVertices(t,e,i,r,n,a){let l=0,c=0,f=0,g=0;for(let u=0;u<i;++u){const d=t[e+u],m=d._texture,_=d.scale.x,x=d.scale.y,v=m.trim,b=m.orig;v?(c=v.x-d.anchor.x*b.width,l=c+v.width,g=v.y-d.anchor.y*b.height,f=g+v.height):(l=b.width*(1-d.anchor.x),c=b.width*-d.anchor.x,f=b.height*(1-d.anchor.y),g=b.height*-d.anchor.y),r[a]=c*_,r[a+1]=g*x,r[a+n]=l*_,r[a+n+1]=g*x,r[a+n*2]=l*_,r[a+n*2+1]=f*x,r[a+n*3]=c*_,r[a+n*3+1]=f*x,a+=n*4}}uploadPosition(t,e,i,r,n,a){for(let l=0;l<i;l++){const c=t[e+l].position;r[a]=c.x,r[a+1]=c.y,r[a+n]=c.x,r[a+n+1]=c.y,r[a+n*2]=c.x,r[a+n*2+1]=c.y,r[a+n*3]=c.x,r[a+n*3+1]=c.y,a+=n*4}}uploadRotation(t,e,i,r,n,a){for(let l=0;l<i;l++){const c=t[e+l].rotation;r[a]=c,r[a+n]=c,r[a+n*2]=c,r[a+n*3]=c,a+=n*4}}uploadUvs(t,e,i,r,n,a){for(let l=0;l<i;++l){const c=t[e+l]._texture._uvs;c?(r[a]=c.x0,r[a+1]=c.y0,r[a+n]=c.x1,r[a+n+1]=c.y1,r[a+n*2]=c.x2,r[a+n*2+1]=c.y2,r[a+n*3]=c.x3,r[a+n*3+1]=c.y3,a+=n*4):(r[a]=0,r[a+1]=0,r[a+n]=0,r[a+n+1]=0,r[a+n*2]=0,r[a+n*2+1]=0,r[a+n*3]=0,r[a+n*3+1]=0,a+=n*4)}}uploadTint(t,e,i,r,n,a){for(let l=0;l<i;++l){const c=t[e+l],f=oe.shared.setValue(c._tintRGB).toPremultiplied(c.alpha,c.texture.baseTexture.alphaMode>0);r[a]=f,r[a+n]=f,r[a+n*2]=f,r[a+n*3]=f,a+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ov.extension={name:"particle",type:lt.RendererPlugin};wt.add(ov);var Dh=(s=>(s[s.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",s[s.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",s))(Dh||{});const Ga={willReadFrequently:!0},Ki=class St{static get experimentalLetterSpacingSupported(){let t=St._experimentalLetterSpacingSupported;if(t!==void 0){const e=ft.ADAPTER.getCanvasRenderingContext2D().prototype;t=St._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,n,a,l,c,f){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=n,this.lineWidths=a,this.lineHeight=l,this.maxLineWidth=c,this.fontProperties=f}static measureText(t,e,i,r=St._canvas){i=i??e.wordWrap;const n=e.toFontString(),a=St.measureFont(n);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const l=r.getContext("2d",Ga);l.font=n;const c=(i?St.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),f=new Array(c.length);let g=0;for(let _=0;_<c.length;_++){const x=St._measureText(c[_],e.letterSpacing,l);f[_]=x,g=Math.max(g,x)}let u=g+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);const d=e.lineHeight||a.fontSize+e.strokeThickness;let m=Math.max(d,a.fontSize+e.strokeThickness*2)+e.leading+(c.length-1)*(d+e.leading);return e.dropShadow&&(m+=e.dropShadowDistance),new St(t,e,u,m,c,f,d+e.leading,g,a)}static _measureText(t,e,i){let r=!1;St.experimentalLetterSpacingSupported&&(St.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(t).width;return n>0&&(r?n-=e:n+=(St.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,i=St._canvas){const r=i.getContext("2d",Ga);let n=0,a="",l="";const c=Object.create(null),{letterSpacing:f,whiteSpace:g}=e,u=St.collapseSpaces(g),d=St.collapseNewlines(g);let m=!u;const _=e.wordWrapWidth+f,x=St.tokenize(t);for(let v=0;v<x.length;v++){let b=x[v];if(St.isNewline(b)){if(!d){l+=St.addLine(a),m=!u,a="",n=0;continue}b=" "}if(u){const T=St.isBreakingSpace(b),C=St.isBreakingSpace(a[a.length-1]);if(T&&C)continue}const S=St.getFromCache(b,f,c,r);if(S>_)if(a!==""&&(l+=St.addLine(a),a="",n=0),St.canBreakWords(b,e.breakWords)){const T=St.wordWrapSplit(b);for(let C=0;C<T.length;C++){let I=T[C],k=I,E=1;for(;T[C+E];){const X=T[C+E];if(!St.canBreakChars(k,X,b,C,e.breakWords))I+=X;else break;k=X,E++}C+=E-1;const B=St.getFromCache(I,f,c,r);B+n>_&&(l+=St.addLine(a),m=!1,a="",n=0),a+=I,n+=B}}else{a.length>0&&(l+=St.addLine(a),a="",n=0);const T=v===x.length-1;l+=St.addLine(b,!T),m=!1,a="",n=0}else S+n>_&&(m=!1,l+=St.addLine(a),a="",n=0),(a.length>0||!St.isBreakingSpace(b)||m)&&(a+=b,n+=S)}return l+=St.addLine(a,!1),l}static addLine(t,e=!0){return t=St.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,r){let n=i[t];return typeof n!="number"&&(n=St._measureText(t,e,r)+e,i[t]=n),n}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!St.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:St._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:St._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let r=0;r<t.length;r++){const n=t[r],a=t[r+1];if(St.isBreakingSpace(n,a)||St.isNewline(n)){i!==""&&(e.push(i),i=""),e.push(n);continue}i+=n}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,n){return!0}static wordWrapSplit(t){return St.graphemeSegmenter(t)}static measureFont(t){if(St._fonts[t])return St._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=St._canvas,r=St._context;r.font=t;const n=St.METRICS_STRING+St.BASELINE_SYMBOL,a=Math.ceil(r.measureText(n).width);let l=Math.ceil(r.measureText(St.BASELINE_SYMBOL).width);const c=Math.ceil(St.HEIGHT_MULTIPLIER*l);if(l=l*St.BASELINE_MULTIPLIER|0,a===0||c===0)return St._fonts[t]=e,e;i.width=a,i.height=c,r.fillStyle="#f00",r.fillRect(0,0,a,c),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(n,0,l);const f=r.getImageData(0,0,a,c).data,g=f.length,u=a*4;let d=0,m=0,_=!1;for(d=0;d<l;++d){for(let x=0;x<u;x+=4)if(f[m+x]!==255){_=!0;break}if(!_)m+=u;else break}for(e.ascent=l-d,m=g-u,_=!1,d=c;d>l;--d){for(let x=0;x<u;x+=4)if(f[m+x]!==255){_=!0;break}if(!_)m-=u;else break}return e.descent=d-l,e.fontSize=e.ascent+e.descent,St._fonts[t]=e,e}static clearMetrics(t=""){t?delete St._fonts[t]:St._fonts={}}static get _canvas(){if(!St.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",Ga)?.measureText)return St.__canvas=e,e;t=ft.ADAPTER.createCanvas()}catch{t=ft.ADAPTER.createCanvas()}t.width=t.height=10,St.__canvas=t}return St.__canvas}static get _context(){return St.__context||(St.__context=St._canvas.getContext("2d",Ga)),St.__context}};Ki.METRICS_STRING="|q",Ki.BASELINE_SYMBOL="M",Ki.BASELINE_MULTIPLIER=1.4,Ki.HEIGHT_MULTIPLIER=2,Ki.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const s=new Intl.Segmenter;return t=>[...s.segment(t)].map(e=>e.segment)}return s=>[...s]})(),Ki.experimentalLetterSpacing=!1,Ki._fonts={},Ki._newlines=[10,13],Ki._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Kr=Ki;const UI=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],av=class vo{constructor(t){this.styleID=0,this.reset(),dc(this,t,t)}clone(){const t={};return dc(t,this,vo.defaultStyle),new vo(t)}reset(){dc(this,vo.defaultStyle,vo.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=cc(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=cc(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){GI(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=cc(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!UI.includes(r)&&(r=`"${r}"`),e[i]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};av.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Dh.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Pr=av;function cc(s){const t=oe.shared,e=i=>{const r=t.setValue(i);return r.alpha===1?r.toHex():r.toRgbaString()};return Array.isArray(s)?s.map(e):e(s)}function GI(s,t){if(!Array.isArray(s)||!Array.isArray(t)||s.length!==t.length)return!1;for(let e=0;e<s.length;++e)if(s[e]!==t[e])return!1;return!0}function dc(s,t,e){for(const i in e)Array.isArray(t[i])?s[i]=t[i].slice():s[i]=t[i]}const HI={texture:!0,children:!1,baseTexture:!0},hv=class Jc extends hr{constructor(t,e,i){let r=!1;i||(i=ft.ADAPTER.createCanvas(),r=!0),i.width=3,i.height=3;const n=ct.from(i);n.orig=new Dt,n.trim=new Dt,super(n),this._ownCanvas=r,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Jc.defaultResolution??ft.RESOLUTION,this._autoResolution=Jc.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Kr.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Ht("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Kr.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,r=Kr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=r.width,a=r.height,l=r.lines,c=r.lineHeight,f=r.lineWidths,g=r.maxLineWidth,u=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,m;const _=e.dropShadow?2:1;for(let x=0;x<_;++x){const v=e.dropShadow&&x===0,b=v?Math.ceil(Math.max(1,a)+e.padding*2):0,S=b*this._resolution;if(v){i.fillStyle="black",i.strokeStyle="black";const C=e.dropShadowColor,I=e.dropShadowBlur*this._resolution,k=e.dropShadowDistance*this._resolution;i.shadowColor=oe.shared.setValue(C).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=I,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*k,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*k+S}else i.fillStyle=this._generateFillStyle(e,l,r),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let T=(c-u.fontSize)/2;c-u.fontSize<0&&(T=0);for(let C=0;C<l.length;C++)d=e.strokeThickness/2,m=e.strokeThickness/2+C*c+u.ascent+T,e.align==="right"?d+=g-f[C]:e.align==="center"&&(d+=(g-f[C])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(l[C],d+e.padding,m+e.padding-b,!0),e.fill&&this.drawLetterSpacing(l[C],d+e.padding,m+e.padding-b)}this.updateTexture()}drawLetterSpacing(t,e,i,r=!1){const n=this._style.letterSpacing;let a=!1;if(Kr.experimentalLetterSpacingSupported&&(Kr.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||a){r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let l=e;const c=Kr.graphemeSegmenter(t);let f=this.context.measureText(t).width,g=0;for(let u=0;u<c.length;++u){const d=c[u];r?this.context.strokeText(d,l,i):this.context.fillText(d,l,i);let m="";for(let _=u+1;_<c.length;++_)m+=c[_];g=this.context.measureText(m).width,l+=f-g+n,f=g}}updateTexture(){const t=this.canvas;if(this._style.trim){const a=aE(t);a.data&&(t.width=a.width,t.height=a.height,this.context.putImageData(a.data,0,0))}const e=this._texture,i=this._style,r=i.trim?0:i.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-r*2,e.orig.height=e._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const r=t.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let n;const a=t.dropShadow?t.dropShadowDistance:0,l=t.padding||0,c=this.canvas.width/this._resolution-a-l*2,f=this.canvas.height/this._resolution-a-l*2,g=r.slice(),u=t.fillGradientStops.slice();if(!u.length){const d=g.length+1;for(let m=1;m<d;++m)u.push(m/d)}if(g.unshift(r[0]),u.unshift(0),g.push(r[r.length-1]),u.push(1),t.fillGradientType===Dh.LINEAR_VERTICAL){n=this.context.createLinearGradient(c/2,l,c/2,f+l);const d=i.fontProperties.fontSize+t.strokeThickness;for(let m=0;m<e.length;m++){const _=i.lineHeight*(m-1)+d,x=i.lineHeight*m;let v=x;m>0&&_>x&&(v=(x+_)/2);const b=x+d,S=i.lineHeight*(m+1);let T=b;m+1<e.length&&S<b&&(T=(b+S)/2);const C=(T-v)/f;for(let I=0;I<g.length;I++){let k=0;typeof u[I]=="number"?k=u[I]:k=I/g.length;let E=Math.min(1,Math.max(0,v/f+k*C));E=Number(E.toFixed(5)),n.addColorStop(E,g[I])}}}else{n=this.context.createLinearGradient(l,f/2,c+l,f/2);const d=g.length+1;let m=1;for(let _=0;_<g.length;_++){let x;typeof u[_]=="number"?x=u[_]:x=m/d,n.addColorStop(x,g[_]),m++}}return n}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},HI,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Jr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Jr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Pr?this._style=t:this._style=new Pr(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};hv.defaultAutoResolution=!0;let bd=hv;class VI{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function WI(s,t){let e=!1;if(s?._textures?.length){for(let i=0;i<s._textures.length;i++)if(s._textures[i]instanceof ct){const r=s._textures[i].baseTexture;t.includes(r)||(t.push(r),e=!0)}}return e}function XI(s,t){if(s.baseTexture instanceof Ot){const e=s.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function $I(s,t){if(s._texture&&s._texture instanceof ct){const e=s._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function zI(s,t){return t instanceof bd?(t.updateText(!0),!0):!1}function qI(s,t){if(t instanceof Pr){const e=t.toFontString();return Kr.measureFont(e),!0}return!1}function YI(s,t){if(s instanceof bd){t.includes(s.style)||t.push(s.style),t.includes(s)||t.push(s);const e=s._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function jI(s,t){return s instanceof Pr?(t.includes(s)||t.push(s),!0):!1}const lv=class uv{constructor(t){this.limiter=new VI(uv.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(YI),this.registerFindHook(jI),this.registerFindHook(WI),this.registerFindHook(XI),this.registerFindHook($I),this.registerUploadHook(zI),this.registerUploadHook(qI)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,He.system.addOnce(this.tick,this,Ns.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)He.system.addOnce(this.tick,this,Ns.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ee)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&He.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};lv.uploadsPerFrame=4;let Qc=lv;Object.defineProperties(ft,{UPLOADS_PER_FRAME:{get(){return Qc.uploadsPerFrame},set(s){Ht("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Qc.uploadsPerFrame=s}}});function cv(s,t){return t instanceof Ot?(t._glTextures[s.CONTEXT_UID]||s.texture.bind(t),!0):!1}function KI(s,t){if(!(t instanceof Ui))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let r=0;r<i.length;r++){const{texture:n}=i[r].style;n&&cv(s,n.baseTexture)}return e.batchable||s.geometry.bind(e,t._resolveDirectShader(s)),!0}function ZI(s,t){return s instanceof Ui?(t.push(s),!0):!1}class dv extends Qc{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(ZI),this.registerUploadHook(cv),this.registerUploadHook(KI)}}dv.extension={name:"prepare",type:lt.RendererSystem};wt.add(dv);var JI=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,QI=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,tP=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,u_=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,eP=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Ha=new te;class fv extends Ph{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new _y,this.state=ar.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=nr.from(u_,eP,e),this.shader=t.context.webGLVersion>1?nr.from(QI,JI,e):nr.from(u_,tP,e)}render(t){const e=this.renderer,i=this.quad;let r=i.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;r=i.uvs,r[0]=r[6]=-n,r[1]=r[3]=-a,r[2]=r[4]=1-n,r[5]=r[7]=1-a,i.invalidate();const l=t._texture,c=l.baseTexture,f=c.alphaMode>0,g=t.tileTransform.localTransform,u=t.uvMatrix;let d=c.isPowerOfTwo&&l.frame.width===c.width&&l.frame.height===c.height;d&&(c._glTextures[e.CONTEXT_UID]?d=c.wrapMode!==ts.CLAMP:c.wrapMode===ts.CLAMP&&(c.wrapMode=ts.REPEAT));const m=d?this.simpleShader:this.shader,_=l.width,x=l.height,v=t._width,b=t._height;Ha.set(g.a*_/v,g.b*_/b,g.c*x/v,g.d*x/b,g.tx/v,g.ty/b),Ha.invert(),d?Ha.prepend(u.mapCoord):(m.uniforms.uMapCoord=u.mapCoord.toArray(!0),m.uniforms.uClampFrame=u.uClampFrame,m.uniforms.uClampOffset=u.uClampOffset),m.uniforms.uTransform=Ha.toArray(!0),m.uniforms.uColor=oe.shared.setValue(t.tint).premultiply(t.worldAlpha,f).toArray(m.uniforms.uColor),m.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),m.uniforms.uSampler=l,e.shader.bind(m),e.geometry.bind(i),this.state.blendMode=sy(t.blendMode,f),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}fv.extension={name:"tilingSprite",type:lt.RendererPlugin};wt.add(fv);const pv=class xo{constructor(t,e,i){this.linkedSheets=[],(t instanceof Ot||t instanceof ct)&&(t={texture:t,data:e,resolutionFilename:i});const{texture:r,data:n,resolutionFilename:a=null,cachePrefix:l=""}=t;this.cachePrefix=l,this._texture=r instanceof ct?r:null,this.baseTexture=r instanceof Ot?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const c=this.baseTexture.resource;this.resolution=this._updateResolution(a||(c?c.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=Mr(t,null);return i===null&&(i=typeof e=="number"?e:parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=xo.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=xo.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const r=this._frameKeys[e],n=this._frames[r],a=n.frame;if(a){let l=null,c=null;const f=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,g=new Dt(0,0,Math.floor(f.w)/this.resolution,Math.floor(f.h)/this.resolution);n.rotated?l=new Dt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):l=new Dt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(c=new Dt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[r]=new ct(this.baseTexture,l,g,c,n.rotated?2:0,n.anchor,n.borders),ct.addToCache(this.textures[r],this.cachePrefix+r.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*xo.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*xo.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};pv.BATCH_SIZE=1e3;let c_=pv;const iP=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function mv(s,t,e){const i={};if(s.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[`${t.cachePrefix}${r}`]=t.textures[r]}),!e){const r=Ae.dirname(s[0]);t.linkedSheets.forEach((n,a)=>{Object.assign(i,mv([`${r}/${t.data.meta.related_multi_packs[a]}`],n,!0))})}return i}const rP={extension:lt.Asset,cache:{test:s=>s instanceof c_,getCacheableAssets:(s,t)=>mv(s,t,!1)},resolver:{test:s=>{const t=s.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&iP.includes(i)},parse:s=>{const t=s.split(".");return{resolution:parseFloat(ft.RETINA_PREFIX.exec(s)?.[1]??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:lt.LoadParser,priority:Gi.Normal},async testParse(s,t){return Ae.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){const{texture:i,imageFilename:r,cachePrefix:n}=t?.data??{};let a=Ae.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(i&&i.baseTexture)l=i;else{const g=Yc(a+(r??s.meta.image),t.src);l=(await e.load([g]))[g]}const c=new c_({texture:l.baseTexture,data:s,resolutionFilename:t.src,cachePrefix:n});await c.parse();const f=s?.meta?.related_multi_packs;if(Array.isArray(f)){const g=[];for(const d of f){if(typeof d!="string")continue;let m=a+d;t.data?.ignoreMultiPack||(m=Yc(m,t.src),g.push(e.load({src:m,data:{ignoreMultiPack:!0}})))}const u=await Promise.all(g);c.linkedSheets=u,u.forEach(d=>{d.linkedSheets=[c].concat(c.linkedSheets.filter(m=>m!==d))})}return c},unload(s){s.destroy(!0)}}};wt.add(rP);class _h{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class th{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const a=e[n].match(/^[a-z]+/gm)[0],l=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),c={};for(const f in l){const g=l[f].split("="),u=g[0],d=g[1].replace(/"/gm,""),m=parseFloat(d),_=isNaN(m)?d:m;c[u]=_}i[a].push(c)}const r=new _h;return i.info.forEach(n=>r.info.push({face:n.face,size:parseInt(n.size,10)})),i.common.forEach(n=>r.common.push({lineHeight:parseInt(n.lineHeight,10)})),i.page.forEach(n=>r.page.push({id:parseInt(n.id,10),file:n.file})),i.char.forEach(n=>r.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),i.kerning.forEach(n=>r.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),i.distanceField.forEach(n=>r.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),r}}class td{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new _h,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),l=t.getElementsByTagName("kerning"),c=t.getElementsByTagName("distanceField");for(let f=0;f<i.length;f++)e.info.push({face:i[f].getAttribute("face"),size:parseInt(i[f].getAttribute("size"),10)});for(let f=0;f<r.length;f++)e.common.push({lineHeight:parseInt(r[f].getAttribute("lineHeight"),10)});for(let f=0;f<n.length;f++)e.page.push({id:parseInt(n[f].getAttribute("id"),10)||0,file:n[f].getAttribute("file")});for(let f=0;f<a.length;f++){const g=a[f];e.char.push({id:parseInt(g.getAttribute("id"),10),page:parseInt(g.getAttribute("page"),10)||0,x:parseInt(g.getAttribute("x"),10),y:parseInt(g.getAttribute("y"),10),width:parseInt(g.getAttribute("width"),10),height:parseInt(g.getAttribute("height"),10),xoffset:parseInt(g.getAttribute("xoffset"),10),yoffset:parseInt(g.getAttribute("yoffset"),10),xadvance:parseInt(g.getAttribute("xadvance"),10)})}for(let f=0;f<l.length;f++)e.kerning.push({first:parseInt(l[f].getAttribute("first"),10),second:parseInt(l[f].getAttribute("second"),10),amount:parseInt(l[f].getAttribute("amount"),10)});for(let f=0;f<c.length;f++)e.distanceField.push({fieldType:c[f].getAttribute("fieldType"),distanceRange:parseInt(c[f].getAttribute("distanceRange"),10)});return e}}class ed{static test(t){return typeof t=="string"&&t.includes("<font>")?td.test(ft.ADAPTER.parseXML(t)):!1}static parse(t){return td.parse(ft.ADAPTER.parseXML(t))}}const fc=[th,td,ed];function sP(s){for(let t=0;t<fc.length;t++)if(fc[t].test(s))return fc[t];return null}function nP(s,t,e,i,r,n){const a=e.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let l;const c=e.dropShadow?e.dropShadowDistance:0,f=e.padding||0,g=s.width/i-c-f*2,u=s.height/i-c-f*2,d=a.slice(),m=e.fillGradientStops.slice();if(!m.length){const _=d.length+1;for(let x=1;x<_;++x)m.push(x/_)}if(d.unshift(a[0]),m.unshift(0),d.push(a[a.length-1]),m.push(1),e.fillGradientType===Dh.LINEAR_VERTICAL){l=t.createLinearGradient(g/2,f,g/2,u+f);let _=0;const x=(n.fontProperties.fontSize+e.strokeThickness)/u;for(let v=0;v<r.length;v++){const b=n.lineHeight*v;for(let S=0;S<d.length;S++){let T=0;typeof m[S]=="number"?T=m[S]:T=S/d.length;const C=b/u+T*x;let I=Math.max(_,C);I=Math.min(I,1),l.addColorStop(I,d[S]),_=I}}}else{l=t.createLinearGradient(f,u/2,g+f,u/2);const _=d.length+1;let x=1;for(let v=0;v<d.length;v++){let b;typeof m[v]=="number"?b=m[v]:b=x/_,l.addColorStop(b,d[v]),x++}}return l}function oP(s,t,e,i,r,n,a){const l=e.text,c=e.fontProperties;t.translate(i,r),t.scale(n,n);const f=a.strokeThickness/2,g=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=nP(s,t,a,n,[l],e),t.strokeStyle=a.stroke,a.dropShadow){const u=a.dropShadowColor,d=a.dropShadowBlur*n,m=a.dropShadowDistance*n;t.shadowColor=oe.shared.setValue(u).setAlpha(a.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*m,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*m}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(l,f,g+e.lineHeight-c.descent),a.fill&&t.fillText(l,f,g+e.lineHeight-c.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function eh(s){return s.codePointAt?s.codePointAt(0):s.charCodeAt(0)}function gv(s){return Array.from?Array.from(s):s.split("")}function aP(s){typeof s=="string"&&(s=[s]);const t=[];for(let e=0,i=s.length;e<i;e++){const r=s[e];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const n=r[0].charCodeAt(0),a=r[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let l=n,c=a;l<=c;l++)t.push(String.fromCharCode(l))}else t.push(...gv(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const qr=class Zi{constructor(t,e,i){const[r]=t.info,[n]=t.common,[a]=t.page,[l]=t.distanceField,c=Mr(a.file),f={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/c,this.chars={},this.pageTextures=f;for(let g=0;g<t.page.length;g++){const{id:u,file:d}=t.page[g];f[u]=e instanceof Array?e[g]:e[d],l?.fieldType&&l.fieldType!=="none"&&(f[u].baseTexture.alphaMode=Ye.NO_PREMULTIPLIED_ALPHA,f[u].baseTexture.mipmap=or.OFF)}for(let g=0;g<t.char.length;g++){const{id:u,page:d}=t.char[g];let{x:m,y:_,width:x,height:v,xoffset:b,yoffset:S,xadvance:T}=t.char[g];m/=c,_/=c,x/=c,v/=c,b/=c,S/=c,T/=c;const C=new Dt(m+f[d].frame.x/c,_+f[d].frame.y/c,x,v);this.chars[u]={xOffset:b,yOffset:S,xAdvance:T,kerning:{},texture:new ct(f[d].baseTexture,C),page:d}}for(let g=0;g<t.kerning.length;g++){let{first:u,second:d,amount:m}=t.kerning[g];u/=c,d/=c,m/=c,this.chars[d]&&(this.chars[d].kerning[u]=m)}this.distanceFieldRange=l?.distanceRange,this.distanceFieldType=l?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let r;if(t instanceof _h)r=t;else{const a=sP(t);if(!a)throw new Error("Unrecognized data format for font.");r=a.parse(t)}e instanceof ct&&(e=[e]);const n=new Zi(r,e,i);return Zi.available[n.font]=n,n}static uninstall(t){const e=Zi.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Zi.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:n,resolution:a,textureWidth:l,textureHeight:c,...f}=Object.assign({},Zi.defaultOptions,i),g=aP(r),u=e instanceof Pr?e:new Pr(e),d=l,m=new _h;m.info[0]={face:u.fontFamily,size:u.fontSize},m.common[0]={lineHeight:u.fontSize};let _=0,x=0,v,b,S,T=0;const C=[];for(let k=0;k<g.length;k++){v||(v=ft.ADAPTER.createCanvas(),v.width=l,v.height=c,b=v.getContext("2d"),S=new Ot(v,{resolution:a,...f}),C.push(new ct(S)),m.page.push({id:C.length-1,file:""}));const E=g[k],B=Kr.measureText(E,u,!1,v),X=B.width,tt=Math.ceil(B.height),Z=Math.ceil((u.fontStyle==="italic"?2:1)*X);if(x>=c-tt*a){if(x===0)throw new Error(`[BitmapFont] textureHeight ${c}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${E}')`);--k,v=null,b=null,S=null,x=0,_=0,T=0;continue}if(T=Math.max(tt+B.fontProperties.descent,T),Z*a+_>=d){if(_===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${E}')`);--k,x+=T*a,x=Math.ceil(x),_=0,T=0;continue}oP(v,b,B,_,x,a,u);const H=eh(B.text);m.char.push({id:H,page:C.length-1,x:_/a,y:x/a,width:Z,height:tt,xoffset:0,yoffset:0,xadvance:X-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),_+=(Z+2*n)*a,_=Math.ceil(_)}if(!i?.skipKerning)for(let k=0,E=g.length;k<E;k++){const B=g[k];for(let X=0;X<E;X++){const tt=g[X],Z=b.measureText(B).width,H=b.measureText(tt).width,K=b.measureText(B+tt).width-(Z+H);K&&m.kerning.push({first:eh(B),second:eh(tt),amount:K})}}const I=new Zi(m,C,!0);return Zi.available[t]!==void 0&&Zi.uninstall(t),Zi.available[t]=I,I}};qr.ALPHA=[["a","z"],["A","Z"]," "],qr.NUMERIC=[["0","9"]],qr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],qr.ASCII=[[" ","~"]],qr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:qr.ALPHANUMERIC},qr.available={};let Yr=qr;var hP=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,lP=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const d_=[],f_=[],p_=[],uP=class _v extends Ee{constructor(t,e={}){super();const{align:i,tint:r,maxWidth:n,letterSpacing:a,fontName:l,fontSize:c}=Object.assign({},_v.styleDefaults,e);if(!Yr.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new oe(r),this._font=void 0,this._fontName=l,this._fontSize=c,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new rr(()=>{this.dirty=!0},this,0,0),this._roundPixels=ft.ROUND_PIXELS,this.dirty=!0,this._resolution=ft.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=Yr.available[this._fontName],e=this.fontSize,i=e/t.size,r=new zt,n=[],a=[],l=[],c=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",f=gv(c),g=this._maxWidth*t.size/e,u=t.distanceFieldType==="none"?d_:f_;let d=null,m=0,_=0,x=0,v=-1,b=0,S=0,T=0,C=0;for(let Z=0;Z<f.length;Z++){const H=f[Z],K=eh(H);if(/(?:\s)/.test(H)&&(v=Z,b=m,C++),H==="\r"||H===`
`){a.push(m),l.push(-1),_=Math.max(_,m),++x,++S,r.x=0,r.y+=t.lineHeight,d=null,C=0;continue}const j=t.chars[K];if(!j)continue;d&&j.kerning[d]&&(r.x+=j.kerning[d]);const _t=p_.pop()||{texture:ct.EMPTY,line:0,charCode:0,prevSpaces:0,position:new zt};_t.texture=j.texture,_t.line=x,_t.charCode=K,_t.position.x=Math.round(r.x+j.xOffset+this._letterSpacing/2),_t.position.y=Math.round(r.y+j.yOffset),_t.prevSpaces=C,n.push(_t),m=_t.position.x+Math.max(j.xAdvance-j.xOffset,j.texture.orig.width),r.x+=j.xAdvance+this._letterSpacing,T=Math.max(T,j.yOffset+j.texture.height),d=K,v!==-1&&g>0&&r.x>g&&(++S,xn(n,1+v-S,1+Z-v),Z=v,v=-1,a.push(b),l.push(n.length>0?n[n.length-1].prevSpaces:0),_=Math.max(_,b),x++,r.x=0,r.y+=t.lineHeight,d=null,C=0)}const I=f[f.length-1];I!=="\r"&&I!==`
`&&(/(?:\s)/.test(I)&&(m=b),a.push(m),_=Math.max(_,m),l.push(-1));const k=[];for(let Z=0;Z<=x;Z++){let H=0;this._align==="right"?H=_-a[Z]:this._align==="center"?H=(_-a[Z])/2:this._align==="justify"&&(H=l[Z]<0?0:(_-a[Z])/l[Z]),k.push(H)}const E=n.length,B={},X=[],tt=this._activePagesMeshData;u.push(...tt);for(let Z=0;Z<E;Z++){const H=n[Z].texture,K=H.baseTexture.uid;if(!B[K]){let j=u.pop();if(!j){const R=new LI;let F,P;t.distanceFieldType==="none"?(F=new h_(ct.EMPTY),P=Rt.NORMAL):(F=new h_(ct.EMPTY,{program:Er.from(lP,hP),uniforms:{uFWidth:0}}),P=Rt.NORMAL_NPM);const V=new a_(R,F);V.blendMode=P,j={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:V,vertices:null,uvs:null,indices:null}}j.index=0,j.indexCount=0,j.vertexCount=0,j.uvsCount=0,j.total=0;const{_textureCache:_t}=this;_t[K]=_t[K]||new ct(H.baseTexture),j.mesh.texture=_t[K],j.mesh.tint=this._tintColor.value,X.push(j),B[K]=j}B[K].total++}for(let Z=0;Z<tt.length;Z++)X.includes(tt[Z])||this.removeChild(tt[Z].mesh);for(let Z=0;Z<X.length;Z++)X[Z].mesh.parent!==this&&this.addChild(X[Z].mesh);this._activePagesMeshData=X;for(const Z in B){const H=B[Z],K=H.total;if(!(H.indices?.length>6*K)||H.vertices.length<a_.BATCHABLE_SIZE*2)H.vertices=new Float32Array(8*K),H.uvs=new Float32Array(8*K),H.indices=new Uint16Array(6*K);else{const j=H.total,_t=H.vertices;for(let R=j*4*2;R<_t.length;R++)_t[R]=0}H.mesh.size=6*K}for(let Z=0;Z<E;Z++){const H=n[Z];let K=H.position.x+k[H.line]*(this._align==="justify"?H.prevSpaces:1);this._roundPixels&&(K=Math.round(K));const j=K*i,_t=H.position.y*i,R=H.texture,F=B[R.baseTexture.uid],P=R.frame,V=R._uvs,L=F.index++;F.indices[L*6+0]=0+L*4,F.indices[L*6+1]=1+L*4,F.indices[L*6+2]=2+L*4,F.indices[L*6+3]=0+L*4,F.indices[L*6+4]=2+L*4,F.indices[L*6+5]=3+L*4,F.vertices[L*8+0]=j,F.vertices[L*8+1]=_t,F.vertices[L*8+2]=j+P.width*i,F.vertices[L*8+3]=_t,F.vertices[L*8+4]=j+P.width*i,F.vertices[L*8+5]=_t+P.height*i,F.vertices[L*8+6]=j,F.vertices[L*8+7]=_t+P.height*i,F.uvs[L*8+0]=V.x0,F.uvs[L*8+1]=V.y0,F.uvs[L*8+2]=V.x1,F.uvs[L*8+3]=V.y1,F.uvs[L*8+4]=V.x2,F.uvs[L*8+5]=V.y2,F.uvs[L*8+6]=V.x3,F.uvs[L*8+7]=V.y3}this._textWidth=_*i,this._textHeight=(r.y+t.lineHeight)*i;for(const Z in B){const H=B[Z];if(this.anchor.x!==0||this.anchor.y!==0){let R=0;const F=this._textWidth*this.anchor.x,P=this._textHeight*this.anchor.y;for(let V=0;V<H.total;V++)H.vertices[R++]-=F,H.vertices[R++]-=P,H.vertices[R++]-=F,H.vertices[R++]-=P,H.vertices[R++]-=F,H.vertices[R++]-=P,H.vertices[R++]-=F,H.vertices[R++]-=P}this._maxLineHeight=T*i;const K=H.mesh.geometry.getBuffer("aVertexPosition"),j=H.mesh.geometry.getBuffer("aTextureCoord"),_t=H.mesh.geometry.getIndex();K.data=H.vertices,j.data=H.uvs,_t.data=H.indices,K.update(),j.update(),_t.update()}for(let Z=0;Z<n.length;Z++)p_.push(n[Z]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:r}=Yr.available[this._fontName];if(i!=="none"){const{a:n,b:a,c:l,d:c}=this.worldTransform,f=Math.sqrt(n*n+a*a),g=Math.sqrt(l*l+c*c),u=(Math.abs(f)+Math.abs(g))/2,d=this.fontSize/r,m=t._view.resolution;for(const _ of this._activePagesMeshData)_.mesh.shader.uniforms.uFWidth=u*e*d*m}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Yr.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Yr.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Yr.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i=Yr.available[this._fontName].distanceFieldType==="none"?d_:f_;i.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],i.filter(r=>e[r.mesh.texture.baseTexture.uid]).forEach(r=>{r.mesh.texture=ct.EMPTY});for(const r in e)e[r].destroy(),delete e[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};uP.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const cP=[".xml",".fnt"],dP={extension:{type:lt.LoadParser,priority:Gi.Normal},name:"loadBitmapFont",test(s){return cP.includes(Ae.extname(s).toLowerCase())},async testParse(s){return th.test(s)||ed.test(s)},async parse(s,t,e){const i=th.test(s)?th.parse(s):ed.parse(s),{src:r}=t,{page:n}=i,a=[];for(let f=0;f<n.length;++f){const g=n[f].file;let u=Ae.join(Ae.dirname(r),g);u=Yc(u,r),a.push(u)}const l=await e.load(a),c=a.map(f=>l[f]);return Yr.install(i,c,!0)},async load(s,t){return(await ft.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}};wt.add(dP);const id=class pn extends Pr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new pn(Object.keys(pn.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete pn.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=pn;if(i[t]){const r=i[t];return this._fonts.push(r),r.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ft.ADAPTER.fetch(t).then(r=>r.blob()).then(async r=>new Promise((n,a)=>{const l=URL.createObjectURL(r),c=new FileReader;c.onload=()=>n([l,c.result]),c.onerror=a,c.readAsDataURL(r)})).then(async([r,n])=>{const a=Object.assign({family:Ae.basename(t,Ae.extname(t)),weight:"normal",style:"normal",display:"auto",src:r,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);i[t]=a,this._fonts.push(a),this.styleID++;const l=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=l,await l.load(),document.fonts.add(l),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=eE(t)),typeof t=="number"?tE(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const n=`${i}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,pn.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=ft.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};id.availableFonts={},id.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let pc=id;const Va=class mn extends hr{constructor(t="",e={}){super(ct.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,r=ct.from(i,{scaleMode:ft.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new Dt,r.trim=new Dt,this.texture=r;const n="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",l=document.createElementNS(n,"svg"),c=document.createElementNS(n,"foreignObject"),f=document.createElementNS(a,"div"),g=document.createElementNS(a,"style");c.setAttribute("width","10000"),c.setAttribute("height","10000"),c.style.overflow="hidden",l.appendChild(c),this.maxWidth=mn.defaultMaxWidth,this.maxHeight=mn.defaultMaxHeight,this._domElement=f,this._styleElement=g,this._svgRoot=l,this._foreignObject=c,this._foreignObject.appendChild(g),this._foreignObject.appendChild(f),this._image=i,this._loadImage=new Image,this._autoResolution=mn.defaultAutoResolution,this._resolution=mn.defaultResolution??ft.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:i,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(r)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:l}=n;(a>this.maxWidth||l>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const c=Math.min(this.maxWidth,Math.ceil(a)),f=Math.min(this.maxHeight,Math.ceil(l));return this._svgRoot.setAttribute("width",c.toString()),this._svgRoot.setAttribute("height",f.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:c+i.padding*2,height:f+i.padding*2}}async updateText(t=!0){const{style:e,_image:i,_loadImage:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:a}=this.measureText();i.width=r.width=Math.ceil(Math.max(1,n)),i.height=r.height=Math.ceil(Math.max(1,a)),this._updateID++;const l=this._updateID;await new Promise(c=>{r.onload=async()=>{if(l<this._updateID){c();return}await e.onBeforeDraw(),i.src=r.src,r.onload=null,r.src="",this.updateTexture(),c()};const f=new XMLSerializer().serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(f)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:r}=this,{padding:n}=t,{baseTexture:a}=e;e.trim.width=e._frame.width=i.width/r,e.trim.height=e._frame.height=i.height/r,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),a.setRealSize(i.width,i.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},mn.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Jr(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Jr(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof pc?(this.ownsStyle=!1,this._style=t):t instanceof Pr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=pc.from(t)):(this.ownsStyle=!0,this._style=new pc(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Va.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Va.defaultMaxWidth=2024,Va.defaultMaxHeight=2024,Va.defaultAutoResolution=!0;const yv=[{dx:0,dy:1,code:2},{dx:-1,dy:0,code:4},{dx:1,dy:0,code:6},{dx:0,dy:-1,code:8}],wd=yv.map(s=>({dx:s.dx,dy:s.dy}));function yh(s,t=!1){const e=s.length,i=e>0?s[0].length:0;return Array.from({length:e},()=>Array(i).fill(t))}function An(s,t,e){const i=s.length,r=s[0].length;return t>=0&&t<r&&e>=0&&e<i}function En(s,t,e,i){return t?s[i][e]==="."&&t[i][e]:s[i][e]==="."}function fP(s,t,e){return s[e][t]==="."}function m_(s,t,e,i){if(!En(s,t,e,i)||!t[i][e])return!1;for(const r of wd){const n=e+r.dx,a=i+r.dy;if(An(s,n,a)&&fP(s,n,a)&&!t[a][n])return!0}return!1}function Td(s,t,e,i){const r=e.length;if(r===0)return null;const n=e[0].length;if(!An(e,s.x,s.y)||!An(e,t.x,t.y)||!En(e,i,s.x,s.y)||!En(e,i,t.x,t.y))return null;const a=yh(e),l=Array.from({length:r},()=>Array(n).fill(null)),c=[];for(c.push({...s}),a[s.y][s.x]=!0;c.length>0;){const d=c.shift();if(d.x===t.x&&d.y===t.y)break;for(const m of yv){const _=d.x+m.dx,x=d.y+m.dy;An(e,_,x)&&En(e,i,_,x)&&(a[x][_]||(a[x][_]=!0,l[x][_]={x:d.x,y:d.y,dir:m.code},c.push({x:_,y:x})))}}if(!a[t.y][t.x])return null;const f=[];let g=t.x,u=t.y;for(;!(g===s.x&&u===s.y);){const d=l[u][g];if(!d)return null;f.push(d.dir),g=d.x,u=d.y}return f.reverse(),f}function g_(s,t,e,i){if(!An(t,s.x,s.y)||!En(t,e,s.x,s.y))return null;if(m_(t,e,s.x,s.y))return{...s};const r=yh(t),n=[],a=[];for(n.push({...s}),r[s.y][s.x]=!0;n.length>0;){const c=n.shift();m_(t,e,c.x,c.y)&&a.push({...c});for(const f of wd){const g=c.x+f.dx,u=c.y+f.dy;An(t,g,u)&&En(t,e,g,u)&&(r[u][g]||(r[u][g]=!0,n.push({x:g,y:u})))}}if(a.length===0)return null;if(!i)return a[0];const l=a.filter(c=>pP(s,c,i));return l.length>0?l[0]:a[0]}function pP(s,t,e){const i=t.x-s.x,r=t.y-s.y;switch(e){case 2:return r>0&&Math.abs(r)>=Math.abs(i);case 8:return r<0&&Math.abs(r)>=Math.abs(i);case 4:return i<0&&Math.abs(i)>=Math.abs(r);case 6:return i>0&&Math.abs(i)>=Math.abs(r);default:return!1}}function Sd(s,t,e){const i=e.length,r=e[0].length,n=yh(e),a=yh(e),l=(g,u)=>g>=0&&u>=0&&g<r&&u<i,c=(g,u)=>e[u][g]==="#",f=[];for(f.push({x:s.x,y:s.y,dist:0}),a[s.y][s.x]=!0;f.length>0;){const{x:g,y:u,dist:d}=f.shift();if(n[u][g]=!0,!(d>=t))for(const{dx:m,dy:_}of wd){const x=g+m,v=u+_;if(l(x,v)&&!a[v][x]){if(a[v][x]=!0,c(x,v)){n[v][x]=!0;continue}f.push({x,y:v,dist:d+1})}}}return n}function mP(s,t,e){const i=Sd(s,t,e),r=[],n=e.length,a=e[0].length;for(let l=0;l<n;l++)for(let c=0;c<a;c++)i[l][c]&&r.push({x:c,y:l});return r}var mc={};var __;function gP(){return __||(__=1,(function(s){(function(){var t=function(){this.init()};t.prototype={init:function(){var u=this||e;return u._counter=1e3,u._html5AudioPool=[],u.html5PoolSize=10,u._codecs={},u._howls=[],u._muted=!1,u._volume=1,u._canPlayEvent="canplaythrough",u._navigator=typeof window<"u"&&window.navigator?window.navigator:null,u.masterGain=null,u.noAudio=!1,u.usingWebAudio=!0,u.autoSuspend=!0,u.ctx=null,u.autoUnlock=!0,u._setup(),u},volume:function(u){var d=this||e;if(u=parseFloat(u),d.ctx||g(),typeof u<"u"&&u>=0&&u<=1){if(d._volume=u,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u,e.ctx.currentTime);for(var m=0;m<d._howls.length;m++)if(!d._howls[m]._webAudio)for(var _=d._howls[m]._getSoundIds(),x=0;x<_.length;x++){var v=d._howls[m]._soundById(_[x]);v&&v._node&&(v._node.volume=v._volume*u)}return d}return d._volume},mute:function(u){var d=this||e;d.ctx||g(),d._muted=u,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u?0:d._volume,e.ctx.currentTime);for(var m=0;m<d._howls.length;m++)if(!d._howls[m]._webAudio)for(var _=d._howls[m]._getSoundIds(),x=0;x<_.length;x++){var v=d._howls[m]._soundById(_[x]);v&&v._node&&(v._node.muted=u?!0:v._muted)}return d},stop:function(){for(var u=this||e,d=0;d<u._howls.length;d++)u._howls[d].stop();return u},unload:function(){for(var u=this||e,d=u._howls.length-1;d>=0;d--)u._howls[d].unload();return u.usingWebAudio&&u.ctx&&typeof u.ctx.close<"u"&&(u.ctx.close(),u.ctx=null,g()),u},codecs:function(u){return(this||e)._codecs[u.replace(/^x-/,"")]},_setup:function(){var u=this||e;if(u.state=u.ctx&&u.ctx.state||"suspended",u._autoSuspend(),!u.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(u._canPlayEvent="canplay")}catch{u.noAudio=!0}else u.noAudio=!0;try{var d=new Audio;d.muted&&(u.noAudio=!0)}catch{}return u.noAudio||u._setupCodecs(),u},_setupCodecs:function(){var u=this||e,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return u}if(!d||typeof d.canPlayType!="function")return u;var m=d.canPlayType("audio/mpeg;").replace(/^no$/,""),_=u._navigator?u._navigator.userAgent:"",x=_.match(/OPR\/(\d+)/g),v=x&&parseInt(x[0].split("/")[1],10)<33,b=_.indexOf("Safari")!==-1&&_.indexOf("Chrome")===-1,S=_.match(/Version\/(.*?) /),T=b&&S&&parseInt(S[1],10)<15;return u._codecs={mp3:!!(!v&&(m||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!m,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!T&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!T&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},u},_unlockAudio:function(){var u=this||e;if(!(u._audioUnlocked||!u.ctx)){u._audioUnlocked=!1,u.autoUnlock=!1,!u._mobileUnloaded&&u.ctx.sampleRate!==44100&&(u._mobileUnloaded=!0,u.unload()),u._scratchBuffer=u.ctx.createBuffer(1,1,22050);var d=function(m){for(;u._html5AudioPool.length<u.html5PoolSize;)try{var _=new Audio;_._unlocked=!0,u._releaseHtml5Audio(_)}catch{u.noAudio=!0;break}for(var x=0;x<u._howls.length;x++)if(!u._howls[x]._webAudio)for(var v=u._howls[x]._getSoundIds(),b=0;b<v.length;b++){var S=u._howls[x]._soundById(v[b]);S&&S._node&&!S._node._unlocked&&(S._node._unlocked=!0,S._node.load())}u._autoResume();var T=u.ctx.createBufferSource();T.buffer=u._scratchBuffer,T.connect(u.ctx.destination),typeof T.start>"u"?T.noteOn(0):T.start(0),typeof u.ctx.resume=="function"&&u.ctx.resume(),T.onended=function(){T.disconnect(0),u._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var C=0;C<u._howls.length;C++)u._howls[C]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),u}},_obtainHtml5Audio:function(){var u=this||e;if(u._html5AudioPool.length)return u._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(u){var d=this||e;return u._unlocked&&d._html5AudioPool.push(u),d},_autoSuspend:function(){var u=this;if(!(!u.autoSuspend||!u.ctx||typeof u.ctx.suspend>"u"||!e.usingWebAudio)){for(var d=0;d<u._howls.length;d++)if(u._howls[d]._webAudio){for(var m=0;m<u._howls[d]._sounds.length;m++)if(!u._howls[d]._sounds[m]._paused)return u}return u._suspendTimer&&clearTimeout(u._suspendTimer),u._suspendTimer=setTimeout(function(){if(u.autoSuspend){u._suspendTimer=null,u.state="suspending";var _=function(){u.state="suspended",u._resumeAfterSuspend&&(delete u._resumeAfterSuspend,u._autoResume())};u.ctx.suspend().then(_,_)}},3e4),u}},_autoResume:function(){var u=this;if(!(!u.ctx||typeof u.ctx.resume>"u"||!e.usingWebAudio))return u.state==="running"&&u.ctx.state!=="interrupted"&&u._suspendTimer?(clearTimeout(u._suspendTimer),u._suspendTimer=null):u.state==="suspended"||u.state==="running"&&u.ctx.state==="interrupted"?(u.ctx.resume().then(function(){u.state="running";for(var d=0;d<u._howls.length;d++)u._howls[d]._emit("resume")}),u._suspendTimer&&(clearTimeout(u._suspendTimer),u._suspendTimer=null)):u.state==="suspending"&&(u._resumeAfterSuspend=!0),u}};var e=new t,i=function(u){var d=this;if(!u.src||u.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}d.init(u)};i.prototype={init:function(u){var d=this;return e.ctx||g(),d._autoplay=u.autoplay||!1,d._format=typeof u.format!="string"?u.format:[u.format],d._html5=u.html5||!1,d._muted=u.mute||!1,d._loop=u.loop||!1,d._pool=u.pool||5,d._preload=typeof u.preload=="boolean"||u.preload==="metadata"?u.preload:!0,d._rate=u.rate||1,d._sprite=u.sprite||{},d._src=typeof u.src!="string"?u.src:[u.src],d._volume=u.volume!==void 0?u.volume:1,d._xhr={method:u.xhr&&u.xhr.method?u.xhr.method:"GET",headers:u.xhr&&u.xhr.headers?u.xhr.headers:null,withCredentials:u.xhr&&u.xhr.withCredentials?u.xhr.withCredentials:!1},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=u.onend?[{fn:u.onend}]:[],d._onfade=u.onfade?[{fn:u.onfade}]:[],d._onload=u.onload?[{fn:u.onload}]:[],d._onloaderror=u.onloaderror?[{fn:u.onloaderror}]:[],d._onplayerror=u.onplayerror?[{fn:u.onplayerror}]:[],d._onpause=u.onpause?[{fn:u.onpause}]:[],d._onplay=u.onplay?[{fn:u.onplay}]:[],d._onstop=u.onstop?[{fn:u.onstop}]:[],d._onmute=u.onmute?[{fn:u.onmute}]:[],d._onvolume=u.onvolume?[{fn:u.onvolume}]:[],d._onrate=u.onrate?[{fn:u.onrate}]:[],d._onseek=u.onseek?[{fn:u.onseek}]:[],d._onunlock=u.onunlock?[{fn:u.onunlock}]:[],d._onresume=[],d._webAudio=e.usingWebAudio&&!d._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var u=this,d=null;if(e.noAudio){u._emit("loaderror",null,"No audio support.");return}typeof u._src=="string"&&(u._src=[u._src]);for(var m=0;m<u._src.length;m++){var _,x;if(u._format&&u._format[m])_=u._format[m];else{if(x=u._src[m],typeof x!="string"){u._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}_=/^data:audio\/([^;,]+);/i.exec(x),_||(_=/\.([^.]+)$/.exec(x.split("?",1)[0])),_&&(_=_[1].toLowerCase())}if(_||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),_&&e.codecs(_)){d=u._src[m];break}}if(!d){u._emit("loaderror",null,"No codec support for selected audio sources.");return}return u._src=d,u._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(u._html5=!0,u._webAudio=!1),new r(u),u._webAudio&&a(u),u},play:function(u,d){var m=this,_=null;if(typeof u=="number")_=u,u=null;else{if(typeof u=="string"&&m._state==="loaded"&&!m._sprite[u])return null;if(typeof u>"u"&&(u="__default",!m._playLock)){for(var x=0,v=0;v<m._sounds.length;v++)m._sounds[v]._paused&&!m._sounds[v]._ended&&(x++,_=m._sounds[v]._id);x===1?u=null:_=null}}var b=_?m._soundById(_):m._inactiveSound();if(!b)return null;if(_&&!u&&(u=b._sprite||"__default"),m._state!=="loaded"){b._sprite=u,b._ended=!1;var S=b._id;return m._queue.push({event:"play",action:function(){m.play(S)}}),S}if(_&&!b._paused)return d||m._loadQueue("play"),b._id;m._webAudio&&e._autoResume();var T=Math.max(0,b._seek>0?b._seek:m._sprite[u][0]/1e3),C=Math.max(0,(m._sprite[u][0]+m._sprite[u][1])/1e3-T),I=C*1e3/Math.abs(b._rate),k=m._sprite[u][0]/1e3,E=(m._sprite[u][0]+m._sprite[u][1])/1e3;b._sprite=u,b._ended=!1;var B=function(){b._paused=!1,b._seek=T,b._start=k,b._stop=E,b._loop=!!(b._loop||m._sprite[u][2])};if(T>=E){m._ended(b);return}var X=b._node;if(m._webAudio){var tt=function(){m._playLock=!1,B(),m._refreshBuffer(b);var j=b._muted||m._muted?0:b._volume;X.gain.setValueAtTime(j,e.ctx.currentTime),b._playStart=e.ctx.currentTime,typeof X.bufferSource.start>"u"?b._loop?X.bufferSource.noteGrainOn(0,T,86400):X.bufferSource.noteGrainOn(0,T,C):b._loop?X.bufferSource.start(0,T,86400):X.bufferSource.start(0,T,C),I!==1/0&&(m._endTimers[b._id]=setTimeout(m._ended.bind(m,b),I)),d||setTimeout(function(){m._emit("play",b._id),m._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?tt():(m._playLock=!0,m.once("resume",tt),m._clearTimer(b._id))}else{var Z=function(){X.currentTime=T,X.muted=b._muted||m._muted||e._muted||X.muted,X.volume=b._volume*e.volume(),X.playbackRate=b._rate;try{var j=X.play();if(j&&typeof Promise<"u"&&(j instanceof Promise||typeof j.then=="function")?(m._playLock=!0,B(),j.then(function(){m._playLock=!1,X._unlocked=!0,d?m._loadQueue():m._emit("play",b._id)}).catch(function(){m._playLock=!1,m._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),b._ended=!0,b._paused=!0})):d||(m._playLock=!1,B(),m._emit("play",b._id)),X.playbackRate=b._rate,X.paused){m._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}u!=="__default"||b._loop?m._endTimers[b._id]=setTimeout(m._ended.bind(m,b),I):(m._endTimers[b._id]=function(){m._ended(b),X.removeEventListener("ended",m._endTimers[b._id],!1)},X.addEventListener("ended",m._endTimers[b._id],!1))}catch(_t){m._emit("playerror",b._id,_t)}};X.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(X.src=m._src,X.load());var H=window&&window.ejecta||!X.readyState&&e._navigator.isCocoonJS;if(X.readyState>=3||H)Z();else{m._playLock=!0,m._state="loading";var K=function(){m._state="loaded",Z(),X.removeEventListener(e._canPlayEvent,K,!1)};X.addEventListener(e._canPlayEvent,K,!1),m._clearTimer(b._id)}}return b._id},pause:function(u){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(u)}}),d;for(var m=d._getSoundIds(u),_=0;_<m.length;_++){d._clearTimer(m[_]);var x=d._soundById(m[_]);if(x&&!x._paused&&(x._seek=d.seek(m[_]),x._rateSeek=0,x._paused=!0,d._stopFade(m[_]),x._node))if(d._webAudio){if(!x._node.bufferSource)continue;typeof x._node.bufferSource.stop>"u"?x._node.bufferSource.noteOff(0):x._node.bufferSource.stop(0),d._cleanBuffer(x._node)}else(!isNaN(x._node.duration)||x._node.duration===1/0)&&x._node.pause();arguments[1]||d._emit("pause",x?x._id:null)}return d},stop:function(u,d){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"stop",action:function(){m.stop(u)}}),m;for(var _=m._getSoundIds(u),x=0;x<_.length;x++){m._clearTimer(_[x]);var v=m._soundById(_[x]);v&&(v._seek=v._start||0,v._rateSeek=0,v._paused=!0,v._ended=!0,m._stopFade(_[x]),v._node&&(m._webAudio?v._node.bufferSource&&(typeof v._node.bufferSource.stop>"u"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),m._cleanBuffer(v._node)):(!isNaN(v._node.duration)||v._node.duration===1/0)&&(v._node.currentTime=v._start||0,v._node.pause(),v._node.duration===1/0&&m._clearSound(v._node))),d||m._emit("stop",v._id))}return m},mute:function(u,d){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"mute",action:function(){m.mute(u,d)}}),m;if(typeof d>"u")if(typeof u=="boolean")m._muted=u;else return m._muted;for(var _=m._getSoundIds(d),x=0;x<_.length;x++){var v=m._soundById(_[x]);v&&(v._muted=u,v._interval&&m._stopFade(v._id),m._webAudio&&v._node?v._node.gain.setValueAtTime(u?0:v._volume,e.ctx.currentTime):v._node&&(v._node.muted=e._muted?!0:u),m._emit("mute",v._id))}return m},volume:function(){var u=this,d=arguments,m,_;if(d.length===0)return u._volume;if(d.length===1||d.length===2&&typeof d[1]>"u"){var x=u._getSoundIds(),v=x.indexOf(d[0]);v>=0?_=parseInt(d[0],10):m=parseFloat(d[0])}else d.length>=2&&(m=parseFloat(d[0]),_=parseInt(d[1],10));var b;if(typeof m<"u"&&m>=0&&m<=1){if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"volume",action:function(){u.volume.apply(u,d)}}),u;typeof _>"u"&&(u._volume=m),_=u._getSoundIds(_);for(var S=0;S<_.length;S++)b=u._soundById(_[S]),b&&(b._volume=m,d[2]||u._stopFade(_[S]),u._webAudio&&b._node&&!b._muted?b._node.gain.setValueAtTime(m,e.ctx.currentTime):b._node&&!b._muted&&(b._node.volume=m*e.volume()),u._emit("volume",b._id))}else return b=_?u._soundById(_):u._sounds[0],b?b._volume:0;return u},fade:function(u,d,m,_){var x=this;if(x._state!=="loaded"||x._playLock)return x._queue.push({event:"fade",action:function(){x.fade(u,d,m,_)}}),x;u=Math.min(Math.max(0,parseFloat(u)),1),d=Math.min(Math.max(0,parseFloat(d)),1),m=parseFloat(m),x.volume(u,_);for(var v=x._getSoundIds(_),b=0;b<v.length;b++){var S=x._soundById(v[b]);if(S){if(_||x._stopFade(v[b]),x._webAudio&&!S._muted){var T=e.ctx.currentTime,C=T+m/1e3;S._volume=u,S._node.gain.setValueAtTime(u,T),S._node.gain.linearRampToValueAtTime(d,C)}x._startFadeInterval(S,u,d,m,v[b],typeof _>"u")}}return x},_startFadeInterval:function(u,d,m,_,x,v){var b=this,S=d,T=m-d,C=Math.abs(T/.01),I=Math.max(4,C>0?_/C:_),k=Date.now();u._fadeTo=m,u._interval=setInterval(function(){var E=(Date.now()-k)/_;k=Date.now(),S+=T*E,S=Math.round(S*100)/100,T<0?S=Math.max(m,S):S=Math.min(m,S),b._webAudio?u._volume=S:b.volume(S,u._id,!0),v&&(b._volume=S),(m<d&&S<=m||m>d&&S>=m)&&(clearInterval(u._interval),u._interval=null,u._fadeTo=null,b.volume(m,u._id),b._emit("fade",u._id))},I)},_stopFade:function(u){var d=this,m=d._soundById(u);return m&&m._interval&&(d._webAudio&&m._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(m._interval),m._interval=null,d.volume(m._fadeTo,u),m._fadeTo=null,d._emit("fade",u)),d},loop:function(){var u=this,d=arguments,m,_,x;if(d.length===0)return u._loop;if(d.length===1)if(typeof d[0]=="boolean")m=d[0],u._loop=m;else return x=u._soundById(parseInt(d[0],10)),x?x._loop:!1;else d.length===2&&(m=d[0],_=parseInt(d[1],10));for(var v=u._getSoundIds(_),b=0;b<v.length;b++)x=u._soundById(v[b]),x&&(x._loop=m,u._webAudio&&x._node&&x._node.bufferSource&&(x._node.bufferSource.loop=m,m&&(x._node.bufferSource.loopStart=x._start||0,x._node.bufferSource.loopEnd=x._stop,u.playing(v[b])&&(u.pause(v[b],!0),u.play(v[b],!0)))));return u},rate:function(){var u=this,d=arguments,m,_;if(d.length===0)_=u._sounds[0]._id;else if(d.length===1){var x=u._getSoundIds(),v=x.indexOf(d[0]);v>=0?_=parseInt(d[0],10):m=parseFloat(d[0])}else d.length===2&&(m=parseFloat(d[0]),_=parseInt(d[1],10));var b;if(typeof m=="number"){if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"rate",action:function(){u.rate.apply(u,d)}}),u;typeof _>"u"&&(u._rate=m),_=u._getSoundIds(_);for(var S=0;S<_.length;S++)if(b=u._soundById(_[S]),b){u.playing(_[S])&&(b._rateSeek=u.seek(_[S]),b._playStart=u._webAudio?e.ctx.currentTime:b._playStart),b._rate=m,u._webAudio&&b._node&&b._node.bufferSource?b._node.bufferSource.playbackRate.setValueAtTime(m,e.ctx.currentTime):b._node&&(b._node.playbackRate=m);var T=u.seek(_[S]),C=(u._sprite[b._sprite][0]+u._sprite[b._sprite][1])/1e3-T,I=C*1e3/Math.abs(b._rate);(u._endTimers[_[S]]||!b._paused)&&(u._clearTimer(_[S]),u._endTimers[_[S]]=setTimeout(u._ended.bind(u,b),I)),u._emit("rate",b._id)}}else return b=u._soundById(_),b?b._rate:u._rate;return u},seek:function(){var u=this,d=arguments,m,_;if(d.length===0)u._sounds.length&&(_=u._sounds[0]._id);else if(d.length===1){var x=u._getSoundIds(),v=x.indexOf(d[0]);v>=0?_=parseInt(d[0],10):u._sounds.length&&(_=u._sounds[0]._id,m=parseFloat(d[0]))}else d.length===2&&(m=parseFloat(d[0]),_=parseInt(d[1],10));if(typeof _>"u")return 0;if(typeof m=="number"&&(u._state!=="loaded"||u._playLock))return u._queue.push({event:"seek",action:function(){u.seek.apply(u,d)}}),u;var b=u._soundById(_);if(b)if(typeof m=="number"&&m>=0){var S=u.playing(_);S&&u.pause(_,!0),b._seek=m,b._ended=!1,u._clearTimer(_),!u._webAudio&&b._node&&!isNaN(b._node.duration)&&(b._node.currentTime=m);var T=function(){S&&u.play(_,!0),u._emit("seek",_)};if(S&&!u._webAudio){var C=function(){u._playLock?setTimeout(C,0):T()};setTimeout(C,0)}else T()}else if(u._webAudio){var I=u.playing(_)?e.ctx.currentTime-b._playStart:0,k=b._rateSeek?b._rateSeek-b._seek:0;return b._seek+(k+I*Math.abs(b._rate))}else return b._node.currentTime;return u},playing:function(u){var d=this;if(typeof u=="number"){var m=d._soundById(u);return m?!m._paused:!1}for(var _=0;_<d._sounds.length;_++)if(!d._sounds[_]._paused)return!0;return!1},duration:function(u){var d=this,m=d._duration,_=d._soundById(u);return _&&(m=d._sprite[_._sprite][1]/1e3),m},state:function(){return this._state},unload:function(){for(var u=this,d=u._sounds,m=0;m<d.length;m++)d[m]._paused||u.stop(d[m]._id),u._webAudio||(u._clearSound(d[m]._node),d[m]._node.removeEventListener("error",d[m]._errorFn,!1),d[m]._node.removeEventListener(e._canPlayEvent,d[m]._loadFn,!1),d[m]._node.removeEventListener("ended",d[m]._endFn,!1),e._releaseHtml5Audio(d[m]._node)),delete d[m]._node,u._clearTimer(d[m]._id);var _=e._howls.indexOf(u);_>=0&&e._howls.splice(_,1);var x=!0;for(m=0;m<e._howls.length;m++)if(e._howls[m]._src===u._src||u._src.indexOf(e._howls[m]._src)>=0){x=!1;break}return n&&x&&delete n[u._src],e.noAudio=!1,u._state="unloaded",u._sounds=[],u=null,null},on:function(u,d,m,_){var x=this,v=x["_on"+u];return typeof d=="function"&&v.push(_?{id:m,fn:d,once:_}:{id:m,fn:d}),x},off:function(u,d,m){var _=this,x=_["_on"+u],v=0;if(typeof d=="number"&&(m=d,d=null),d||m)for(v=0;v<x.length;v++){var b=m===x[v].id;if(d===x[v].fn&&b||!d&&b){x.splice(v,1);break}}else if(u)_["_on"+u]=[];else{var S=Object.keys(_);for(v=0;v<S.length;v++)S[v].indexOf("_on")===0&&Array.isArray(_[S[v]])&&(_[S[v]]=[])}return _},once:function(u,d,m){var _=this;return _.on(u,d,m,1),_},_emit:function(u,d,m){for(var _=this,x=_["_on"+u],v=x.length-1;v>=0;v--)(!x[v].id||x[v].id===d||u==="load")&&(setTimeout((function(b){b.call(this,d,m)}).bind(_,x[v].fn),0),x[v].once&&_.off(u,x[v].fn,x[v].id));return _._loadQueue(u),_},_loadQueue:function(u){var d=this;if(d._queue.length>0){var m=d._queue[0];m.event===u&&(d._queue.shift(),d._loadQueue()),u||m.action()}return d},_ended:function(u){var d=this,m=u._sprite;if(!d._webAudio&&u._node&&!u._node.paused&&!u._node.ended&&u._node.currentTime<u._stop)return setTimeout(d._ended.bind(d,u),100),d;var _=!!(u._loop||d._sprite[m][2]);if(d._emit("end",u._id),!d._webAudio&&_&&d.stop(u._id,!0).play(u._id),d._webAudio&&_){d._emit("play",u._id),u._seek=u._start||0,u._rateSeek=0,u._playStart=e.ctx.currentTime;var x=(u._stop-u._start)*1e3/Math.abs(u._rate);d._endTimers[u._id]=setTimeout(d._ended.bind(d,u),x)}return d._webAudio&&!_&&(u._paused=!0,u._ended=!0,u._seek=u._start||0,u._rateSeek=0,d._clearTimer(u._id),d._cleanBuffer(u._node),e._autoSuspend()),!d._webAudio&&!_&&d.stop(u._id,!0),d},_clearTimer:function(u){var d=this;if(d._endTimers[u]){if(typeof d._endTimers[u]!="function")clearTimeout(d._endTimers[u]);else{var m=d._soundById(u);m&&m._node&&m._node.removeEventListener("ended",d._endTimers[u],!1)}delete d._endTimers[u]}return d},_soundById:function(u){for(var d=this,m=0;m<d._sounds.length;m++)if(u===d._sounds[m]._id)return d._sounds[m];return null},_inactiveSound:function(){var u=this;u._drain();for(var d=0;d<u._sounds.length;d++)if(u._sounds[d]._ended)return u._sounds[d].reset();return new r(u)},_drain:function(){var u=this,d=u._pool,m=0,_=0;if(!(u._sounds.length<d)){for(_=0;_<u._sounds.length;_++)u._sounds[_]._ended&&m++;for(_=u._sounds.length-1;_>=0;_--){if(m<=d)return;u._sounds[_]._ended&&(u._webAudio&&u._sounds[_]._node&&u._sounds[_]._node.disconnect(0),u._sounds.splice(_,1),m--)}}},_getSoundIds:function(u){var d=this;if(typeof u>"u"){for(var m=[],_=0;_<d._sounds.length;_++)m.push(d._sounds[_]._id);return m}else return[u]},_refreshBuffer:function(u){var d=this;return u._node.bufferSource=e.ctx.createBufferSource(),u._node.bufferSource.buffer=n[d._src],u._panner?u._node.bufferSource.connect(u._panner):u._node.bufferSource.connect(u._node),u._node.bufferSource.loop=u._loop,u._loop&&(u._node.bufferSource.loopStart=u._start||0,u._node.bufferSource.loopEnd=u._stop||0),u._node.bufferSource.playbackRate.setValueAtTime(u._rate,e.ctx.currentTime),d},_cleanBuffer:function(u){var d=this,m=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(!u.bufferSource)return d;if(e._scratchBuffer&&u.bufferSource&&(u.bufferSource.onended=null,u.bufferSource.disconnect(0),m))try{u.bufferSource.buffer=e._scratchBuffer}catch{}return u.bufferSource=null,d},_clearSound:function(u){var d=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);d||(u.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(u){this._parent=u,this.init()};r.prototype={init:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++e._counter,d._sounds.push(u),u.create(),u},create:function(){var u=this,d=u._parent,m=e._muted||u._muted||u._parent._muted?0:u._volume;return d._webAudio?(u._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),u._node.gain.setValueAtTime(m,e.ctx.currentTime),u._node.paused=!0,u._node.connect(e.masterGain)):e.noAudio||(u._node=e._obtainHtml5Audio(),u._errorFn=u._errorListener.bind(u),u._node.addEventListener("error",u._errorFn,!1),u._loadFn=u._loadListener.bind(u),u._node.addEventListener(e._canPlayEvent,u._loadFn,!1),u._endFn=u._endListener.bind(u),u._node.addEventListener("ended",u._endFn,!1),u._node.src=d._src,u._node.preload=d._preload===!0?"auto":d._preload,u._node.volume=m*e.volume(),u._node.load()),u},reset:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._rateSeek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++e._counter,u},_errorListener:function(){var u=this;u._parent._emit("loaderror",u._id,u._node.error?u._node.error.code:0),u._node.removeEventListener("error",u._errorFn,!1)},_loadListener:function(){var u=this,d=u._parent;d._duration=Math.ceil(u._node.duration*10)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,d._duration*1e3]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),u._node.removeEventListener(e._canPlayEvent,u._loadFn,!1)},_endListener:function(){var u=this,d=u._parent;d._duration===1/0&&(d._duration=Math.ceil(u._node.duration*10)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=d._duration*1e3),d._ended(u)),u._node.removeEventListener("ended",u._endFn,!1)}};var n={},a=function(u){var d=u._src;if(n[d]){u._duration=n[d].duration,f(u);return}if(/^data:[^;]+;base64,/.test(d)){for(var m=atob(d.split(",")[1]),_=new Uint8Array(m.length),x=0;x<m.length;++x)_[x]=m.charCodeAt(x);c(_.buffer,u)}else{var v=new XMLHttpRequest;v.open(u._xhr.method,d,!0),v.withCredentials=u._xhr.withCredentials,v.responseType="arraybuffer",u._xhr.headers&&Object.keys(u._xhr.headers).forEach(function(b){v.setRequestHeader(b,u._xhr.headers[b])}),v.onload=function(){var b=(v.status+"")[0];if(b!=="0"&&b!=="2"&&b!=="3"){u._emit("loaderror",null,"Failed loading audio file with status: "+v.status+".");return}c(v.response,u)},v.onerror=function(){u._webAudio&&(u._html5=!0,u._webAudio=!1,u._sounds=[],delete n[d],u.load())},l(v)}},l=function(u){try{u.send()}catch{u.onerror()}},c=function(u,d){var m=function(){d._emit("loaderror",null,"Decoding audio data failed.")},_=function(x){x&&d._sounds.length>0?(n[d._src]=x,f(d,x)):m()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(u).then(_).catch(m):e.ctx.decodeAudioData(u,_,m)},f=function(u,d){d&&!u._duration&&(u._duration=d.duration),Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue())},g=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var u=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),d=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),m=d?parseInt(d[1],10):null;if(u&&m&&m<9){var _=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!_&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};s.Howler=e,s.Howl=i,typeof si<"u"?(si.HowlerGlobal=t,si.Howler=e,si.Howl=i,si.Sound=r):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=r)})();(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,r){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(i=typeof i!="number"?n._pos[1]:i,r=typeof r!="number"?n._pos[2]:r,typeof e=="number")n._pos=[e,i,r],typeof n.ctx.listener.positionX<"u"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(e,i,r,n,a,l){var c=this;if(!c.ctx||!c.ctx.listener)return c;var f=c._orientation;if(i=typeof i!="number"?f[1]:i,r=typeof r!="number"?f[2]:r,n=typeof n!="number"?f[3]:n,a=typeof a!="number"?f[4]:a,l=typeof l!="number"?f[5]:l,typeof e=="number")c._orientation=[e,i,r,n,a,l],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(l,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(e,i,r,n,a,l);else return f;return c},Howl.prototype.init=(function(e){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}})(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(e,i)}}),r;var n=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")r._stereo=e,r._pos=[e,0,0];else return r._stereo;for(var a=r._getSoundIds(i),l=0;l<a.length;l++){var c=r._soundById(a[l]);if(c)if(typeof e=="number")c._stereo=e,c._pos=[e,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&t(c,n),n==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(e,0,0):c._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",c._id);else return c._stereo}return r},Howl.prototype.pos=function(e,i,r,n){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(e,i,r,n)}}),a;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof n>"u")if(typeof e=="number")a._pos=[e,i,r];else return a._pos;for(var l=a._getSoundIds(n),c=0;c<l.length;c++){var f=a._soundById(l[c]);if(f)if(typeof e=="number")f._pos=[e,i,r],f._node&&((!f._panner||f._panner.pan)&&t(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setPosition(e,i,r)),a._emit("pos",f._id);else return f._pos}return a},Howl.prototype.orientation=function(e,i,r,n){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(e,i,r,n)}}),a;if(i=typeof i!="number"?a._orientation[1]:i,r=typeof r!="number"?a._orientation[2]:r,typeof n>"u")if(typeof e=="number")a._orientation=[e,i,r];else return a._orientation;for(var l=a._getSoundIds(n),c=0;c<l.length;c++){var f=a._soundById(l[c]);if(f)if(typeof e=="number")f._orientation=[e,i,r],f._node&&(f._panner||(f._pos||(f._pos=a._pos||[0,0,-.5]),t(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setOrientation(e,i,r)),a._emit("orientation",f._id);else return f._orientation}return a},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,r,n,a;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof n>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),e._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:e._panningModel});else return a=e._soundById(parseInt(i[0],10)),a?a._pannerAttr:e._pannerAttr;else i.length===2&&(r=i[0],n=parseInt(i[1],10));for(var l=e._getSoundIds(n),c=0;c<l.length;c++)if(a=e._soundById(l[c]),a){var f=a._pannerAttr;f={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:f.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:f.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:f.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:f.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:f.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:f.panningModel};var g=a._panner;g||(a._pos||(a._pos=e._pos||[0,0,-.5]),t(a,"spatial"),g=a._panner),g.coneInnerAngle=f.coneInnerAngle,g.coneOuterAngle=f.coneOuterAngle,g.coneOuterGain=f.coneOuterGain,g.distanceModel=f.distanceModel,g.maxDistance=f.maxDistance,g.refDistance=f.refDistance,g.rolloffFactor=f.rolloffFactor,g.panningModel=f.panningModel}return e},Sound.prototype.init=(function(e){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,e.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}})(Sound.prototype.init),Sound.prototype.reset=(function(e){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),e.call(this)}})(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(mc)),mc}var Le=gP();const _P={click:new Le.Howl({src:["./assets/audio/click.mp3"],volume:.7}),collapse:new Le.Howl({src:["./assets/audio/collapse.mp3"],volume:.7}),fire:new Le.Howl({src:["./assets/audio/fire.mp3"],volume:.7}),search:new Le.Howl({src:["./assets/audio/search.mp3"],volume:.7}),heal:new Le.Howl({src:["./assets/audio/heal.mp3"],volume:.7}),damage1:new Le.Howl({src:["./assets/audio/damage1.mp3"],volume:.7}),damage2:new Le.Howl({src:["./assets/audio/damage2.mp3"],volume:.7}),attack:new Le.Howl({src:["./assets/audio/attack.mp3"],volume:.7}),chest:new Le.Howl({src:["./assets/audio/chest.mp3"],volume:.7}),useItem:new Le.Howl({src:["./assets/audio/useItem.mp3"],volume:.7}),close:new Le.Howl({src:["./assets/audio/close.mp3"],volume:.7}),rest:new Le.Howl({src:["./assets/audio/rest.mp3"],volume:.7}),teleport:new Le.Howl({src:["./assets/audio/teleport.mp3"],volume:.7}),activation:new Le.Howl({src:["./assets/audio/activation.mp3"],volume:.7})},Ts={dungeon1:new Le.Howl({src:["./assets/audio/dungeon1.mp3"],volume:.5,loop:!0}),gameClear:new Le.Howl({src:["./assets/audio/gameClear.mp3"],volume:.5,loop:!0})};let Pi=null,Wa=!0;const ni={playSe(s){Wa||_P[s].play()},setBgm(s){Pi=s},playBgm(s){Pi&&Pi!==s&&Ts[Pi].stop(),!Wa&&!Ts[s].playing()&&Ts[s].play(),Pi=s},muteBgm(s){Wa=s,Pi&&(Wa?Ts[Pi].pause():Ts[Pi].playing()||Ts[Pi].play())},pauseBgm(){Pi&&Ts[Pi].pause()}};var yP=Object.defineProperty,Ss=Math.pow,vP=(s,t,e)=>t in s?yP(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Q=(s,t,e)=>(vP(s,typeof t!="symbol"?t+"":t,e),e),he=(s,t,e)=>new Promise((i,r)=>{var n=c=>{try{l(e.next(c))}catch(f){r(f)}},a=c=>{try{l(e.throw(c))}catch(f){r(f)}},l=c=>c.done?i(c.value):Promise.resolve(c.value).then(n,a);l((e=e.apply(s,t)).next())});class Ad{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new Ad}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let r=0;r<this._breathParameters.length;++r){const n=this._breathParameters[r];t.addParameterValueById(n.parameterId,n.offset+n.peak*Math.sin(i/n.cycle),n.weight)}}}class uo{constructor(t,e,i,r,n){this.parameterId=t??void 0,this.offset=e??0,this.peak=i??0,this.cycle=r??0,this.weight=n??0}}const vv=class rd{static create(t){return new rd(t)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}rd.CloseIfZero||(i=-i);for(let n=0;n<this._parameterIds.length;++n)t.setParameterValueById(this._parameterIds[n],i)}constructor(t){var e,i;this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],t!=null&&(this._parameterIds=(i=(e=t.getEyeBlinkParameters())==null?void 0:e.slice())!=null?i:this._parameterIds)}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};vv.CloseIfZero=!0;let xP=vv;const bP=.001,y_=.5;class Ed{static create(t){const e=new Ed;typeof t.FadeInTime=="number"&&(e._fadeTimeSeconds=t.FadeInTime,e._fadeTimeSeconds<=0&&(e._fadeTimeSeconds=y_));const i=t.Groups,r=i.length;for(let n=0;n<r;++n){const a=i[n],l=a.length;let c=0;for(let f=0;f<l;++f){const g=a[f],u=new vh;u.partId=g.Id;const d=g.Link;if(d){const m=d.length;for(let _=0;_<m;++_){const x=new vh;x.partId=d[_],u.link.push(x)}}e._partGroups.push(u),++c}e._partGroupCounts.push(c)}return e}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let r=0;r<this._partGroupCounts.length;r++){const n=this._partGroupCounts[r];this.doFade(t,e,i,n),i+=n}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.length;++i){const r=this._partGroupCounts[i];for(let n=e;n<e+r;++n){this._partGroups[n].initialize(t);const a=this._partGroups[n].partIndex,l=this._partGroups[n].parameterIndex;if(!(a<0)){t.setPartOpacityByIndex(a,n==e?1:0),t.setParameterValueByIndex(l,n==e?1:0);for(let c=0;c<this._partGroups[n].link.length;++c)this._partGroups[n].link[c].initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.length;++e){const i=this._partGroups[e];if(i.link.length==0)continue;const r=this._partGroups[e].partIndex,n=t.getPartOpacityByIndex(r);for(let a=0;a<i.link.length;++a){const c=i.link[a].partIndex;c<0||t.setPartOpacityByIndex(c,n)}}}doFade(t,e,i,r){let n=-1,a=1;const l=.5,c=.15;for(let f=i;f<i+r;++f){const g=this._partGroups[f].partIndex,u=this._partGroups[f].parameterIndex;if(t.getParameterValueByIndex(u)>bP){if(n>=0)break;n=f,a=t.getPartOpacityByIndex(g),a+=e/this._fadeTimeSeconds,a>1&&(a=1)}}n<0&&(n=0,a=1);for(let f=i;f<i+r;++f){const g=this._partGroups[f].partIndex;if(n==f)t.setPartOpacityByIndex(g,a);else{let u=t.getPartOpacityByIndex(g),d;a<l?d=a*(l-1)/l+1:d=(1-a)*l/(1-l),(1-d)*(1-a)>c&&(d=1-c/(1-a)),u>d&&(u=d),t.setPartOpacityByIndex(g,u)}}}constructor(){this._fadeTimeSeconds=y_,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class vh{constructor(t){this.parameterIndex=0,this.partIndex=0,this.partId="",this.link=[],t!=null&&this.assignment(t)}assignment(t){return this.partId=t.partId,this.link=t.link.map(e=>e.clone()),this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new vh;return t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=this.link.map(e=>e.clone()),t}}class Ct{constructor(t,e){this.x=t||0,this.y=e||0}add(t){const e=new Ct(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new Ct(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new Ct(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new Ct(t,t))}division(t){const e=new Ct(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new Ct(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}const xv=class ih{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let r;return e===1/0?r=1/0:(r=Math.exp(Math.log(e)/3),r=(e/(r*r)+2*r)/3),i?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),r=Math.atan2(t.y,t.x);let n=i-r;for(;n<-Math.PI;)n+=Math.PI*2;for(;n>Math.PI;)n-=Math.PI*2;return n}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r}static radianToDirection(t){const e=new Ct;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<ih.Epsilon?this.abs(e)<ih.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,r){if(this.sqrt(t)<ih.Epsilon)return this.range(this.quadraticEquation(e,i,r),0,1);const n=e/t,a=i/t,l=r/t,c=(3*a-n*n)/3,f=c/3,g=(2*n*n*n-9*n*a+27*l)/27,u=g/2,d=u*u+f*f*f,m=.5,_=m+.01;if(d<0){const T=-c/3,C=T*T*T,I=this.sqrt(C),k=-g/(2*I),E=this.range(k,-1,1),B=Math.acos(E),tt=2*this.cbrt(I),Z=tt*this.cos(B/3)-n/3;if(this.abs(Z-m)<_)return this.range(Z,0,1);const H=tt*this.cos((B+2*Math.PI)/3)-n/3;if(this.abs(H-m)<_)return this.range(H,0,1);const K=tt*this.cos((B+4*Math.PI)/3)-n/3;return this.range(K,0,1)}if(d==0){let T;u<0?T=this.cbrt(-u):T=-this.cbrt(u);const C=2*T-n/3;if(this.abs(C-m)<_)return this.range(C,0,1);const I=-T-n/3;return this.range(I,0,1)}const x=this.sqrt(d),v=this.cbrt(x-u),b=this.cbrt(x+u),S=v-b-n/3;return this.range(S,0,1)}constructor(){}};xv.Epsilon=1e-5;let Yt=xv;class xi{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=4;for(let a=0;a<n;++a)for(let l=0;l<n;++l)for(let c=0;c<n;++c)r[l+a*4]+=t[c+a*4]*e[l+c*4];for(let a=0;a<16;++a)i[a]=r[a]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);xi.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);xi.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){xi.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new xi;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}class Cd{initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=r}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._modelColor=new ri,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new xi,this._mvpMatrix4x4.loadIdentity()}}var Cr=(s=>(s[s.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",s[s.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",s[s.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",s))(Cr||{});class ri{constructor(t=1,e=1,i=1,r=1){this.R=t,this.G=e,this.B=i,this.A=r}}let zi=!1,hn=!1,ln;const gc={vertexOffset:0,vertexStep:2};class So{static startUp(t){if(zi)return co("CubismFramework.startUp() is already done."),zi;if(Live2DCubismCore._isStarted)return zi=!0,!0;if(Live2DCubismCore._isStarted=!0,ln=t,ln&&Live2DCubismCore.Logging.csmSetLogFunction(ln.logFunction),zi=!0,zi){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,r=(e&16711680)>>16,n=e&65535,a=e;co("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+r).slice(-2),("0000"+n).slice(-4),a)}return co("CubismFramework.startUp() is complete."),zi}static cleanUp(){zi=!1,hn=!1,ln=void 0}static initialize(t=0){if(!zi){Ls("CubismFramework is not started.");return}if(hn){Ls("CubismFramework.initialize() skipped, already initialized.");return}Live2DCubismCore.Memory.initializeAmountOfMemory(t),hn=!0,co("CubismFramework.initialize() is complete.")}static dispose(){if(!zi){Ls("CubismFramework is not started.");return}if(!hn){Ls("CubismFramework.dispose() skipped, not initialized.");return}Cd.staticRelease(),hn=!1,co("CubismFramework.dispose() is complete.")}static isStarted(){return zi}static isInitialized(){return hn}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return ln!=null?ln.loggingLevel:5}constructor(){}}var Bn=(s=>(s[s.LogLevel_Verbose=0]="LogLevel_Verbose",s[s.LogLevel_Debug=1]="LogLevel_Debug",s[s.LogLevel_Info=2]="LogLevel_Info",s[s.LogLevel_Warning=3]="LogLevel_Warning",s[s.LogLevel_Error=4]="LogLevel_Error",s[s.LogLevel_Off=5]="LogLevel_Off",s))(Bn||{});const yn=typeof process<"u"?()=>{}:s=>console.assert(s);function v_(s,...t){Lh.print(Bn.LogLevel_Debug,"[CSM][D]"+s+`
`,t)}function co(s,...t){Lh.print(Bn.LogLevel_Info,"[CSM][I]"+s+`
`,t)}function Ls(s,...t){Lh.print(Bn.LogLevel_Warning,"[CSM][W]"+s+`
`,t)}function er(s,...t){Lh.print(Bn.LogLevel_Error,"[CSM][E]"+s+`
`,t)}class Lh{static print(t,e,i){if(t<So.getLoggingLevel())return;const r=So.coreLogFunction;if(!r)return;const n=e.replace(/{(\d+)}/g,(a,l)=>i[l]);r(n)}static dumpBytes(t,e,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(t,`
`):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[e[r]&255]);this.print(t,`
`)}constructor(){}}class x_{constructor(t=!1,e=new ri){this.isOverwritten=t,this.Color=e}}class b_{constructor(t=!1,e=new ri){this.isOverwritten=t,this.Color=e}}class wP{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class TP{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.length;for(let i=0;i<t;++i)i<e?this._savedParameters[i]=this._parameterValues[i]:this._savedParameters.push(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors[t].Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors[t].Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,i,r,n=1){this._userMultiplyColors[t].Color.R=e,this._userMultiplyColors[t].Color.G=i,this._userMultiplyColors[t].Color.B=r,this._userMultiplyColors[t].Color.A=n}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,i,r,n=1){this._userScreenColors[t].Color.R=e,this._userScreenColors[t].Color.G=i,this._userScreenColors[t].Color.B=r,this._userScreenColors[t].Color.A=n}getPartMultiplyColor(t){return this._userPartMultiplyColors[t].Color}getPartScreenColor(t){return this._userPartScreenColors[t].Color}setPartColor(t,e,i,r,n,a,l){if(a[t].Color.R=e,a[t].Color.G=i,a[t].Color.B=r,a[t].Color.A=n,a[t].isOverwritten)for(let c=0;c<this._partChildDrawables[t].length;++c){const f=this._partChildDrawables[t][c];l[f].Color.R=e,l[f].Color.G=i,l[f].Color.B=r,l[f].Color.A=n}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartMultiplyColorByRGBA(t,e,i,r,n){this.setPartColor(t,e,i,r,n,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartScreenColorByRGBA(t,e,i,r,n){this.setPartColor(t,e,i,r,n,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors[t].isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors[t].isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors[t].isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors[t].isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors[t].isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors[t].isOverwritten}setOverwriteColorForPartColors(t,e,i,r){i[t].isOverwritten=e;for(let n=0;n<this._partChildDrawables[t].length;++n){const a=this._partChildDrawables[t][n];r[a].isOverwritten=e,e&&(r[a].Color.R=i[t].Color.R,r[a].Color.G=i[t].Color.G,r[a].Color.B=i[t].Color.B,r[a].Color.A=i[t].Color.A)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors[t].isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors[t].isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings[t].isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings[t].isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings[t].isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings[t].isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds[e])return e;return t in this._notExistPartId?this._notExistPartId[t]:(e=i+this._notExistPartId.length,this._notExistPartId[t]=e,this._notExistPartOpacities[e]=0,e)}getPartId(t){return this._model.parts.ids[t]}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(t in this._notExistPartOpacities){this._notExistPartOpacities[t]=e;return}yn(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return t in this._notExistPartOpacities?this._notExistPartOpacities[t]:(yn(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds[e])return e;return t in this._notExistParameterId?this._notExistParameterId[t]:(e=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[t]=e,this._notExistParameterValues[e]=0,e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return t in this._notExistParameterValues?this._notExistParameterValues[t]:(yn(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(t in this._notExistParameterValues){this._notExistParameterValues[t]=i==1?e:this._notExistParameterValues[t]*(1-i)+e*i;return}yn(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)}multiplyParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds[i]==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){return this._model.drawables.ids[t]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,r=new ri;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,r=new ri;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?Cr.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?Cr.CubismBlendMode_Multiplicative:Cr.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.length;t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters[i]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;for(let r=0;r<i;++r)this._parameterIds.push(e[r])}const t=this._model.parts.count;{const e=this._model.parts.ids;for(let i=0;i<t;++i)this._partIds.push(e[i])}{const e=this._model.drawables.ids,i=this._model.drawables.count,r=new wP(!1,!1);for(let n=0;n<t;++n){const a=new ri(1,1,1,1),l=new ri(0,0,0,1),c=new b_(!1,a),f=new b_(!1,l);this._userPartMultiplyColors.push(c),this._userPartScreenColors.push(f),this._partChildDrawables.push([])}for(let n=0;n<i;++n){const a=new ri(1,1,1,1),l=new ri(0,0,0,1),c=new x_(!1,a),f=new x_(!1,l);this._drawableIds.push(e[n]),this._userMultiplyColors.push(c),this._userScreenColors.push(f),this._userCullings.push(r);const g=this.getDrawableParentPartIndex(n);g>=0&&this._partChildDrawables[g].push(n)}}}constructor(t){this._model=t,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=[],this._userScreenColors=[],this._userCullings=[],this._userPartMultiplyColors=[],this._userPartScreenColors=[],this._partChildDrawables=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class Md{static create(t,e){if(e&&!this.hasMocConsistency(t))throw new Error("Inconsistent MOC3.");const i=Live2DCubismCore.Moc.fromArrayBuffer(t);if(i){const r=new Md(i);return r._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(i,t),r}throw new Error("Failed to CubismMoc.create().")}createModel(){let t;const e=Live2DCubismCore.Model.fromMoc(this._moc);if(e)return t=new TP(e),++this._modelCount,t;throw new Error("Unknown error")}deleteModel(t){t!=null&&--this._modelCount}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){this._moc._release(),this._moc=void 0}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}class bv{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const l=this.getDuration();e.getEndTime()<0&&e.setEndTime(l<=0?-1:e.getStartTime()+l)}let r=this._weight;const n=this._fadeInSeconds==0?1:Yt.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),a=this._fadeOutSeconds==0||e.getEndTime()<0?1:Yt.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);r=r*n*a,e.setState(i,r),yn(0<=r&&r<=1),this.doUpdateParameters(t,i,r,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}setFinishedMotionHandler(t){this._onFinishedMotion=t}getFinishedMotionHandler(){return this._onFinishedMotion}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){}getModelOpacityValue(){return 1}}const w_=1;class Id extends bv{static create(t){const e=new Id;return e.parse(t),e}doUpdateParameters(t,e,i,r){for(let n=0;n<this._parameters.length;++n){const a=this._parameters[n];switch(a.blendType){case 0:{t.addParameterValueById(a.parameterId,a.value,i);break}case 1:{t.multiplyParameterValueById(a.parameterId,a.value,i);break}case 2:{t.setParameterValueById(a.parameterId,a.value,i);break}}}}parse(t){this.setFadeInTime(t.FadeInTime!=null?t.FadeInTime:w_),this.setFadeOutTime(t.FadeOutTime!=null?t.FadeOutTime:w_);const e=(t.Parameters||[]).length;for(let i=0;i<e;++i){const r=t.Parameters[i],n=r.Id,a=r.Value;let l;!r.Blend||r.Blend==="Add"?l=0:r.Blend==="Multiply"?l=1:r.Blend==="Overwrite"?l=2:l=0;const c={parameterId:n,blendType:l,value:a};this._parameters.push(c)}}constructor(){super(),this._parameters=[]}}var xh;(s=>{s.supportMoreMaskDivisions=!0,s.setOpacityFromMotion=!1})(xh||(xh={}));var Ji=(s=>(s[s.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",s[s.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",s[s.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",s))(Ji||{}),Qi=(s=>(s[s.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",s[s.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",s[s.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",s[s.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",s))(Qi||{});class jr{constructor(t=0,e=0){this.time=t,this.value=e}}class SP{constructor(){this.basePointIndex=0,this.segmentType=0}}class AP{constructor(){this.id="",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class EP{constructor(){this.fireTime=0,this.value=""}}class CP{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class wv{constructor(t){this._json=t}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(t){return t==0?!!this._json.Meta.AreBeziersRestricted:!1}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(t){return this._json.Curves[t].Target}getMotionCurveId(t){return this._json.Curves[t].Id}getMotionCurveFadeInTime(t){return this._json.Curves[t].FadeInTime}getMotionCurveFadeOutTime(t){return this._json.Curves[t].FadeOutTime}getMotionCurveSegmentCount(t){return this._json.Curves[t].Segments.length}getMotionCurveSegment(t,e){return this._json.Curves[t].Segments[e]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(t){return this._json.UserData[t].Time}getEventValue(t){return this._json.UserData[t].Value}}var Tv=(s=>(s[s.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",s))(Tv||{});const MP="EyeBlink",IP="LipSync",PP="Model",RP="Parameter",FP="PartOpacity",Xa="Opacity",DP=!1;function _i(s,t,e){const i=new jr;return i.time=s.time+(t.time-s.time)*e,i.value=s.value+(t.value-s.value)*e,i}function LP(s,t){let e=(t-s[0].time)/(s[1].time-s[0].time);return e<0&&(e=0),s[0].value+(s[1].value-s[0].value)*e}function BP(s,t){let e=(t-s[0].time)/(s[3].time-s[0].time);e<0&&(e=0);const i=_i(s[0],s[1],e),r=_i(s[1],s[2],e),n=_i(s[2],s[3],e),a=_i(i,r,e),l=_i(r,n,e);return _i(a,l,e).value}function OP(s,t){const e=t,i=s[0].time,r=s[3].time,n=s[1].time,a=s[2].time,l=r-3*a+3*n-i,c=3*a-6*n+3*i,f=3*n-3*i,g=i-e,u=Yt.cardanoAlgorithmForBezier(l,c,f,g),d=_i(s[0],s[1],u),m=_i(s[1],s[2],u),_=_i(s[2],s[3],u),x=_i(d,m,u),v=_i(m,_,u);return _i(x,v,u).value}function kP(s,t){return s[0].value}function NP(s,t){return s[1].value}function _c(s,t,e){const i=s.curves[t];let r=-1;const n=i.baseSegmentIndex+i.segmentCount;let a=0;for(let c=i.baseSegmentIndex;c<n;++c)if(a=s.segments[c].basePointIndex+(s.segments[c].segmentType==Qi.CubismMotionSegmentType_Bezier?3:1),s.points[a].time>e){r=c;break}if(r==-1)return s.points[a].value;const l=s.segments[r];return l.evaluate(s.points.slice(l.basePointIndex),e)}class Pd extends bv{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._modelOpacity=1}static create(t,e){const i=new Pd;return i.parse(t),i._sourceFrameRate=i._motionData.fps,i._loopDurationSeconds=i._motionData.duration,i._onFinishedMotion=e,i}doUpdateParameters(t,e,i,r){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=MP),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=IP),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=Xa);let n=e-r.getStartTime();n<0&&(n=0);let a=Number.MAX_VALUE,l=Number.MAX_VALUE;const c=64;let f=0,g=0;this._eyeBlinkParameterIds.length>c&&v_("too many eye blink targets : {0}",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>c&&v_("too many lip sync targets : {0}",this._lipSyncParameterIds.length);const u=this._fadeInSeconds<=0?1:Yt.getEasingSine((e-r.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||r.getEndTime()<0?1:Yt.getEasingSine((r.getEndTime()-e)/this._fadeOutSeconds);let m,_,x,v=n;if(this._isLoop)for(;v>this._motionData.duration;)v-=this._motionData.duration;const b=this._motionData.curves;for(_=0;_<this._motionData.curveCount&&b[_].type==Ji.CubismMotionCurveTarget_Model;++_)m=_c(this._motionData,_,v),b[_].id==this._modelCurveIdEyeBlink?l=m:b[_].id==this._modelCurveIdLipSync?a=m:b[_].id==this._modelCurveIdOpacity&&(this._modelOpacity=m,t.setModelOapcity(this.getModelOpacityValue()));for(;_<this._motionData.curveCount&&b[_].type==Ji.CubismMotionCurveTarget_Parameter;++_){if(x=t.getParameterIndex(b[_].id),x==-1)continue;const S=t.getParameterValueByIndex(x);if(m=_c(this._motionData,_,v),l!=Number.MAX_VALUE){for(let C=0;C<this._eyeBlinkParameterIds.length&&C<c;++C)if(this._eyeBlinkParameterIds[C]==b[_].id){m*=l,g|=1<<C;break}}if(a!=Number.MAX_VALUE){for(let C=0;C<this._lipSyncParameterIds.length&&C<c;++C)if(this._lipSyncParameterIds[C]==b[_].id){m+=a,f|=1<<C;break}}let T;if(b[_].fadeInTime<0&&b[_].fadeOutTime<0)T=S+(m-S)*i;else{let C,I;b[_].fadeInTime<0?C=u:C=b[_].fadeInTime==0?1:Yt.getEasingSine((e-r.getFadeInStartTime())/b[_].fadeInTime),b[_].fadeOutTime<0?I=d:I=b[_].fadeOutTime==0||r.getEndTime()<0?1:Yt.getEasingSine((r.getEndTime()-e)/b[_].fadeOutTime);const k=this._weight*C*I;T=S+(m-S)*k}t.setParameterValueByIndex(x,T,1)}{if(l!=Number.MAX_VALUE)for(let S=0;S<this._eyeBlinkParameterIds.length&&S<c;++S){const T=t.getParameterValueById(this._eyeBlinkParameterIds[S]);if(g>>S&1)continue;const C=T+(l-T)*i;t.setParameterValueById(this._eyeBlinkParameterIds[S],C)}if(a!=Number.MAX_VALUE)for(let S=0;S<this._lipSyncParameterIds.length&&S<c;++S){const T=t.getParameterValueById(this._lipSyncParameterIds[S]);if(f>>S&1)continue;const C=T+(a-T)*i;t.setParameterValueById(this._lipSyncParameterIds[S],C)}}for(;_<this._motionData.curveCount&&b[_].type==Ji.CubismMotionCurveTarget_PartOpacity;++_)if(m=_c(this._motionData,_,v),xh.setOpacityFromMotion)t.setPartOpacityById(b[_].id,m);else{if(x=t.getParameterIndex(b[_].id),x==-1)continue;t.setParameterValueByIndex(x,m)}n>=this._motionData.duration&&(this._isLoop?(r.setStartTime(e),this._isLoopFadeIn&&r.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i[r].id){i[r].fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i[r].id){i[r].fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0}parse(t){this._motionData=new CP;const e=new wv(t);this._motionData.duration=e.getMotionDuration(),this._motionData.loop=e.isMotionLoop(),this._motionData.curveCount=e.getMotionCurveCount(),this._motionData.fps=e.getMotionFps(),this._motionData.eventCount=e.getEventCount();const i=e.getEvaluationOptionFlag(Tv.EvaluationOptionFlag_AreBeziersRistricted),r=e.getMotionFadeInTime(),n=e.getMotionFadeOutTime();r!==void 0?this._fadeInSeconds=r<0?1:r:this._fadeInSeconds=1,n!==void 0?this._fadeOutSeconds=n<0?1:n:this._fadeOutSeconds=1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new AP),this._motionData.segments=Array.from({length:e.getMotionTotalSegmentCount()}).map(()=>new SP),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new EP),this._motionData.points=[];let a=0,l=0;for(let c=0;c<this._motionData.curveCount;++c){const f=this._motionData.curves[c];switch(e.getMotionCurveTarget(c)){case PP:f.type=Ji.CubismMotionCurveTarget_Model;break;case RP:f.type=Ji.CubismMotionCurveTarget_Parameter;break;case FP:f.type=Ji.CubismMotionCurveTarget_PartOpacity;break;default:Ls('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}f.id=e.getMotionCurveId(c),f.baseSegmentIndex=l;const g=e.getMotionCurveFadeInTime(c),u=e.getMotionCurveFadeOutTime(c);f.fadeInTime=g!==void 0?g:-1,f.fadeOutTime=u!==void 0?u:-1;for(let d=0;d<e.getMotionCurveSegmentCount(c);){switch(d==0?(this._motionData.segments[l].basePointIndex=a,this._motionData.points[a]=new jr(e.getMotionCurveSegment(c,d),e.getMotionCurveSegment(c,d+1)),a+=1,d+=2):this._motionData.segments[l].basePointIndex=a-1,e.getMotionCurveSegment(c,d)){case Qi.CubismMotionSegmentType_Linear:{this._motionData.segments[l].segmentType=Qi.CubismMotionSegmentType_Linear,this._motionData.segments[l].evaluate=LP,this._motionData.points[a]=new jr(e.getMotionCurveSegment(c,d+1),e.getMotionCurveSegment(c,d+2)),a+=1,d+=3;break}case Qi.CubismMotionSegmentType_Bezier:{this._motionData.segments[l].segmentType=Qi.CubismMotionSegmentType_Bezier,i||DP?this._motionData.segments[l].evaluate=BP:this._motionData.segments[l].evaluate=OP,this._motionData.points[a]=new jr(e.getMotionCurveSegment(c,d+1),e.getMotionCurveSegment(c,d+2)),this._motionData.points[a+1]=new jr(e.getMotionCurveSegment(c,d+3),e.getMotionCurveSegment(c,d+4)),this._motionData.points[a+2]=new jr(e.getMotionCurveSegment(c,d+5),e.getMotionCurveSegment(c,d+6)),a+=3,d+=7;break}case Qi.CubismMotionSegmentType_Stepped:{this._motionData.segments[l].segmentType=Qi.CubismMotionSegmentType_Stepped,this._motionData.segments[l].evaluate=kP,this._motionData.points[a]=new jr(e.getMotionCurveSegment(c,d+1),e.getMotionCurveSegment(c,d+2)),a+=1,d+=3;break}case Qi.CubismMotionSegmentType_InverseStepped:{this._motionData.segments[l].segmentType=Qi.CubismMotionSegmentType_InverseStepped,this._motionData.segments[l].evaluate=NP,this._motionData.points[a]=new jr(e.getMotionCurveSegment(c,d+1),e.getMotionCurveSegment(c,d+2)),a+=1,d+=3;break}default:{yn(0);break}}++f.segmentCount,++l}this._motionData.curves.push(f)}for(let c=0;c<e.getEventCount();++c)this._motionData.events[c].fireTime=e.getEventTime(c),this._motionData.events[c].value=e.getEventValue(c);e.release()}getFiredEvent(t,e){this._firedEventValues.length=0;for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events[i].fireTime>t&&this._motionData.events[i].fireTime<=e&&this._firedEventValues.push(this._motionData.events[i].value);return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves[t];if(e.type==Ji.CubismMotionCurveTarget_Model&&e.id===Xa)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves[t];if(e.type==Ji.CubismMotionCurveTarget_Model&&e.id===Xa)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves[t];if(e.type==Ji.CubismMotionCurveTarget_Model&&e.id===Xa)return e.id}}getModelOpacityValue(){return this._modelOpacity}}class UP{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class Sv{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let t=0;t<this._motions.length;++t)this._motions[t]&&this._motions[t].release();this._motions=void 0}startMotion(t,e,i){if(t==null)return GP;let r;for(let n=0;n<this._motions.length;++n)r=this._motions[n],r?.setFadeOut(r._motion.getFadeOutTime());return r=new UP,r._autoDelete=e,r._motion=t,this._motions.push(r),r._motionQueueEntryHandle}isFinished(){let t=0;for(;t<this._motions.length;){const e=this._motions[t];if(e==null){this._motions.splice(t,1);continue}if(e._motion==null){e.release(),this._motions.splice(t,1);continue}if(!e.isFinished())return!1;t++}return!0}isFinishedByHandle(t){for(let e=0;e<this._motions.length;e++){const i=this._motions[e];if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=0;t<this._motions.length;t++){const e=this._motions[t];e?.release()}this._motions=[]}getCubismMotionQueueEntry(t){return this._motions.find(e=>e!=null&&e._motionQueueEntryHandle==t)}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1,r=0;for(;r<this._motions.length;){const n=this._motions[r];if(n==null){this._motions.splice(r,1);continue}const a=n._motion;if(a==null){n.release(),this._motions.splice(r,1);continue}a.updateParameters(t,n,e),i=!0;const l=a.getFiredEvent(n.getLastCheckEventSeconds()-n.getStartTime(),e-n.getStartTime());for(let c=0;c<l.length;++c)this._eventCallBack(this,l[c],this._eventCustomData);n.setLastCheckEventSeconds(e),n.isFinished()?(n.release(),this._motions.splice(r,1)):(n.isTriggeredFadeOut()&&n.startFadeOut(n.getFadeOutSeconds(),e),r++)}return i}}const GP=-1;var sd=(s=>(s[s.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",s))(sd||{}),Fs=(s=>(s[s.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",s[s.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",s[s.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",s))(Fs||{});class HP{constructor(){this.initialPosition=new Ct(0,0),this.position=new Ct(0,0),this.lastPosition=new Ct(0,0),this.lastGravity=new Ct(0,0),this.force=new Ct(0,0),this.velocity=new Ct(0,0)}}class VP{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class WP{constructor(){this.source={}}}class XP{constructor(){this.destination={},this.translationScale=new Ct(0,0)}}class $P{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new Ct(0,0),this.wind=new Ct(0,0),this.fps=0}}class zP{constructor(t){this._json=t}release(){this._json=void 0}getGravity(){const t=new Ct(0,0);return t.x=this._json.Meta.EffectiveForces.Gravity.X,t.y=this._json.Meta.EffectiveForces.Gravity.Y,t}getWind(){const t=new Ct(0,0);return t.x=this._json.Meta.EffectiveForces.Wind.X,t.y=this._json.Meta.EffectiveForces.Wind.Y,t}getFps(){return this._json.Meta.Fps||0}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Default}getNormalizationAngleMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Default}getInputCount(t){return this._json.PhysicsSettings[t].Input.length}getInputWeight(t,e){return this._json.PhysicsSettings[t].Input[e].Weight}getInputReflect(t,e){return this._json.PhysicsSettings[t].Input[e].Reflect}getInputType(t,e){return this._json.PhysicsSettings[t].Input[e].Type}getInputSourceId(t,e){return this._json.PhysicsSettings[t].Input[e].Source.Id}getOutputCount(t){return this._json.PhysicsSettings[t].Output.length}getOutputVertexIndex(t,e){return this._json.PhysicsSettings[t].Output[e].VertexIndex}getOutputAngleScale(t,e){return this._json.PhysicsSettings[t].Output[e].Scale}getOutputWeight(t,e){return this._json.PhysicsSettings[t].Output[e].Weight}getOutputDestinationId(t,e){return this._json.PhysicsSettings[t].Output[e].Destination.Id}getOutputType(t,e){return this._json.PhysicsSettings[t].Output[e].Type}getOutputReflect(t,e){return this._json.PhysicsSettings[t].Output[e].Reflect}getParticleCount(t){return this._json.PhysicsSettings[t].Vertices.length}getParticleMobility(t,e){return this._json.PhysicsSettings[t].Vertices[e].Mobility}getParticleDelay(t,e){return this._json.PhysicsSettings[t].Vertices[e].Delay}getParticleAcceleration(t,e){return this._json.PhysicsSettings[t].Vertices[e].Acceleration}getParticleRadius(t,e){return this._json.PhysicsSettings[t].Vertices[e].Radius}getParticlePosition(t,e){const i=new Ct(0,0);return i.x=this._json.PhysicsSettings[t].Vertices[e].Position.X,i.y=this._json.PhysicsSettings[t].Vertices[e].Position.Y,i}}const T_="X",S_="Y",A_="Angle",qP=5,nd=100,E_=.001,YP=5;class Rd{static create(t){const e=new Rd;return e.parse(t),e._physicsRig.gravity.y=0,e}static delete(t){t?.release()}parse(t){this._physicsRig=new $P;const e=new zP(t);this._physicsRig.gravity=e.getGravity(),this._physicsRig.wind=e.getWind(),this._physicsRig.subRigCount=e.getSubRigCount(),this._physicsRig.fps=e.getFps(),this._currentRigOutputs=[],this._previousRigOutputs=[];let i=0,r=0,n=0;for(let a=0;a<this._physicsRig.subRigCount;++a){const l=new VP;l.normalizationPosition.minimum=e.getNormalizationPositionMinimumValue(a),l.normalizationPosition.maximum=e.getNormalizationPositionMaximumValue(a),l.normalizationPosition.defalut=e.getNormalizationPositionDefaultValue(a),l.normalizationAngle.minimum=e.getNormalizationAngleMinimumValue(a),l.normalizationAngle.maximum=e.getNormalizationAngleMaximumValue(a),l.normalizationAngle.defalut=e.getNormalizationAngleDefaultValue(a),l.inputCount=e.getInputCount(a),l.baseInputIndex=i,i+=l.inputCount;for(let g=0;g<l.inputCount;++g){const u=new WP;switch(u.sourceParameterIndex=-1,u.weight=e.getInputWeight(a,g),u.reflect=e.getInputReflect(a,g),e.getInputType(a,g)){case T_:u.type=Fs.CubismPhysicsSource_X,u.getNormalizedParameterValue=KP;break;case S_:u.type=Fs.CubismPhysicsSource_Y,u.getNormalizedParameterValue=ZP;break;case A_:u.type=Fs.CubismPhysicsSource_Angle,u.getNormalizedParameterValue=JP;break}u.source.targetType=sd.CubismPhysicsTargetType_Parameter,u.source.id=e.getInputSourceId(a,g),this._physicsRig.inputs.push(u)}l.outputCount=e.getOutputCount(a),l.baseOutputIndex=r;const c=new C_,f=new C_;for(let g=0;g<l.outputCount;++g){c.outputs[g]=0,f.outputs[g]=0;let u=this._physicsRig.outputs[r+g];switch(u||(u=new XP,this._physicsRig.outputs[r+g]=u),u.destinationParameterIndex=-1,u.vertexIndex=e.getOutputVertexIndex(a,g),u.angleScale=e.getOutputAngleScale(a,g),u.weight=e.getOutputWeight(a,g),u.destination.targetType=sd.CubismPhysicsTargetType_Parameter,u.destination.id=e.getOutputDestinationId(a,g),e.getOutputType(a,g)){case T_:u.type=Fs.CubismPhysicsSource_X,u.getValue=QP,u.getScale=sR;break;case S_:u.type=Fs.CubismPhysicsSource_Y,u.getValue=tR,u.getScale=nR;break;case A_:u.type=Fs.CubismPhysicsSource_Angle,u.getValue=eR,u.getScale=oR;break}u.reflect=e.getOutputReflect(a,g)}this._currentRigOutputs.push(c),this._previousRigOutputs.push(f),r+=l.outputCount,l.particleCount=e.getParticleCount(a),l.baseParticleIndex=n,n+=l.particleCount;for(let g=0;g<l.particleCount;++g){const u=new HP;u.mobility=e.getParticleMobility(a,g),u.delay=e.getParticleDelay(a,g),u.acceleration=e.getParticleAcceleration(a,g),u.radius=e.getParticleRadius(a,g),u.position=e.getParticlePosition(a,g),this._physicsRig.particles.push(u)}this._physicsRig.settings.push(l)}this.initialize(),e.release()}stabilization(t){var e,i,r,n;let a,l,c,f;const g=new Ct;let u,d,m,_,x,v,b,S;x=t.getModel().parameters.values,v=t.getModel().parameters.maximumValues,b=t.getModel().parameters.minimumValues,S=t.getModel().parameters.defaultValues,((i=(e=this._parameterCaches)==null?void 0:e.length)!=null?i:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),((n=(r=this._parameterInputCaches)==null?void 0:r.length)!=null?n:0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let T=0;T<t.getParameterCount();++T)this._parameterCaches[T]=x[T],this._parameterInputCaches[T]=x[T];for(let T=0;T<this._physicsRig.subRigCount;++T){a={angle:0},g.x=0,g.y=0,u=this._physicsRig.settings[T],d=this._physicsRig.inputs.slice(u.baseInputIndex),m=this._physicsRig.outputs.slice(u.baseOutputIndex),_=this._physicsRig.particles.slice(u.baseParticleIndex);for(let C=0;C<u.inputCount;++C)l=d[C].weight/nd,d[C].sourceParameterIndex==-1&&(d[C].sourceParameterIndex=t.getParameterIndex(d[C].source.id)),d[C].getNormalizedParameterValue(g,a,x[d[C].sourceParameterIndex],b[d[C].sourceParameterIndex],v[d[C].sourceParameterIndex],S[d[C].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,d[C].reflect,l),this._parameterCaches[d[C].sourceParameterIndex]=x[d[C].sourceParameterIndex];c=Yt.degreesToRadian(-a.angle),g.x=g.x*Yt.cos(c)-g.y*Yt.sin(c),g.y=g.x*Yt.sin(c)+g.y*Yt.cos(c),hR(_,u.particleCount,g,a.angle,this._options.wind,E_*u.normalizationPosition.maximum);for(let C=0;C<u.outputCount;++C){const I=m[C].vertexIndex;if(m[C].destinationParameterIndex==-1&&(m[C].destinationParameterIndex=t.getParameterIndex(m[C].destination.id)),I<1||I>=u.particleCount)continue;let k=new Ct;k=_[I].position.substract(_[I-1].position),f=m[C].getValue(k,_,I,m[C].reflect,this._options.gravity),this._currentRigOutputs[T].outputs[C]=f,this._previousRigOutputs[T].outputs[C]=f;const E=m[C].destinationParameterIndex,B=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(x.subarray(E))):x.slice(E);yc(B,b[E],v[E],f,m[C]);for(let X=E,tt=0;X<this._parameterCaches.length;X++,tt++)x[X]=this._parameterCaches[X]=B[tt]}}}evaluate(t,e){var i,r,n,a;let l,c,f,g;const u=new Ct;let d,m,_,x;if(0>=e)return;let v,b,S,T,C;if(this._currentRemainTime+=e,this._currentRemainTime>YP&&(this._currentRemainTime=0),v=t.getModel().parameters.values,b=t.getModel().parameters.maximumValues,S=t.getModel().parameters.minimumValues,T=t.getModel().parameters.defaultValues,((r=(i=this._parameterCaches)==null?void 0:i.length)!=null?r:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),((a=(n=this._parameterInputCaches)==null?void 0:n.length)!=null?a:0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let k=0;k<t.getParameterCount();++k)this._parameterInputCaches[k]=v[k]}for(this._physicsRig.fps>0?C=1/this._physicsRig.fps:C=e;this._currentRemainTime>=C;){for(let E=0;E<this._physicsRig.subRigCount;++E){d=this._physicsRig.settings[E],_=this._physicsRig.outputs.slice(d.baseOutputIndex);for(let B=0;B<d.outputCount;++B)this._previousRigOutputs[E].outputs[B]=this._currentRigOutputs[E].outputs[B]}const k=C/this._currentRemainTime;for(let E=0;E<t.getParameterCount();++E)this._parameterCaches[E]=this._parameterInputCaches[E]*(1-k)+v[E]*k,this._parameterInputCaches[E]=this._parameterCaches[E];for(let E=0;E<this._physicsRig.subRigCount;++E){l={angle:0},u.x=0,u.y=0,d=this._physicsRig.settings[E],m=this._physicsRig.inputs.slice(d.baseInputIndex),_=this._physicsRig.outputs.slice(d.baseOutputIndex),x=this._physicsRig.particles.slice(d.baseParticleIndex);for(let B=0;B<d.inputCount;++B)c=m[B].weight/nd,m[B].sourceParameterIndex==-1&&(m[B].sourceParameterIndex=t.getParameterIndex(m[B].source.id)),m[B].getNormalizedParameterValue(u,l,this._parameterCaches[m[B].sourceParameterIndex],S[m[B].sourceParameterIndex],b[m[B].sourceParameterIndex],T[m[B].sourceParameterIndex],d.normalizationPosition,d.normalizationAngle,m[B].reflect,c);f=Yt.degreesToRadian(-l.angle),u.x=u.x*Yt.cos(f)-u.y*Yt.sin(f),u.y=u.x*Yt.sin(f)+u.y*Yt.cos(f),aR(x,d.particleCount,u,l.angle,this._options.wind,E_*d.normalizationPosition.maximum,C,qP);for(let B=0;B<d.outputCount;++B){const X=_[B].vertexIndex;if(_[B].destinationParameterIndex==-1&&(_[B].destinationParameterIndex=t.getParameterIndex(_[B].destination.id)),X<1||X>=d.particleCount)continue;const tt=new Ct;tt.x=x[X].position.x-x[X-1].position.x,tt.y=x[X].position.y-x[X-1].position.y,g=_[B].getValue(tt,x,X,_[B].reflect,this._options.gravity),this._currentRigOutputs[E].outputs[B]=g;const Z=_[B].destinationParameterIndex,H=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(Z))):this._parameterCaches.slice(Z);yc(H,S[Z],b[Z],g,_[B]);for(let K=Z,j=0;K<this._parameterCaches.length;K++,j++)this._parameterCaches[K]=H[j]}}this._currentRemainTime-=C}const I=this._currentRemainTime/C;this.interpolate(t,I)}interpolate(t,e){let i,r,n,a,l;n=t.getModel().parameters.values,a=t.getModel().parameters.maximumValues,l=t.getModel().parameters.minimumValues;for(let c=0;c<this._physicsRig.subRigCount;++c){r=this._physicsRig.settings[c],i=this._physicsRig.outputs.slice(r.baseOutputIndex);for(let f=0;f<r.outputCount;++f){if(i[f].destinationParameterIndex==-1)continue;const g=i[f].destinationParameterIndex,u=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(n.subarray(g))):n.slice(g);yc(u,l[g],a[g],this._previousRigOutputs[c].outputs[f]*(1-e)+this._currentRigOutputs[c].outputs[f]*e,i[f]);for(let d=g,m=0;d<n.length;d++,m++)n[d]=u[m]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._options=new jP,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=[],this._previousRigOutputs=[],this._currentRemainTime=0}release(){this._physicsRig=void 0}initialize(){let t,e,i;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings[r],t=this._physicsRig.particles.slice(e.baseParticleIndex),t[0].initialPosition=new Ct(0,0),t[0].lastPosition=new Ct(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new Ct(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new Ct(0,0),t[0].force=new Ct(0,0);for(let n=1;n<e.particleCount;++n)i=new Ct(0,0),i.y=t[n].radius,t[n].initialPosition=new Ct(t[n-1].initialPosition.x+i.x,t[n-1].initialPosition.y+i.y),t[n].position=new Ct(t[n].initialPosition.x,t[n].initialPosition.y),t[n].lastPosition=new Ct(t[n].initialPosition.x,t[n].initialPosition.y),t[n].lastGravity=new Ct(0,-1),t[n].lastGravity.y*=-1,t[n].velocity=new Ct(0,0),t[n].force=new Ct(0,0)}}}class jP{constructor(){this.gravity=new Ct(0,0),this.wind=new Ct(0,0)}}class C_{constructor(){this.outputs=[]}}function KP(s,t,e,i,r,n,a,l,c,f){s.x+=Fd(e,i,r,n,a.minimum,a.maximum,a.defalut,c)*f}function ZP(s,t,e,i,r,n,a,l,c,f){s.y+=Fd(e,i,r,n,a.minimum,a.maximum,a.defalut,c)*f}function JP(s,t,e,i,r,n,a,l,c,f){t.angle+=Fd(e,i,r,n,l.minimum,l.maximum,l.defalut,c)*f}function QP(s,t,e,i,r){let n=s.x;return i&&(n*=-1),n}function tR(s,t,e,i,r){let n=s.y;return i&&(n*=-1),n}function eR(s,t,e,i,r){let n;return e>=2?r=t[e-1].position.substract(t[e-2].position):r=r.multiplyByScaler(-1),n=Yt.directionToRadian(r,s),i&&(n*=-1),n}function iR(s,t){return Math.abs(Math.max(s,t)-Math.min(s,t))}function rR(s,t){return Math.min(s,t)+iR(s,t)/2}function sR(s,t){return s.x}function nR(s,t){return s.y}function oR(s,t){return t}function aR(s,t,e,i,r,n,a,l){let c,f,g,u,d=new Ct(0,0),m=new Ct(0,0),_=new Ct(0,0),x=new Ct(0,0);s[0].position=new Ct(e.x,e.y),c=Yt.degreesToRadian(i),u=Yt.radianToDirection(c),u.normalize();for(let v=1;v<t;++v)s[v].force=u.multiplyByScaler(s[v].acceleration).add(r),s[v].lastPosition=new Ct(s[v].position.x,s[v].position.y),f=s[v].delay*a*30,d=s[v].position.substract(s[v-1].position),g=Yt.directionToRadian(s[v].lastGravity,u)/l,d.x=Yt.cos(g)*d.x-d.y*Yt.sin(g),d.y=Yt.sin(g)*d.x+d.y*Yt.cos(g),s[v].position=s[v-1].position.add(d),m=s[v].velocity.multiplyByScaler(f),_=s[v].force.multiplyByScaler(f).multiplyByScaler(f),s[v].position=s[v].position.add(m).add(_),x=s[v].position.substract(s[v-1].position),x.normalize(),s[v].position=s[v-1].position.add(x.multiplyByScaler(s[v].radius)),Yt.abs(s[v].position.x)<n&&(s[v].position.x=0),f!=0&&(s[v].velocity=s[v].position.substract(s[v].lastPosition),s[v].velocity=s[v].velocity.divisionByScalar(f),s[v].velocity=s[v].velocity.multiplyByScaler(s[v].mobility)),s[v].force=new Ct(0,0),s[v].lastGravity=new Ct(u.x,u.y)}function hR(s,t,e,i,r,n){let a,l,c=new Ct(0,0);s[0].position=new Ct(e.x,e.y),a=Yt.degreesToRadian(i),l=Yt.radianToDirection(a),l.normalize();for(let f=1;f<t;++f)s[f].force=l.multiplyByScaler(s[f].acceleration).add(r),s[f].lastPosition=new Ct(s[f].position.x,s[f].position.y),s[f].velocity=new Ct(0,0),c=s[f].force,c.normalize(),c=c.multiplyByScaler(s[f].radius),s[f].position=s[f-1].position.add(c),Yt.abs(s[f].position.x)<n&&(s[f].position.x=0),s[f].force=new Ct(0,0),s[f].lastGravity=new Ct(l.x,l.y)}function yc(s,t,e,i,r){let n,a,l;n=r.getScale(r.translationScale,r.angleScale),a=i*n,a<t?(a<r.valueBelowMinimum&&(r.valueBelowMinimum=a),a=t):a>e&&(a>r.valueExceededMaximum&&(r.valueExceededMaximum=a),a=e),l=r.weight/nd,l>=1||(a=s[0]*(1-l)+a*l),s[0]=a}function Fd(s,t,e,i,r,n,a,l){let c=0;const f=Yt.max(e,t);f<s&&(s=f);const g=Yt.min(e,t);g>s&&(s=g);const u=Yt.min(r,n),d=Yt.max(r,n),m=a,_=rR(g,f),x=s-_;switch(Math.sign(x)){case 1:{const v=d-m,b=f-_;b!=0&&(c=x*(v/b),c+=m);break}case-1:{const v=u-m,b=g-_;b!=0&&(c=x*(v/b),c+=m);break}case 0:{c=m;break}}return l?c:c*-1}class od{constructor(t=0,e=0,i=0,r=0){this.x=t,this.y=e,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}const $a=4,lR=36,uR=32,cR=10;let As,Tr,bh;class M_{getChannelFlagAsColor(t){return this._channelColors[t]}getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures=[],this._maskColorBuffers=[];const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.push(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers[e]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.push(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures[e]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers[e],0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,bh),this._maskTexture=new dR(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,n=Number.MIN_VALUE,a=Number.MIN_VALUE;const l=e._clippedDrawableIndexList.length;for(let c=0;c<l;c++){const f=e._clippedDrawableIndexList[c],g=t.getDrawableVertexCount(f),u=t.getDrawableVertices(f);let d=Number.MAX_VALUE,m=Number.MAX_VALUE,_=-Number.MAX_VALUE,x=-Number.MAX_VALUE;const v=g*gc.vertexStep;for(let b=gc.vertexOffset;b<v;b+=gc.vertexStep){const S=u[b],T=u[b+1];S<d&&(d=S),S>_&&(_=S),T<m&&(m=T),T>x&&(x=T)}if(d!=Number.MAX_VALUE)if(d<i&&(i=d),m<r&&(r=m),_>n&&(n=_),x>a&&(a=x),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const b=n-i,S=a-r;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=b,e._allClippedDrawRect.height=S}}}constructor(){this._currentMaskRenderTexture=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new od,this._tmpMatrix=new xi,this._tmpMatrixForMask=new xi,this._tmpMatrixForDraw=new xi;let t=new ri;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.push(t),t=new ri,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.push(t),t=new ri,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.push(t),t=new ri,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.push(t)}release(){var t;const e=this;for(let i=0;i<this._clippingContextListForMask.length;i++)this._clippingContextListForMask[i]&&((t=this._clippingContextListForMask[i])==null||t.release());if(e._clippingContextListForMask=void 0,e._clippingContextListForDraw=void 0,this._maskTexture){for(let i=0;i<this._maskTexture.textures.length;i++)this.gl.deleteFramebuffer(this._maskTexture.textures[i]);this._maskTexture=void 0}if(e._channelColors=void 0,this._maskColorBuffers)for(let i=0;i<this._maskColorBuffers.length;i++)this.gl.deleteTexture(this._maskColorBuffers[i]);this._maskColorBuffers=void 0,this._maskRenderTextures=void 0,this._clearedFrameBufferflags=void 0}initialize(t,e,i,r,n){n%1!=0&&(Ls("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),n=~~n),n<1&&Ls("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=n<1?1:n,this._clearedFrameBufferflags=[];for(let a=0;a<e;a++){if(r[a]<=0){this._clippingContextListForDraw.push(null);continue}let l=this.findSameClip(i[a],r[a]);l==null&&(l=new fR(this,i[a],r[a]),this._clippingContextListForMask.push(l)),l.addClippedDrawable(a),this._clippingContextListForDraw.push(l)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let r=0;r<this._clippingContextListForMask.length;r++){const n=this._clippingContextListForMask[r];this.calcClippedDrawTotalBounds(t,n),n._isUsing&&i++}if(i>0){this.setupLayoutBounds(e.isUsingHighPrecisionMask()?0:i),e.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture()[0],e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags||(this._clearedFrameBufferflags=[]);for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferflags[r]=!1;for(let r=0;r<this._clippingContextListForMask.length;r++){const n=this._clippingContextListForMask[r],a=n._allClippedDrawRect,l=n._layoutBounds,c=.05;let f=0,g=0;const u=this.getMaskRenderTexture()[n._bufferIndex];if(this._currentMaskRenderTexture!=u&&!e.isUsingHighPrecisionMask()&&(this._currentMaskRenderTexture=u,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),e.isUsingHighPrecisionMask()){const d=t.getPixelsPerUnit(),m=n.getClippingManager()._clippingMaskBufferSize,_=l.width*m,x=l.height*m;this._tmpBoundsOnModel.setRect(a),this._tmpBoundsOnModel.width*d>_?(this._tmpBoundsOnModel.expand(a.width*c,0),f=l.width/this._tmpBoundsOnModel.width):f=d/_,this._tmpBoundsOnModel.height*d>x?(this._tmpBoundsOnModel.expand(0,a.height*c),g=l.height/this._tmpBoundsOnModel.height):g=d/x}else this._tmpBoundsOnModel.setRect(a),this._tmpBoundsOnModel.expand(a.width*c,a.height*c),f=l.width/this._tmpBoundsOnModel.width,g=l.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(l.x,l.y),this._tmpMatrix.scaleRelative(f,g),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(l.x,l.y),this._tmpMatrix.scaleRelative(f,g),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),n._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),n._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!e.isUsingHighPrecisionMask()){const d=n._clippingIdCount;for(let m=0;m<d;m++){const _=n._clippingIdList[m];t.getDrawableDynamicFlagVertexPositionsDidChange(_)&&(e.setIsCulling(t.getDrawableCulling(_)!=!1),this._clearedFrameBufferflags[n._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[n._bufferIndex]=!0),e.setClippingContextBufferForMask(n),e.drawMesh(t.getDrawableTextureIndex(_),t.getDrawableVertexIndexCount(_),t.getDrawableVertexCount(_),t.getDrawableVertexIndices(_),t.getDrawableVertices(_),t.getDrawableVertexUvs(_),t.getMultiplyColor(_),t.getScreenColor(_),t.getDrawableOpacity(_),Cr.CubismBlendMode_Normal,!1))}}}e.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,bh),e.setClippingContextBufferForMask(null),this.gl.viewport(Tr[0],Tr[1],Tr[2],Tr[3]))}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.length;i++){const r=this._clippingContextListForMask[i],n=r._clippingIdCount;if(n!=e)continue;let a=0;for(let l=0;l<n;l++){const c=r._clippingIdList[l];for(let f=0;f<n;f++)if(t[f]==c){a++;break}}if(a==n)return r}return null}setupLayoutBounds(t){const e=this._renderTextureCount<=1?lR:uR*this._renderTextureCount;if(t<=0||t>e){t>e&&er(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let f=0;f<this._clippingContextListForMask.length;f++){const g=this._clippingContextListForMask[f];g._layoutChannelNo=0,g._layoutBounds.x=0,g._layoutBounds.y=0,g._layoutBounds.width=1,g._layoutBounds.height=1,g._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let r=t/this._renderTextureCount,n=t%this._renderTextureCount;r=~~r,n=~~n;let a=r/$a,l=r%$a;a=~~a,l=~~l;let c=0;for(let f=0;f<this._renderTextureCount;f++)for(let g=0;g<$a;g++){let u=a+(g<l?1:0);const d=l+1>=$a?0:l+1;if(u<i&&g==d&&(u+=f<n?1:0),u!=0)if(u==1){const m=this._clippingContextListForMask[c++];m._layoutChannelNo=g,m._layoutBounds.x=0,m._layoutBounds.y=0,m._layoutBounds.width=1,m._layoutBounds.height=1,m._bufferIndex=f}else if(u==2)for(let m=0;m<u;m++){let _=m%2;_=~~_;const x=this._clippingContextListForMask[c++];x._layoutChannelNo=g,x._layoutBounds.x=_*.5,x._layoutBounds.y=0,x._layoutBounds.width=.5,x._layoutBounds.height=1,x._bufferIndex=f}else if(u<=4)for(let m=0;m<u;m++){let _=m%2,x=m/2;_=~~_,x=~~x;const v=this._clippingContextListForMask[c++];v._layoutChannelNo=g,v._layoutBounds.x=_*.5,v._layoutBounds.y=x*.5,v._layoutBounds.width=.5,v._layoutBounds.height=.5,v._bufferIndex=f}else if(u<=i)for(let m=0;m<u;m++){let _=m%3,x=m/3;_=~~_,x=~~x;const v=this._clippingContextListForMask[c++];v._layoutChannelNo=g,v._layoutBounds.x=_/3,v._layoutBounds.y=x/3,v._layoutBounds.width=1/3,v._layoutBounds.height=1/3,v._bufferIndex=f}else if(xh.supportMoreMaskDivisions&&u<=16)for(let m=0;m<u;m++){let _=m%4,x=m/4;_=~~_,x=~~x;const v=this._clippingContextListForMask[c++];v._layoutChannelNo=g,v._layoutBounds.x=_/4,v._layoutBounds.y=x/4,v._layoutBounds.width=1/4,v._layoutBounds.height=1/4,v._bufferIndex=f}else{er(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let m=0;m<u;m++){const _=this._clippingContextListForMask[c++];_._layoutChannelNo=0,_._layoutBounds.x=0,_._layoutBounds.y=0,_._layoutBounds.width=1,_._layoutBounds.height=1,_._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.length}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class dR{constructor(t,e){this.frameNo=t,this.textures=e}}class fR{constructor(t,e,i){this._isUsing=!1,this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new od,this._layoutBounds=new od,this._clippedDrawableIndexList=[],this._matrixForMask=new xi,this._matrixForDraw=new xi,this._bufferIndex=0}release(){const t=this;t._layoutBounds=void 0,t._allClippedDrawRect=void 0,t._clippedDrawableIndexList=void 0}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class pR{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){er(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){er(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class Cn{static getInstance(){return As==null&&(As=new Cn),As}static deleteInstance(){As&&(As.release(),As=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,r,n,a,l,c,f,g,u,d,m,_,x){m||er("NoPremultipliedAlpha is not allowed"),this._shaderSets.length==0&&this.generateShaders();let v,b,S,T;const C=t.getClippingContextBufferForMask();if(C!=null){const I=this._shaderSets[0];this.gl.useProgram(I.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(I.samplerTexture0Location,0),l.vertex==null&&(l.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(I.attributePositionLocation),this.gl.vertexAttribPointer(I.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),l.uv==null&&(l.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(I.attributeTexCoordLocation),this.gl.vertexAttribPointer(I.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const k=C._layoutChannelNo,E=C.getClippingManager().getChannelFlagAsColor(k);this.gl.uniform4f(I.uniformChannelFlagLocation,E.R,E.G,E.B,E.A),this.gl.uniformMatrix4fv(I.uniformClipMatrixLocation,!1,C._matrixForMask.getArray());const B=C._layoutBounds;this.gl.uniform4f(I.uniformBaseColorLocation,B.x*2-1,B.y*2-1,B.getRight()*2-1,B.getBottom()*2-1),this.gl.uniform4f(I.uniformMultiplyColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(I.uniformScreenColorLocation,d.R,d.G,d.B,d.A),v=this.gl.ZERO,b=this.gl.ONE_MINUS_SRC_COLOR,S=this.gl.ZERO,T=this.gl.ONE_MINUS_SRC_ALPHA}else{const I=t.getClippingContextBufferForDraw(),E=I!=null?x?2:1:0;let B;switch(f){case Cr.CubismBlendMode_Normal:default:B=this._shaderSets[1+E],v=this.gl.ONE,b=this.gl.ONE_MINUS_SRC_ALPHA,S=this.gl.ONE,T=this.gl.ONE_MINUS_SRC_ALPHA;break;case Cr.CubismBlendMode_Additive:B=this._shaderSets[4+E],v=this.gl.ONE,b=this.gl.ONE,S=this.gl.ZERO,T=this.gl.ONE;break;case Cr.CubismBlendMode_Multiplicative:B=this._shaderSets[7+E],v=this.gl.DST_COLOR,b=this.gl.ONE_MINUS_SRC_ALPHA,S=this.gl.ZERO,T=this.gl.ONE;break}if(this.gl.useProgram(B.shaderProgram),l.vertex==null&&(l.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(B.attributePositionLocation),this.gl.vertexAttribPointer(B.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),l.uv==null&&(l.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(B.attributeTexCoordLocation),this.gl.vertexAttribPointer(B.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),I!=null){this.gl.activeTexture(this.gl.TEXTURE1);const X=I.getClippingManager().getColorBuffer()[t.getClippingContextBufferForDraw()._bufferIndex];this.gl.bindTexture(this.gl.TEXTURE_2D,X),this.gl.uniform1i(B.samplerTexture1Location,1),this.gl.uniformMatrix4fv(B.uniformClipMatrixLocation,!1,I._matrixForDraw.getArray());const tt=I._layoutChannelNo,Z=I.getClippingManager().getChannelFlagAsColor(tt);this.gl.uniform4f(B.uniformChannelFlagLocation,Z.R,Z.G,Z.B,Z.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(B.samplerTexture0Location,0),this.gl.uniformMatrix4fv(B.uniformMatrixLocation,!1,_.getArray()),this.gl.uniform4f(B.uniformBaseColorLocation,g.R,g.G,g.B,g.A),this.gl.uniform4f(B.uniformMultiplyColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(B.uniformScreenColorLocation,d.R,d.G,d.B,d.A)}l.index==null&&(l.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,l.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(v,b,S,T)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.length;t++)this.gl.deleteProgram(this._shaderSets[t].shaderProgram),this._shaderSets[t].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let t=0;t<cR;t++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(mR,gR),this._shaderSets[1].shaderProgram=this.loadShaderProgram(_R,yR),this._shaderSets[2].shaderProgram=this.loadShaderProgram(I_,vR),this._shaderSets[3].shaderProgram=this.loadShaderProgram(I_,xR),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_position"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_texCoord"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"s_texture0"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_clipMatrix"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_channelFlag"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_baseColor"),this._shaderSets[0].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_multiplyColor"),this._shaderSets[0].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_screenColor"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_position"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_texCoord"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"s_texture0"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_matrix"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_baseColor"),this._shaderSets[1].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_multiplyColor"),this._shaderSets[1].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_screenColor"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_position"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_texCoord"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture0"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture1"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_matrix"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_clipMatrix"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_channelFlag"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_baseColor"),this._shaderSets[2].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_multiplyColor"),this._shaderSets[2].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_screenColor"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_position"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_texCoord"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture0"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture1"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_matrix"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_clipMatrix"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_channelFlag"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_baseColor"),this._shaderSets[3].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_multiplyColor"),this._shaderSets[3].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_screenColor"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_position"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_texCoord"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"s_texture0"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_matrix"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_baseColor"),this._shaderSets[4].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_multiplyColor"),this._shaderSets[4].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_screenColor"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_position"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_texCoord"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture0"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture1"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_matrix"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_clipMatrix"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_channelFlag"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_baseColor"),this._shaderSets[5].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_multiplyColor"),this._shaderSets[5].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_screenColor"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_position"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_texCoord"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture0"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture1"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_matrix"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_clipMatrix"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_channelFlag"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_baseColor"),this._shaderSets[6].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_multiplyColor"),this._shaderSets[6].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_screenColor"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_position"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_texCoord"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"s_texture0"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_matrix"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_baseColor"),this._shaderSets[7].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_multiplyColor"),this._shaderSets[7].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_screenColor"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_position"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_texCoord"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture0"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture1"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_matrix"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_clipMatrix"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_channelFlag"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_baseColor"),this._shaderSets[8].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_multiplyColor"),this._shaderSets[8].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_screenColor"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_position"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_texCoord"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture0"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture1"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_matrix"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_clipMatrix"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_channelFlag"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_baseColor"),this._shaderSets[9].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_multiplyColor"),this._shaderSets[9].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_screenColor")}loadShaderProgram(t,e){const i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return er("Vertex shader compile error!"),0;const n=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return n?(this.gl.attachShader(i,r),this.gl.attachShader(i,n),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(n),i):(er("Failed to link program: {0}",i),this.gl.deleteShader(r),this.gl.deleteShader(n),i&&this.gl.deleteProgram(i),0)):(er("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){const a=this.gl.getShaderInfoLog(r);er("Shader compile log: {0} ",a)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}const mR="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",gR="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",_R="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",I_="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",yR="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",vR="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",xR="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class Av extends Cd{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new M_,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts(),e));for(let i=t.getDrawableCount()-1;i>=0;i--)this._sortedDrawableIndexList[i]=0;super.initialize(t)}bindTexture(t,e){this._textures[t]=e}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=new M_,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new pR,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}release(){var t,e,i;const r=this;this._clippingManager.release(),r._clippingManager=void 0,(t=this.gl)==null||t.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,(e=this.gl)==null||e.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,(i=this.gl)==null||i.deleteBuffer(this._bufferData.index),this._bufferData.index=null,r._bufferData=void 0,r._textures=void 0}doDrawModel(){if(this.gl==null){er(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const r=e[i];this._sortedDrawableIndexList[r]=i}for(let i=0;i<t;++i){const r=this._sortedDrawableIndexList[i];if(!this.getModel().getDrawableDynamicFlagIsVisible(r))continue;const n=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw()[r]:null;if(n!=null&&this.isUsingHighPrecisionMask()){n._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,n.getClippingManager().getMaskRenderTexture()[n._bufferIndex]),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const a=n._clippingIdCount;for(let l=0;l<a;l++){const c=n._clippingIdList[l];this._model.getDrawableDynamicFlagVertexPositionsDidChange(c)&&(this.setIsCulling(this._model.getDrawableCulling(c)!=!1),this.setClippingContextBufferForMask(n),this.drawMesh(this.getModel().getDrawableTextureIndex(c),this.getModel().getDrawableVertexIndexCount(c),this.getModel().getDrawableVertexCount(c),this.getModel().getDrawableVertexIndices(c),this.getModel().getDrawableVertices(c),this.getModel().getDrawableVertexUvs(c),this.getModel().getMultiplyColor(c),this.getModel().getScreenColor(c),this.getModel().getDrawableOpacity(c),Cr.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,bh),this.setClippingContextBufferForMask(null),this.gl.viewport(Tr[0],Tr[1],Tr[2],Tr[3]),this.preDraw()}this.setClippingContextBufferForDraw(n),this.setIsCulling(this.getModel().getDrawableCulling(r)),this.drawMesh(this.getModel().getDrawableTextureIndex(r),this.getModel().getDrawableVertexIndexCount(r),this.getModel().getDrawableVertexCount(r),this.getModel().getDrawableVertexIndices(r),this.getModel().getDrawableVertices(r),this.getModel().getDrawableVertexUvs(r),this.getModel().getMultiplyColor(r),this.getModel().getScreenColor(r),this.getModel().getDrawableOpacity(r),this.getModel().getDrawableBlendMode(r),this.getModel().getDrawableInvertedMaskBit(r))}}drawMesh(t,e,i,r,n,a,l,c,f,g,u){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const d=this.getModelColor();this.getClippingContextBufferForMask()==null&&(d.A*=f,this.isPremultipliedAlpha()&&(d.R*=d.A,d.G*=d.A,d.B*=d.A));let m=null;this._textures[t]!=null&&(m=this._textures[t]),Cn.getInstance().setupShaderProgram(this,m,i,n,r,a,this._bufferData,f,g,d,l,c,this.isPremultipliedAlpha(),this.getMvpMatrix(),u),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){Cn.deleteInstance()}setRenderState(t,e){bh=t,Tr=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(const t of Object.entries(this._textures))this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),Cn.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}Cd.staticRelease=()=>{Av.doStaticRelease()};class Ev{constructor(t){this.groups=t.Groups,this.hitAreas=t.HitAreas,this.layout=t.Layout,this.moc=t.FileReferences.Moc,this.expressions=t.FileReferences.Expressions,this.motions=t.FileReferences.Motions,this.textures=t.FileReferences.Textures,this.physics=t.FileReferences.Physics,this.pose=t.FileReferences.Pose}getEyeBlinkParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name==="EyeBlink"))==null?void 0:e.Ids}getLipSyncParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name==="LipSync"))==null?void 0:e.Ids}}const bR="ParamAngleX",wR="ParamAngleY",TR="ParamAngleZ",SR="ParamEyeBallX",AR="ParamEyeBallY",ER="ParamMouthForm",CR="ParamBodyAngleX",MR="ParamBreath",P_=2,R_=2,wh={motionFadingDuration:500,idleMotionFadingDuration:2e3},Qt={log(s,...t){},warn(s,...t){console.warn(`[${s}]`,...t)},error(s,...t){console.error(`[${s}]`,...t)}};function ad(s,t,e){return s<t?t:s>e?e:s}function IR(s,t){t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{i!=="constructor"&&Object.defineProperty(s.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))})})}function PR(s){let t=s.lastIndexOf("/");return t!=-1&&(s=s.slice(0,t)),t=s.lastIndexOf("/"),t!==-1&&(s=s.slice(t+1)),s}function RR(s,t){const e=s.indexOf(t);e!==-1&&s.splice(e,1)}class Cv extends rs{constructor(t,e){super(),Q(this,"tag"),Q(this,"settings"),Q(this,"expressions",[]),Q(this,"defaultExpression"),Q(this,"currentExpression"),Q(this,"reserveExpressionIndex",-1),Q(this,"destroyed",!1),this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return he(this,null,function*(){if(!this.definitions[t]){Qt.warn(this.tag,`Undefined expression at [${t}]`);return}if(this.expressions[t]===null){Qt.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);return}if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e})}_loadExpression(t){throw new Error("Not implemented.")}setRandomExpression(){return he(this,null,function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)this.expressions[e]!==null&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return he(this,null,function*(){if(typeof t!="number"&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length)||t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!e||this.reserveExpressionIndex!==t?!1:(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),!0)})}update(t,e){return this.isFinished()?!1:this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy");const t=this;t.definitions=void 0,t.expressions=void 0}}const F_=.01,FR=40/7.5,DR=1/(.15*1e3);class LR{constructor(){Q(this,"targetX",0),Q(this,"targetY",0),Q(this,"x",0),Q(this,"y",0),Q(this,"vx",0),Q(this,"vy",0)}focus(t,e,i=!1){this.targetX=ad(t,-1,1),this.targetY=ad(e,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(e)<F_&&Math.abs(i)<F_)return;const r=Math.sqrt(Ss(e,2)+Ss(i,2)),n=FR/(1e3/t);let a=n*(e/r)-this.vx,l=n*(i/r)-this.vy;const c=Math.sqrt(Ss(a,2)+Ss(l,2)),f=n*DR*t;c>f&&(a*=f/c,l*=f/c),this.vx+=a,this.vy+=l;const g=Math.sqrt(Ss(this.vx,2)+Ss(this.vy,2)),u=.5*(Math.sqrt(Ss(f,2)+8*f*r)-f);g>u&&(this.vx*=u/g,this.vy*=u/g),this.x+=this.vx,this.y+=this.vy}}class Dd{constructor(t){Q(this,"json"),Q(this,"name"),Q(this,"url"),Q(this,"pose"),Q(this,"physics"),this.json=t;const e=t.url;if(typeof e!="string")throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=e,this.name=PR(this.url)}resolveURL(t){return pd.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,"moc"),this.pose!==void 0&&(this.pose=t(this.pose,"pose")),this.physics!==void 0&&(this.physics=t(this.physics,"physics"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles(e=>(t.push(e),e)),t}validateFiles(t){const e=(n,a)=>{const l=this.resolveURL(n);if(!t.includes(l)){if(a)throw new Error(`File "${n}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(n=>e(n,!0)),this.getDefinedFiles().filter(n=>e(n,!1))}}var Mn=(s=>(s[s.NONE=0]="NONE",s[s.IDLE=1]="IDLE",s[s.NORMAL=2]="NORMAL",s[s.FORCE=3]="FORCE",s))(Mn||{});class BR{constructor(){Q(this,"tag"),Q(this,"debug",!1),Q(this,"currentPriority",0),Q(this,"reservePriority",0),Q(this,"currentGroup"),Q(this,"currentIndex"),Q(this,"reservedGroup"),Q(this,"reservedIndex"),Q(this,"reservedIdleGroup"),Q(this,"reservedIdleIndex")}reserve(t,e,i){if(i<=0)return Qt.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(t===this.currentGroup&&e===this.currentIndex)return Qt.log(this.tag,"Motion is already playing.",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return Qt.log(this.tag,"Motion is already reserved.",this.dump(t,e)),!1;if(i===1){if(this.currentPriority!==0)return Qt.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,e)),!1;if(this.reservedIdleGroup!==void 0)return Qt.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(i<3){if(i<=this.currentPriority)return Qt.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(t,e)),!1;if(i<=this.reservePriority)return Qt.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(t,e)),!1}this.setReserved(t,e,i)}return!0}start(t,e,i,r){if(r===1){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==0)return Qt.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,i)),!1}else{if(e!==this.reservedGroup||i!==this.reservedIndex)return Qt.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(e,i)),!1;this.setReserved(void 0,void 0,0)}return t?(this.setCurrent(e,i,r),!0):!1}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(t,e,i){this.currentPriority=i,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,i){this.reservePriority=i,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return this.currentGroup===void 0&&this.reservedIdleGroup===void 0}shouldOverrideExpression(){return!1}dump(t,e){if(this.debug){const i=["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"];return`
<Requested> group = "${t}", index = ${e}
`+i.map(r=>"["+r+"] "+this[r]).join(`
`)}return""}}const OR="SoundManager",In=.5;class Te{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach(e=>e.volume=this._volume)}static add(t,e,i,r){const n=new Audio(t);return n.volume=this._volume,n.preload="auto",n.crossOrigin=r,n.addEventListener("ended",()=>{this.dispose(n),e?.()}),n.addEventListener("error",a=>{this.dispose(n),Qt.warn(OR,`Error occurred on "${t}"`,a.error),i?.(a.error)}),this.audios.push(n),n}static play(t){return new Promise((e,i)=>{var r;(r=t.play())==null||r.catch(n=>{t.dispatchEvent(new ErrorEvent("error",{error:n})),i(n)}),t.readyState===t.HAVE_ENOUGH_DATA?e():t.addEventListener("canplaythrough",e)})}static addContext(t){const e=new AudioContext;return this.contexts.push(e),e}static addAnalyzer(t,e){const i=e.createMediaElementSource(t),r=e.createAnalyser();return r.fftSize=256,r.minDecibels=-90,r.maxDecibels=-10,r.smoothingTimeConstant=.85,i.connect(r),r.connect(e.destination),this.analysers.push(r),r}static analyze(t){if(t!=null){const e=new Float32Array(t.fftSize);let i=0;t.getFloatTimeDomainData(e);for(const r of e)i+=r*r;return parseFloat(Math.sqrt(i/e.length*20).toFixed(1))}else return parseFloat(Math.random().toFixed(1))}static dispose(t){t.pause(),t.removeAttribute("src"),RR(this.audios,t)}static destroy(){for(let t=this.contexts.length-1;t>=0;t--)this.contexts[t].close();for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}Q(Te,"audios",[]);Q(Te,"analysers",[]);Q(Te,"contexts",[]);Q(Te,"_volume",In);var Mv=(s=>(s.ALL="ALL",s.IDLE="IDLE",s.NONE="NONE",s))(Mv||{});class Ld extends rs{constructor(t,e){super(),Q(this,"tag"),Q(this,"settings"),Q(this,"motionGroups",{}),Q(this,"state",new BR),Q(this,"currentAudio"),Q(this,"currentAnalyzer"),Q(this,"currentContext"),Q(this,"playing",!1),Q(this,"destroyed",!1),this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){t?.idleMotionGroup&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const i of Object.keys(this.definitions))this.motionGroups[i]=[];let e;switch(t?.motionPreload){case"NONE":return;case"ALL":e=Object.keys(this.definitions);break;case"IDLE":default:e=[this.groups.idle];break}for(const i of e)if(this.definitions[i])for(let r=0;r<this.definitions[i].length;r++)this.loadMotion(i,r).then()}loadMotion(t,e){return he(this,null,function*(){var i;if(!((i=this.definitions[t])!=null&&i[e])){Qt.warn(this.tag,`Undefined motion at "${t}"[${e}]`);return}if(this.motionGroups[t][e]===null){Qt.warn(this.tag,`Cannot start motion at "${t}"[${e}] because it's already failed in loading.`);return}if(this.motionGroups[t][e])return this.motionGroups[t][e];const r=yield this._loadMotion(t,e);if(!this.destroyed)return this.motionGroups[t][e]=r??null,r})}_loadMotion(t,e){throw new Error("Not implemented.")}speak(t){return he(this,arguments,function*(e,{volume:i=In,expression:r,resetExpression:n=!0,crossOrigin:a,onFinish:l,onError:c}={}){let f,g,u;if(this.currentAudio&&!this.currentAudio.ended)return!1;let d;const m=e&&e.startsWith("data:");if(console.log(l),e&&!m){const x=document.createElement("a");x.href=e,e=x.href,d=e}else d="data:audio/";const _=e;if(_)try{f=Te.add(_,(x=this)=>{console.log("Audio finished playing"),l?.(),n&&r&&x.expressionManager&&x.expressionManager.resetExpression(),x.currentAudio=void 0},(x,v=this)=>{console.log("Error during audio playback:",x),c?.(x),n&&r&&v.expressionManager&&v.expressionManager.resetExpression(),v.currentAudio=void 0},a),this.currentAudio=f,Te.volume=i,u=Te.addContext(this.currentAudio),this.currentContext=u,g=Te.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=g}catch(x){return Qt.warn(this.tag,"Failed to create audio",d,x),!1}if(f){let x=!0;if(yield Te.play(f).catch(b=>{Qt.warn(this.tag,"Failed to play audio",f.src,b),x=!1}),!x)return!1}return this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),r&&this.expressionManager&&this.expressionManager.setExpression(r),this.playing=!0,!0})}startMotion(t,e){return he(this,arguments,function*(i,r,n=Mn.NORMAL,{sound:a=void 0,volume:l=In,expression:c=void 0,resetExpression:f=!0,crossOrigin:g,onFinish:u,onError:d}={}){var m;if(!this.state.reserve(i,r,n)||this.currentAudio&&!this.currentAudio.ended&&n!=Mn.FORCE)return!1;const _=(m=this.definitions[i])==null?void 0:m[r];if(!_)return!1;this.currentAudio&&Te.dispose(this.currentAudio);let x,v,b,S;const T=a&&a.startsWith("data:");if(a&&!T){const k=document.createElement("a");k.href=a,a=k.href,S=a}else S=this.getSoundFile(_),S&&(S=this.settings.resolveURL(S));const C=S;if(C)try{x=Te.add(C,(k=this)=>{console.log("Audio finished playing"),u?.(),console.log(u),f&&c&&k.expressionManager&&k.expressionManager.resetExpression(),k.currentAudio=void 0},(k,E=this)=>{console.log("Error during audio playback:",k),d?.(k),f&&c&&E.expressionManager&&E.expressionManager.resetExpression(),E.currentAudio=void 0},g),this.currentAudio=x,Te.volume=l,b=Te.addContext(this.currentAudio),this.currentContext=b,v=Te.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=v}catch(k){Qt.warn(this.tag,"Failed to create audio",S,k)}const I=yield this.loadMotion(i,r);return x&&(yield Te.play(x).catch(E=>Qt.warn(this.tag,"Failed to play audio",x.src,E))),this.state.start(I,i,r,n)?(this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),Qt.log(this.tag,"Start motion:",this.getMotionName(_)),this.emit("motionStart",i,r,x),c&&this.expressionManager&&this.state.shouldOverrideExpression()&&this.expressionManager.setExpression(c),this.playing=!0,this._startMotion(I),!0):(x&&(Te.dispose(x),this.currentAudio=void 0),!1)})}startRandomMotion(t,e){return he(this,arguments,function*(i,r,{sound:n,volume:a=In,expression:l,resetExpression:c=!0,crossOrigin:f,onFinish:g,onError:u}={}){const d=this.definitions[i];if(d?.length){const m=[];for(let _=0;_<d.length;_++)this.motionGroups[i][_]!==null&&!this.state.isActive(i,_)&&m.push(_);if(m.length){const _=m[Math.floor(Math.random()*m.length)];return this.startMotion(i,_,r,{sound:n,volume:a,expression:l,resetExpression:c,crossOrigin:f,onFinish:g,onError:u})}}return!1})}stopSpeaking(){this.currentAudio&&(Te.dispose(this.currentAudio),this.currentAudio=void 0)}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.stopSpeaking()}update(t,e){var i;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&((i=this.expressionManager)==null||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,Mn.IDLE)),this.updateParameters(t,e)}mouthSync(){return this.currentAnalyzer?Te.analyze(this.currentAnalyzer):0}destroy(){var t;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),(t=this.expressionManager)==null||t.destroy();const e=this;e.definitions=void 0,e.motionGroups=void 0}}const kR={x:0,y:0,width:0,height:0};class NR extends rs{constructor(){super(...arguments),Q(this,"focusController",new LR),Q(this,"pose"),Q(this,"physics"),Q(this,"originalWidth",0),Q(this,"originalHeight",0),Q(this,"width",0),Q(this,"height",0),Q(this,"localTransform",new te),Q(this,"drawingMatrix",new te),Q(this,"hitAreas",{}),Q(this,"textureFlipY",!1),Q(this,"viewport",[0,0,0,0]),Q(this,"destroyed",!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this,e=this.getSize();t.originalWidth=e[0],t.originalHeight=e[1];const i=Object.assign({width:P_,height:R_},this.getLayout());this.localTransform.scale(i.width/P_,i.height/R_),t.width=this.originalWidth*this.localTransform.a,t.height=this.originalHeight*this.localTransform.d;const r=i.x!==void 0&&i.x-i.width/2||i.centerX!==void 0&&i.centerX||i.left!==void 0&&i.left-i.width/2||i.right!==void 0&&i.right+i.width/2||0,n=i.y!==void 0&&i.y-i.height/2||i.centerY!==void 0&&i.centerY||i.top!==void 0&&i.top-i.height/2||i.bottom!==void 0&&i.bottom+i.height/2||0;this.localTransform.translate(this.width*r,-this.height*n)}setupHitAreas(){const t=this.getHitAreaDefs().filter(e=>e.index>=0);for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,t,e))}isHit(t,e,i){if(!this.hitAreas[t])return!1;const r=this.hitAreas[t].index,n=this.getDrawableBounds(r,kR);return n.x<=e&&e<=n.x+n.width&&n.y<=i&&i<=n.y+n.height}getDrawableBounds(t,e){const i=this.getDrawableVertices(t);let r=i[0],n=i[0],a=i[1],l=i[1];for(let c=0;c<i.length;c+=2){const f=i[c],g=i[c+1];r=Math.min(f,r),n=Math.max(f,n),a=Math.min(g,a),l=Math.max(g,l)}return e??(e={}),e.x=r,e.y=a,e.width=n-r,e.height=l-a,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}const UR="XHRLoader";class D_ extends Error{constructor(t,e,i,r=!1){super(t),this.url=e,this.status=i,this.aborted=r}}const Ao=class qe{static createXHR(t,e,i,r,n){const a=new XMLHttpRequest;if(qe.allXhrSet.add(a),t){let l=qe.xhrMap.get(t);l?l.add(a):(l=new Set([a]),qe.xhrMap.set(t,l)),t.listeners("destroy").includes(qe.cancelXHRs)||t.once("destroy",qe.cancelXHRs)}return a.open("GET",e),a.responseType=i,a.onload=()=>{(a.status===200||a.status===0)&&a.response?r(a.response):a.onerror()},a.onerror=()=>{Qt.warn(UR,`Failed to load resource as ${a.responseType} (Status ${a.status}): ${e}`),n(new D_("Network error.",e,a.status))},a.onabort=()=>n(new D_("Aborted.",e,a.status,!0)),a.onloadend=()=>{var l;qe.allXhrSet.delete(a),t&&((l=qe.xhrMap.get(t))==null||l.delete(a))},a}static cancelXHRs(){var t;(t=qe.xhrMap.get(this))==null||t.forEach(e=>{e.abort(),qe.allXhrSet.delete(e)}),qe.xhrMap.delete(this)}static release(){qe.allXhrSet.forEach(t=>t.abort()),qe.allXhrSet.clear(),qe.xhrMap=new WeakMap}};Q(Ao,"xhrMap",new WeakMap);Q(Ao,"allXhrSet",new Set);Q(Ao,"loader",(s,t)=>new Promise((e,i)=>{Ao.createXHR(s.target,s.settings?s.settings.resolveURL(s.url):s.url,s.type,n=>{s.result=n,e()},i).send()}));let GR=Ao;function Iv(s,t){let e=-1;return i(0);function i(r,n){if(n)return Promise.reject(n);if(r<=e)return Promise.reject(new Error("next() called multiple times"));e=r;const a=s[r];if(!a)return Promise.resolve();try{return Promise.resolve(a(t,i.bind(null,r+1)))}catch(l){return Promise.reject(l)}}}class is{static load(t){return Iv(this.middlewares,t).then(()=>t.result)}}Q(is,"middlewares",[GR.loader]);function HR(s,t={}){var e;const i={resourceOptions:{crossorigin:t.crossOrigin}};if(ct.fromURL)return ct.fromURL(s,i).catch(a=>{if(a instanceof Error)throw a;const l=new Error("Texture loading error");throw l.event=a,l});i.resourceOptions.autoLoad=!1;const r=ct.from(s,i);if(r.baseTexture.valid)return Promise.resolve(r);const n=r.baseTexture.resource;return(e=n._live2d_load)!=null||(n._live2d_load=new Promise((a,l)=>{const c=f=>{n.source.removeEventListener("error",c);const g=new Error("Texture loading error");g.event=f,l(g)};n.source.addEventListener("error",c),n.load().then(()=>a(r)).catch(c)})),n._live2d_load}function VR(){}const L_="Live2DFactory",Pv=(s,t)=>he(void 0,null,function*(){if(typeof s.source=="string"){const e=yield is.load({url:s.source,type:"json",target:s.live2dModel});e.url=s.source,s.source=e,s.live2dModel.emit("settingsJSONLoaded",e)}return t()}),Rv=(s,t)=>he(void 0,null,function*(){if(s.source instanceof Dd)return s.settings=s.source,t();if(typeof s.source=="object"){const e=bi.findRuntime(s.source);if(e){const i=e.createModelSettings(s.source);return s.settings=i,s.live2dModel.emit("settingsLoaded",i),t()}}throw new TypeError("Unknown settings format.")}),Fv=(s,t)=>{if(s.settings){const e=bi.findRuntime(s.settings);if(e)return e.ready().then(t)}return t()},Dv=(s,t)=>he(void 0,null,function*(){yield t();const e=s.internalModel;if(e){const i=s.settings,r=bi.findRuntime(i);if(r){const n=[];i.pose&&n.push(is.load({settings:i,url:i.pose,type:"json",target:e}).then(a=>{e.pose=r.createPose(e.coreModel,a),s.live2dModel.emit("poseLoaded",e.pose)}).catch(a=>{s.live2dModel.emit("poseLoadError",a),Qt.warn(L_,"Failed to load pose.",a)})),i.physics&&n.push(is.load({settings:i,url:i.physics,type:"json",target:e}).then(a=>{e.physics=r.createPhysics(e.coreModel,a),s.live2dModel.emit("physicsLoaded",e.physics)}).catch(a=>{s.live2dModel.emit("physicsLoadError",a),Qt.warn(L_,"Failed to load physics.",a)})),n.length&&(yield Promise.all(n))}}}),Lv=(s,t)=>he(void 0,null,function*(){if(s.settings){const e=s.live2dModel,i=Promise.all(s.settings.textures.map(r=>{const n=s.settings.resolveURL(r);return HR(n,{crossOrigin:s.options.crossOrigin})}));if(i.catch(VR),yield t(),s.internalModel)e.internalModel=s.internalModel,e.emit("modelLoaded",s.internalModel);else throw new TypeError("Missing internal model.");e.textures=yield i,e.emit("textureLoaded",e.textures)}else throw new TypeError("Missing settings.")}),Bv=(s,t)=>he(void 0,null,function*(){const e=s.settings;if(e instanceof Dd){const i=bi.findRuntime(e);if(!i)throw new TypeError("Unknown model settings.");const r=yield is.load({settings:e,url:e.moc,type:"arraybuffer",target:s.live2dModel});if(!i.isValidMoc(r))throw new Error("Invalid moc data");const n=i.createCoreModel(r);return s.internalModel=i.createInternalModel(n,e,s.options),t()}throw new TypeError("Missing settings.")}),Ue=class gn{static unzip(t,e){return he(this,null,function*(){const i=yield gn.getFilePaths(t),r=[];for(const a of e.getDefinedFiles()){const l=decodeURI(pd.resolve(e.url,a));i.includes(l)&&r.push(l)}const n=yield gn.getFiles(t,r);for(let a=0;a<n.length;a++){const l=r[a],c=n[a];Object.defineProperty(c,"webkitRelativePath",{value:l})}return n})}static createSettings(t){return he(this,null,function*(){const i=(yield gn.getFilePaths(t)).find(l=>l.endsWith("model.json")||l.endsWith("model3.json"));if(!i)throw new Error("Settings file not found");const r=yield gn.readText(t,i);if(!r)throw new Error("Empty settings file: "+i);const n=JSON.parse(r);n.url=i;const a=gn.live2dFactory.findRuntime(n);if(!a)throw new Error("Unknown settings JSON");return a.createModelSettings(n)})}static zipReader(t,e){return he(this,null,function*(){throw new Error("Not implemented")})}static getFilePaths(t){return he(this,null,function*(){throw new Error("Not implemented")})}static getFiles(t,e){return he(this,null,function*(){throw new Error("Not implemented")})}static readText(t,e){return he(this,null,function*(){throw new Error("Not implemented")})}static releaseReader(t){}};Q(Ue,"live2dFactory");Q(Ue,"ZIP_PROTOCOL","zip://");Q(Ue,"uid",0);Q(Ue,"factory",(s,t)=>he(Ue,null,function*(){const e=s.source;let i,r,n;if(typeof e=="string"&&(e.endsWith(".zip")||e.startsWith(Ue.ZIP_PROTOCOL))?(e.startsWith(Ue.ZIP_PROTOCOL)?i=e.slice(Ue.ZIP_PROTOCOL.length):i=e,r=yield is.load({url:i,type:"blob",target:s.live2dModel})):Array.isArray(e)&&e.length===1&&e[0]instanceof File&&e[0].name.endsWith(".zip")&&(r=e[0],i=URL.createObjectURL(r),n=e.settings),r){if(!r.size)throw new Error("Empty zip file");const a=yield Ue.zipReader(r,i);n||(n=yield Ue.createSettings(a)),n._objectURL=Ue.ZIP_PROTOCOL+Ue.uid+"/"+n.url;const l=yield Ue.unzip(a,n);l.settings=n,s.source=l,i.startsWith("blob:")&&s.live2dModel.once("modelLoaded",c=>{c.once("destroy",function(){URL.revokeObjectURL(i)})}),Ue.releaseReader(a)}return t()}));let Ov=Ue;const Di=class rh{static resolveURL(t,e){var i;const r=(i=rh.filesMap[t])==null?void 0:i[e];if(r===void 0)throw new Error("Cannot find this file from uploaded files: "+e);return r}static upload(t,e){return he(this,null,function*(){const i={};for(const r of e.getDefinedFiles()){const n=decodeURI(pd.resolve(e.url,r)),a=t.find(l=>l.webkitRelativePath===n);a&&(i[r]=URL.createObjectURL(a))}rh.filesMap[e._objectURL]=i})}static createSettings(t){return he(this,null,function*(){const e=t.find(l=>l.name.endsWith("model.json")||l.name.endsWith("model3.json"));if(!e)throw new TypeError("Settings file not found");const i=yield rh.readText(e),r=JSON.parse(i);r.url=e.webkitRelativePath;const n=bi.findRuntime(r);if(!n)throw new Error("Unknown settings JSON");const a=n.createModelSettings(r);return a._objectURL=URL.createObjectURL(e),a})}static readText(t){return he(this,null,function*(){return new Promise((e,i)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=i,r.readAsText(t,"utf8")})})}};Q(Di,"live2dFactory");Q(Di,"filesMap",{});Q(Di,"factory",(s,t)=>he(Di,null,function*(){if(Array.isArray(s.source)&&s.source[0]instanceof File){const e=s.source;let i=e.settings;if(!i)i=yield Di.createSettings(e);else if(!i._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings');i.validateFiles(e.map(r=>encodeURI(r.webkitRelativePath))),yield Di.upload(e,i),i.resolveURL=function(r){return Di.resolveURL(this._objectURL,r)},s.source=i,s.live2dModel.once("modelLoaded",r=>{r.once("destroy",function(){const n=this.settings._objectURL;if(URL.revokeObjectURL(n),Di.filesMap[n])for(const a of Object.values(Di.filesMap[n]))URL.revokeObjectURL(a);delete Di.filesMap[n]})})}return t()}));let kv=Di;const Hi=class Ie{static registerRuntime(t){Ie.runtimes.push(t),Ie.runtimes.sort((e,i)=>i.version-e.version)}static findRuntime(t){for(const e of Ie.runtimes)if(e.test(t))return e}static setupLive2DModel(t,e,i){return he(this,null,function*(){const r=new Promise(l=>t.once("textureLoaded",l)),n=new Promise(l=>t.once("modelLoaded",l)),a=Promise.all([r,n]).then(()=>t.emit("ready"));yield Iv(Ie.live2DModelMiddlewares,{live2dModel:t,source:e,options:i||{}}),yield a,t.emit("load")})}static loadMotion(t,e,i){var r,n;const a=l=>t.emit("motionLoadError",e,i,l);try{const l=(r=t.definitions[e])==null?void 0:r[i];if(!l)return Promise.resolve(void 0);t.listeners("destroy").includes(Ie.releaseTasks)||t.once("destroy",Ie.releaseTasks);let c=Ie.motionTasksMap.get(t);c||(c={},Ie.motionTasksMap.set(t,c));let f=c[e];f||(f=[],c[e]=f);const g=t.getMotionFile(l);return(n=f[i])!=null||(f[i]=is.load({url:g,settings:t.settings,type:t.motionDataType,target:t}).then(u=>{var d;const m=(d=Ie.motionTasksMap.get(t))==null?void 0:d[e];m&&delete m[i];const _=t.createMotion(u,e,l);return t.emit("motionLoaded",e,i,_),_}).catch(u=>{Qt.warn(t.tag,`Failed to load motion: ${g}
`,u),a(u)})),f[i]}catch(l){Qt.warn(t.tag,`Failed to load motion at "${e}"[${i}]
`,l),a(l)}return Promise.resolve(void 0)}static loadExpression(t,e){var i;const r=n=>t.emit("expressionLoadError",e,n);try{const n=t.definitions[e];if(!n)return Promise.resolve(void 0);t.listeners("destroy").includes(Ie.releaseTasks)||t.once("destroy",Ie.releaseTasks);let a=Ie.expressionTasksMap.get(t);a||(a=[],Ie.expressionTasksMap.set(t,a));const l=t.getExpressionFile(n);return(i=a[e])!=null||(a[e]=is.load({url:l,settings:t.settings,type:"json",target:t}).then(c=>{const f=Ie.expressionTasksMap.get(t);f&&delete f[e];const g=t.createExpression(c,n);return t.emit("expressionLoaded",e,g),g}).catch(c=>{Qt.warn(t.tag,`Failed to load expression: ${l}
`,c),r(c)})),a[e]}catch(n){Qt.warn(t.tag,`Failed to load expression at [${e}]
`,n),r(n)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof Ld?Ie.motionTasksMap.delete(this):Ie.expressionTasksMap.delete(this)}};Q(Hi,"runtimes",[]);Q(Hi,"urlToJSON",Pv);Q(Hi,"jsonToSettings",Rv);Q(Hi,"waitUntilReady",Fv);Q(Hi,"setupOptionals",Dv);Q(Hi,"setupEssentials",Lv);Q(Hi,"createInternalModel",Bv);Q(Hi,"live2DModelMiddlewares",[Ov.factory,kv.factory,Pv,Rv,Fv,Dv,Lv,Bv]);Q(Hi,"motionTasksMap",new WeakMap);Q(Hi,"expressionTasksMap",new WeakMap);let bi=Hi;Ld.prototype._loadMotion=function(s,t){return bi.loadMotion(this,s,t)};Cv.prototype._loadExpression=function(s){return bi.loadExpression(this,s)};kv.live2dFactory=bi;Ov.live2dFactory=bi;const Nv=class hd{constructor(t,{autoUpdate:e=!0,autoHitTest:i=!0,autoFocus:r=!0,autoInteract:n,ticker:a}={}){Q(this,"model"),Q(this,"destroyed",!1),Q(this,"_ticker"),Q(this,"_autoUpdate",!1),Q(this,"_autoHitTest",!1),Q(this,"_autoFocus",!1),a||(hd.defaultTicker?a=hd.defaultTicker:typeof PIXI<"u"&&(a=PIXI.Ticker.shared)),n!==void 0&&(i=n,r=n,Qt.warn(t.tag,"options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.")),this.model=t,this.ticker=a,this.autoUpdate=e,this.autoHitTest=i,this.autoFocus=r,(i||r)&&(this.model.eventMode="static")}get ticker(){return this._ticker}set ticker(t){var e;this._ticker&&this._ticker.remove(za,this),this._ticker=t,this._autoUpdate&&((e=this._ticker)==null||e.add(za,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){var e;this.destroyed||(t?this._ticker?(this._ticker.add(za,this),this._autoUpdate=!0):Qt.warn(this.model.tag,"No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI)."):((e=this._ticker)==null||e.remove(za,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(t){t!==this.autoHitTest&&(t?this.model.on("pointertap",O_,this):this.model.off("pointertap",O_,this),this._autoHitTest=t)}get autoFocus(){return this._autoFocus}set autoFocus(t){t!==this.autoFocus&&(t?this.model.on("globalpointermove",k_,this):this.model.off("globalpointermove",k_,this),this._autoFocus=t)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(t){this.autoHitTest=t,this.autoFocus=t}onTickerUpdate(){const t=this.ticker.deltaMS;this.model.update(t)}onTap(t){this.model.tap(t.global.x,t.global.y)}onPointerMove(t){this.model.focus(t.global.x,t.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};Q(Nv,"defaultTicker");let B_=Nv;function za(){this.onTickerUpdate()}function O_(s){this.onTap(s)}function k_(s){this.onPointerMove(s)}class WR extends Ih{}const mi=new zt,XR=new te;class $R extends Ee{constructor(t){super(),Q(this,"tag","Live2DModel(uninitialized)"),Q(this,"internalModel"),Q(this,"textures",[]),Q(this,"transform",new WR),Q(this,"anchor",new rr(this.onAnchorChange,this,0,0)),Q(this,"glContextID",-1),Q(this,"elapsedTime",0),Q(this,"deltaTime",0),Q(this,"automator"),this.automator=new B_(this,t),this.once("modelLoaded",()=>this.init(t))}static from(t,e){const i=new this(e);return bi.setupLive2DModel(i,t,e).then(()=>i)}static fromSync(t,e){const i=new this(e);return bi.setupLive2DModel(i,t,e).then(e?.onLoad).catch(e?.onError),i}static registerTicker(t){B_.defaultTicker=t.shared}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,i,{sound:r=void 0,volume:n=In,expression:a=void 0,resetExpression:l=!0,crossOrigin:c,onFinish:f,onError:g}={}){return e===void 0?this.internalModel.motionManager.startRandomMotion(t,i,{sound:r,volume:n,expression:a,resetExpression:l,crossOrigin:c,onFinish:f,onError:g}):this.internalModel.motionManager.startMotion(t,e,i,{sound:r,volume:n,expression:a,resetExpression:l,crossOrigin:c,onFinish:f,onError:g})}stopMotions(){return this.internalModel.motionManager.stopAllMotions()}speak(t,{volume:e=In,expression:i,resetExpression:r=!0,crossOrigin:n,onFinish:a,onError:l}={}){return this.internalModel.motionManager.speak(t,{volume:e,expression:i,resetExpression:r,crossOrigin:n,onFinish:a,onError:l})}stopSpeaking(){return this.internalModel.motionManager.stopSpeaking()}expression(t){return this.internalModel.motionManager.expressionManager?t===void 0?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,i=!1){mi.x=t,mi.y=e,this.toModelPosition(mi,mi,!0);const r=mi.x/this.internalModel.originalWidth*2-1,n=mi.y/this.internalModel.originalHeight*2-1,a=Math.atan2(n,r);this.internalModel.focusController.focus(Math.cos(a),-Math.sin(a),i)}tap(t,e){const i=this.hitTest(t,e);i.length&&(Qt.log(this.tag,"Hit",i),this.emit("hit",i))}hitTest(t,e){return mi.x=t,mi.y=e,this.toModelPosition(mi,mi),this.internalModel.hitTest(mi.x,mi.y)}toModelPosition(t,e=t.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let n=0;n<this.textures.length;n++){const a=this.textures[n];a.valid&&((e||!a.baseTexture._glTextures[this.glContextID])&&(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(a.baseTexture,0)),this.internalModel.bindTexture(n,a.baseTexture._glTextures[this.glContextID].texture),a.baseTexture.touched=t.textureGC.count)}const i=t.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const r=XR.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(r),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit("destroy"),t?.texture&&this.textures.forEach(e=>e.destroy(t.baseTexture)),this.automator.destroy(),this.internalModel.destroy(),super.destroy(t)}}if(!window.Live2DCubismCore)throw new Error("Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.");class zR extends Cv{constructor(t,e){var i;super(t,e),Q(this,"queueManager",new Sv),Q(this,"definitions"),this.definitions=(i=t.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.Name===t)}getExpressionFile(t){return t.File}createExpression(t,e){return Id.create(t)}_setExpression(t){return this.queueManager.startMotion(t,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}}class qR extends Ld{constructor(t,e){var i;super(t,e),Q(this,"definitions"),Q(this,"groups",{idle:"Idle"}),Q(this,"motionDataType","json"),Q(this,"queueManager",new Sv),Q(this,"expressionManager"),Q(this,"eyeBlinkIds"),Q(this,"lipSyncIds",["ParamMouthOpenY"]),this.definitions=(i=t.motions)!=null?i:{},this.eyeBlinkIds=t.getEyeBlinkParameters()||[];const r=t.getLipSyncParameters();r?.length&&(this.lipSyncIds=r),this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new zR(this.settings,t)),this.queueManager.setEventCallback((e,i,r)=>{this.emit("motion:"+i)})}isFinished(){return this.queueManager.isFinished()}_startMotion(t,e){return t.setFinishedMotionHandler(e),this.queueManager.stopAllMotions(),this.queueManager.startMotion(t,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(t,e,i){const r=Pd.create(t),n=new wv(t),a=(e===this.groups.idle?wh.idleMotionFadingDuration:wh.motionFadingDuration)/1e3;return n.getMotionFadeInTime()===void 0&&r.setFadeInTime(i.FadeInTime>0?i.FadeInTime:a),n.getMotionFadeOutTime()===void 0&&r.setFadeOutTime(i.FadeOutTime>0?i.FadeOutTime:a),r.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),r}getMotionFile(t){return t.File}getMotionName(t){return t.File}getSoundFile(t){return t.Sound}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}const N_=new xi;class YR extends NR{constructor(t,e,i){super(),Q(this,"settings"),Q(this,"coreModel"),Q(this,"motionManager"),Q(this,"lipSync",!0),Q(this,"breath",Ad.create()),Q(this,"eyeBlink"),Q(this,"userData"),Q(this,"renderer",new Av),Q(this,"idParamAngleX",bR),Q(this,"idParamAngleY",wR),Q(this,"idParamAngleZ",TR),Q(this,"idParamEyeBallX",SR),Q(this,"idParamEyeBallY",AR),Q(this,"idParamBodyAngleX",CR),Q(this,"idParamBreath",MR),Q(this,"idParamMouthForm",ER),Q(this,"pixelsPerUnit",1),Q(this,"centeringTransform",new te),this.coreModel=t,this.settings=e,this.motionManager=new qR(e,i),this.init()}init(){var t;super.init(),(t=this.settings.getEyeBlinkParameters())!=null&&t.length&&(this.eyeBlink=xP.create(this.settings)),this.breath.setParameters([new uo(this.idParamAngleX,0,15,6.5345,.5),new uo(this.idParamAngleY,0,8,3.5345,.5),new uo(this.idParamAngleZ,0,10,5.5345,.5),new uo(this.idParamBodyAngleX,0,4,15.5345,.5),new uo(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const t={};if(this.settings.layout)for(const[e,i]of Object.entries(this.settings.layout)){const r=e.charAt(0).toLowerCase()+e.slice(1);t[r]=i}return t}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(t,e){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(t),this.renderer._clippingManager._currentFrameNo=e,this.renderer._clippingManager._maskTexture=void 0,Cn.getInstance()._shaderSets=[]}bindTexture(t,e){this.renderer.bindTexture(t,e)}getHitAreaDefs(){var t,e;return(e=(t=this.settings.hitAreas)==null?void 0:t.map(i=>({id:i.Id,name:i.Name,index:this.coreModel.getDrawableIndex(i.Id)})))!=null?e:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(t){return this.coreModel.getDrawableIndex(t)}getDrawableVertices(t){if(typeof t=="string"&&(t=this.coreModel.getDrawableIndex(t),t===-1))throw new TypeError("Unable to find drawable ID: "+t);const e=this.coreModel.getDrawableVertices(t).slice();for(let i=0;i<e.length;i+=2)e[i]=e[i]*this.pixelsPerUnit+this.originalWidth/2,e[i+1]=-e[i+1]*this.pixelsPerUnit+this.originalHeight/2;return e}updateTransform(t){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(t)}update(t,e){var i,r,n,a;super.update(t,e),t/=1e3,e/=1e3;const l=this.coreModel;this.emit("beforeMotionUpdate");const c=this.motionManager.update(this.coreModel,e);if(this.emit("afterMotionUpdate"),l.saveParameters(),(i=this.motionManager.expressionManager)==null||i.update(l,e),c||(r=this.eyeBlink)==null||r.updateParameters(l,t),this.updateFocus(),this.updateNaturalMovements(t*1e3,e*1e3),this.lipSync&&this.motionManager.currentAudio){let f=this.motionManager.mouthSync(),g=0;const u=1,d=1.2;f>0&&(g=.4),f=ad(f*d,g,u);for(let m=0;m<this.motionManager.lipSyncIds.length;++m)l.addParameterValueById(this.motionManager.lipSyncIds[m],f,.8)}(n=this.physics)==null||n.evaluate(l,t),(a=this.pose)==null||a.updateParameters(l,t),this.emit("beforeModelUpdate"),l.update(),l.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,this.focusController.x*30),this.coreModel.addParameterValueById(this.idParamAngleY,this.focusController.y*30),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,this.focusController.x*10)}updateFacialEmotion(t){this.coreModel.addParameterValueById(this.idParamMouthForm,t)}updateNaturalMovements(t,e){var i;(i=this.breath)==null||i.updateParameters(this.coreModel,t/1e3)}draw(t){const e=this.drawingMatrix,i=N_.getArray();i[0]=e.a,i[1]=e.b,i[4]=-e.c,i[5]=-e.d,i[12]=e.tx,i[13]=e.ty,this.renderer.setMvpMatrix(N_),this.renderer.setRenderState(t.getParameter(t.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}class Pn extends Dd{constructor(t){if(super(t),Q(this,"moc"),Q(this,"textures"),!Pn.isValidJSON(t))throw new TypeError("Invalid JSON.");Object.assign(this,new Ev(t))}static isValidJSON(t){var e;return!!t?.FileReferences&&typeof t.FileReferences.Moc=="string"&&((e=t.FileReferences.Textures)==null?void 0:e.length)>0&&t.FileReferences.Textures.every(i=>typeof i=="string")}replaceFiles(t){if(super.replaceFiles(t),this.motions)for(const[e,i]of Object.entries(this.motions))for(let r=0;r<i.length;r++)i[r].File=t(i[r].File,`motions.${e}[${r}].File`),i[r].Sound!==void 0&&(i[r].Sound=t(i[r].Sound,`motions.${e}[${r}].Sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].File=t(this.expressions[e].File,`expressions[${e}].File`)}}IR(Pn,[Ev]);let qa,U_=20;function jR(){return So.isStarted()?Promise.resolve():(qa??(qa=new Promise((s,t)=>{function e(){try{KR(),s()}catch(i){if(U_--,U_<0){const r=new Error("Failed to start up Cubism 4 framework.");r.cause=i,t(r);return}setTimeout(e,10)}}e()})),qa)}function KR(s){s=Object.assign({logFunction:console.log,loggingLevel:Bn.LogLevel_Verbose},s),So.startUp(s),So.initialize()}bi.registerRuntime({version:4,ready:jR,test(s){return s instanceof Pn||Pn.isValidJSON(s)},isValidMoc(s){if(s.byteLength<4)return!1;const t=new Int8Array(s,0,4);return String.fromCharCode(...t)==="MOC3"},createModelSettings(s){return new Pn(s)},createCoreModel(s,t){const e=Md.create(s,!!t?.checkMocConsistency);try{const i=e.createModel();return i.__moc=e,i}catch(i){try{e.release()}catch{}throw i}},createInternalModel(s,t,e){const i=new YR(s,t,e),r=s;return r.__moc&&(i.__moc=r.__moc,delete r.__moc,i.once("destroy",ZR)),i},createPhysics(s,t){return Rd.create(t)},createPose(s,t){return Ed.create(t)}});function ZR(){var s;(s=this.__moc)==null||s.release()}wh.motionFadingDuration=0;wh.idleMotionFadingDuration=0;class JR{sprite;motionTime=0;motionManager;isWalking=!1;constructor(){}async load(t,e){this.sprite=await $R.from("./assets/live2d/lira/lira.model3.json",{ticker:He.shared,motionPreload:Mv.ALL,idleMotionGroup:"Idle"}),this.motionManager=this.sprite.internalModel.motionManager;const i=t.view;this.sprite.x=i.width-420,this.sprite.y=0,this.sprite.width=584,this.sprite.height=809,e.addChild(this.sprite)}walkStart(){this.isWalking||(this.motionManager.groups.idle="Walk",this.motionManager.stopAllMotions(),this.motionManager.startRandomMotion("Walk",Mn.IDLE),this.isWalking=!0)}walkEnd(){this.isWalking&&(this.motionManager.groups.idle="Idle",this.isWalking=!1)}async playMotion(t){await this.sprite.motion(t,0,Mn.FORCE),t==="Damage"&&(this.motionTime=60)}async expression(t){await this.sprite.expression(t)}update(){this.motionTime>0&&(this.motionTime--,this.motionTime===0&&this.expression("normal"))}}class ns{container;x;y;width;height;lineHeight;background;constructor(t,e,i,r,n=20){this.x=t,this.y=e,this.width=i,this.height=r,this.lineHeight=n,this.container=new Ee,this.container.x=t,this.container.y=e}update(t){}drawWindow(){const t=new Ui;t.beginFill(0,.5),t.lineStyle(2,15790320,1),t.drawRect(0,0,this.width,this.height),t.endFill(),this.background=t,this.container.addChild(this.background)}drawGradientWindow(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d");if(!e)return;const i=e.createLinearGradient(0,0,this.width,0);i.addColorStop(0,"rgba(0, 0, 0, 1.0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.0)"),e.fillStyle=i,e.fillRect(0,0,this.width,this.height);const r=ct.from(t),n=new Ui;n.beginTextureFill({texture:r}),n.drawRect(0,0,this.width,this.height),n.endFill(),this.background=n,this.container.addChild(this.background)}drawText(t,e,i,r=16,n="#ffffff",a=1280,l="left"){const c=new Pr({fontFamily:"GameFont",fontSize:r,fill:n,stroke:"#000000",strokeThickness:4,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:2,dropShadowDistance:0,wordWrap:!0,wordWrapWidth:a,breakWords:!0,align:l}),f=new bd(t,c);return f.x=e,f.y=i,f}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}}class QR extends ns{lines=[];textObjects=[];scrollOffset=0;paddingX=8;paddingY=8;lineSpacing=4;scrollBarWidth=5;scrollBarTrack;scrollBarThumb;textContainer;textMask;innerHeight;contentWidth;constructor(t,e,i,r,n){super(t,e,i,r,n),this.drawWindow(),this.innerHeight=this.height-this.paddingY*2,this.contentWidth=this.width-this.paddingX*2-(this.scrollBarWidth+4),this.textContainer=new Ee,this.container.addChild(this.textContainer);const a=new Ui;a.beginFill(16777215),a.drawRect(this.paddingX,this.paddingY,this.contentWidth,this.innerHeight),a.endFill(),this.textMask=a,this.container.addChild(this.textMask),this.textContainer.mask=this.textMask}addLine(t,e="normal"){let i="#ffffff";e==="action"&&(i="#ffff00"),e==="damage"&&(i="#ff0000"),e==="heal"&&(i="#008000"),e==="hero"&&(i="#ff69b4"),this.lines.push({text:t,color:i}),this.scrollToBottom()}clear(){this.lines=[],this.scrollOffset=0,this.redrawText(!0)}scroll(t){this.scrollOffset+=t*24,this.scrollOffset<0&&(this.scrollOffset=0),this.redrawText(!1)}handleWheel(t){if(t===0)return;const e=t>0?1:-1;this.scroll(e)}scrollToTop(){this.scrollOffset=0,this.redrawText(!1)}scrollToBottom(){this.redrawText(!0)}redrawText(t){for(const n of this.textObjects)this.textContainer.removeChild(n),n.destroy();this.textObjects=[];let e=0;for(const n of this.lines){const a=this.drawText(n.text,0,0,16,n.color,this.contentWidth);e+=a.height+this.lineSpacing,a.destroy()}e<0&&(e=0);const i=Math.max(0,e-this.innerHeight);t?this.scrollOffset=i:this.scrollOffset>i&&(this.scrollOffset=i),this.textContainer.y=this.paddingY-this.scrollOffset;let r=0;for(const n of this.lines){const a=this.drawText(n.text,this.paddingX,r,16,n.color,this.contentWidth);this.textObjects.push(a),this.textContainer.addChild(a),r+=a.height+this.lineSpacing}this.drawScrollBar(this.innerHeight,e,i)}drawScrollBar(t,e,i){if(this.scrollBarTrack&&(this.container.removeChild(this.scrollBarTrack),this.scrollBarTrack.destroy(),this.scrollBarTrack=void 0),this.scrollBarThumb&&(this.container.removeChild(this.scrollBarThumb),this.scrollBarThumb.destroy(),this.scrollBarThumb=void 0),e<=t)return;const r=this.width-this.scrollBarWidth-2,n=this.paddingY,a=t,l=new Ui;l.beginFill(0,.4),l.drawRect(r,n,this.scrollBarWidth,a),l.endFill();const f=Math.max(16,a*t/e),g=i>0?this.scrollOffset/i:0,u=n+(a-f)*g,d=new Ui;d.beginFill(16777215,.8),d.drawRect(r+1,u,this.scrollBarWidth-2,f),d.endFill(),this.scrollBarTrack=l,this.scrollBarThumb=d,this.container.addChild(l),this.container.addChild(d)}}class tF extends ns{linesText;openness;opening;closing;baseY;heroSprite;constructor(t,e,i,r,n,a){super(t,e,i,r,n),this.openness=0,this.opening=!1,this.closing=!1,this.baseY=e,this.heroSprite=a;const l=8,c=16;this.drawWindow(),this.linesText=this.drawText("",l,l,c,"#ffffff",this.width-l*2),this.container.scale.y=0,this.container.addChild(this.linesText)}drawMessage(t){t=t.replace("",""),t=t.replace("","");const e=/^\\E\[(.+?)\]/,i=t.match(e);if(i){const r=i[1],n=t.replace(e,"");this.linesText.text=n,this.heroSprite.expression(r),(r==="surprise"||r==="smile")&&this.heroSprite.playMotion("Jump")}else this.linesText.text=t;this.adjustSize(),this.open()}adjustSize(){const e=this.linesText.width+16,i=this.linesText.height+16;this.background.width=e,this.background.height=i,this.y=Math.min(720-i-8,this.baseY)}update(){this.updateOpen(),this.updateClose()}updateOpen(){this.opening&&(this.openness+=32,this.updateOpenness(),this.isOpen()&&(this.opening=!1))}updateClose(){this.closing&&(this.openness-=32,this.updateOpenness(),this.isClosed()&&(this.closing=!1))}updateOpenness(){this.openness=Math.min(this.openness,255),this.openness=Math.max(this.openness,0),this.container.scale.y=this.openness/255,this.container.y=this.y+this.height/2*(1-this.openness/255)}open(){this.isOpen()||(this.opening=!0),this.closing=!1}close(){this.isClosed()||(this.closing=!0),this.opening=!1}isOpen(){return this.openness>=255}isClosed(){return this.openness<=0}}class eF extends ns{turn;labelText;valueText;constructor(t,e,i,r,n){super(t,e,i,r),this.turn=n,this.drawGradientWindow(),this.draw()}update(t){this.redraw()}redraw(){const t=this.turn.turn;this.valueText.text=`${t}`}draw(){const i=this.turn.turn;this.labelText=this.drawText("",16,4,32,"#00bfff"),this.valueText=this.drawText(`${i}`,128,4,32),this.container.addChild(this.labelText),this.container.addChild(this.valueText)}}class iF extends ns{inventory;totalText;valueText;constructor(t,e,i,r,n){super(t,e,i,r),this.inventory=n,this.drawGradientWindow(),this.draw()}update(t){this.redraw()}redraw(){const t=this.inventory.totalValue();this.valueText.text=`${t}`}draw(){const i=this.inventory.totalValue();this.totalText=this.drawText("",8,4,16,"#00bfff"),this.valueText=this.drawText(`${i}`,72,4,16),this.container.addChild(this.totalText),this.container.addChild(this.valueText)}}class rF extends ns{item;iconSprite;baseTexture;equipment;constructor(t,e,i,r,n,a){super(t,e,i,r),this.drawWindow(),this.item=a,this.baseTexture=n.baseTexture,this.iconSprite=new hr,this.equipment=this.drawText("E",this.width-16,this.height-24,16,"#00bfff"),this.container.addChild(this.iconSprite),this.container.addChild(this.equipment),this.drawIcon()}setItem(t){this.item=t}drawIcon(){if(this.item){const t=this.item.iconId,e=48,i=t%10*e,r=Math.floor(t/10)*e;this.iconSprite.texture=new ct(this.baseTexture,new Dt(i,r,e,e)),this.iconSprite.visible=!0,this.equipment.visible=this.item.category==="equipment"}else this.iconSprite.visible=!1,this.equipment.visible=!1}redraw(){if(this.item){const t=this.item.iconId,e=48,i=t%10*e,r=Math.floor(t/10)*e;this.iconSprite.texture=new ct(this.baseTexture,new Dt(i,r,e,e)),this.iconSprite.visible=!0,this.equipment.visible=this.item.category==="equipment"}else this.iconSprite.visible=!1,this.equipment.visible=!1}}class G_ extends ns{iconWindows;items;descriptionWindow;constructor(t,e,i,r,n,a,l){super(t,e,i,r),this.iconWindows=[],this.items=a,this.createIconWindows(n,a,l),this.createDescription()}setItems(){for(let t=0;t<this.iconWindows.length;t++)this.iconWindows[t].setItem(this.items[t]),this.iconWindows[t].redraw()}createIconWindows(t,e,i){for(let n=0;n<i;n++){const a=e[n];this.iconWindows[n]=new rF(64*(n%3),64*Math.floor(n/3),48,48,t,a),this.container.addChild(this.iconWindows[n].container)}}createDescription(){this.descriptionWindow=new sF(0,0,240,64),this.container.addChild(this.descriptionWindow.container)}onMouse(t,e){const i=t-this.x,r=e-this.y;for(let n=0;n<this.iconWindows.length;n++)if(this.iconWindows[n].contains(i,r)){this.displayDescription(!0,i,r,n);break}else this.displayDescription(!1,i,r,n)}displayDescription(t,e=0,i=0,r=0){const n=this.iconWindows[r].item;t&&n&&(this.descriptionWindow.redraw(n),this.descriptionWindow.container.x=e,this.descriptionWindow.container.y=i),this.descriptionWindow.container.visible=t&&!!n}}class sF extends ns{texts;constructor(t,e,i,r){super(t,e,i,r),this.texts=[],this.drawWindow(),this.drawDescription(),this.container.visible=!1}drawDescription(){this.texts[0]=this.drawText("",6,6),this.texts[1]=this.drawText("",this.width-96-6,6,16,"#00bfff"),this.texts[2]=this.drawText("",this.width-32-6,6,16,"#ffffff"),this.texts[3]=this.drawText("",12,30,14,"#ffffff");for(const r of this.texts)this.container.addChild(r)}redraw(t){if(!t)return;const e=t.name,i=t.description;if(this.texts[0].text=e,this.texts[3].text=i,"mpCost"in t){const r=t.mpCost;this.texts[1].text="MP",this.texts[2].text=`${r}`}else{const r=t.value,n=this.width-(48+String(r).length*16);this.texts[1].text="",this.texts[1].x=n,this.texts[2].text=`${r}`}}}class vc extends ns{ChangeSpeed;gaugeFill;gaugeFrame;labelText;valueText;gradientTexture;rowHeight;rowMarginY;constructor(t,e,i,r){super(t,e,i,r),this.ChangeSpeed=30,this.rowMarginY=8,this.rowHeight=(r-this.rowMarginY)/2}setup(t,e,i){const r=new Ui;r.beginFill(0,.7),r.lineStyle(1,15790320,1),r.drawRect(0,0,this.width,this.rowHeight),r.endFill(),this.gaugeFrame=r,this.container.addChild(this.gaugeFrame);const n=document.createElement("canvas");n.width=this.width,n.height=this.rowHeight;const a=n.getContext("2d");if(!a)return;const l=a.createLinearGradient(0,0,n.width,0);l.addColorStop(0,e),l.addColorStop(1,i),a.fillStyle=l,a.fillRect(0,0,n.width,n.height),this.gradientTexture=ct.from(n),this.gaugeFill=new Ui,this.container.addChild(this.gaugeFill),this.labelText=this.drawText(`${t}`,-36,-6,18,"#00bfff"),this.container.addChild(this.labelText),this.valueText=this.drawText("",8,-6,18),this.container.addChild(this.valueText)}drawGauge(t,e){const i=Math.max(0,Math.min(1,t/e)),r=1,n=this.width-r*2,a=this.rowHeight-r*2;this.gradientTexture&&(this.gaugeFill.clear(),this.gaugeFill.beginTextureFill({texture:this.gradientTexture}),this.gaugeFill.drawRect(r,r,n*i,a),this.gaugeFill.endFill(),this.valueText&&(this.valueText.text=`${t} / ${e}`))}updateGauge(t,e,i){const r=e;let n=i;if(n===r)return n;const a=r>n?1:-1,l=this.ChangeSpeed*t*a;return a>0&&n+l>r||a<0&&n+l<r?n=r:n=n+l,n}}class nF extends vc{status;displayHp;displayMp;hpGauge;mpGauge;constructor(t,e,i,r,n){super(t,e,i,r),this.status=n,this.displayHp=n.hp,this.displayMp=n.mp;const a=24;this.hpGauge=new vc(t,e,i,r),this.mpGauge=new vc(t,e+a,i,r),this.setHpGauge(),this.setMpGauge(),this.container.addChild(this.hpGauge.container),this.container.addChild(this.mpGauge.container)}setHpGauge(){this.hpGauge.setup("HP","#ff9900","#ffcc66")}setMpGauge(){this.mpGauge.setup("MP","#0088ff","#66ccff")}drawHpGauge(){const t=Math.round(this.displayHp);this.hpGauge.drawGauge(t,this.status.hpMax)}drawMpGauge(){const t=Math.round(this.displayMp);this.mpGauge.drawGauge(t,this.status.mpMax)}update(t){const e=t/60;this.displayHp=this.hpGauge.updateGauge(e,this.status.hp,this.displayHp),this.displayMp=this.mpGauge.updateGauge(e,this.status.mp,this.displayMp),this.drawHpGauge(),this.drawMpGauge()}}class Bd{container;sprite;constructor(t,e,i,r,n){this.container=new Ee,this.container.x=t,this.container.y=e,this.sprite=new hr(n),this.sprite.width=i,this.sprite.height=r,this.container.addChild(this.sprite)}get x(){return this.container.x}set x(t){this.container.x=t}get y(){return this.container.y}set y(t){this.container.y=t}get width(){return this.sprite.width}set width(t){this.sprite.width=t}get height(){return this.sprite.height}set height(t){this.sprite.height=t}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}}class oF extends Bd{constructor(t,e,i,r,n){super(t,e,i,r,n)}}class H_ extends Bd{textureOn;textureOff;pushback=0;constructor(t,e,i,r,n,a){const c=n.baseTexture,f=new ct(c,new Dt(a*64,0,i,r)),g=new ct(c,new Dt(a*64,r,i,r));super(t,e,i,r,f),this.textureOff=f,this.textureOn=g}setswitching(t){this.sprite.texture=t?this.textureOn:this.textureOff,t&&(this.pushback=10)}update(){this.pushback>0&&(this.pushback--,this.pushback===0&&this.setswitching(!1))}}class aF extends Bd{baseY;floatTime;floatAmplitude;position;tx;ty;dx;dy;constructor(t,e,i,r){const n=t.x*32+32+20-5,a=t.y*32+96-12+20;super(n,a,e,i,r),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.position=t,this.floatTime=0,this.floatAmplitude=4,this.tx=n,this.ty=a,this.dx=this.tx,this.dy=this.ty,this.baseY=this.ty}update(t){const e=t/60;this.updateFloat(e),this.updateMove(e),this.updateShake(),this.updateTransparent()}updateTransparent(){this.position.transparentFlag?this.sprite.alpha=.5:this.sprite.alpha=1}updateFloat(t){this.floatTime+=t;const i=Math.sin(this.floatTime*2*Math.PI*.5)*this.floatAmplitude;this.y=this.baseY+i}updateShake(){const t=this.position.shake;if(t>0){const e=1-t/30,i=1-e,n=Math.sin(e*Math.PI*10)*4*i,a=this.position.x*32+32;this.x=a+n,this.position.shake--,this.position.shake<=0&&(this.x=a)}}updateMove(t){const e=this.position.x,i=this.position.y,r=this.position.dir,n=64*t;switch(this.tx=e*32+32+20-5,this.ty=i*32+96-12+20,r){case 2:this.sprite.angle=0;break;case 4:this.sprite.angle=90;break;case 6:this.sprite.angle=-90;break;case 8:this.sprite.angle=180;break}if(this.position.tereportFlag){this.x=this.tx,this.baseY=this.ty,this.position.tereportFlag=!1;return}this.x<this.tx?this.x=Math.min(this.x+n,this.tx):this.x>this.tx&&(this.x=Math.max(this.x-n,this.tx)),this.baseY<this.ty?this.baseY=Math.min(this.baseY+n,this.ty):this.baseY>this.ty&&(this.baseY=Math.max(this.baseY-n,this.ty)),this.x===this.tx&&this.baseY===this.ty&&this.position.move()}}class hF{container;dungeon;tileSize;hero;heroPos;tracksFOV;monsters;tresures;effect;goalSprite;tilesGraphics;baseTexture;constructor(t,e,i,r,n,a,l){this.dungeon=t,this.tileSize=e,this.hero=r,this.heroPos=this.hero.position,this.tracksFOV=this.heroPos.tracksFOV,this.monsters=n,this.tresures=a,this.effect=l,this.tilesGraphics=new Ui,this.container=new Ee,this.container.addChild(this.tilesGraphics),this.baseTexture=i.baseTexture,this.setup()}update(t){const e=t/60;this.updateFOV(),this.updateEffect(e),this.updateMonsters(e),this.redraw()}updateFOV(){this.tracksFOV=this.heroPos.tracksFOV}updateEffect(t){this.updateMove(t,this.effect,320),this.updateFadeOut(t,this.effect)}updateMonsters(t){const e=this.monsters.monsters;for(const i of e)i.active&&i.alive&&this.updateMove(t,i.position,128),!i.alive&&i.collapse>0&&this.updateCollapse(t,i)}updateMove(t,e,i){const r=e.x,n=e.y,a=i*t,l=e.sprite,c=this.tileSize;e.tx=r*32+32+c/2,e.ty=n*32+96+c/2,l.x<e.tx?l.x=Math.min(l.x+a,e.tx):l.x>e.tx&&(l.x=Math.max(l.x-a,e.tx)),l.y<e.ty?l.y=Math.min(l.y+a,e.ty):l.y>e.ty&&(l.y=Math.max(l.y-a,e.ty)),l.x===e.tx&&l.y===e.ty&&e.move()}updateCollapse(t,e){const i=e.collapse/15,r=Math.min(Math.max(i,0),1),n=r,a=1+(1-r),l=r;e.position.sprite.y-=1,e.position.sprite.scale.set(n,a),e.position.sprite.alpha=l,e.collapse--}updateFadeOut(t,e){if(e.shake>0){const i=e.shake/30,r=Math.min(Math.max(i,0),1),n=1+(1-r),a=1+(1-r);e.sprite.scale.set(n,a),e.sprite.alpha=r,e.shake--}}setup(){const t=this.monsters.monsters,e=this.tresures.tresures;for(const a of t){const l=a.position.x,c=a.position.y,f=a.rank===""?2:1;a.position.sprite=this.iconSprite(f,l,c),this.container.addChild(a.position.sprite)}for(const a of e){const l=a.position.x,c=a.position.y;a.sprite=this.iconSprite(3,l,c),this.container.addChild(a.sprite)}const i=this.dungeon.goal.x,r=this.dungeon.goal.y;this.goalSprite=this.iconSprite(5,i,r),this.container.addChild(this.goalSprite);const n=this.hero.effect;n.sprite=this.iconSprite(6,n.position.x,n.position.y),n.sprite.visible=!1,this.container.addChild(n.sprite)}iconSprite(t,e,i){const r=this.tileSize,n=e*r+32+r/2,a=i*r+96+r/2,l=t*r,c=0,f=new ct(this.baseTexture,new Dt(l,c,r,r)),g=new hr(f);return g.anchor.set(.5,.5),g.x=n,g.y=a,g.visible=!1,g}redraw(){const t=this.dungeon;this.tilesGraphics.clear(),this.resetInFOV();for(let e=0;e<t.height;e++){const i=t.tiles[e];for(let r=0;r<t.width;r++){const n=i[r];this.drawFOV(r,e,n)}}}drawFOV(t,e,i){const a=this.tileSize,l=this.dungeon.goal,c=t*a+32,f=e*a+96;this.isInTracksFOV(t,e)?(this.drawCell(i,c,f,this.tileSize),t===l.x&&e===l.y&&(this.goalSprite.visible=!0),this.visibleMonsters(t,e),this.visibleTresures(t,e),this.visibleEffect(t,e)):(this.tilesGraphics.beginFill(3158064),this.tilesGraphics.drawRect(c,f,a,a),this.tilesGraphics.endFill())}drawCell(t,e,i,r){t==="#"?(this.tilesGraphics.beginFill(1052688),this.tilesGraphics.drawRect(e,i,r,r),this.tilesGraphics.endFill()):(this.tilesGraphics.beginFill(3355562),this.tilesGraphics.drawRect(e,i,r,r),this.tilesGraphics.endFill())}resetInFOV(){const t=this.monsters.monsters;for(const i of t)i.position.inFOV=!1;const e=this.hero.effect;e.inFOV=!1}visibleMonsters(t,e){const i=this.monsters.monsters;for(const r of i)t===r.position.x&&e===r.position.y?(r.position.inFOV=!0,r.position.sprite.visible=!0,!r.alive&&!r.collapse&&(r.position.sprite.visible=!1)):r.position.inFOV||(r.position.sprite.visible=!1)}visibleTresures(t,e){const i=this.tresures.tresures;for(const r of i)if(t===r.position.x&&e===r.position.y)if(r.alive)r.sprite.visible=!0;else{const n=this.tileSize,a=new ct(this.baseTexture,new Dt(4*n,0,n,n));r.sprite.texture=a}}visibleEffect(t,e){const i=this.hero.effect;t===i.position.x&&e===i.position.y?(i.inFOV=!0,i.active||i.shake>0?i.sprite.visible=!0:i.sprite.visible=!1):i.inFOV||(i.sprite.visible=!1)}isInTracksFOV(t,e){return this.tracksFOV[e][t]}}class lF extends Ee{dots=[];_isCalling=!1;radius;speed;constructor(t,e,i=24,r=6,n=.12){super(),this.x=t,this.y=e,this.radius=i,this.speed=n;const a=8,l=[3355443,5592405,7829367,10066329,12303291,13421772,14540253,15658734];for(let c=0;c<a;c++){const f=new Ui;f.beginFill(l[c],1),f.drawCircle(0,0,r),f.endFill(),this.dots.push(f),this.addChild(f)}this.layoutDots(),this.visible=!1}layoutDots(){const t=this.dots.length;for(let e=0;e<t;e++){const i=-Math.PI/2+Math.PI*2*e/t,r=this.dots[e];r.x=Math.cos(i)*this.radius,r.y=Math.sin(i)*this.radius}}set isCalling(t){this._isCalling=t,this.visible=t}get isCalling(){return this._isCalling}update(t){this._isCalling&&(this.rotation+=this.speed*t)}}class uF{root;width;height;particles=[];running=!1;options;emitEnabled=!1;emitAccumulator=0;constructor(t,e,i,r){this.root=t,this.width=e,this.height=i,this.options={particleCount:250,emissionRate:80,maxParticles:350,colors:[16761095,5025616,240116,15277667,16771899],minSize:4,maxSize:10,minSpeed:20,maxSpeed:60,gravity:100,lifetime:6,...r}}launchBurst(){this.running=!0,this.emitEnabled=!1;for(let t=0;t<this.options.particleCount;t++)this.createParticle()}startContinuous(){this.emitEnabled||(this.running=!0,this.emitEnabled=!0,this.emitAccumulator=0)}stopContinuous(){this.emitEnabled=!1}get isRunning(){return this.running}clear(){for(const t of this.particles)this.root.removeChild(t.sprite),t.sprite.destroy();this.particles.length=0,this.running=!1}update(t){if(!this.running)return;const e=t/60;this.emitEnabled&&this.emitContinuously(e);const i=this.options.gravity,r=220;for(let n=this.particles.length-1;n>=0;n--){const a=this.particles[n];a.age+=e,a.vy+=i*e,a.vy>r&&(a.vy=r),a.sprite.y+=a.vy*e;const l=Math.sin(2*Math.PI*a.swayFrequency*a.age+a.swayPhase)*a.swayAmplitude;a.sprite.x=a.baseX+l,a.sprite.rotation+=a.rotationSpeed*e;const c=a.sprite.y>this.height+50,f=a.age>=a.lifetime;(c||f)&&(this.root.removeChild(a.sprite),a.sprite.destroy(),this.particles.splice(n,1))}!this.emitEnabled&&this.particles.length===0&&(this.running=!1)}emitContinuously(t){const e=this.options.emissionRate;this.emitAccumulator+=e*t;let i=Math.floor(this.emitAccumulator);if(!(i<=0)){this.emitAccumulator-=i;for(let r=0;r<i&&!(this.particles.length>=this.options.maxParticles);r++)this.createParticle()}}createParticle(){const t=this.rand(this.options.minSize,this.options.maxSize),e=this.randomColor(),i=new hr(ct.WHITE);i.tint=e,i.width=t,i.height=t,i.anchor.set(.5);const r=this.width*Math.random();i.x=r,i.y=-this.height*.2*Math.random(),i.rotation=Math.random()*Math.PI*2,this.root.addChild(i);const a=this.rand(this.options.minSpeed,this.options.maxSpeed),l=this.rand(20,60),c=this.rand(.2,.5),f=Math.random()*Math.PI*2,g=(Math.random()-.5)*1.5;this.particles.push({sprite:i,vx:0,vy:a,rotationSpeed:g,age:0,lifetime:this.options.lifetime,baseX:r,swayAmplitude:l,swayFrequency:c,swayPhase:f})}rand(t,e){return t+Math.random()*(e-t)}randomColor(){const t=this.options.colors,e=Math.random()*t.length|0;return t[e]}}const Od="https://sofia-uncertified-threatfully.ngrok-free.dev";async function cF(s,t){const e=await fetch(`${Od}/api/heroine-decide`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({turnPrompt:s,history:t})});if(!e.ok)throw new Error(`API error: ${e.status}`);return await e.json()}async function dF(s,t){const e=await fetch(`${Od}/api/heroine-speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({turnPrompt:s,history:t})});if(!e.ok)throw new Error(`API error: ${e.status}`);return(await e.json()).line}async function fF(s,t){const e=await fetch(`${Od}/api/summarize-history`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({summary:s,history:t})});if(!e.ok)throw new Error(`API error: ${e.status}`);const i=await e.json();return console.log(i.summary),i.summary}class pF{wait=0;commands=[];startTurn=!1;hero;heroPosition;monsters;tresures;inventory;constructor(t,e,i,r,n){this.hero=t,this.heroPosition=e,this.monsters=i,this.tresures=r,this.inventory=n}update(){this.startTurn&&this.waitCommand()&&this.runNextCommand()}turnStart(){this.startTurn=!0,this.hero.rest=!1,this.actionMonsters(),this.sortCommands()}addCommand(t){this.commands.push(t)}addCommandMany(t){this.commands.push(...t)}addInterrupt(t,e){const i=this.commands[0];i&&i.actor!==t?this.commands.unshift(e):i||this.commands.unshift(e)}sortCommands(){this.commands.sort((t,e)=>e.initiative-t.initiative)}actionMonsters(){const t=this.monsters.actionMonsters();for(const e of t){const i=e.actor;i.rest=!1,i.taken=!1,"moveType"in i&&i.moveType==="chase"&&this.distanceHtoM(i.pos)>1&&(this.distanceHtoM(i.pos)>4?i.active=!1:this.addCommand({actor:i,category:"move",initiative:e.initiative,type:"routeSearch",target:"hero",dir:"auto"})),this.addCommand(e)}}distanceHtoM(t){const e=this.heroPosition.position;return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}waitCommand(){return this.isBusy()?!1:this.wait>0?(this.wait--,!1):!0}isBusy(){if(this.heroPosition.isBusy()||this.hero.effect.isBusy())return!0;for(const t of this.monsters.monsters)if(t.active&&t.alive&&t.position.isBusy())return!0;return!1}runNextCommand(){const t=this.commands.shift();if(t&&t.actor.alive&&!t.actor.rest){if(this.wait=5,t.category==="move"&&"type"in t){const e=t.actor.position,i=this.dirToNumber(t.dir);if(t.type==="step"&&e.addCommand(()=>e.step(i)),t.type==="turn"&&e.addCommand(()=>e.turnDir(i)),t.type==="auto"&&(t.dir!=="auto"?(e.addCommand(()=>e.step(i)),this.goTarget(e,t.target,i)):this.goTarget(e,t.target),e.addCommand(()=>e.autoCorridor(!0))),t.type==="forced"&&(t.dir!=="auto"?(e.addCommand(()=>e.step(i)),this.goTarget(e,t.target,i)):this.goTarget(e,t.target),e.addCommand(()=>e.autoCorridor(!1))),t.type==="routeSearch")if(t.target==="hero"){const r=this.heroPosition.position;e.addCommand(()=>e.routeSearch(r))}else this.goTarget(e,t.target)}t.category==="skill"&&"index"in t&&(t.actor.useSkill(t.index),this.wait=30),t.category==="useItem"&&"index"in t&&(this.inventory.useItem(t.index),this.wait=30),t.category==="rest"&&(t.actor.rest=!0),t.category==="discardItem"&&"index"in t&&this.inventory.discardItem(t.index),t.category==="openTresure"&&this.heroPosition.openTresure()}}goTarget(t,e,i){e==="frontier"&&(i?t.addCommand(()=>t.goFrontier(i)):t.addCommand(()=>t.goFrontier())),e==="lastFork"&&t.addCommand(()=>t.backLastFork())}dirToNumber(t){switch(t){case"down":return 2;case"left":return 4;case"right":return 6;case"up":return 8;case"auto":return this.heroPosition.dir}}isTurnEnd(){return this.startTurn&&this.commands.length<=0&&this.wait<=0&&!this.isBusy()}}class mF{messageWindow;callingSpinner;messageLog=[];constructor(){}setup(t,e){this.messageWindow=t,this.callingSpinner=e}async decide(t,e,i){const r=this.buildTurnPrompt(t,e,"action");this.callingSpinner.isCalling=!0,this.messageWindow.close(),console.log(r);const{commands:n,toolCalls:a}=await cF(r,i);return console.log(n),this.callingSpinner.isCalling=!1,{commands:n,toolCalls:a}}async report(t,e,i,r,n){const a=n?"":"",l=this.buildTurnPrompt(t,a,"speak",e,i);this.callingSpinner.isCalling=!0,console.log(l);const c=await dF(l,r);return this.callingSpinner.isCalling=!1,this.messageWindow.drawMessage(c),c}buildTurnPrompt(t,e,i="speak",r,n){const{turn:a,hero:l,heroPosition:c,inventory:f,lastOrder:g}=t,u=f.summary(),d=u.length>0?u.map(C=>`- ${C.index} ${C.name}: ${C.description}`).join(`
`):"- ",m=l.position.position,_=l.position.dir,x=l.position.tileDescription(m),v=c.FOVDescription(m),b=v.length>0?v.map(C=>`(${C.x}, ${C.y})= ${C.description}`).join(`
`):"";let S=!1;for(const C of v)if(C.description.includes("")){S=!0;break}const T=[];if(T.push(`turn:${a}`),T.push(`state: HP ${l.hp} / ${l.hpMax}, MP ${l.mp} / ${l.mpMax}`),T.push("items:"),T.push(d),T.push(`Pos:(${m.x}, ${m.y}), Dir:${_}, ${x}`),T.push("FOVinfo:"),T.push(b),S&&T.push("Adjacent treasure:Yes"),i==="action"&&T.push(`Order:${e}`),r&&n){const C=r.join(`
`),I=n.join(`
`);T.push(`:
${C}`),T.push(`:
${I}`)}return T.push(""),i==="speak"?(T.push(`:${g} ${e}`),T.push("-  23"),T.push("- ")):i==="action"&&(T.push("- "),T.push("- "),T.push("- "),T.push("- order")),T.join(`
`)}messageTest(t){t==="a"?this.messageWindow.drawMessage(`  


`):t==="b"?this.messageWindow.drawMessage(`  
`):t==="c"&&this.messageWindow.close()}}class gF{turn=1;maxTurn=40;executor;ai;actionLog=[];lastOrder="";lastPlan=[];lastState="";allHistory=[];toChatSummary={row:[],summary:""};gameOverFlag=!1;waitAiFlag=!1;hero;inventory;tresures;textWindow;confetti;constructor(t,e,i){this.hero=t,this.inventory=e,this.tresures=i;const r=t.position,n=t.position.monsters;this.executor=new pF(t,r,n,i,e),this.ai=new mF}setup(t,e,i,r){this.ai.setup(t,e),this.textWindow=i,this.confetti=r}getContext(){return{turn:this.turn,hero:this.hero,heroPosition:this.hero.position,monsters:this.hero.position.monsters,inventory:this.inventory,tresures:this.tresures,lastOrder:this.lastOrder}}update(){this.executor.update(),this.executor.isTurnEnd()&&(this.executor.startTurn=!1,this.hero.rest&&this.hero.restMp(),this.statusReport())}async setPrompt(t){this.waitAiFlag=!0;const e=this.getContext(),i=this.summaryToChat(),r=this.hero.position.position;this.lastState=`HP:${this.hero.hp}/${this.hero.hpMax} MP:${this.hero.mp}/${this.hero.mpMax} pos:(x:${r.x},y:${r.y})`,console.log(i);const{commands:n}=await this.ai.decide(e,t,i);if(!n)return;const a=n.map(c=>this.mapBychatCommandToInternal(c));this.lastOrder=t;const l=a.map(c=>this.mapToLastPlan(c));this.lastPlan=this.compressLastPlan(l),this.executor.addCommandMany(a),this.executor.turnStart(),this.addStartHistory(t),this.waitAiFlag=!1}async statusReport(){console.log(this.actionLog),this.waitAiFlag=!0;const t=this.summaryToChat(),e=await this.ai.report(this.getContext(),this.lastPlan,this.actionLog,t,this.hero.position.isGameClear());this.addHeroineHistory(e),this.endTurn(),this.waitAiFlag=!1}summaryToChat(){const t=this.toChatSummary.row;if(this.toChatSummary.summary){const e=[{role:"user",content:this.toChatSummary.summary}];return e.push(...t),e}else return t}mapBychatCommandToInternal(t){const e=this.hero,i=this.hero.setInitiative();return t.category==="move"&&"type"in t?{actor:e,category:t.category,initiative:i,type:t.type,target:t.target,dir:t.dir}:"index"in t?{actor:e,category:t.category,initiative:i,index:t.index}:t.category==="rest"?{actor:e,category:t.category,initiative:10}:{actor:e,category:t.category,initiative:i}}mapToLastPlan(t){let e="";if(t.category==="move"&&"type"in t){let i="";switch(t.dir){case"down":i="";break;case"left":i="";break;case"right":i="";break;case"up":i="";break}let r="";switch(t.target){case"lastFork":r="";break;case"lastEnemy":r="";break;case"frontier":r="";break}t.type==="step"&&(e=`${i}1`),t.type==="auto"&&(e=""),t.type==="forced"&&(e=""),t.type==="turn"&&(e=`${i}`),t.type==="routeSearch"&&(e=`${r}`)}return t.category==="skill"&&"index"in t&&(e=`${this.hero.skills[t.index].name}`),t.category==="useItem"&&"index"in t&&(e=`${this.inventory.inventory[t.index].name}`),t.category==="discardItem"&&"index"in t&&(e=`${this.inventory.inventory[t.index].name}`),t.category==="openTresure"&&(e=""),t.category==="rest"&&(e=""),e}compressLastPlan(t){if(t.length===0)return[];const e=[];let i=t[0],r=1;for(let n=1;n<t.length;n++){const a=t[n];a===i?r++:(e.push(this.formatAction(i,r)),i=a,r=1)}return e.push(this.formatAction(i,r)),e}formatAction(t,e){if(e===1)return t;const i=t.match(/^(.+?)(\d+)$/);if(i){const n=i[1],l=Number(i[2])*e;return`${n}${l}`}const r=t.match(/^(.+?)$/);return r?`${r[1]}${e}`:`${t} ${e}`}addStartHistory(t){this.allHistory.push({role:"user",content:`# ${this.turn}
- ${t}`})}addHeroineHistory(t){t=t.replace("",""),t=t.replace("","");const e=/^\\E\[(.+?)\]/,i=t.replace(e,""),r=this.actionLog.join("  "),n=this.hero.position.position;this.allHistory.push({role:"user",content:`- ${r}`}),this.allHistory.push({role:"user",content:`- ${this.lastState}  HP:${this.hero.hp}/${this.hero.hpMax} MP:${this.hero.mp}/${this.hero.mpMax} pos:(x:${n.x},y:${n.y})`}),this.allHistory.push({role:"assistant",content:`- ${i}`})}addActionLog(t){const e=t.replace("","");this.actionLog.push(e)}async endTurn(){this.clearActionLog(),this.gameClear(),this.gameOver(),this.turn++,await this.maybeSummerize()}gameClear(){if(!this.hero.position.isGameClear())return;const t=[],e=this.inventory.result(),i=this.inventory.totalValue();t.push({role:"user",content:"# "}),t.push({role:"user",content:`- ${this.turn}`}),t.push({role:"user",content:`- HP ${this.hero.hp} / ${this.hero.hpMax} MP ${this.hero.mp} / ${this.hero.mpMax}`}),t.push({role:"user",content:"- "}),t.push({role:"user",content:e.join(`
`)}),t.push({role:"user",content:`- ${i}`}),this.allHistory.push(...t),this.gameOverFlag=!0,this.textWindow.addLine("","action"),this.textWindow.addLine("","action"),this.confetti.startContinuous(),ni.playBgm("gameClear")}gameOver(){this.hero.hp===0&&(this.textWindow.addLine("","damage"),this.textWindow.addLine(`${this.hero.name}`,"damage"),this.gameOverFlag=!0)}async maybeSummerize(){this.waitAiFlag=!0;const t=5,e=8,i=structuredClone(this.allHistory).splice(-4,4);this.toChatSummary.row.push(...i),!this.gameOverFlag&&this.turn!==0&&this.turn%t===0&&this.allHistory.length!==0&&(this.toChatSummary.summary=await fF(this.toChatSummary.summary,this.toChatSummary.row),this.toChatSummary.row.length>e&&(this.toChatSummary.row=this.toChatSummary.row.slice(-e)),this.waitAiFlag=!1)}clearActionLog(){this.actionLog=[]}resultHistory(){const t=this.allHistory.map(n=>`${n.content}`).join(`
`),e=new Blob([t],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.download="log.txt",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}addInterrupt(t,e){this.executor.addInterrupt(t,e)}messageTest(t){this.ai.messageTest(t)}isBusy(){return this.executor.isBusy()||this.gameOverFlag||this.waitAiFlag}}var bo={exports:{}};var _F=bo.exports,V_;function yF(){return V_||(V_=1,(function(s,t){(function(){var e,i="4.17.21",r=200,n="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",f=500,g="__lodash_placeholder__",u=1,d=2,m=4,_=1,x=2,v=1,b=2,S=4,T=8,C=16,I=32,k=64,E=128,B=256,X=512,tt=30,Z="...",H=800,K=16,j=1,_t=2,R=3,F=1/0,P=9007199254740991,V=17976931348623157e292,L=NaN,U=4294967295,z=U-1,$=U>>>1,rt=[["ary",E],["bind",v],["bindKey",b],["curry",T],["curryRight",C],["flip",X],["partial",I],["partialRight",k],["rearg",B]],nt="[object Arguments]",ut="[object Array]",pt="[object AsyncFunction]",gt="[object Boolean]",xt="[object Date]",ot="[object DOMException]",yt="[object Error]",bt="[object Function]",Lt="[object GeneratorFunction]",Ft="[object Map]",vt="[object Number]",At="[object Null]",jt="[object Object]",fe="[object Promise]",Rr="[object Proxy]",Ve="[object RegExp]",le="[object Set]",oi="[object String]",wi="[object Symbol]",Fr="[object Undefined]",os="[object WeakMap]",Bh="[object WeakSet]",Dr="[object ArrayBuffer]",Lr="[object DataView]",lr="[object Float32Array]",as="[object Float64Array]",Hs="[object Int8Array]",On="[object Int16Array]",kn="[object Int32Array]",hs="[object Uint8Array]",Br="[object Uint8ClampedArray]",W="[object Uint16Array]",q="[object Uint32Array]",qt=/\b__p \+= '';/g,ee=/\b(__p \+=) '' \+/g,ie=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Nt=/&(?:amp|lt|gt|quot|#39);/g,Ti=/[&<>"']/g,ur=RegExp(Nt.source),Be=RegExp(Ti.source),Vi=/<%-([\s\S]+?)%>/g,Nn=/<%([\s\S]+?)%>/g,cr=/<%=([\s\S]+?)%>/g,je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Mo=/^\w*$/,Io=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vs=/[\\^$.*+?()[\]{}|]/g,ls=RegExp(Vs.source),us=/^\s+/,Ws=/\s/,Un=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gn=/\{\n\/\* \[wrapped with (.+)\] \*/,Po=/,? & /,Ro=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Hn=/[()=,{}\[\]\/\s]/,Fo=/\\(\\)?/g,Vn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wn=/\w*$/,Oh=/^[-+]0x[0-9a-f]+$/i,Xn=/^0b[01]+$/i,Or=/^\[object .+?Constructor\]$/,Xs=/^0o[0-7]+$/i,kh=/^(?:0|[1-9]\d*)$/,Do=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Lo=/($^)/,Hv=/['\n\r\u2028\u2029\\]/g,Bo="\\ud800-\\udfff",Vv="\\u0300-\\u036f",Wv="\\ufe20-\\ufe2f",Xv="\\u20d0-\\u20ff",Nd=Vv+Wv+Xv,Ud="\\u2700-\\u27bf",Gd="a-z\\xdf-\\xf6\\xf8-\\xff",$v="\\xac\\xb1\\xd7\\xf7",zv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",qv="\\u2000-\\u206f",Yv=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Hd="A-Z\\xc0-\\xd6\\xd8-\\xde",Vd="\\ufe0e\\ufe0f",Wd=$v+zv+qv+Yv,Nh="[']",jv="["+Bo+"]",Xd="["+Wd+"]",Oo="["+Nd+"]",$d="\\d+",Kv="["+Ud+"]",zd="["+Gd+"]",qd="[^"+Bo+Wd+$d+Ud+Gd+Hd+"]",Uh="\\ud83c[\\udffb-\\udfff]",Zv="(?:"+Oo+"|"+Uh+")",Yd="[^"+Bo+"]",Gh="(?:\\ud83c[\\udde6-\\uddff]){2}",Hh="[\\ud800-\\udbff][\\udc00-\\udfff]",$s="["+Hd+"]",jd="\\u200d",Kd="(?:"+zd+"|"+qd+")",Jv="(?:"+$s+"|"+qd+")",Zd="(?:"+Nh+"(?:d|ll|m|re|s|t|ve))?",Jd="(?:"+Nh+"(?:D|LL|M|RE|S|T|VE))?",Qd=Zv+"?",tf="["+Vd+"]?",Qv="(?:"+jd+"(?:"+[Yd,Gh,Hh].join("|")+")"+tf+Qd+")*",t0="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",e0="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ef=tf+Qd+Qv,i0="(?:"+[Kv,Gh,Hh].join("|")+")"+ef,r0="(?:"+[Yd+Oo+"?",Oo,Gh,Hh,jv].join("|")+")",s0=RegExp(Nh,"g"),n0=RegExp(Oo,"g"),Vh=RegExp(Uh+"(?="+Uh+")|"+r0+ef,"g"),o0=RegExp([$s+"?"+zd+"+"+Zd+"(?="+[Xd,$s,"$"].join("|")+")",Jv+"+"+Jd+"(?="+[Xd,$s+Kd,"$"].join("|")+")",$s+"?"+Kd+"+"+Zd,$s+"+"+Jd,e0,t0,$d,i0].join("|"),"g"),a0=RegExp("["+jd+Bo+Nd+Vd+"]"),h0=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,l0=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],u0=-1,ne={};ne[lr]=ne[as]=ne[Hs]=ne[On]=ne[kn]=ne[hs]=ne[Br]=ne[W]=ne[q]=!0,ne[nt]=ne[ut]=ne[Dr]=ne[gt]=ne[Lr]=ne[xt]=ne[yt]=ne[bt]=ne[Ft]=ne[vt]=ne[jt]=ne[Ve]=ne[le]=ne[oi]=ne[os]=!1;var se={};se[nt]=se[ut]=se[Dr]=se[Lr]=se[gt]=se[xt]=se[lr]=se[as]=se[Hs]=se[On]=se[kn]=se[Ft]=se[vt]=se[jt]=se[Ve]=se[le]=se[oi]=se[wi]=se[hs]=se[Br]=se[W]=se[q]=!0,se[yt]=se[bt]=se[os]=!1;var c0={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},d0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},f0={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},p0={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},m0=parseFloat,g0=parseInt,rf=typeof si=="object"&&si&&si.Object===Object&&si,_0=typeof self=="object"&&self&&self.Object===Object&&self,Ce=rf||_0||Function("return this")(),Wh=t&&!t.nodeType&&t,cs=Wh&&!0&&s&&!s.nodeType&&s,sf=cs&&cs.exports===Wh,Xh=sf&&rf.process,ai=(function(){try{var N=cs&&cs.require&&cs.require("util").types;return N||Xh&&Xh.binding&&Xh.binding("util")}catch{}})(),nf=ai&&ai.isArrayBuffer,of=ai&&ai.isDate,af=ai&&ai.isMap,hf=ai&&ai.isRegExp,lf=ai&&ai.isSet,uf=ai&&ai.isTypedArray;function Ke(N,J,Y){switch(Y.length){case 0:return N.call(J);case 1:return N.call(J,Y[0]);case 2:return N.call(J,Y[0],Y[1]);case 3:return N.call(J,Y[0],Y[1],Y[2])}return N.apply(J,Y)}function y0(N,J,Y,mt){for(var Bt=-1,Kt=N==null?0:N.length;++Bt<Kt;){var ve=N[Bt];J(mt,ve,Y(ve),N)}return mt}function hi(N,J){for(var Y=-1,mt=N==null?0:N.length;++Y<mt&&J(N[Y],Y,N)!==!1;);return N}function v0(N,J){for(var Y=N==null?0:N.length;Y--&&J(N[Y],Y,N)!==!1;);return N}function cf(N,J){for(var Y=-1,mt=N==null?0:N.length;++Y<mt;)if(!J(N[Y],Y,N))return!1;return!0}function kr(N,J){for(var Y=-1,mt=N==null?0:N.length,Bt=0,Kt=[];++Y<mt;){var ve=N[Y];J(ve,Y,N)&&(Kt[Bt++]=ve)}return Kt}function ko(N,J){var Y=N==null?0:N.length;return!!Y&&zs(N,J,0)>-1}function $h(N,J,Y){for(var mt=-1,Bt=N==null?0:N.length;++mt<Bt;)if(Y(J,N[mt]))return!0;return!1}function ae(N,J){for(var Y=-1,mt=N==null?0:N.length,Bt=Array(mt);++Y<mt;)Bt[Y]=J(N[Y],Y,N);return Bt}function Nr(N,J){for(var Y=-1,mt=J.length,Bt=N.length;++Y<mt;)N[Bt+Y]=J[Y];return N}function zh(N,J,Y,mt){var Bt=-1,Kt=N==null?0:N.length;for(mt&&Kt&&(Y=N[++Bt]);++Bt<Kt;)Y=J(Y,N[Bt],Bt,N);return Y}function x0(N,J,Y,mt){var Bt=N==null?0:N.length;for(mt&&Bt&&(Y=N[--Bt]);Bt--;)Y=J(Y,N[Bt],Bt,N);return Y}function qh(N,J){for(var Y=-1,mt=N==null?0:N.length;++Y<mt;)if(J(N[Y],Y,N))return!0;return!1}var b0=Yh("length");function w0(N){return N.split("")}function T0(N){return N.match(Ro)||[]}function df(N,J,Y){var mt;return Y(N,function(Bt,Kt,ve){if(J(Bt,Kt,ve))return mt=Kt,!1}),mt}function No(N,J,Y,mt){for(var Bt=N.length,Kt=Y+(mt?1:-1);mt?Kt--:++Kt<Bt;)if(J(N[Kt],Kt,N))return Kt;return-1}function zs(N,J,Y){return J===J?B0(N,J,Y):No(N,ff,Y)}function S0(N,J,Y,mt){for(var Bt=Y-1,Kt=N.length;++Bt<Kt;)if(mt(N[Bt],J))return Bt;return-1}function ff(N){return N!==N}function pf(N,J){var Y=N==null?0:N.length;return Y?Kh(N,J)/Y:L}function Yh(N){return function(J){return J==null?e:J[N]}}function jh(N){return function(J){return N==null?e:N[J]}}function mf(N,J,Y,mt,Bt){return Bt(N,function(Kt,ve,re){Y=mt?(mt=!1,Kt):J(Y,Kt,ve,re)}),Y}function A0(N,J){var Y=N.length;for(N.sort(J);Y--;)N[Y]=N[Y].value;return N}function Kh(N,J){for(var Y,mt=-1,Bt=N.length;++mt<Bt;){var Kt=J(N[mt]);Kt!==e&&(Y=Y===e?Kt:Y+Kt)}return Y}function Zh(N,J){for(var Y=-1,mt=Array(N);++Y<N;)mt[Y]=J(Y);return mt}function E0(N,J){return ae(J,function(Y){return[Y,N[Y]]})}function gf(N){return N&&N.slice(0,xf(N)+1).replace(us,"")}function Ze(N){return function(J){return N(J)}}function Jh(N,J){return ae(J,function(Y){return N[Y]})}function $n(N,J){return N.has(J)}function _f(N,J){for(var Y=-1,mt=N.length;++Y<mt&&zs(J,N[Y],0)>-1;);return Y}function yf(N,J){for(var Y=N.length;Y--&&zs(J,N[Y],0)>-1;);return Y}function C0(N,J){for(var Y=N.length,mt=0;Y--;)N[Y]===J&&++mt;return mt}var M0=jh(c0),I0=jh(d0);function P0(N){return"\\"+p0[N]}function R0(N,J){return N==null?e:N[J]}function qs(N){return a0.test(N)}function F0(N){return h0.test(N)}function D0(N){for(var J,Y=[];!(J=N.next()).done;)Y.push(J.value);return Y}function Qh(N){var J=-1,Y=Array(N.size);return N.forEach(function(mt,Bt){Y[++J]=[Bt,mt]}),Y}function vf(N,J){return function(Y){return N(J(Y))}}function Ur(N,J){for(var Y=-1,mt=N.length,Bt=0,Kt=[];++Y<mt;){var ve=N[Y];(ve===J||ve===g)&&(N[Y]=g,Kt[Bt++]=Y)}return Kt}function Uo(N){var J=-1,Y=Array(N.size);return N.forEach(function(mt){Y[++J]=mt}),Y}function L0(N){var J=-1,Y=Array(N.size);return N.forEach(function(mt){Y[++J]=[mt,mt]}),Y}function B0(N,J,Y){for(var mt=Y-1,Bt=N.length;++mt<Bt;)if(N[mt]===J)return mt;return-1}function O0(N,J,Y){for(var mt=Y+1;mt--;)if(N[mt]===J)return mt;return mt}function Ys(N){return qs(N)?N0(N):b0(N)}function Si(N){return qs(N)?U0(N):w0(N)}function xf(N){for(var J=N.length;J--&&Ws.test(N.charAt(J)););return J}var k0=jh(f0);function N0(N){for(var J=Vh.lastIndex=0;Vh.test(N);)++J;return J}function U0(N){return N.match(Vh)||[]}function G0(N){return N.match(o0)||[]}var H0=(function N(J){J=J==null?Ce:js.defaults(Ce.Object(),J,js.pick(Ce,l0));var Y=J.Array,mt=J.Date,Bt=J.Error,Kt=J.Function,ve=J.Math,re=J.Object,tl=J.RegExp,V0=J.String,li=J.TypeError,Go=Y.prototype,W0=Kt.prototype,Ks=re.prototype,Ho=J["__core-js_shared__"],Vo=W0.toString,Jt=Ks.hasOwnProperty,X0=0,bf=(function(){var o=/[^.]+$/.exec(Ho&&Ho.keys&&Ho.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""})(),Wo=Ks.toString,$0=Vo.call(re),z0=Ce._,q0=tl("^"+Vo.call(Jt).replace(Vs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xo=sf?J.Buffer:e,Gr=J.Symbol,$o=J.Uint8Array,wf=Xo?Xo.allocUnsafe:e,zo=vf(re.getPrototypeOf,re),Tf=re.create,Sf=Ks.propertyIsEnumerable,qo=Go.splice,Af=Gr?Gr.isConcatSpreadable:e,zn=Gr?Gr.iterator:e,ds=Gr?Gr.toStringTag:e,Yo=(function(){try{var o=_s(re,"defineProperty");return o({},"",{}),o}catch{}})(),Y0=J.clearTimeout!==Ce.clearTimeout&&J.clearTimeout,j0=mt&&mt.now!==Ce.Date.now&&mt.now,K0=J.setTimeout!==Ce.setTimeout&&J.setTimeout,jo=ve.ceil,Ko=ve.floor,el=re.getOwnPropertySymbols,Z0=Xo?Xo.isBuffer:e,Ef=J.isFinite,J0=Go.join,Q0=vf(re.keys,re),xe=ve.max,Fe=ve.min,tx=mt.now,ex=J.parseInt,Cf=ve.random,ix=Go.reverse,il=_s(J,"DataView"),qn=_s(J,"Map"),rl=_s(J,"Promise"),Zs=_s(J,"Set"),Yn=_s(J,"WeakMap"),jn=_s(re,"create"),Zo=Yn&&new Yn,Js={},rx=ys(il),sx=ys(qn),nx=ys(rl),ox=ys(Zs),ax=ys(Yn),Jo=Gr?Gr.prototype:e,Kn=Jo?Jo.valueOf:e,Mf=Jo?Jo.toString:e;function A(o){if(pe(o)&&!kt(o)&&!(o instanceof Xt)){if(o instanceof ui)return o;if(Jt.call(o,"__wrapped__"))return Ip(o)}return new ui(o)}var Qs=(function(){function o(){}return function(h){if(!ue(h))return{};if(Tf)return Tf(h);o.prototype=h;var p=new o;return o.prototype=e,p}})();function Qo(){}function ui(o,h){this.__wrapped__=o,this.__actions__=[],this.__chain__=!!h,this.__index__=0,this.__values__=e}A.templateSettings={escape:Vi,evaluate:Nn,interpolate:cr,variable:"",imports:{_:A}},A.prototype=Qo.prototype,A.prototype.constructor=A,ui.prototype=Qs(Qo.prototype),ui.prototype.constructor=ui;function Xt(o){this.__wrapped__=o,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=U,this.__views__=[]}function hx(){var o=new Xt(this.__wrapped__);return o.__actions__=We(this.__actions__),o.__dir__=this.__dir__,o.__filtered__=this.__filtered__,o.__iteratees__=We(this.__iteratees__),o.__takeCount__=this.__takeCount__,o.__views__=We(this.__views__),o}function lx(){if(this.__filtered__){var o=new Xt(this);o.__dir__=-1,o.__filtered__=!0}else o=this.clone(),o.__dir__*=-1;return o}function ux(){var o=this.__wrapped__.value(),h=this.__dir__,p=kt(o),y=h<0,w=p?o.length:0,M=wb(0,w,this.__views__),D=M.start,O=M.end,G=O-D,et=y?O:D-1,it=this.__iteratees__,st=it.length,ht=0,Tt=Fe(G,this.__takeCount__);if(!p||!y&&w==G&&Tt==G)return Jf(o,this.__actions__);var It=[];t:for(;G--&&ht<Tt;){et+=h;for(var Gt=-1,Pt=o[et];++Gt<st;){var Wt=it[Gt],$t=Wt.iteratee,ti=Wt.type,Ne=$t(Pt);if(ti==_t)Pt=Ne;else if(!Ne){if(ti==j)continue t;break t}}It[ht++]=Pt}return It}Xt.prototype=Qs(Qo.prototype),Xt.prototype.constructor=Xt;function fs(o){var h=-1,p=o==null?0:o.length;for(this.clear();++h<p;){var y=o[h];this.set(y[0],y[1])}}function cx(){this.__data__=jn?jn(null):{},this.size=0}function dx(o){var h=this.has(o)&&delete this.__data__[o];return this.size-=h?1:0,h}function fx(o){var h=this.__data__;if(jn){var p=h[o];return p===c?e:p}return Jt.call(h,o)?h[o]:e}function px(o){var h=this.__data__;return jn?h[o]!==e:Jt.call(h,o)}function mx(o,h){var p=this.__data__;return this.size+=this.has(o)?0:1,p[o]=jn&&h===e?c:h,this}fs.prototype.clear=cx,fs.prototype.delete=dx,fs.prototype.get=fx,fs.prototype.has=px,fs.prototype.set=mx;function dr(o){var h=-1,p=o==null?0:o.length;for(this.clear();++h<p;){var y=o[h];this.set(y[0],y[1])}}function gx(){this.__data__=[],this.size=0}function _x(o){var h=this.__data__,p=ta(h,o);if(p<0)return!1;var y=h.length-1;return p==y?h.pop():qo.call(h,p,1),--this.size,!0}function yx(o){var h=this.__data__,p=ta(h,o);return p<0?e:h[p][1]}function vx(o){return ta(this.__data__,o)>-1}function xx(o,h){var p=this.__data__,y=ta(p,o);return y<0?(++this.size,p.push([o,h])):p[y][1]=h,this}dr.prototype.clear=gx,dr.prototype.delete=_x,dr.prototype.get=yx,dr.prototype.has=vx,dr.prototype.set=xx;function fr(o){var h=-1,p=o==null?0:o.length;for(this.clear();++h<p;){var y=o[h];this.set(y[0],y[1])}}function bx(){this.size=0,this.__data__={hash:new fs,map:new(qn||dr),string:new fs}}function wx(o){var h=da(this,o).delete(o);return this.size-=h?1:0,h}function Tx(o){return da(this,o).get(o)}function Sx(o){return da(this,o).has(o)}function Ax(o,h){var p=da(this,o),y=p.size;return p.set(o,h),this.size+=p.size==y?0:1,this}fr.prototype.clear=bx,fr.prototype.delete=wx,fr.prototype.get=Tx,fr.prototype.has=Sx,fr.prototype.set=Ax;function ps(o){var h=-1,p=o==null?0:o.length;for(this.__data__=new fr;++h<p;)this.add(o[h])}function Ex(o){return this.__data__.set(o,c),this}function Cx(o){return this.__data__.has(o)}ps.prototype.add=ps.prototype.push=Ex,ps.prototype.has=Cx;function Ai(o){var h=this.__data__=new dr(o);this.size=h.size}function Mx(){this.__data__=new dr,this.size=0}function Ix(o){var h=this.__data__,p=h.delete(o);return this.size=h.size,p}function Px(o){return this.__data__.get(o)}function Rx(o){return this.__data__.has(o)}function Fx(o,h){var p=this.__data__;if(p instanceof dr){var y=p.__data__;if(!qn||y.length<r-1)return y.push([o,h]),this.size=++p.size,this;p=this.__data__=new fr(y)}return p.set(o,h),this.size=p.size,this}Ai.prototype.clear=Mx,Ai.prototype.delete=Ix,Ai.prototype.get=Px,Ai.prototype.has=Rx,Ai.prototype.set=Fx;function If(o,h){var p=kt(o),y=!p&&vs(o),w=!p&&!y&&$r(o),M=!p&&!y&&!w&&sn(o),D=p||y||w||M,O=D?Zh(o.length,V0):[],G=O.length;for(var et in o)(h||Jt.call(o,et))&&!(D&&(et=="length"||w&&(et=="offset"||et=="parent")||M&&(et=="buffer"||et=="byteLength"||et=="byteOffset")||_r(et,G)))&&O.push(et);return O}function Pf(o){var h=o.length;return h?o[pl(0,h-1)]:e}function Dx(o,h){return fa(We(o),ms(h,0,o.length))}function Lx(o){return fa(We(o))}function sl(o,h,p){(p!==e&&!Ei(o[h],p)||p===e&&!(h in o))&&pr(o,h,p)}function Zn(o,h,p){var y=o[h];(!(Jt.call(o,h)&&Ei(y,p))||p===e&&!(h in o))&&pr(o,h,p)}function ta(o,h){for(var p=o.length;p--;)if(Ei(o[p][0],h))return p;return-1}function Bx(o,h,p,y){return Hr(o,function(w,M,D){h(y,w,p(w),D)}),y}function Rf(o,h){return o&&Xi(h,we(h),o)}function Ox(o,h){return o&&Xi(h,$e(h),o)}function pr(o,h,p){h=="__proto__"&&Yo?Yo(o,h,{configurable:!0,enumerable:!0,value:p,writable:!0}):o[h]=p}function nl(o,h){for(var p=-1,y=h.length,w=Y(y),M=o==null;++p<y;)w[p]=M?e:Ul(o,h[p]);return w}function ms(o,h,p){return o===o&&(p!==e&&(o=o<=p?o:p),h!==e&&(o=o>=h?o:h)),o}function ci(o,h,p,y,w,M){var D,O=h&u,G=h&d,et=h&m;if(p&&(D=w?p(o,y,w,M):p(o)),D!==e)return D;if(!ue(o))return o;var it=kt(o);if(it){if(D=Sb(o),!O)return We(o,D)}else{var st=De(o),ht=st==bt||st==Lt;if($r(o))return ep(o,O);if(st==jt||st==nt||ht&&!w){if(D=G||ht?{}:xp(o),!O)return G?fb(o,Ox(D,o)):db(o,Rf(D,o))}else{if(!se[st])return w?o:{};D=Ab(o,st,O)}}M||(M=new Ai);var Tt=M.get(o);if(Tt)return Tt;M.set(o,D),jp(o)?o.forEach(function(Pt){D.add(ci(Pt,h,p,Pt,o,M))}):qp(o)&&o.forEach(function(Pt,Wt){D.set(Wt,ci(Pt,h,p,Wt,o,M))});var It=et?G?Al:Sl:G?$e:we,Gt=it?e:It(o);return hi(Gt||o,function(Pt,Wt){Gt&&(Wt=Pt,Pt=o[Wt]),Zn(D,Wt,ci(Pt,h,p,Wt,o,M))}),D}function kx(o){var h=we(o);return function(p){return Ff(p,o,h)}}function Ff(o,h,p){var y=p.length;if(o==null)return!y;for(o=re(o);y--;){var w=p[y],M=h[w],D=o[w];if(D===e&&!(w in o)||!M(D))return!1}return!0}function Df(o,h,p){if(typeof o!="function")throw new li(a);return so(function(){o.apply(e,p)},h)}function Jn(o,h,p,y){var w=-1,M=ko,D=!0,O=o.length,G=[],et=h.length;if(!O)return G;p&&(h=ae(h,Ze(p))),y?(M=$h,D=!1):h.length>=r&&(M=$n,D=!1,h=new ps(h));t:for(;++w<O;){var it=o[w],st=p==null?it:p(it);if(it=y||it!==0?it:0,D&&st===st){for(var ht=et;ht--;)if(h[ht]===st)continue t;G.push(it)}else M(h,st,y)||G.push(it)}return G}var Hr=op(Wi),Lf=op(al,!0);function Nx(o,h){var p=!0;return Hr(o,function(y,w,M){return p=!!h(y,w,M),p}),p}function ea(o,h,p){for(var y=-1,w=o.length;++y<w;){var M=o[y],D=h(M);if(D!=null&&(O===e?D===D&&!Qe(D):p(D,O)))var O=D,G=M}return G}function Ux(o,h,p,y){var w=o.length;for(p=Ut(p),p<0&&(p=-p>w?0:w+p),y=y===e||y>w?w:Ut(y),y<0&&(y+=w),y=p>y?0:Zp(y);p<y;)o[p++]=h;return o}function Bf(o,h){var p=[];return Hr(o,function(y,w,M){h(y,w,M)&&p.push(y)}),p}function Me(o,h,p,y,w){var M=-1,D=o.length;for(p||(p=Cb),w||(w=[]);++M<D;){var O=o[M];h>0&&p(O)?h>1?Me(O,h-1,p,y,w):Nr(w,O):y||(w[w.length]=O)}return w}var ol=ap(),Of=ap(!0);function Wi(o,h){return o&&ol(o,h,we)}function al(o,h){return o&&Of(o,h,we)}function ia(o,h){return kr(h,function(p){return yr(o[p])})}function gs(o,h){h=Wr(h,o);for(var p=0,y=h.length;o!=null&&p<y;)o=o[$i(h[p++])];return p&&p==y?o:e}function kf(o,h,p){var y=h(o);return kt(o)?y:Nr(y,p(o))}function Oe(o){return o==null?o===e?Fr:At:ds&&ds in re(o)?bb(o):Lb(o)}function hl(o,h){return o>h}function Gx(o,h){return o!=null&&Jt.call(o,h)}function Hx(o,h){return o!=null&&h in re(o)}function Vx(o,h,p){return o>=Fe(h,p)&&o<xe(h,p)}function ll(o,h,p){for(var y=p?$h:ko,w=o[0].length,M=o.length,D=M,O=Y(M),G=1/0,et=[];D--;){var it=o[D];D&&h&&(it=ae(it,Ze(h))),G=Fe(it.length,G),O[D]=!p&&(h||w>=120&&it.length>=120)?new ps(D&&it):e}it=o[0];var st=-1,ht=O[0];t:for(;++st<w&&et.length<G;){var Tt=it[st],It=h?h(Tt):Tt;if(Tt=p||Tt!==0?Tt:0,!(ht?$n(ht,It):y(et,It,p))){for(D=M;--D;){var Gt=O[D];if(!(Gt?$n(Gt,It):y(o[D],It,p)))continue t}ht&&ht.push(It),et.push(Tt)}}return et}function Wx(o,h,p,y){return Wi(o,function(w,M,D){h(y,p(w),M,D)}),y}function Qn(o,h,p){h=Wr(h,o),o=Sp(o,h);var y=o==null?o:o[$i(fi(h))];return y==null?e:Ke(y,o,p)}function Nf(o){return pe(o)&&Oe(o)==nt}function Xx(o){return pe(o)&&Oe(o)==Dr}function $x(o){return pe(o)&&Oe(o)==xt}function to(o,h,p,y,w){return o===h?!0:o==null||h==null||!pe(o)&&!pe(h)?o!==o&&h!==h:zx(o,h,p,y,to,w)}function zx(o,h,p,y,w,M){var D=kt(o),O=kt(h),G=D?ut:De(o),et=O?ut:De(h);G=G==nt?jt:G,et=et==nt?jt:et;var it=G==jt,st=et==jt,ht=G==et;if(ht&&$r(o)){if(!$r(h))return!1;D=!0,it=!1}if(ht&&!it)return M||(M=new Ai),D||sn(o)?_p(o,h,p,y,w,M):vb(o,h,G,p,y,w,M);if(!(p&_)){var Tt=it&&Jt.call(o,"__wrapped__"),It=st&&Jt.call(h,"__wrapped__");if(Tt||It){var Gt=Tt?o.value():o,Pt=It?h.value():h;return M||(M=new Ai),w(Gt,Pt,p,y,M)}}return ht?(M||(M=new Ai),xb(o,h,p,y,w,M)):!1}function qx(o){return pe(o)&&De(o)==Ft}function ul(o,h,p,y){var w=p.length,M=w,D=!y;if(o==null)return!M;for(o=re(o);w--;){var O=p[w];if(D&&O[2]?O[1]!==o[O[0]]:!(O[0]in o))return!1}for(;++w<M;){O=p[w];var G=O[0],et=o[G],it=O[1];if(D&&O[2]){if(et===e&&!(G in o))return!1}else{var st=new Ai;if(y)var ht=y(et,it,G,o,h,st);if(!(ht===e?to(it,et,_|x,y,st):ht))return!1}}return!0}function Uf(o){if(!ue(o)||Ib(o))return!1;var h=yr(o)?q0:Or;return h.test(ys(o))}function Yx(o){return pe(o)&&Oe(o)==Ve}function jx(o){return pe(o)&&De(o)==le}function Kx(o){return pe(o)&&va(o.length)&&!!ne[Oe(o)]}function Gf(o){return typeof o=="function"?o:o==null?ze:typeof o=="object"?kt(o)?Wf(o[0],o[1]):Vf(o):hm(o)}function cl(o){if(!ro(o))return Q0(o);var h=[];for(var p in re(o))Jt.call(o,p)&&p!="constructor"&&h.push(p);return h}function Zx(o){if(!ue(o))return Db(o);var h=ro(o),p=[];for(var y in o)y=="constructor"&&(h||!Jt.call(o,y))||p.push(y);return p}function dl(o,h){return o<h}function Hf(o,h){var p=-1,y=Xe(o)?Y(o.length):[];return Hr(o,function(w,M,D){y[++p]=h(w,M,D)}),y}function Vf(o){var h=Cl(o);return h.length==1&&h[0][2]?wp(h[0][0],h[0][1]):function(p){return p===o||ul(p,o,h)}}function Wf(o,h){return Il(o)&&bp(h)?wp($i(o),h):function(p){var y=Ul(p,o);return y===e&&y===h?Gl(p,o):to(h,y,_|x)}}function ra(o,h,p,y,w){o!==h&&ol(h,function(M,D){if(w||(w=new Ai),ue(M))Jx(o,h,D,p,ra,y,w);else{var O=y?y(Rl(o,D),M,D+"",o,h,w):e;O===e&&(O=M),sl(o,D,O)}},$e)}function Jx(o,h,p,y,w,M,D){var O=Rl(o,p),G=Rl(h,p),et=D.get(G);if(et){sl(o,p,et);return}var it=M?M(O,G,p+"",o,h,D):e,st=it===e;if(st){var ht=kt(G),Tt=!ht&&$r(G),It=!ht&&!Tt&&sn(G);it=G,ht||Tt||It?kt(O)?it=O:me(O)?it=We(O):Tt?(st=!1,it=ep(G,!0)):It?(st=!1,it=ip(G,!0)):it=[]:no(G)||vs(G)?(it=O,vs(O)?it=Jp(O):(!ue(O)||yr(O))&&(it=xp(G))):st=!1}st&&(D.set(G,it),w(it,G,y,M,D),D.delete(G)),sl(o,p,it)}function Xf(o,h){var p=o.length;if(p)return h+=h<0?p:0,_r(h,p)?o[h]:e}function $f(o,h,p){h.length?h=ae(h,function(M){return kt(M)?function(D){return gs(D,M.length===1?M[0]:M)}:M}):h=[ze];var y=-1;h=ae(h,Ze(Mt()));var w=Hf(o,function(M,D,O){var G=ae(h,function(et){return et(M)});return{criteria:G,index:++y,value:M}});return A0(w,function(M,D){return cb(M,D,p)})}function Qx(o,h){return zf(o,h,function(p,y){return Gl(o,y)})}function zf(o,h,p){for(var y=-1,w=h.length,M={};++y<w;){var D=h[y],O=gs(o,D);p(O,D)&&eo(M,Wr(D,o),O)}return M}function tb(o){return function(h){return gs(h,o)}}function fl(o,h,p,y){var w=y?S0:zs,M=-1,D=h.length,O=o;for(o===h&&(h=We(h)),p&&(O=ae(o,Ze(p)));++M<D;)for(var G=0,et=h[M],it=p?p(et):et;(G=w(O,it,G,y))>-1;)O!==o&&qo.call(O,G,1),qo.call(o,G,1);return o}function qf(o,h){for(var p=o?h.length:0,y=p-1;p--;){var w=h[p];if(p==y||w!==M){var M=w;_r(w)?qo.call(o,w,1):_l(o,w)}}return o}function pl(o,h){return o+Ko(Cf()*(h-o+1))}function eb(o,h,p,y){for(var w=-1,M=xe(jo((h-o)/(p||1)),0),D=Y(M);M--;)D[y?M:++w]=o,o+=p;return D}function ml(o,h){var p="";if(!o||h<1||h>P)return p;do h%2&&(p+=o),h=Ko(h/2),h&&(o+=o);while(h);return p}function Vt(o,h){return Fl(Tp(o,h,ze),o+"")}function ib(o){return Pf(nn(o))}function rb(o,h){var p=nn(o);return fa(p,ms(h,0,p.length))}function eo(o,h,p,y){if(!ue(o))return o;h=Wr(h,o);for(var w=-1,M=h.length,D=M-1,O=o;O!=null&&++w<M;){var G=$i(h[w]),et=p;if(G==="__proto__"||G==="constructor"||G==="prototype")return o;if(w!=D){var it=O[G];et=y?y(it,G,O):e,et===e&&(et=ue(it)?it:_r(h[w+1])?[]:{})}Zn(O,G,et),O=O[G]}return o}var Yf=Zo?function(o,h){return Zo.set(o,h),o}:ze,sb=Yo?function(o,h){return Yo(o,"toString",{configurable:!0,enumerable:!1,value:Vl(h),writable:!0})}:ze;function nb(o){return fa(nn(o))}function di(o,h,p){var y=-1,w=o.length;h<0&&(h=-h>w?0:w+h),p=p>w?w:p,p<0&&(p+=w),w=h>p?0:p-h>>>0,h>>>=0;for(var M=Y(w);++y<w;)M[y]=o[y+h];return M}function ob(o,h){var p;return Hr(o,function(y,w,M){return p=h(y,w,M),!p}),!!p}function sa(o,h,p){var y=0,w=o==null?y:o.length;if(typeof h=="number"&&h===h&&w<=$){for(;y<w;){var M=y+w>>>1,D=o[M];D!==null&&!Qe(D)&&(p?D<=h:D<h)?y=M+1:w=M}return w}return gl(o,h,ze,p)}function gl(o,h,p,y){var w=0,M=o==null?0:o.length;if(M===0)return 0;h=p(h);for(var D=h!==h,O=h===null,G=Qe(h),et=h===e;w<M;){var it=Ko((w+M)/2),st=p(o[it]),ht=st!==e,Tt=st===null,It=st===st,Gt=Qe(st);if(D)var Pt=y||It;else et?Pt=It&&(y||ht):O?Pt=It&&ht&&(y||!Tt):G?Pt=It&&ht&&!Tt&&(y||!Gt):Tt||Gt?Pt=!1:Pt=y?st<=h:st<h;Pt?w=it+1:M=it}return Fe(M,z)}function jf(o,h){for(var p=-1,y=o.length,w=0,M=[];++p<y;){var D=o[p],O=h?h(D):D;if(!p||!Ei(O,G)){var G=O;M[w++]=D===0?0:D}}return M}function Kf(o){return typeof o=="number"?o:Qe(o)?L:+o}function Je(o){if(typeof o=="string")return o;if(kt(o))return ae(o,Je)+"";if(Qe(o))return Mf?Mf.call(o):"";var h=o+"";return h=="0"&&1/o==-F?"-0":h}function Vr(o,h,p){var y=-1,w=ko,M=o.length,D=!0,O=[],G=O;if(p)D=!1,w=$h;else if(M>=r){var et=h?null:_b(o);if(et)return Uo(et);D=!1,w=$n,G=new ps}else G=h?[]:O;t:for(;++y<M;){var it=o[y],st=h?h(it):it;if(it=p||it!==0?it:0,D&&st===st){for(var ht=G.length;ht--;)if(G[ht]===st)continue t;h&&G.push(st),O.push(it)}else w(G,st,p)||(G!==O&&G.push(st),O.push(it))}return O}function _l(o,h){return h=Wr(h,o),o=Sp(o,h),o==null||delete o[$i(fi(h))]}function Zf(o,h,p,y){return eo(o,h,p(gs(o,h)),y)}function na(o,h,p,y){for(var w=o.length,M=y?w:-1;(y?M--:++M<w)&&h(o[M],M,o););return p?di(o,y?0:M,y?M+1:w):di(o,y?M+1:0,y?w:M)}function Jf(o,h){var p=o;return p instanceof Xt&&(p=p.value()),zh(h,function(y,w){return w.func.apply(w.thisArg,Nr([y],w.args))},p)}function yl(o,h,p){var y=o.length;if(y<2)return y?Vr(o[0]):[];for(var w=-1,M=Y(y);++w<y;)for(var D=o[w],O=-1;++O<y;)O!=w&&(M[w]=Jn(M[w]||D,o[O],h,p));return Vr(Me(M,1),h,p)}function Qf(o,h,p){for(var y=-1,w=o.length,M=h.length,D={};++y<w;){var O=y<M?h[y]:e;p(D,o[y],O)}return D}function vl(o){return me(o)?o:[]}function xl(o){return typeof o=="function"?o:ze}function Wr(o,h){return kt(o)?o:Il(o,h)?[o]:Mp(Zt(o))}var ab=Vt;function Xr(o,h,p){var y=o.length;return p=p===e?y:p,!h&&p>=y?o:di(o,h,p)}var tp=Y0||function(o){return Ce.clearTimeout(o)};function ep(o,h){if(h)return o.slice();var p=o.length,y=wf?wf(p):new o.constructor(p);return o.copy(y),y}function bl(o){var h=new o.constructor(o.byteLength);return new $o(h).set(new $o(o)),h}function hb(o,h){var p=h?bl(o.buffer):o.buffer;return new o.constructor(p,o.byteOffset,o.byteLength)}function lb(o){var h=new o.constructor(o.source,Wn.exec(o));return h.lastIndex=o.lastIndex,h}function ub(o){return Kn?re(Kn.call(o)):{}}function ip(o,h){var p=h?bl(o.buffer):o.buffer;return new o.constructor(p,o.byteOffset,o.length)}function rp(o,h){if(o!==h){var p=o!==e,y=o===null,w=o===o,M=Qe(o),D=h!==e,O=h===null,G=h===h,et=Qe(h);if(!O&&!et&&!M&&o>h||M&&D&&G&&!O&&!et||y&&D&&G||!p&&G||!w)return 1;if(!y&&!M&&!et&&o<h||et&&p&&w&&!y&&!M||O&&p&&w||!D&&w||!G)return-1}return 0}function cb(o,h,p){for(var y=-1,w=o.criteria,M=h.criteria,D=w.length,O=p.length;++y<D;){var G=rp(w[y],M[y]);if(G){if(y>=O)return G;var et=p[y];return G*(et=="desc"?-1:1)}}return o.index-h.index}function sp(o,h,p,y){for(var w=-1,M=o.length,D=p.length,O=-1,G=h.length,et=xe(M-D,0),it=Y(G+et),st=!y;++O<G;)it[O]=h[O];for(;++w<D;)(st||w<M)&&(it[p[w]]=o[w]);for(;et--;)it[O++]=o[w++];return it}function np(o,h,p,y){for(var w=-1,M=o.length,D=-1,O=p.length,G=-1,et=h.length,it=xe(M-O,0),st=Y(it+et),ht=!y;++w<it;)st[w]=o[w];for(var Tt=w;++G<et;)st[Tt+G]=h[G];for(;++D<O;)(ht||w<M)&&(st[Tt+p[D]]=o[w++]);return st}function We(o,h){var p=-1,y=o.length;for(h||(h=Y(y));++p<y;)h[p]=o[p];return h}function Xi(o,h,p,y){var w=!p;p||(p={});for(var M=-1,D=h.length;++M<D;){var O=h[M],G=y?y(p[O],o[O],O,p,o):e;G===e&&(G=o[O]),w?pr(p,O,G):Zn(p,O,G)}return p}function db(o,h){return Xi(o,Ml(o),h)}function fb(o,h){return Xi(o,yp(o),h)}function oa(o,h){return function(p,y){var w=kt(p)?y0:Bx,M=h?h():{};return w(p,o,Mt(y,2),M)}}function tn(o){return Vt(function(h,p){var y=-1,w=p.length,M=w>1?p[w-1]:e,D=w>2?p[2]:e;for(M=o.length>3&&typeof M=="function"?(w--,M):e,D&&ke(p[0],p[1],D)&&(M=w<3?e:M,w=1),h=re(h);++y<w;){var O=p[y];O&&o(h,O,y,M)}return h})}function op(o,h){return function(p,y){if(p==null)return p;if(!Xe(p))return o(p,y);for(var w=p.length,M=h?w:-1,D=re(p);(h?M--:++M<w)&&y(D[M],M,D)!==!1;);return p}}function ap(o){return function(h,p,y){for(var w=-1,M=re(h),D=y(h),O=D.length;O--;){var G=D[o?O:++w];if(p(M[G],G,M)===!1)break}return h}}function pb(o,h,p){var y=h&v,w=io(o);function M(){var D=this&&this!==Ce&&this instanceof M?w:o;return D.apply(y?p:this,arguments)}return M}function hp(o){return function(h){h=Zt(h);var p=qs(h)?Si(h):e,y=p?p[0]:h.charAt(0),w=p?Xr(p,1).join(""):h.slice(1);return y[o]()+w}}function en(o){return function(h){return zh(om(nm(h).replace(s0,"")),o,"")}}function io(o){return function(){var h=arguments;switch(h.length){case 0:return new o;case 1:return new o(h[0]);case 2:return new o(h[0],h[1]);case 3:return new o(h[0],h[1],h[2]);case 4:return new o(h[0],h[1],h[2],h[3]);case 5:return new o(h[0],h[1],h[2],h[3],h[4]);case 6:return new o(h[0],h[1],h[2],h[3],h[4],h[5]);case 7:return new o(h[0],h[1],h[2],h[3],h[4],h[5],h[6])}var p=Qs(o.prototype),y=o.apply(p,h);return ue(y)?y:p}}function mb(o,h,p){var y=io(o);function w(){for(var M=arguments.length,D=Y(M),O=M,G=rn(w);O--;)D[O]=arguments[O];var et=M<3&&D[0]!==G&&D[M-1]!==G?[]:Ur(D,G);if(M-=et.length,M<p)return fp(o,h,aa,w.placeholder,e,D,et,e,e,p-M);var it=this&&this!==Ce&&this instanceof w?y:o;return Ke(it,this,D)}return w}function lp(o){return function(h,p,y){var w=re(h);if(!Xe(h)){var M=Mt(p,3);h=we(h),p=function(O){return M(w[O],O,w)}}var D=o(h,p,y);return D>-1?w[M?h[D]:D]:e}}function up(o){return gr(function(h){var p=h.length,y=p,w=ui.prototype.thru;for(o&&h.reverse();y--;){var M=h[y];if(typeof M!="function")throw new li(a);if(w&&!D&&ca(M)=="wrapper")var D=new ui([],!0)}for(y=D?y:p;++y<p;){M=h[y];var O=ca(M),G=O=="wrapper"?El(M):e;G&&Pl(G[0])&&G[1]==(E|T|I|B)&&!G[4].length&&G[9]==1?D=D[ca(G[0])].apply(D,G[3]):D=M.length==1&&Pl(M)?D[O]():D.thru(M)}return function(){var et=arguments,it=et[0];if(D&&et.length==1&&kt(it))return D.plant(it).value();for(var st=0,ht=p?h[st].apply(this,et):it;++st<p;)ht=h[st].call(this,ht);return ht}})}function aa(o,h,p,y,w,M,D,O,G,et){var it=h&E,st=h&v,ht=h&b,Tt=h&(T|C),It=h&X,Gt=ht?e:io(o);function Pt(){for(var Wt=arguments.length,$t=Y(Wt),ti=Wt;ti--;)$t[ti]=arguments[ti];if(Tt)var Ne=rn(Pt),ei=C0($t,Ne);if(y&&($t=sp($t,y,w,Tt)),M&&($t=np($t,M,D,Tt)),Wt-=ei,Tt&&Wt<et){var ge=Ur($t,Ne);return fp(o,h,aa,Pt.placeholder,p,$t,ge,O,G,et-Wt)}var Ci=st?p:this,xr=ht?Ci[o]:o;return Wt=$t.length,O?$t=Bb($t,O):It&&Wt>1&&$t.reverse(),it&&G<Wt&&($t.length=G),this&&this!==Ce&&this instanceof Pt&&(xr=Gt||io(xr)),xr.apply(Ci,$t)}return Pt}function cp(o,h){return function(p,y){return Wx(p,o,h(y),{})}}function ha(o,h){return function(p,y){var w;if(p===e&&y===e)return h;if(p!==e&&(w=p),y!==e){if(w===e)return y;typeof p=="string"||typeof y=="string"?(p=Je(p),y=Je(y)):(p=Kf(p),y=Kf(y)),w=o(p,y)}return w}}function wl(o){return gr(function(h){return h=ae(h,Ze(Mt())),Vt(function(p){var y=this;return o(h,function(w){return Ke(w,y,p)})})})}function la(o,h){h=h===e?" ":Je(h);var p=h.length;if(p<2)return p?ml(h,o):h;var y=ml(h,jo(o/Ys(h)));return qs(h)?Xr(Si(y),0,o).join(""):y.slice(0,o)}function gb(o,h,p,y){var w=h&v,M=io(o);function D(){for(var O=-1,G=arguments.length,et=-1,it=y.length,st=Y(it+G),ht=this&&this!==Ce&&this instanceof D?M:o;++et<it;)st[et]=y[et];for(;G--;)st[et++]=arguments[++O];return Ke(ht,w?p:this,st)}return D}function dp(o){return function(h,p,y){return y&&typeof y!="number"&&ke(h,p,y)&&(p=y=e),h=vr(h),p===e?(p=h,h=0):p=vr(p),y=y===e?h<p?1:-1:vr(y),eb(h,p,y,o)}}function ua(o){return function(h,p){return typeof h=="string"&&typeof p=="string"||(h=pi(h),p=pi(p)),o(h,p)}}function fp(o,h,p,y,w,M,D,O,G,et){var it=h&T,st=it?D:e,ht=it?e:D,Tt=it?M:e,It=it?e:M;h|=it?I:k,h&=~(it?k:I),h&S||(h&=-4);var Gt=[o,h,w,Tt,st,It,ht,O,G,et],Pt=p.apply(e,Gt);return Pl(o)&&Ap(Pt,Gt),Pt.placeholder=y,Ep(Pt,o,h)}function Tl(o){var h=ve[o];return function(p,y){if(p=pi(p),y=y==null?0:Fe(Ut(y),292),y&&Ef(p)){var w=(Zt(p)+"e").split("e"),M=h(w[0]+"e"+(+w[1]+y));return w=(Zt(M)+"e").split("e"),+(w[0]+"e"+(+w[1]-y))}return h(p)}}var _b=Zs&&1/Uo(new Zs([,-0]))[1]==F?function(o){return new Zs(o)}:$l;function pp(o){return function(h){var p=De(h);return p==Ft?Qh(h):p==le?L0(h):E0(h,o(h))}}function mr(o,h,p,y,w,M,D,O){var G=h&b;if(!G&&typeof o!="function")throw new li(a);var et=y?y.length:0;if(et||(h&=-97,y=w=e),D=D===e?D:xe(Ut(D),0),O=O===e?O:Ut(O),et-=w?w.length:0,h&k){var it=y,st=w;y=w=e}var ht=G?e:El(o),Tt=[o,h,p,y,w,it,st,M,D,O];if(ht&&Fb(Tt,ht),o=Tt[0],h=Tt[1],p=Tt[2],y=Tt[3],w=Tt[4],O=Tt[9]=Tt[9]===e?G?0:o.length:xe(Tt[9]-et,0),!O&&h&(T|C)&&(h&=-25),!h||h==v)var It=pb(o,h,p);else h==T||h==C?It=mb(o,h,O):(h==I||h==(v|I))&&!w.length?It=gb(o,h,p,y):It=aa.apply(e,Tt);var Gt=ht?Yf:Ap;return Ep(Gt(It,Tt),o,h)}function mp(o,h,p,y){return o===e||Ei(o,Ks[p])&&!Jt.call(y,p)?h:o}function gp(o,h,p,y,w,M){return ue(o)&&ue(h)&&(M.set(h,o),ra(o,h,e,gp,M),M.delete(h)),o}function yb(o){return no(o)?e:o}function _p(o,h,p,y,w,M){var D=p&_,O=o.length,G=h.length;if(O!=G&&!(D&&G>O))return!1;var et=M.get(o),it=M.get(h);if(et&&it)return et==h&&it==o;var st=-1,ht=!0,Tt=p&x?new ps:e;for(M.set(o,h),M.set(h,o);++st<O;){var It=o[st],Gt=h[st];if(y)var Pt=D?y(Gt,It,st,h,o,M):y(It,Gt,st,o,h,M);if(Pt!==e){if(Pt)continue;ht=!1;break}if(Tt){if(!qh(h,function(Wt,$t){if(!$n(Tt,$t)&&(It===Wt||w(It,Wt,p,y,M)))return Tt.push($t)})){ht=!1;break}}else if(!(It===Gt||w(It,Gt,p,y,M))){ht=!1;break}}return M.delete(o),M.delete(h),ht}function vb(o,h,p,y,w,M,D){switch(p){case Lr:if(o.byteLength!=h.byteLength||o.byteOffset!=h.byteOffset)return!1;o=o.buffer,h=h.buffer;case Dr:return!(o.byteLength!=h.byteLength||!M(new $o(o),new $o(h)));case gt:case xt:case vt:return Ei(+o,+h);case yt:return o.name==h.name&&o.message==h.message;case Ve:case oi:return o==h+"";case Ft:var O=Qh;case le:var G=y&_;if(O||(O=Uo),o.size!=h.size&&!G)return!1;var et=D.get(o);if(et)return et==h;y|=x,D.set(o,h);var it=_p(O(o),O(h),y,w,M,D);return D.delete(o),it;case wi:if(Kn)return Kn.call(o)==Kn.call(h)}return!1}function xb(o,h,p,y,w,M){var D=p&_,O=Sl(o),G=O.length,et=Sl(h),it=et.length;if(G!=it&&!D)return!1;for(var st=G;st--;){var ht=O[st];if(!(D?ht in h:Jt.call(h,ht)))return!1}var Tt=M.get(o),It=M.get(h);if(Tt&&It)return Tt==h&&It==o;var Gt=!0;M.set(o,h),M.set(h,o);for(var Pt=D;++st<G;){ht=O[st];var Wt=o[ht],$t=h[ht];if(y)var ti=D?y($t,Wt,ht,h,o,M):y(Wt,$t,ht,o,h,M);if(!(ti===e?Wt===$t||w(Wt,$t,p,y,M):ti)){Gt=!1;break}Pt||(Pt=ht=="constructor")}if(Gt&&!Pt){var Ne=o.constructor,ei=h.constructor;Ne!=ei&&"constructor"in o&&"constructor"in h&&!(typeof Ne=="function"&&Ne instanceof Ne&&typeof ei=="function"&&ei instanceof ei)&&(Gt=!1)}return M.delete(o),M.delete(h),Gt}function gr(o){return Fl(Tp(o,e,Fp),o+"")}function Sl(o){return kf(o,we,Ml)}function Al(o){return kf(o,$e,yp)}var El=Zo?function(o){return Zo.get(o)}:$l;function ca(o){for(var h=o.name+"",p=Js[h],y=Jt.call(Js,h)?p.length:0;y--;){var w=p[y],M=w.func;if(M==null||M==o)return w.name}return h}function rn(o){var h=Jt.call(A,"placeholder")?A:o;return h.placeholder}function Mt(){var o=A.iteratee||Wl;return o=o===Wl?Gf:o,arguments.length?o(arguments[0],arguments[1]):o}function da(o,h){var p=o.__data__;return Mb(h)?p[typeof h=="string"?"string":"hash"]:p.map}function Cl(o){for(var h=we(o),p=h.length;p--;){var y=h[p],w=o[y];h[p]=[y,w,bp(w)]}return h}function _s(o,h){var p=R0(o,h);return Uf(p)?p:e}function bb(o){var h=Jt.call(o,ds),p=o[ds];try{o[ds]=e;var y=!0}catch{}var w=Wo.call(o);return y&&(h?o[ds]=p:delete o[ds]),w}var Ml=el?function(o){return o==null?[]:(o=re(o),kr(el(o),function(h){return Sf.call(o,h)}))}:zl,yp=el?function(o){for(var h=[];o;)Nr(h,Ml(o)),o=zo(o);return h}:zl,De=Oe;(il&&De(new il(new ArrayBuffer(1)))!=Lr||qn&&De(new qn)!=Ft||rl&&De(rl.resolve())!=fe||Zs&&De(new Zs)!=le||Yn&&De(new Yn)!=os)&&(De=function(o){var h=Oe(o),p=h==jt?o.constructor:e,y=p?ys(p):"";if(y)switch(y){case rx:return Lr;case sx:return Ft;case nx:return fe;case ox:return le;case ax:return os}return h});function wb(o,h,p){for(var y=-1,w=p.length;++y<w;){var M=p[y],D=M.size;switch(M.type){case"drop":o+=D;break;case"dropRight":h-=D;break;case"take":h=Fe(h,o+D);break;case"takeRight":o=xe(o,h-D);break}}return{start:o,end:h}}function Tb(o){var h=o.match(Gn);return h?h[1].split(Po):[]}function vp(o,h,p){h=Wr(h,o);for(var y=-1,w=h.length,M=!1;++y<w;){var D=$i(h[y]);if(!(M=o!=null&&p(o,D)))break;o=o[D]}return M||++y!=w?M:(w=o==null?0:o.length,!!w&&va(w)&&_r(D,w)&&(kt(o)||vs(o)))}function Sb(o){var h=o.length,p=new o.constructor(h);return h&&typeof o[0]=="string"&&Jt.call(o,"index")&&(p.index=o.index,p.input=o.input),p}function xp(o){return typeof o.constructor=="function"&&!ro(o)?Qs(zo(o)):{}}function Ab(o,h,p){var y=o.constructor;switch(h){case Dr:return bl(o);case gt:case xt:return new y(+o);case Lr:return hb(o,p);case lr:case as:case Hs:case On:case kn:case hs:case Br:case W:case q:return ip(o,p);case Ft:return new y;case vt:case oi:return new y(o);case Ve:return lb(o);case le:return new y;case wi:return ub(o)}}function Eb(o,h){var p=h.length;if(!p)return o;var y=p-1;return h[y]=(p>1?"& ":"")+h[y],h=h.join(p>2?", ":" "),o.replace(Un,`{
/* [wrapped with `+h+`] */
`)}function Cb(o){return kt(o)||vs(o)||!!(Af&&o&&o[Af])}function _r(o,h){var p=typeof o;return h=h??P,!!h&&(p=="number"||p!="symbol"&&kh.test(o))&&o>-1&&o%1==0&&o<h}function ke(o,h,p){if(!ue(p))return!1;var y=typeof h;return(y=="number"?Xe(p)&&_r(h,p.length):y=="string"&&h in p)?Ei(p[h],o):!1}function Il(o,h){if(kt(o))return!1;var p=typeof o;return p=="number"||p=="symbol"||p=="boolean"||o==null||Qe(o)?!0:Mo.test(o)||!je.test(o)||h!=null&&o in re(h)}function Mb(o){var h=typeof o;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?o!=="__proto__":o===null}function Pl(o){var h=ca(o),p=A[h];if(typeof p!="function"||!(h in Xt.prototype))return!1;if(o===p)return!0;var y=El(p);return!!y&&o===y[0]}function Ib(o){return!!bf&&bf in o}var Pb=Ho?yr:ql;function ro(o){var h=o&&o.constructor,p=typeof h=="function"&&h.prototype||Ks;return o===p}function bp(o){return o===o&&!ue(o)}function wp(o,h){return function(p){return p==null?!1:p[o]===h&&(h!==e||o in re(p))}}function Rb(o){var h=_a(o,function(y){return p.size===f&&p.clear(),y}),p=h.cache;return h}function Fb(o,h){var p=o[1],y=h[1],w=p|y,M=w<(v|b|E),D=y==E&&p==T||y==E&&p==B&&o[7].length<=h[8]||y==(E|B)&&h[7].length<=h[8]&&p==T;if(!(M||D))return o;y&v&&(o[2]=h[2],w|=p&v?0:S);var O=h[3];if(O){var G=o[3];o[3]=G?sp(G,O,h[4]):O,o[4]=G?Ur(o[3],g):h[4]}return O=h[5],O&&(G=o[5],o[5]=G?np(G,O,h[6]):O,o[6]=G?Ur(o[5],g):h[6]),O=h[7],O&&(o[7]=O),y&E&&(o[8]=o[8]==null?h[8]:Fe(o[8],h[8])),o[9]==null&&(o[9]=h[9]),o[0]=h[0],o[1]=w,o}function Db(o){var h=[];if(o!=null)for(var p in re(o))h.push(p);return h}function Lb(o){return Wo.call(o)}function Tp(o,h,p){return h=xe(h===e?o.length-1:h,0),function(){for(var y=arguments,w=-1,M=xe(y.length-h,0),D=Y(M);++w<M;)D[w]=y[h+w];w=-1;for(var O=Y(h+1);++w<h;)O[w]=y[w];return O[h]=p(D),Ke(o,this,O)}}function Sp(o,h){return h.length<2?o:gs(o,di(h,0,-1))}function Bb(o,h){for(var p=o.length,y=Fe(h.length,p),w=We(o);y--;){var M=h[y];o[y]=_r(M,p)?w[M]:e}return o}function Rl(o,h){if(!(h==="constructor"&&typeof o[h]=="function")&&h!="__proto__")return o[h]}var Ap=Cp(Yf),so=K0||function(o,h){return Ce.setTimeout(o,h)},Fl=Cp(sb);function Ep(o,h,p){var y=h+"";return Fl(o,Eb(y,Ob(Tb(y),p)))}function Cp(o){var h=0,p=0;return function(){var y=tx(),w=K-(y-p);if(p=y,w>0){if(++h>=H)return arguments[0]}else h=0;return o.apply(e,arguments)}}function fa(o,h){var p=-1,y=o.length,w=y-1;for(h=h===e?y:h;++p<h;){var M=pl(p,w),D=o[M];o[M]=o[p],o[p]=D}return o.length=h,o}var Mp=Rb(function(o){var h=[];return o.charCodeAt(0)===46&&h.push(""),o.replace(Io,function(p,y,w,M){h.push(w?M.replace(Fo,"$1"):y||p)}),h});function $i(o){if(typeof o=="string"||Qe(o))return o;var h=o+"";return h=="0"&&1/o==-F?"-0":h}function ys(o){if(o!=null){try{return Vo.call(o)}catch{}try{return o+""}catch{}}return""}function Ob(o,h){return hi(rt,function(p){var y="_."+p[0];h&p[1]&&!ko(o,y)&&o.push(y)}),o.sort()}function Ip(o){if(o instanceof Xt)return o.clone();var h=new ui(o.__wrapped__,o.__chain__);return h.__actions__=We(o.__actions__),h.__index__=o.__index__,h.__values__=o.__values__,h}function kb(o,h,p){(p?ke(o,h,p):h===e)?h=1:h=xe(Ut(h),0);var y=o==null?0:o.length;if(!y||h<1)return[];for(var w=0,M=0,D=Y(jo(y/h));w<y;)D[M++]=di(o,w,w+=h);return D}function Nb(o){for(var h=-1,p=o==null?0:o.length,y=0,w=[];++h<p;){var M=o[h];M&&(w[y++]=M)}return w}function Ub(){var o=arguments.length;if(!o)return[];for(var h=Y(o-1),p=arguments[0],y=o;y--;)h[y-1]=arguments[y];return Nr(kt(p)?We(p):[p],Me(h,1))}var Gb=Vt(function(o,h){return me(o)?Jn(o,Me(h,1,me,!0)):[]}),Hb=Vt(function(o,h){var p=fi(h);return me(p)&&(p=e),me(o)?Jn(o,Me(h,1,me,!0),Mt(p,2)):[]}),Vb=Vt(function(o,h){var p=fi(h);return me(p)&&(p=e),me(o)?Jn(o,Me(h,1,me,!0),e,p):[]});function Wb(o,h,p){var y=o==null?0:o.length;return y?(h=p||h===e?1:Ut(h),di(o,h<0?0:h,y)):[]}function Xb(o,h,p){var y=o==null?0:o.length;return y?(h=p||h===e?1:Ut(h),h=y-h,di(o,0,h<0?0:h)):[]}function $b(o,h){return o&&o.length?na(o,Mt(h,3),!0,!0):[]}function zb(o,h){return o&&o.length?na(o,Mt(h,3),!0):[]}function qb(o,h,p,y){var w=o==null?0:o.length;return w?(p&&typeof p!="number"&&ke(o,h,p)&&(p=0,y=w),Ux(o,h,p,y)):[]}function Pp(o,h,p){var y=o==null?0:o.length;if(!y)return-1;var w=p==null?0:Ut(p);return w<0&&(w=xe(y+w,0)),No(o,Mt(h,3),w)}function Rp(o,h,p){var y=o==null?0:o.length;if(!y)return-1;var w=y-1;return p!==e&&(w=Ut(p),w=p<0?xe(y+w,0):Fe(w,y-1)),No(o,Mt(h,3),w,!0)}function Fp(o){var h=o==null?0:o.length;return h?Me(o,1):[]}function Yb(o){var h=o==null?0:o.length;return h?Me(o,F):[]}function jb(o,h){var p=o==null?0:o.length;return p?(h=h===e?1:Ut(h),Me(o,h)):[]}function Kb(o){for(var h=-1,p=o==null?0:o.length,y={};++h<p;){var w=o[h];y[w[0]]=w[1]}return y}function Dp(o){return o&&o.length?o[0]:e}function Zb(o,h,p){var y=o==null?0:o.length;if(!y)return-1;var w=p==null?0:Ut(p);return w<0&&(w=xe(y+w,0)),zs(o,h,w)}function Jb(o){var h=o==null?0:o.length;return h?di(o,0,-1):[]}var Qb=Vt(function(o){var h=ae(o,vl);return h.length&&h[0]===o[0]?ll(h):[]}),tw=Vt(function(o){var h=fi(o),p=ae(o,vl);return h===fi(p)?h=e:p.pop(),p.length&&p[0]===o[0]?ll(p,Mt(h,2)):[]}),ew=Vt(function(o){var h=fi(o),p=ae(o,vl);return h=typeof h=="function"?h:e,h&&p.pop(),p.length&&p[0]===o[0]?ll(p,e,h):[]});function iw(o,h){return o==null?"":J0.call(o,h)}function fi(o){var h=o==null?0:o.length;return h?o[h-1]:e}function rw(o,h,p){var y=o==null?0:o.length;if(!y)return-1;var w=y;return p!==e&&(w=Ut(p),w=w<0?xe(y+w,0):Fe(w,y-1)),h===h?O0(o,h,w):No(o,ff,w,!0)}function sw(o,h){return o&&o.length?Xf(o,Ut(h)):e}var nw=Vt(Lp);function Lp(o,h){return o&&o.length&&h&&h.length?fl(o,h):o}function ow(o,h,p){return o&&o.length&&h&&h.length?fl(o,h,Mt(p,2)):o}function aw(o,h,p){return o&&o.length&&h&&h.length?fl(o,h,e,p):o}var hw=gr(function(o,h){var p=o==null?0:o.length,y=nl(o,h);return qf(o,ae(h,function(w){return _r(w,p)?+w:w}).sort(rp)),y});function lw(o,h){var p=[];if(!(o&&o.length))return p;var y=-1,w=[],M=o.length;for(h=Mt(h,3);++y<M;){var D=o[y];h(D,y,o)&&(p.push(D),w.push(y))}return qf(o,w),p}function Dl(o){return o==null?o:ix.call(o)}function uw(o,h,p){var y=o==null?0:o.length;return y?(p&&typeof p!="number"&&ke(o,h,p)?(h=0,p=y):(h=h==null?0:Ut(h),p=p===e?y:Ut(p)),di(o,h,p)):[]}function cw(o,h){return sa(o,h)}function dw(o,h,p){return gl(o,h,Mt(p,2))}function fw(o,h){var p=o==null?0:o.length;if(p){var y=sa(o,h);if(y<p&&Ei(o[y],h))return y}return-1}function pw(o,h){return sa(o,h,!0)}function mw(o,h,p){return gl(o,h,Mt(p,2),!0)}function gw(o,h){var p=o==null?0:o.length;if(p){var y=sa(o,h,!0)-1;if(Ei(o[y],h))return y}return-1}function _w(o){return o&&o.length?jf(o):[]}function yw(o,h){return o&&o.length?jf(o,Mt(h,2)):[]}function vw(o){var h=o==null?0:o.length;return h?di(o,1,h):[]}function xw(o,h,p){return o&&o.length?(h=p||h===e?1:Ut(h),di(o,0,h<0?0:h)):[]}function bw(o,h,p){var y=o==null?0:o.length;return y?(h=p||h===e?1:Ut(h),h=y-h,di(o,h<0?0:h,y)):[]}function ww(o,h){return o&&o.length?na(o,Mt(h,3),!1,!0):[]}function Tw(o,h){return o&&o.length?na(o,Mt(h,3)):[]}var Sw=Vt(function(o){return Vr(Me(o,1,me,!0))}),Aw=Vt(function(o){var h=fi(o);return me(h)&&(h=e),Vr(Me(o,1,me,!0),Mt(h,2))}),Ew=Vt(function(o){var h=fi(o);return h=typeof h=="function"?h:e,Vr(Me(o,1,me,!0),e,h)});function Cw(o){return o&&o.length?Vr(o):[]}function Mw(o,h){return o&&o.length?Vr(o,Mt(h,2)):[]}function Iw(o,h){return h=typeof h=="function"?h:e,o&&o.length?Vr(o,e,h):[]}function Ll(o){if(!(o&&o.length))return[];var h=0;return o=kr(o,function(p){if(me(p))return h=xe(p.length,h),!0}),Zh(h,function(p){return ae(o,Yh(p))})}function Bp(o,h){if(!(o&&o.length))return[];var p=Ll(o);return h==null?p:ae(p,function(y){return Ke(h,e,y)})}var Pw=Vt(function(o,h){return me(o)?Jn(o,h):[]}),Rw=Vt(function(o){return yl(kr(o,me))}),Fw=Vt(function(o){var h=fi(o);return me(h)&&(h=e),yl(kr(o,me),Mt(h,2))}),Dw=Vt(function(o){var h=fi(o);return h=typeof h=="function"?h:e,yl(kr(o,me),e,h)}),Lw=Vt(Ll);function Bw(o,h){return Qf(o||[],h||[],Zn)}function Ow(o,h){return Qf(o||[],h||[],eo)}var kw=Vt(function(o){var h=o.length,p=h>1?o[h-1]:e;return p=typeof p=="function"?(o.pop(),p):e,Bp(o,p)});function Op(o){var h=A(o);return h.__chain__=!0,h}function Nw(o,h){return h(o),o}function pa(o,h){return h(o)}var Uw=gr(function(o){var h=o.length,p=h?o[0]:0,y=this.__wrapped__,w=function(M){return nl(M,o)};return h>1||this.__actions__.length||!(y instanceof Xt)||!_r(p)?this.thru(w):(y=y.slice(p,+p+(h?1:0)),y.__actions__.push({func:pa,args:[w],thisArg:e}),new ui(y,this.__chain__).thru(function(M){return h&&!M.length&&M.push(e),M}))});function Gw(){return Op(this)}function Hw(){return new ui(this.value(),this.__chain__)}function Vw(){this.__values__===e&&(this.__values__=Kp(this.value()));var o=this.__index__>=this.__values__.length,h=o?e:this.__values__[this.__index__++];return{done:o,value:h}}function Ww(){return this}function Xw(o){for(var h,p=this;p instanceof Qo;){var y=Ip(p);y.__index__=0,y.__values__=e,h?w.__wrapped__=y:h=y;var w=y;p=p.__wrapped__}return w.__wrapped__=o,h}function $w(){var o=this.__wrapped__;if(o instanceof Xt){var h=o;return this.__actions__.length&&(h=new Xt(this)),h=h.reverse(),h.__actions__.push({func:pa,args:[Dl],thisArg:e}),new ui(h,this.__chain__)}return this.thru(Dl)}function zw(){return Jf(this.__wrapped__,this.__actions__)}var qw=oa(function(o,h,p){Jt.call(o,p)?++o[p]:pr(o,p,1)});function Yw(o,h,p){var y=kt(o)?cf:Nx;return p&&ke(o,h,p)&&(h=e),y(o,Mt(h,3))}function jw(o,h){var p=kt(o)?kr:Bf;return p(o,Mt(h,3))}var Kw=lp(Pp),Zw=lp(Rp);function Jw(o,h){return Me(ma(o,h),1)}function Qw(o,h){return Me(ma(o,h),F)}function tT(o,h,p){return p=p===e?1:Ut(p),Me(ma(o,h),p)}function kp(o,h){var p=kt(o)?hi:Hr;return p(o,Mt(h,3))}function Np(o,h){var p=kt(o)?v0:Lf;return p(o,Mt(h,3))}var eT=oa(function(o,h,p){Jt.call(o,p)?o[p].push(h):pr(o,p,[h])});function iT(o,h,p,y){o=Xe(o)?o:nn(o),p=p&&!y?Ut(p):0;var w=o.length;return p<0&&(p=xe(w+p,0)),xa(o)?p<=w&&o.indexOf(h,p)>-1:!!w&&zs(o,h,p)>-1}var rT=Vt(function(o,h,p){var y=-1,w=typeof h=="function",M=Xe(o)?Y(o.length):[];return Hr(o,function(D){M[++y]=w?Ke(h,D,p):Qn(D,h,p)}),M}),sT=oa(function(o,h,p){pr(o,p,h)});function ma(o,h){var p=kt(o)?ae:Hf;return p(o,Mt(h,3))}function nT(o,h,p,y){return o==null?[]:(kt(h)||(h=h==null?[]:[h]),p=y?e:p,kt(p)||(p=p==null?[]:[p]),$f(o,h,p))}var oT=oa(function(o,h,p){o[p?0:1].push(h)},function(){return[[],[]]});function aT(o,h,p){var y=kt(o)?zh:mf,w=arguments.length<3;return y(o,Mt(h,4),p,w,Hr)}function hT(o,h,p){var y=kt(o)?x0:mf,w=arguments.length<3;return y(o,Mt(h,4),p,w,Lf)}function lT(o,h){var p=kt(o)?kr:Bf;return p(o,ya(Mt(h,3)))}function uT(o){var h=kt(o)?Pf:ib;return h(o)}function cT(o,h,p){(p?ke(o,h,p):h===e)?h=1:h=Ut(h);var y=kt(o)?Dx:rb;return y(o,h)}function dT(o){var h=kt(o)?Lx:nb;return h(o)}function fT(o){if(o==null)return 0;if(Xe(o))return xa(o)?Ys(o):o.length;var h=De(o);return h==Ft||h==le?o.size:cl(o).length}function pT(o,h,p){var y=kt(o)?qh:ob;return p&&ke(o,h,p)&&(h=e),y(o,Mt(h,3))}var mT=Vt(function(o,h){if(o==null)return[];var p=h.length;return p>1&&ke(o,h[0],h[1])?h=[]:p>2&&ke(h[0],h[1],h[2])&&(h=[h[0]]),$f(o,Me(h,1),[])}),ga=j0||function(){return Ce.Date.now()};function gT(o,h){if(typeof h!="function")throw new li(a);return o=Ut(o),function(){if(--o<1)return h.apply(this,arguments)}}function Up(o,h,p){return h=p?e:h,h=o&&h==null?o.length:h,mr(o,E,e,e,e,e,h)}function Gp(o,h){var p;if(typeof h!="function")throw new li(a);return o=Ut(o),function(){return--o>0&&(p=h.apply(this,arguments)),o<=1&&(h=e),p}}var Bl=Vt(function(o,h,p){var y=v;if(p.length){var w=Ur(p,rn(Bl));y|=I}return mr(o,y,h,p,w)}),Hp=Vt(function(o,h,p){var y=v|b;if(p.length){var w=Ur(p,rn(Hp));y|=I}return mr(h,y,o,p,w)});function Vp(o,h,p){h=p?e:h;var y=mr(o,T,e,e,e,e,e,h);return y.placeholder=Vp.placeholder,y}function Wp(o,h,p){h=p?e:h;var y=mr(o,C,e,e,e,e,e,h);return y.placeholder=Wp.placeholder,y}function Xp(o,h,p){var y,w,M,D,O,G,et=0,it=!1,st=!1,ht=!0;if(typeof o!="function")throw new li(a);h=pi(h)||0,ue(p)&&(it=!!p.leading,st="maxWait"in p,M=st?xe(pi(p.maxWait)||0,h):M,ht="trailing"in p?!!p.trailing:ht);function Tt(ge){var Ci=y,xr=w;return y=w=e,et=ge,D=o.apply(xr,Ci),D}function It(ge){return et=ge,O=so(Wt,h),it?Tt(ge):D}function Gt(ge){var Ci=ge-G,xr=ge-et,lm=h-Ci;return st?Fe(lm,M-xr):lm}function Pt(ge){var Ci=ge-G,xr=ge-et;return G===e||Ci>=h||Ci<0||st&&xr>=M}function Wt(){var ge=ga();if(Pt(ge))return $t(ge);O=so(Wt,Gt(ge))}function $t(ge){return O=e,ht&&y?Tt(ge):(y=w=e,D)}function ti(){O!==e&&tp(O),et=0,y=G=w=O=e}function Ne(){return O===e?D:$t(ga())}function ei(){var ge=ga(),Ci=Pt(ge);if(y=arguments,w=this,G=ge,Ci){if(O===e)return It(G);if(st)return tp(O),O=so(Wt,h),Tt(G)}return O===e&&(O=so(Wt,h)),D}return ei.cancel=ti,ei.flush=Ne,ei}var _T=Vt(function(o,h){return Df(o,1,h)}),yT=Vt(function(o,h,p){return Df(o,pi(h)||0,p)});function vT(o){return mr(o,X)}function _a(o,h){if(typeof o!="function"||h!=null&&typeof h!="function")throw new li(a);var p=function(){var y=arguments,w=h?h.apply(this,y):y[0],M=p.cache;if(M.has(w))return M.get(w);var D=o.apply(this,y);return p.cache=M.set(w,D)||M,D};return p.cache=new(_a.Cache||fr),p}_a.Cache=fr;function ya(o){if(typeof o!="function")throw new li(a);return function(){var h=arguments;switch(h.length){case 0:return!o.call(this);case 1:return!o.call(this,h[0]);case 2:return!o.call(this,h[0],h[1]);case 3:return!o.call(this,h[0],h[1],h[2])}return!o.apply(this,h)}}function xT(o){return Gp(2,o)}var bT=ab(function(o,h){h=h.length==1&&kt(h[0])?ae(h[0],Ze(Mt())):ae(Me(h,1),Ze(Mt()));var p=h.length;return Vt(function(y){for(var w=-1,M=Fe(y.length,p);++w<M;)y[w]=h[w].call(this,y[w]);return Ke(o,this,y)})}),Ol=Vt(function(o,h){var p=Ur(h,rn(Ol));return mr(o,I,e,h,p)}),$p=Vt(function(o,h){var p=Ur(h,rn($p));return mr(o,k,e,h,p)}),wT=gr(function(o,h){return mr(o,B,e,e,e,h)});function TT(o,h){if(typeof o!="function")throw new li(a);return h=h===e?h:Ut(h),Vt(o,h)}function ST(o,h){if(typeof o!="function")throw new li(a);return h=h==null?0:xe(Ut(h),0),Vt(function(p){var y=p[h],w=Xr(p,0,h);return y&&Nr(w,y),Ke(o,this,w)})}function AT(o,h,p){var y=!0,w=!0;if(typeof o!="function")throw new li(a);return ue(p)&&(y="leading"in p?!!p.leading:y,w="trailing"in p?!!p.trailing:w),Xp(o,h,{leading:y,maxWait:h,trailing:w})}function ET(o){return Up(o,1)}function CT(o,h){return Ol(xl(h),o)}function MT(){if(!arguments.length)return[];var o=arguments[0];return kt(o)?o:[o]}function IT(o){return ci(o,m)}function PT(o,h){return h=typeof h=="function"?h:e,ci(o,m,h)}function RT(o){return ci(o,u|m)}function FT(o,h){return h=typeof h=="function"?h:e,ci(o,u|m,h)}function DT(o,h){return h==null||Ff(o,h,we(h))}function Ei(o,h){return o===h||o!==o&&h!==h}var LT=ua(hl),BT=ua(function(o,h){return o>=h}),vs=Nf((function(){return arguments})())?Nf:function(o){return pe(o)&&Jt.call(o,"callee")&&!Sf.call(o,"callee")},kt=Y.isArray,OT=nf?Ze(nf):Xx;function Xe(o){return o!=null&&va(o.length)&&!yr(o)}function me(o){return pe(o)&&Xe(o)}function kT(o){return o===!0||o===!1||pe(o)&&Oe(o)==gt}var $r=Z0||ql,NT=of?Ze(of):$x;function UT(o){return pe(o)&&o.nodeType===1&&!no(o)}function GT(o){if(o==null)return!0;if(Xe(o)&&(kt(o)||typeof o=="string"||typeof o.splice=="function"||$r(o)||sn(o)||vs(o)))return!o.length;var h=De(o);if(h==Ft||h==le)return!o.size;if(ro(o))return!cl(o).length;for(var p in o)if(Jt.call(o,p))return!1;return!0}function HT(o,h){return to(o,h)}function VT(o,h,p){p=typeof p=="function"?p:e;var y=p?p(o,h):e;return y===e?to(o,h,e,p):!!y}function kl(o){if(!pe(o))return!1;var h=Oe(o);return h==yt||h==ot||typeof o.message=="string"&&typeof o.name=="string"&&!no(o)}function WT(o){return typeof o=="number"&&Ef(o)}function yr(o){if(!ue(o))return!1;var h=Oe(o);return h==bt||h==Lt||h==pt||h==Rr}function zp(o){return typeof o=="number"&&o==Ut(o)}function va(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=P}function ue(o){var h=typeof o;return o!=null&&(h=="object"||h=="function")}function pe(o){return o!=null&&typeof o=="object"}var qp=af?Ze(af):qx;function XT(o,h){return o===h||ul(o,h,Cl(h))}function $T(o,h,p){return p=typeof p=="function"?p:e,ul(o,h,Cl(h),p)}function zT(o){return Yp(o)&&o!=+o}function qT(o){if(Pb(o))throw new Bt(n);return Uf(o)}function YT(o){return o===null}function jT(o){return o==null}function Yp(o){return typeof o=="number"||pe(o)&&Oe(o)==vt}function no(o){if(!pe(o)||Oe(o)!=jt)return!1;var h=zo(o);if(h===null)return!0;var p=Jt.call(h,"constructor")&&h.constructor;return typeof p=="function"&&p instanceof p&&Vo.call(p)==$0}var Nl=hf?Ze(hf):Yx;function KT(o){return zp(o)&&o>=-P&&o<=P}var jp=lf?Ze(lf):jx;function xa(o){return typeof o=="string"||!kt(o)&&pe(o)&&Oe(o)==oi}function Qe(o){return typeof o=="symbol"||pe(o)&&Oe(o)==wi}var sn=uf?Ze(uf):Kx;function ZT(o){return o===e}function JT(o){return pe(o)&&De(o)==os}function QT(o){return pe(o)&&Oe(o)==Bh}var t1=ua(dl),e1=ua(function(o,h){return o<=h});function Kp(o){if(!o)return[];if(Xe(o))return xa(o)?Si(o):We(o);if(zn&&o[zn])return D0(o[zn]());var h=De(o),p=h==Ft?Qh:h==le?Uo:nn;return p(o)}function vr(o){if(!o)return o===0?o:0;if(o=pi(o),o===F||o===-F){var h=o<0?-1:1;return h*V}return o===o?o:0}function Ut(o){var h=vr(o),p=h%1;return h===h?p?h-p:h:0}function Zp(o){return o?ms(Ut(o),0,U):0}function pi(o){if(typeof o=="number")return o;if(Qe(o))return L;if(ue(o)){var h=typeof o.valueOf=="function"?o.valueOf():o;o=ue(h)?h+"":h}if(typeof o!="string")return o===0?o:+o;o=gf(o);var p=Xn.test(o);return p||Xs.test(o)?g0(o.slice(2),p?2:8):Oh.test(o)?L:+o}function Jp(o){return Xi(o,$e(o))}function i1(o){return o?ms(Ut(o),-P,P):o===0?o:0}function Zt(o){return o==null?"":Je(o)}var r1=tn(function(o,h){if(ro(h)||Xe(h)){Xi(h,we(h),o);return}for(var p in h)Jt.call(h,p)&&Zn(o,p,h[p])}),Qp=tn(function(o,h){Xi(h,$e(h),o)}),ba=tn(function(o,h,p,y){Xi(h,$e(h),o,y)}),s1=tn(function(o,h,p,y){Xi(h,we(h),o,y)}),n1=gr(nl);function o1(o,h){var p=Qs(o);return h==null?p:Rf(p,h)}var a1=Vt(function(o,h){o=re(o);var p=-1,y=h.length,w=y>2?h[2]:e;for(w&&ke(h[0],h[1],w)&&(y=1);++p<y;)for(var M=h[p],D=$e(M),O=-1,G=D.length;++O<G;){var et=D[O],it=o[et];(it===e||Ei(it,Ks[et])&&!Jt.call(o,et))&&(o[et]=M[et])}return o}),h1=Vt(function(o){return o.push(e,gp),Ke(tm,e,o)});function l1(o,h){return df(o,Mt(h,3),Wi)}function u1(o,h){return df(o,Mt(h,3),al)}function c1(o,h){return o==null?o:ol(o,Mt(h,3),$e)}function d1(o,h){return o==null?o:Of(o,Mt(h,3),$e)}function f1(o,h){return o&&Wi(o,Mt(h,3))}function p1(o,h){return o&&al(o,Mt(h,3))}function m1(o){return o==null?[]:ia(o,we(o))}function g1(o){return o==null?[]:ia(o,$e(o))}function Ul(o,h,p){var y=o==null?e:gs(o,h);return y===e?p:y}function _1(o,h){return o!=null&&vp(o,h,Gx)}function Gl(o,h){return o!=null&&vp(o,h,Hx)}var y1=cp(function(o,h,p){h!=null&&typeof h.toString!="function"&&(h=Wo.call(h)),o[h]=p},Vl(ze)),v1=cp(function(o,h,p){h!=null&&typeof h.toString!="function"&&(h=Wo.call(h)),Jt.call(o,h)?o[h].push(p):o[h]=[p]},Mt),x1=Vt(Qn);function we(o){return Xe(o)?If(o):cl(o)}function $e(o){return Xe(o)?If(o,!0):Zx(o)}function b1(o,h){var p={};return h=Mt(h,3),Wi(o,function(y,w,M){pr(p,h(y,w,M),y)}),p}function w1(o,h){var p={};return h=Mt(h,3),Wi(o,function(y,w,M){pr(p,w,h(y,w,M))}),p}var T1=tn(function(o,h,p){ra(o,h,p)}),tm=tn(function(o,h,p,y){ra(o,h,p,y)}),S1=gr(function(o,h){var p={};if(o==null)return p;var y=!1;h=ae(h,function(M){return M=Wr(M,o),y||(y=M.length>1),M}),Xi(o,Al(o),p),y&&(p=ci(p,u|d|m,yb));for(var w=h.length;w--;)_l(p,h[w]);return p});function A1(o,h){return em(o,ya(Mt(h)))}var E1=gr(function(o,h){return o==null?{}:Qx(o,h)});function em(o,h){if(o==null)return{};var p=ae(Al(o),function(y){return[y]});return h=Mt(h),zf(o,p,function(y,w){return h(y,w[0])})}function C1(o,h,p){h=Wr(h,o);var y=-1,w=h.length;for(w||(w=1,o=e);++y<w;){var M=o==null?e:o[$i(h[y])];M===e&&(y=w,M=p),o=yr(M)?M.call(o):M}return o}function M1(o,h,p){return o==null?o:eo(o,h,p)}function I1(o,h,p,y){return y=typeof y=="function"?y:e,o==null?o:eo(o,h,p,y)}var im=pp(we),rm=pp($e);function P1(o,h,p){var y=kt(o),w=y||$r(o)||sn(o);if(h=Mt(h,4),p==null){var M=o&&o.constructor;w?p=y?new M:[]:ue(o)?p=yr(M)?Qs(zo(o)):{}:p={}}return(w?hi:Wi)(o,function(D,O,G){return h(p,D,O,G)}),p}function R1(o,h){return o==null?!0:_l(o,h)}function F1(o,h,p){return o==null?o:Zf(o,h,xl(p))}function D1(o,h,p,y){return y=typeof y=="function"?y:e,o==null?o:Zf(o,h,xl(p),y)}function nn(o){return o==null?[]:Jh(o,we(o))}function L1(o){return o==null?[]:Jh(o,$e(o))}function B1(o,h,p){return p===e&&(p=h,h=e),p!==e&&(p=pi(p),p=p===p?p:0),h!==e&&(h=pi(h),h=h===h?h:0),ms(pi(o),h,p)}function O1(o,h,p){return h=vr(h),p===e?(p=h,h=0):p=vr(p),o=pi(o),Vx(o,h,p)}function k1(o,h,p){if(p&&typeof p!="boolean"&&ke(o,h,p)&&(h=p=e),p===e&&(typeof h=="boolean"?(p=h,h=e):typeof o=="boolean"&&(p=o,o=e)),o===e&&h===e?(o=0,h=1):(o=vr(o),h===e?(h=o,o=0):h=vr(h)),o>h){var y=o;o=h,h=y}if(p||o%1||h%1){var w=Cf();return Fe(o+w*(h-o+m0("1e-"+((w+"").length-1))),h)}return pl(o,h)}var N1=en(function(o,h,p){return h=h.toLowerCase(),o+(p?sm(h):h)});function sm(o){return Hl(Zt(o).toLowerCase())}function nm(o){return o=Zt(o),o&&o.replace(Do,M0).replace(n0,"")}function U1(o,h,p){o=Zt(o),h=Je(h);var y=o.length;p=p===e?y:ms(Ut(p),0,y);var w=p;return p-=h.length,p>=0&&o.slice(p,w)==h}function G1(o){return o=Zt(o),o&&Be.test(o)?o.replace(Ti,I0):o}function H1(o){return o=Zt(o),o&&ls.test(o)?o.replace(Vs,"\\$&"):o}var V1=en(function(o,h,p){return o+(p?"-":"")+h.toLowerCase()}),W1=en(function(o,h,p){return o+(p?" ":"")+h.toLowerCase()}),X1=hp("toLowerCase");function $1(o,h,p){o=Zt(o),h=Ut(h);var y=h?Ys(o):0;if(!h||y>=h)return o;var w=(h-y)/2;return la(Ko(w),p)+o+la(jo(w),p)}function z1(o,h,p){o=Zt(o),h=Ut(h);var y=h?Ys(o):0;return h&&y<h?o+la(h-y,p):o}function q1(o,h,p){o=Zt(o),h=Ut(h);var y=h?Ys(o):0;return h&&y<h?la(h-y,p)+o:o}function Y1(o,h,p){return p||h==null?h=0:h&&(h=+h),ex(Zt(o).replace(us,""),h||0)}function j1(o,h,p){return(p?ke(o,h,p):h===e)?h=1:h=Ut(h),ml(Zt(o),h)}function K1(){var o=arguments,h=Zt(o[0]);return o.length<3?h:h.replace(o[1],o[2])}var Z1=en(function(o,h,p){return o+(p?"_":"")+h.toLowerCase()});function J1(o,h,p){return p&&typeof p!="number"&&ke(o,h,p)&&(h=p=e),p=p===e?U:p>>>0,p?(o=Zt(o),o&&(typeof h=="string"||h!=null&&!Nl(h))&&(h=Je(h),!h&&qs(o))?Xr(Si(o),0,p):o.split(h,p)):[]}var Q1=en(function(o,h,p){return o+(p?" ":"")+Hl(h)});function tS(o,h,p){return o=Zt(o),p=p==null?0:ms(Ut(p),0,o.length),h=Je(h),o.slice(p,p+h.length)==h}function eS(o,h,p){var y=A.templateSettings;p&&ke(o,h,p)&&(h=e),o=Zt(o),h=ba({},h,y,mp);var w=ba({},h.imports,y.imports,mp),M=we(w),D=Jh(w,M),O,G,et=0,it=h.interpolate||Lo,st="__p += '",ht=tl((h.escape||Lo).source+"|"+it.source+"|"+(it===cr?Vn:Lo).source+"|"+(h.evaluate||Lo).source+"|$","g"),Tt="//# sourceURL="+(Jt.call(h,"sourceURL")?(h.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++u0+"]")+`
`;o.replace(ht,function(Pt,Wt,$t,ti,Ne,ei){return $t||($t=ti),st+=o.slice(et,ei).replace(Hv,P0),Wt&&(O=!0,st+=`' +
__e(`+Wt+`) +
'`),Ne&&(G=!0,st+=`';
`+Ne+`;
__p += '`),$t&&(st+=`' +
((__t = (`+$t+`)) == null ? '' : __t) +
'`),et=ei+Pt.length,Pt}),st+=`';
`;var It=Jt.call(h,"variable")&&h.variable;if(!It)st=`with (obj) {
`+st+`
}
`;else if(Hn.test(It))throw new Bt(l);st=(G?st.replace(qt,""):st).replace(ee,"$1").replace(ie,"$1;"),st="function("+(It||"obj")+`) {
`+(It?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(O?", __e = _.escape":"")+(G?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+st+`return __p
}`;var Gt=am(function(){return Kt(M,Tt+"return "+st).apply(e,D)});if(Gt.source=st,kl(Gt))throw Gt;return Gt}function iS(o){return Zt(o).toLowerCase()}function rS(o){return Zt(o).toUpperCase()}function sS(o,h,p){if(o=Zt(o),o&&(p||h===e))return gf(o);if(!o||!(h=Je(h)))return o;var y=Si(o),w=Si(h),M=_f(y,w),D=yf(y,w)+1;return Xr(y,M,D).join("")}function nS(o,h,p){if(o=Zt(o),o&&(p||h===e))return o.slice(0,xf(o)+1);if(!o||!(h=Je(h)))return o;var y=Si(o),w=yf(y,Si(h))+1;return Xr(y,0,w).join("")}function oS(o,h,p){if(o=Zt(o),o&&(p||h===e))return o.replace(us,"");if(!o||!(h=Je(h)))return o;var y=Si(o),w=_f(y,Si(h));return Xr(y,w).join("")}function aS(o,h){var p=tt,y=Z;if(ue(h)){var w="separator"in h?h.separator:w;p="length"in h?Ut(h.length):p,y="omission"in h?Je(h.omission):y}o=Zt(o);var M=o.length;if(qs(o)){var D=Si(o);M=D.length}if(p>=M)return o;var O=p-Ys(y);if(O<1)return y;var G=D?Xr(D,0,O).join(""):o.slice(0,O);if(w===e)return G+y;if(D&&(O+=G.length-O),Nl(w)){if(o.slice(O).search(w)){var et,it=G;for(w.global||(w=tl(w.source,Zt(Wn.exec(w))+"g")),w.lastIndex=0;et=w.exec(it);)var st=et.index;G=G.slice(0,st===e?O:st)}}else if(o.indexOf(Je(w),O)!=O){var ht=G.lastIndexOf(w);ht>-1&&(G=G.slice(0,ht))}return G+y}function hS(o){return o=Zt(o),o&&ur.test(o)?o.replace(Nt,k0):o}var lS=en(function(o,h,p){return o+(p?" ":"")+h.toUpperCase()}),Hl=hp("toUpperCase");function om(o,h,p){return o=Zt(o),h=p?e:h,h===e?F0(o)?G0(o):T0(o):o.match(h)||[]}var am=Vt(function(o,h){try{return Ke(o,e,h)}catch(p){return kl(p)?p:new Bt(p)}}),uS=gr(function(o,h){return hi(h,function(p){p=$i(p),pr(o,p,Bl(o[p],o))}),o});function cS(o){var h=o==null?0:o.length,p=Mt();return o=h?ae(o,function(y){if(typeof y[1]!="function")throw new li(a);return[p(y[0]),y[1]]}):[],Vt(function(y){for(var w=-1;++w<h;){var M=o[w];if(Ke(M[0],this,y))return Ke(M[1],this,y)}})}function dS(o){return kx(ci(o,u))}function Vl(o){return function(){return o}}function fS(o,h){return o==null||o!==o?h:o}var pS=up(),mS=up(!0);function ze(o){return o}function Wl(o){return Gf(typeof o=="function"?o:ci(o,u))}function gS(o){return Vf(ci(o,u))}function _S(o,h){return Wf(o,ci(h,u))}var yS=Vt(function(o,h){return function(p){return Qn(p,o,h)}}),vS=Vt(function(o,h){return function(p){return Qn(o,p,h)}});function Xl(o,h,p){var y=we(h),w=ia(h,y);p==null&&!(ue(h)&&(w.length||!y.length))&&(p=h,h=o,o=this,w=ia(h,we(h)));var M=!(ue(p)&&"chain"in p)||!!p.chain,D=yr(o);return hi(w,function(O){var G=h[O];o[O]=G,D&&(o.prototype[O]=function(){var et=this.__chain__;if(M||et){var it=o(this.__wrapped__),st=it.__actions__=We(this.__actions__);return st.push({func:G,args:arguments,thisArg:o}),it.__chain__=et,it}return G.apply(o,Nr([this.value()],arguments))})}),o}function xS(){return Ce._===this&&(Ce._=z0),this}function $l(){}function bS(o){return o=Ut(o),Vt(function(h){return Xf(h,o)})}var wS=wl(ae),TS=wl(cf),SS=wl(qh);function hm(o){return Il(o)?Yh($i(o)):tb(o)}function AS(o){return function(h){return o==null?e:gs(o,h)}}var ES=dp(),CS=dp(!0);function zl(){return[]}function ql(){return!1}function MS(){return{}}function IS(){return""}function PS(){return!0}function RS(o,h){if(o=Ut(o),o<1||o>P)return[];var p=U,y=Fe(o,U);h=Mt(h),o-=U;for(var w=Zh(y,h);++p<o;)h(p);return w}function FS(o){return kt(o)?ae(o,$i):Qe(o)?[o]:We(Mp(Zt(o)))}function DS(o){var h=++X0;return Zt(o)+h}var LS=ha(function(o,h){return o+h},0),BS=Tl("ceil"),OS=ha(function(o,h){return o/h},1),kS=Tl("floor");function NS(o){return o&&o.length?ea(o,ze,hl):e}function US(o,h){return o&&o.length?ea(o,Mt(h,2),hl):e}function GS(o){return pf(o,ze)}function HS(o,h){return pf(o,Mt(h,2))}function VS(o){return o&&o.length?ea(o,ze,dl):e}function WS(o,h){return o&&o.length?ea(o,Mt(h,2),dl):e}var XS=ha(function(o,h){return o*h},1),$S=Tl("round"),zS=ha(function(o,h){return o-h},0);function qS(o){return o&&o.length?Kh(o,ze):0}function YS(o,h){return o&&o.length?Kh(o,Mt(h,2)):0}return A.after=gT,A.ary=Up,A.assign=r1,A.assignIn=Qp,A.assignInWith=ba,A.assignWith=s1,A.at=n1,A.before=Gp,A.bind=Bl,A.bindAll=uS,A.bindKey=Hp,A.castArray=MT,A.chain=Op,A.chunk=kb,A.compact=Nb,A.concat=Ub,A.cond=cS,A.conforms=dS,A.constant=Vl,A.countBy=qw,A.create=o1,A.curry=Vp,A.curryRight=Wp,A.debounce=Xp,A.defaults=a1,A.defaultsDeep=h1,A.defer=_T,A.delay=yT,A.difference=Gb,A.differenceBy=Hb,A.differenceWith=Vb,A.drop=Wb,A.dropRight=Xb,A.dropRightWhile=$b,A.dropWhile=zb,A.fill=qb,A.filter=jw,A.flatMap=Jw,A.flatMapDeep=Qw,A.flatMapDepth=tT,A.flatten=Fp,A.flattenDeep=Yb,A.flattenDepth=jb,A.flip=vT,A.flow=pS,A.flowRight=mS,A.fromPairs=Kb,A.functions=m1,A.functionsIn=g1,A.groupBy=eT,A.initial=Jb,A.intersection=Qb,A.intersectionBy=tw,A.intersectionWith=ew,A.invert=y1,A.invertBy=v1,A.invokeMap=rT,A.iteratee=Wl,A.keyBy=sT,A.keys=we,A.keysIn=$e,A.map=ma,A.mapKeys=b1,A.mapValues=w1,A.matches=gS,A.matchesProperty=_S,A.memoize=_a,A.merge=T1,A.mergeWith=tm,A.method=yS,A.methodOf=vS,A.mixin=Xl,A.negate=ya,A.nthArg=bS,A.omit=S1,A.omitBy=A1,A.once=xT,A.orderBy=nT,A.over=wS,A.overArgs=bT,A.overEvery=TS,A.overSome=SS,A.partial=Ol,A.partialRight=$p,A.partition=oT,A.pick=E1,A.pickBy=em,A.property=hm,A.propertyOf=AS,A.pull=nw,A.pullAll=Lp,A.pullAllBy=ow,A.pullAllWith=aw,A.pullAt=hw,A.range=ES,A.rangeRight=CS,A.rearg=wT,A.reject=lT,A.remove=lw,A.rest=TT,A.reverse=Dl,A.sampleSize=cT,A.set=M1,A.setWith=I1,A.shuffle=dT,A.slice=uw,A.sortBy=mT,A.sortedUniq=_w,A.sortedUniqBy=yw,A.split=J1,A.spread=ST,A.tail=vw,A.take=xw,A.takeRight=bw,A.takeRightWhile=ww,A.takeWhile=Tw,A.tap=Nw,A.throttle=AT,A.thru=pa,A.toArray=Kp,A.toPairs=im,A.toPairsIn=rm,A.toPath=FS,A.toPlainObject=Jp,A.transform=P1,A.unary=ET,A.union=Sw,A.unionBy=Aw,A.unionWith=Ew,A.uniq=Cw,A.uniqBy=Mw,A.uniqWith=Iw,A.unset=R1,A.unzip=Ll,A.unzipWith=Bp,A.update=F1,A.updateWith=D1,A.values=nn,A.valuesIn=L1,A.without=Pw,A.words=om,A.wrap=CT,A.xor=Rw,A.xorBy=Fw,A.xorWith=Dw,A.zip=Lw,A.zipObject=Bw,A.zipObjectDeep=Ow,A.zipWith=kw,A.entries=im,A.entriesIn=rm,A.extend=Qp,A.extendWith=ba,Xl(A,A),A.add=LS,A.attempt=am,A.camelCase=N1,A.capitalize=sm,A.ceil=BS,A.clamp=B1,A.clone=IT,A.cloneDeep=RT,A.cloneDeepWith=FT,A.cloneWith=PT,A.conformsTo=DT,A.deburr=nm,A.defaultTo=fS,A.divide=OS,A.endsWith=U1,A.eq=Ei,A.escape=G1,A.escapeRegExp=H1,A.every=Yw,A.find=Kw,A.findIndex=Pp,A.findKey=l1,A.findLast=Zw,A.findLastIndex=Rp,A.findLastKey=u1,A.floor=kS,A.forEach=kp,A.forEachRight=Np,A.forIn=c1,A.forInRight=d1,A.forOwn=f1,A.forOwnRight=p1,A.get=Ul,A.gt=LT,A.gte=BT,A.has=_1,A.hasIn=Gl,A.head=Dp,A.identity=ze,A.includes=iT,A.indexOf=Zb,A.inRange=O1,A.invoke=x1,A.isArguments=vs,A.isArray=kt,A.isArrayBuffer=OT,A.isArrayLike=Xe,A.isArrayLikeObject=me,A.isBoolean=kT,A.isBuffer=$r,A.isDate=NT,A.isElement=UT,A.isEmpty=GT,A.isEqual=HT,A.isEqualWith=VT,A.isError=kl,A.isFinite=WT,A.isFunction=yr,A.isInteger=zp,A.isLength=va,A.isMap=qp,A.isMatch=XT,A.isMatchWith=$T,A.isNaN=zT,A.isNative=qT,A.isNil=jT,A.isNull=YT,A.isNumber=Yp,A.isObject=ue,A.isObjectLike=pe,A.isPlainObject=no,A.isRegExp=Nl,A.isSafeInteger=KT,A.isSet=jp,A.isString=xa,A.isSymbol=Qe,A.isTypedArray=sn,A.isUndefined=ZT,A.isWeakMap=JT,A.isWeakSet=QT,A.join=iw,A.kebabCase=V1,A.last=fi,A.lastIndexOf=rw,A.lowerCase=W1,A.lowerFirst=X1,A.lt=t1,A.lte=e1,A.max=NS,A.maxBy=US,A.mean=GS,A.meanBy=HS,A.min=VS,A.minBy=WS,A.stubArray=zl,A.stubFalse=ql,A.stubObject=MS,A.stubString=IS,A.stubTrue=PS,A.multiply=XS,A.nth=sw,A.noConflict=xS,A.noop=$l,A.now=ga,A.pad=$1,A.padEnd=z1,A.padStart=q1,A.parseInt=Y1,A.random=k1,A.reduce=aT,A.reduceRight=hT,A.repeat=j1,A.replace=K1,A.result=C1,A.round=$S,A.runInContext=N,A.sample=uT,A.size=fT,A.snakeCase=Z1,A.some=pT,A.sortedIndex=cw,A.sortedIndexBy=dw,A.sortedIndexOf=fw,A.sortedLastIndex=pw,A.sortedLastIndexBy=mw,A.sortedLastIndexOf=gw,A.startCase=Q1,A.startsWith=tS,A.subtract=zS,A.sum=qS,A.sumBy=YS,A.template=eS,A.times=RS,A.toFinite=vr,A.toInteger=Ut,A.toLength=Zp,A.toLower=iS,A.toNumber=pi,A.toSafeInteger=i1,A.toString=Zt,A.toUpper=rS,A.trim=sS,A.trimEnd=nS,A.trimStart=oS,A.truncate=aS,A.unescape=hS,A.uniqueId=DS,A.upperCase=lS,A.upperFirst=Hl,A.each=kp,A.eachRight=Np,A.first=Dp,Xl(A,(function(){var o={};return Wi(A,function(h,p){Jt.call(A.prototype,p)||(o[p]=h)}),o})(),{chain:!1}),A.VERSION=i,hi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(o){A[o].placeholder=A}),hi(["drop","take"],function(o,h){Xt.prototype[o]=function(p){p=p===e?1:xe(Ut(p),0);var y=this.__filtered__&&!h?new Xt(this):this.clone();return y.__filtered__?y.__takeCount__=Fe(p,y.__takeCount__):y.__views__.push({size:Fe(p,U),type:o+(y.__dir__<0?"Right":"")}),y},Xt.prototype[o+"Right"]=function(p){return this.reverse()[o](p).reverse()}}),hi(["filter","map","takeWhile"],function(o,h){var p=h+1,y=p==j||p==R;Xt.prototype[o]=function(w){var M=this.clone();return M.__iteratees__.push({iteratee:Mt(w,3),type:p}),M.__filtered__=M.__filtered__||y,M}}),hi(["head","last"],function(o,h){var p="take"+(h?"Right":"");Xt.prototype[o]=function(){return this[p](1).value()[0]}}),hi(["initial","tail"],function(o,h){var p="drop"+(h?"":"Right");Xt.prototype[o]=function(){return this.__filtered__?new Xt(this):this[p](1)}}),Xt.prototype.compact=function(){return this.filter(ze)},Xt.prototype.find=function(o){return this.filter(o).head()},Xt.prototype.findLast=function(o){return this.reverse().find(o)},Xt.prototype.invokeMap=Vt(function(o,h){return typeof o=="function"?new Xt(this):this.map(function(p){return Qn(p,o,h)})}),Xt.prototype.reject=function(o){return this.filter(ya(Mt(o)))},Xt.prototype.slice=function(o,h){o=Ut(o);var p=this;return p.__filtered__&&(o>0||h<0)?new Xt(p):(o<0?p=p.takeRight(-o):o&&(p=p.drop(o)),h!==e&&(h=Ut(h),p=h<0?p.dropRight(-h):p.take(h-o)),p)},Xt.prototype.takeRightWhile=function(o){return this.reverse().takeWhile(o).reverse()},Xt.prototype.toArray=function(){return this.take(U)},Wi(Xt.prototype,function(o,h){var p=/^(?:filter|find|map|reject)|While$/.test(h),y=/^(?:head|last)$/.test(h),w=A[y?"take"+(h=="last"?"Right":""):h],M=y||/^find/.test(h);w&&(A.prototype[h]=function(){var D=this.__wrapped__,O=y?[1]:arguments,G=D instanceof Xt,et=O[0],it=G||kt(D),st=function(Wt){var $t=w.apply(A,Nr([Wt],O));return y&&ht?$t[0]:$t};it&&p&&typeof et=="function"&&et.length!=1&&(G=it=!1);var ht=this.__chain__,Tt=!!this.__actions__.length,It=M&&!ht,Gt=G&&!Tt;if(!M&&it){D=Gt?D:new Xt(this);var Pt=o.apply(D,O);return Pt.__actions__.push({func:pa,args:[st],thisArg:e}),new ui(Pt,ht)}return It&&Gt?o.apply(this,O):(Pt=this.thru(st),It?y?Pt.value()[0]:Pt.value():Pt)})}),hi(["pop","push","shift","sort","splice","unshift"],function(o){var h=Go[o],p=/^(?:push|sort|unshift)$/.test(o)?"tap":"thru",y=/^(?:pop|shift)$/.test(o);A.prototype[o]=function(){var w=arguments;if(y&&!this.__chain__){var M=this.value();return h.apply(kt(M)?M:[],w)}return this[p](function(D){return h.apply(kt(D)?D:[],w)})}}),Wi(Xt.prototype,function(o,h){var p=A[h];if(p){var y=p.name+"";Jt.call(Js,y)||(Js[y]=[]),Js[y].push({name:h,func:p})}}),Js[aa(e,b).name]=[{name:"wrapper",func:e}],Xt.prototype.clone=hx,Xt.prototype.reverse=lx,Xt.prototype.value=ux,A.prototype.at=Uw,A.prototype.chain=Gw,A.prototype.commit=Hw,A.prototype.next=Vw,A.prototype.plant=Xw,A.prototype.reverse=$w,A.prototype.toJSON=A.prototype.valueOf=A.prototype.value=zw,A.prototype.first=A.prototype.head,zn&&(A.prototype[zn]=Ww),A}),js=H0();cs?((cs.exports=js)._=js,Wh._=js):Ce._=js}).call(_F)})(bo,bo.exports)),bo.exports}var vF=yF();const Li=ud(vF),Rn=[2,4,6,8];class Uv{name;hp;hpMax;mp;mpMax;initiative;rest=!1;taken=!1;skills;position;alive;effect;textWindow;turn;constructor(t){this.hpMax=100,this.mpMax=100,this.hp=this.hpMax,this.mp=this.mpMax,this.initiative=0,this.skills=[],this.alive=!0,this.effect=t}setTextWindow(t){this.textWindow=t}get pos(){return this.position.position}get dir(){return this.position.dir}gainHp(t){this.hp+=t,this.rest=!1,this.hp>this.hpMax&&(this.hp=this.hpMax)}damageHp(t){this.hp-=t,this.hp<0&&(this.hp=0),this.hp===0&&this.defeat()}gainMp(t){this.mp+=t,this.mp>this.mpMax&&(this.mp=this.mpMax)}damageMp(t){this.mp-=t,this.mp<0&&(this.mp=0)}defeat(){this.alive=!1}setInitiative(){return this.initiative+Math.floor(Math.random()*3)-1}}class xF extends Uv{position;statModifiers;heroLive2d;constructor(t,e){super(e),this.position=t,this.statModifiers={hpMax:0,mpMax:0,attack:0,defense:0,speed:0,avoid:0,critRate:0}}setup(t,e,i){const r=t.skills;this.name=t.name,this.hpMax=t.hpMax,this.mpMax=t.mpMax,this.hp=this.hpMax,this.mp=this.mpMax,this.initiative=t.initiative;for(const n of r){const a=new Gv(n,e);this.skills.push(a)}this.turn=i}setSprite(t){this.heroLive2d=t}gainHp(t){const e=Math.min(t,this.hpMax-this.hp);this.hp+=t,this.hp>this.hpMax&&(this.hp=this.hpMax);const i=`${this.name}HP${e}`;this.textWindow.addLine(i,"heal"),this.turn.addActionLog(i)}damageHp(t){super.damageHp(t),this.position.shake=15;const e=`${this.name}${t}`;this.heroLive2d.expression("damage"),this.heroLive2d.playMotion("Damage"),this.textWindow.addLine(e,"damage"),this.turn.addActionLog(e)}restMp(){const t=Math.floor(this.mpMax*.25);this.gainMp(t),ni.playSe("rest");const e=`${this.name}MP${t}`;this.textWindow.addLine(e,"heal"),this.turn.addActionLog(e),this.rest=!1}skillsData(){const t=[];for(const e of this.skills)t.push(e.data);return t}useSkill(t){if(this.mp>=this.skills[t].mpCost){const e=`${this.name}${this.skills[t].name}`;this.textWindow.addLine(e,"action"),this.turn.addActionLog(e),this.skills[t].effect(this)}else{const e=`${this.name}${this.skills[t].name}MP`;this.textWindow.addLine(e,"action"),this.turn.addActionLog(e)}}resetStatModifiers(){this.statModifiers={hpMax:0,mpMax:0,attack:0,defense:0,speed:0,avoid:0,critRate:0}}avoid(){if(this.statModifiers.avoid>=Math.random()){const e=`${this.name}`;return this.textWindow.addLine(e,"action"),this.turn.addActionLog(e),!0}else return!1}critical(){if(this.statModifiers.critRate>=Math.random()){const e="";return this.textWindow.addLine(e,"damage"),this.turn.addActionLog(e),!0}else return!1}}class bF extends Uv{monsterId;data;position;active=!1;collapse=15;inventory;hero;constructor(t,e,i,r,n,a,l,c){super(n),this.monsterId=t,this.setup(e,r,l,c),this.position=i,this.inventory=a}get rank(){return this.data.rank}get moveType(){return this.data.moveType}get activeType(){return this.data.activeType}get appearance(){return this.data.appearance}damageHp(t){super.damageHp(t);const e=this.action();!this.taken&&e&&this.turn.addInterrupt(this,e),this.active=!0,this.taken=!1}defeat(){this.alive=!1,ni.playSe("collapse");const t=this.hero.position.isInTracksFOV(this.pos)?`${this.name}`:"";this.textWindow.addLine(t,"damage"),this.turn.addActionLog(t);const e=this.dropItem();e&&this.inventory.getItem(e)}setup(t,e,i,r){for(const a of t)if(a.id===this.monsterId){this.data=a;break}const n=this.data.skills;for(const a of n){const l=new Gv(a,e);this.skills.push(l)}this.name=this.data.name,this.hpMax=this.data.hpMax,this.hp=this.hpMax,this.initiative=this.data.initiative,this.data.activeType==="always"&&(this.active=!0),this.turn=i,this.hero=r}action(){if(this.active&&this.alive){const t=Math.floor(Math.random()*this.skills.length),e=this.setInitiative();return this.position.turnToPoint(this.hero.pos),{actor:this,category:"skill",initiative:e,index:t}}return!1}useSkill(t){const e=`${this.name}`;this.textWindow.addLine(e,"action"),this.turn.addActionLog(e),this.skills[t].effect(this),this.taken=!0}dropItem(){const t=this.data.drops;if(t.length===0)return null;const e=t.reduce((a,l)=>a+Math.max(0,l.dropRate),0),i=Math.max(0,1-e),r=e+i;if(r<=0)return null;let n=Math.random()*r;if(n<i)return null;n-=i;for(const a of t){const l=Math.max(0,a.dropRate);if(!(l<=0)){if(n<l)return a.itemId;n-=l}}return null}}class wF{monsters;constructor(){this.monsters=[]}setTextWindow(t){for(const e of this.monsters)e.setTextWindow(t)}setup(t,e,i,r,n,a,l){const c=t.monsters;for(const f of c){const g=f.monsterId,u=new CF(t,f.position),d=new bF(g,e,u,i,r,n,a,l);this.monsters.push(d)}}actionMonsters(){let t=[];for(const e of this.monsters){const i=e.action();i&&t.push(i)}return t}}class Gv{data;skillId;power;hitRate;range;constructor(t,e){this.skillId=t,this.setup(e)}get name(){return this.data.name}get category(){return this.data.category}get iconId(){return this.data.iconId}get mpCost(){return this.data.mpCost}get description(){return this.data.description}setup(t){for(const e of t)if(e.id===this.skillId){this.data=e,this.power=e.power,this.hitRate=e.hitRate,this.range=e.range;break}}effect(t){const e=t.position,i=t.effect;t.damageMp(this.mpCost),ni.playSe(this.data.se),this.category==="attack"&&i.setEffect(t.pos,t.dir,this),this.category==="heal"&&t.gainHp(this.power),this.category==="detect"&&e.expandFOV(this.range)}}class TF{itemId;position;alive;sprite;inventry;turn;textWindow;constructor(t,e,i,r){this.itemId=t,this.position=e,this.alive=!0,this.inventry=i,this.turn=r}get pos(){return this.position}setTextWindow(t){this.textWindow=t}open(){if(this.alive)if(this.inventry.getItem(this.itemId))ni.playSe("chest"),this.turn.addActionLog(""),this.alive=!1;else{ni.playSe("close");const t="";this.textWindow.addLine(t,"damage"),this.turn.addActionLog(t)}}}class SF{tresures;constructor(){this.tresures=[]}setTextWindow(t){for(const e of this.tresures)e.setTextWindow(t)}setup(t,e,i){const r=t.tresures;for(const n of r){const a=n.itemId,l=n.position,c=new TF(a,l,e,i);this.tresures.push(c)}}}class AF{inventory;itemData;hero;textWindow;iconsWindow;turn;constructor(t,e){this.inventory=[],this.itemData=t,this.hero=e,this.initiaize()}setup(t,e){this.textWindow=t,this.turn=e}setIconsWindow(t){this.iconsWindow=t}initiaize(){const t=new W_(1,this.itemData,this.hero);this.inventory.push(t)}getItem(t){if(this.inventory.length<6){const e=new W_(t,this.itemData,this.hero),i=`${e.name}`;return this.textWindow.addLine(i,"action"),this.turn.addActionLog(i),this.inventory.push(e),this.equipmentEffects(),this.iconsWindow.setItems(),!0}else return!1}useItem(t){const e=this.inventory[t];if(e&&e.category=="consumable"){const i=`${e.name}`;this.textWindow.addLine(i,"action"),this.turn.addActionLog(i),e.useItem(),this.loseItem(t)}}discardItem(t){const e=this.inventory[t];if(e){const i=`${e.name}`;this.textWindow.addLine(i,"action"),this.turn.addActionLog(i),this.loseItem(t)}}loseItem(t){this.inventory.splice(t,1),this.equipmentEffects(),this.iconsWindow.setItems()}equipmentEffects(){this.hero.resetStatModifiers();for(const t of this.inventory)t&&t.category=="equipment"&&this.equipmentEffect(t)}equipmentEffect(t){"hpMax"in t.effect&&(this.hero.statModifiers.hpMax+=t.effect.hpMax),"mpMax"in t.effect&&(this.hero.statModifiers.mpMax+=t.effect.mpMax),"attack"in t.effect&&(this.hero.statModifiers.attack+=t.effect.attack),"defense"in t.effect&&(this.hero.statModifiers.defense+=t.effect.defense),"speed"in t.effect&&(this.hero.statModifiers.speed+=t.effect.speed),"avoid"in t.effect&&(this.hero.statModifiers.avoid+=t.effect.avoid),"critRate"in t.effect&&(this.hero.statModifiers.critRate+=t.effect.critRate)}totalValue(){let t=0;for(const e of this.inventory)t+=e.value;return t}itemsData(){const t=[];for(const e of this.inventory)t.push(e.data);return t}summary(){const t=[];for(let e=0;e<this.inventory.length;e++){const i=this.inventory[e];t.push({index:e,name:i.name,value:i.value,description:i.description})}return t}result(){const t=[];for(let e=0;e<this.inventory.length;e++){const i=this.inventory[e];t.push(`  - ${i.name} ${i.value}`)}return t}}class W_{itemId;data;hero;constructor(t,e,i){this.itemId=t,this.hero=i,this.setup(e)}get name(){return this.data.name}get iconId(){return this.data.iconId}get value(){return this.data.value}get description(){return this.data.description}get category(){return this.data.category}get effect(){return this.data.effect}setup(t){for(const e of t)if(e.id===this.itemId){this.data=e;break}}useItem(){this.effect.type=="heal"&&(ni.playSe("useItem"),this.effect.target=="hp"?this.hero.gainHp(this.effect.amount):this.effect.target=="mp"&&this.hero.gainMp(this.effect.amount)),this.effect.type=="teleport"&&(ni.playSe("teleport"),this.hero.position.tereport()),this.effect.type=="transparent"&&(ni.playSe("activation"),this.hero.position.setTransparent())}}class kd{position;dir=6;commands=[];reserve=[];nowStep;lastStep;dungeon;monsters;inFOV=!1;tereportFlag=!1;shake=0;turn;constructor(t,e={x:1,y:1}){this.position=e,this.nowStep=structuredClone(this.position),this.lastStep=structuredClone(this.position),this.dungeon=t}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}addCommand(t){this.commands.push(t)}runNextCommand(){const t=this.commands.shift();t&&t()}step(t){this.lastStep=structuredClone(this.nowStep);const e=this.directions(this.nowStep,t);this.dir=t,this.isWall(e)||(this.nowStep=this.directions(this.nowStep,t),this.reserve.push(t))}turnDir(t){this.dir=t}directions(t,e){let i=structuredClone(t);switch(e){case 2:i.y+=1;break;case 4:i.x-=1;break;case 6:i.x+=1;break;case 8:i.y-=1;break}return i}isStart(t){return this.dungeon.start.x===t.x&&this.dungeon.start.y===t.y}isWall(t){const i=this.dungeon.tiles;if(t.y<0||t.y>=i.length)return!0;const r=i[t.y];return t.x<0||t.x>=r.length?!0:r[t.x]==="#"}isFork(t){let e=0;for(const i of Rn){const r=this.directions(t,i);this.isWall(r)||e++}return e>=3}isEnd(t){let e=0;for(const i of Rn){const r=this.directions(t,i);this.isWall(r)&&e++}return e>=3}isCorner(t){const e=[2,8],i=[4,6],r=Rn.filter(l=>{const c=this.directions(t,l);return!this.isWall(c)}),n=r.some(l=>e.includes(l)),a=r.some(l=>i.includes(l));return n&&a&&r.length===2}isMonster(t){const e=this.monsters.monsters;for(const i of e)if(i.alive&&Li.isEqual(t,i.pos))return!0;return!1}isGoal(t){return this.dungeon.goal.x===t.x&&this.dungeon.goal.y===t.y}routeSearch(t){const e=structuredClone(this.position),i=Td(e,t,this.dungeon.tiles,!1);if(i)for(const r of i)this.step(r)}move(){if(this.reserve.length>0){const t=this.reserve.shift();t&&(this.position=this.directions(this.position,t))}else this.commands.length>0&&this.runNextCommand()}isMoving(){return this.reserve.length>0||this.shake>0}isBusy(){return this.isMoving()||this.commands.length>0}turnToPoint(t){const e=this.x-t.x,i=this.y-t.y;Math.abs(e)>Math.abs(i)?this.turnDir(e>0?4:6):i!==0&&this.turnDir(i>0?8:2)}hasObstacle(t){return!!(this.isWall(t)||this.isMonster(t)||this.isTresure(t))}tereport(){const t=this.dungeon.tiles,e=t.length,i=t[0]?.length??0,r=[];for(let l=0;l<e;l++)for(let c=0;c<i;c++){const f={x:c,y:l};this.hasObstacle(f)||r.push(f)}if(r.length===0)return;const n=Math.floor(Math.random()*r.length),a=r[n];this.reserve=[],this.position=structuredClone(a),this.nowStep=structuredClone(a),this.lastStep=structuredClone(a),this.tereportFlag=!0}isTresure(t){return!1}expandFOV(t){}autoCorridor(t){}goFrontier(){}backLastFork(){}backLastEnemy(){}}class EF extends kd{tracks;tracksFOV;lastEnemy=[];forkStack=[];moveLog=[];transparentFlag=!1;throughMonster=!1;tresures;heroSprite;constructor(t,e,i){super(t,{x:t.start.x,y:t.start.y}),this.monsters=e,this.tresures=i,this.tracks=Array(16).fill([]);for(let a=0;a<16;a++)this.tracks[a]=Array(16).fill(!1);this.tracks[this.y][this.x]=!0;const r=this.tracks.length,n=this.tracks[0].length;this.tracksFOV=Array.from({length:r},()=>Array(n).fill(!1)),this.setTracksFOV()}setup(t,e){this.turn=t,this.heroSprite=e}step(t){this.lastStep=structuredClone(this.nowStep);const e=this.directions(this.nowStep,t);this.dir=t,!this.isWall(e)&&!this.isTresure(e)&&this.isMonsterWithTransparent(e)&&(this.nowStep=this.directions(this.nowStep,t),this.dir=t,this.reserve.push(t),this.transparentFlag&&this.isMonster(e)&&(this.throughMonster=!0)),this.checkMovelog()}isMonsterWithTransparent(t){return this.transparentFlag||!this.isMonster(t)}checkMovelog(){this.moveLog.push(this.dir),this.isFork(this.nowStep)&&(this.toTextMoveLog(),this.turn.addActionLog("")),this.isTresure(this.nowStep)&&(this.toTextMoveLog(),this.turn.addActionLog("")),this.isGoal(this.nowStep)&&(this.toTextMoveLog(),this.turn.addActionLog("")),this.turnToMonster()}toTextMoveLog(){const t=this.moveLog.length;if(t>0){const e=`${t}`;this.turn.addActionLog(e)}this.moveLog=[]}turnToMonster(){for(const t of Rn){const e=this.directions(this.nowStep,t);if(this.isMonster(e)){this.toTextMoveLog(),this.turnDir(t),this.turn.addActionLog("");break}}}isTresure(t){const e=this.tresures.tresures;for(const i of e)if(i.alive&&Li.isEqual(t,i.pos))return!0;return!1}isFork(t,e){return e&&this.tracks[t.y][t.x]?!1:super.isFork(t)}goFrontier(t){const e={x:this.x,y:this.y},i=t?g_(e,this.dungeon.tiles,this.tracks,t):g_(e,this.dungeon.tiles,this.tracks);if(i){const r=Td(e,i,this.dungeon.tiles,this.tracksFOV);if(r){for(const n of r)if(this.step(n),this.isGoal(this.nowStep))break}}}backLastFork(){if(this.forkStack.length>0){let t=this.forkStack.pop();for(;this.forkStack.length>0&&Li.isEqual(this.position,t);)t=this.forkStack.pop();t&&this.routeSearch(t)}}setLastEnemy(t){this.lastEnemy.push({x:t.x,y:t.y})}backLastEnemy(){if(this.lastEnemy.length>0){let t=this.lastEnemy.pop();for(;this.lastEnemy.length>0&&Li.isEqual(this.position,t);)t=this.lastEnemy.pop();t&&this.routeSearch(t)}}openTresure(){const t=this.tresures.tresures;for(const e of t){e.alive&&Li.isEqual(this.position,e.position)&&(this.tracks[e.pos.y][e.pos.x]=!0,e.open());for(const i of Rn){const r=this.directions(this.position,i);e.alive&&Li.isEqual(r,e.position)&&(this.tracks[e.pos.y][e.pos.x]=!0,e.open())}}}autoCorridor(t,e){let i=50;t:for(;i>0;){let r=[];for(const n of Rn){const a=this.directions(this.nowStep,n);if(this.isTresure(a))break t;this.isWall(a)||this.isMonsterWithTransparent(a)&&r.push(n)}if(r.length<=0)break;if(r.length>1){r=r.filter(c=>!Li.isEqual(this.directions(this.nowStep,c),this.lastStep));const n=r.every(c=>this.isknownTile(c)===!0),a=r.every(c=>this.isknownTile(c)===!1);n||a||(r=r.filter(c=>!this.isknownTile(c)));const l=r[Math.floor(Math.random()*r.length)];this.step(l)}else this.isEnd(this.nowStep)&&this.step(r[0]);if(Li.isEqual(this.lastStep,this.nowStep)||t===!0&&this.isFork(this.nowStep,!0)||e==="fork"&&this.isFork(this.nowStep)||e==="corner"&&this.isCorner(this.nowStep)||this.isGoal(this.nowStep))break;i--}}isknownTile(t){return this.tracks[this.directions(this.nowStep,t).y][this.directions(this.nowStep,t).x]}setTracksFOV(){const t=this.tracks.length,e=this.tracks[0].length,i=2;for(let r=0;r<t;r++)for(let n=0;n<e;n++)if(this.tracks[r][n])for(let a=-i;a<=i;a++){const l=r+a;if(!(l<0||l>=t))for(let c=-i;c<=i;c++){const f=n+c;f<0||f>=e||(this.tracksFOV[l][f]=!0)}}}expandFOV(t){const e=this.x,i=this.y,r=this.tracks.length,n=this.tracks[0].length;for(let a=-t;a<=t;a++){const l=i+a;if(!(l<0||l>=r))for(let c=-t;c<=t;c++){const f=e+c;f<0||f>=n||(this.tracksFOV[l][f]=!0,Math.abs(c)+Math.abs(a)<=t&&(this.tracksFOV[l][f]=!0))}}}move(){if(this.reserve.length>0){this.heroSprite.walkStart();const t=this.reserve.shift();t&&(this.dir=t,this.position=this.directions(this.position,t),this.tracks[this.y][this.x]=!0,this.isFork(this.position)&&this.forkStack.push(structuredClone(this.position)),this.setTracksFOV(),this.discoveredMonster())}else this.commands.length>0?this.runNextCommand():this.throughMonster?(this.transparentFlag=!1,this.throughMonster=!1):this.heroSprite.walkEnd()}tereport(){super.tereport(),this.tracks[this.y][this.x]=!0,this.setTracksFOV()}discoveredMonster(){if(this.transparentFlag)return;const t=this.monsters.monsters;for(const e of t)e.alive&&!e.active&&e.activeType==="discovery"&&e.position.isInFOV(this.position)&&(e.position.turnToPoint(this.position),e.active=!0)}setTransparent(){this.transparentFlag=!0;const t=this.monsters.monsters;for(const e of t)e.active=!1}isInFOV(t){return Sd(this.position,2,this.dungeon.tiles)[t.y][t.x]}isInTracksFOV(t){return this.tracksFOV[t.y][t.x]}FOVDescription(t){const e=[],i=mP(t,2,this.dungeon.tiles);for(const r of i)e.push({x:r.x,y:r.y,description:this.tileDescription(r)});return e}tileDescription(t){const e=[],i=this.monsterDescription(t);return this.isWall(t)?e.push(""):e.push(""),i&&e.push(`:${i.appearance}`),this.isTresure(t)&&e.push(""),this.isFork(t)&&e.push(""),this.isStart(t)&&e.push(""),this.isEnd(t)&&!this.isWall(t)&&e.push(""),this.isGoal(t)&&e.push(""),e.join(",")}monsterDescription(t){const e=this.monsters.monsters;for(const i of e)if(i.alive&&Li.isEqual(t,i.pos))return i;return!1}isGameClear(){return this.isGoal(this.position)}}class CF extends kd{sprite;tx;ty;constructor(t,e){super(t,e),this.tx=1,this.ty=1}routeSearch(t){const e=structuredClone(this.position),i=Td(e,t,this.dungeon.tiles,!1);if(i){i.pop();for(const r of i)this.step(r)}}isInFOV(t){return Sd(this.position,2,this.dungeon.tiles)[t.y][t.x]}}class MF extends kd{active=!1;distance=0;power=0;tx=1;ty=1;sprite;skill;hero;constructor(t){super(t)}setup(t,e,i){this.monsters=t,this.hero=e,this.turn=i}setEffect(t,e,i){this.position.x=t.x,this.position.y=t.y,this.nowStep.x=t.x,this.nowStep.y=t.y,this.dir=e,this.skill=i,this.distance=i.range+1,this.power=i.power,this.active=!0;const r=32;for(this.sprite.x=this.x*r+32+r/2,this.sprite.y=this.y*r+96+r/2,this.sprite.alpha=1;this.distance>0;)this.step(this.dir),this.distance--}move(){if(this.reserve.length>0){const t=this.reserve.shift();t&&(this.position=this.directions(this.position,t),this.collisionTarget())}else this.active&&(this.active=!1)}collisionTarget(){const t=this.monsters.monsters;for(const e of t)if(e.alive&&Li.isEqual(this.position,e.pos)&&this.active){const i=10-this.dir;if(e.position.turnDir(i),this.hero.position.isInTracksFOV(e.pos)){const r=`${e.name}${this.skill.name}`;this.turn.addActionLog(r)}else{const r=`${this.skill.name}`;this.turn.addActionLog(r)}this.hero.critical()?e.damageHp(Math.floor(this.power*1.5)):e.damageHp(this.power),e.alive||this.hero.position.setLastEnemy(this.position),this.shake=30,this.active=!1}if(this.hero.alive&&Li.isEqual(this.position,this.hero.pos)&&this.active){const e=10-this.dir;this.hero.avoid()||this.hero.damageHp(this.power),this.hero.position.turnDir(e),this.active=!1}}}async function IF(){const[s,t,e,i,r,n,a]=await Promise.all([Bi.load("./assets/images/background.png"),Bi.load("./assets/images/hero.png"),Bi.load("./assets/images/button.png"),Bi.load("./assets/images/point.png"),Bi.load("./assets/images/mapIcons.png"),Bi.load("./assets/images/itemIcons.png"),Bi.load("./assets/images/expressions.png")]),c=await(await fetch("./assets/data/dungeon.json")).json(),g=await(await fetch("./assets/data/hero.json")).json(),d=await(await fetch("./assets/data/monsters.json")).json(),_=await(await fetch("./assets/data/items.json")).json(),v=await(await fetch("./assets/data/skills.json")).json();return{dungeon:c,hero:g,monsters:d,items:_,skills:v,backgroundTexture:s,heroTexture:t,bgmButtonTexture:e,pointTexture:i,mapIconsTexture:r,itemIconsTexture:n,expressionsTexture:a}}class PF{app;container;constructor(t){this.app=t,this.container=new Ee}destroy(){this.container.destroy({children:!0})}}class RF extends PF{assets;dungeonMap;monsters;tresures;effect;background;heroLive2d;bgmButton;textButton;point;callingSpinner;confetti;turnWindow;textWindow;valueWindow;messageWindow;skillIcons;itemIcons;heroStatus;statusGauges;bgm;bgmPlaying;heroPosition;inventory;turn;constructor(t,e){super(t),this.assets=e,ni.setBgm("dungeon1"),this.Initialize()}async Initialize(){this.createObjects(),this.createSprites(),this.container.addChild(this.background.container),this.heroLive2d=new JR,await this.heroLive2d.load(this.app,this.container),this.container.addChild(this.bgmButton.container),this.container.addChild(this.textButton.container),this.container.addChild(this.dungeonMap.container),this.container.addChild(this.point.container),this.container.addChild(this.callingSpinner),this.createWindows(),this.turn.setup(this.messageWindow,this.callingSpinner,this.textWindow,this.confetti),this.inventory.setup(this.textWindow,this.turn),this.heroStatus.setSprite(this.heroLive2d),this.heroPosition.setup(this.turn,this.heroLive2d)}createObjects(){const t=this.assets.dungeon[0],e=this.assets.monsters,i=this.assets.skills,r=this.assets.items;this.effect=new MF(t),this.monsters=new wF,this.tresures=new SF,this.heroPosition=new EF(t,this.monsters,this.tresures),this.heroStatus=new xF(this.heroPosition,this.effect),this.inventory=new AF(r,this.heroStatus),this.turn=new gF(this.heroStatus,this.inventory,this.tresures),this.heroStatus.setup(this.assets.hero[0],i,this.turn),this.tresures.setup(t,this.inventory,this.turn),this.monsters.setup(t,e,i,this.effect,this.inventory,this.turn,this.heroStatus),this.effect.setup(this.monsters,this.heroStatus,this.turn)}createSprites(){const t=this.assets.dungeon[0],e=32,i=this.app.view;this.dungeonMap=new hF(t,e,this.assets.mapIconsTexture,this.heroStatus,this.monsters,this.tresures,this.effect),this.background=new oF(0,0,i.width,i.height,this.assets.backgroundTexture),this.bgmButton=new H_(32,i.height-64-20,64,64,this.assets.bgmButtonTexture,0),this.textButton=new H_(128,i.height-64-20,64,64,this.assets.bgmButtonTexture,1),this.point=new aF(this.heroPosition,40,40,this.assets.pointTexture),this.callingSpinner=new lF(i.width-48,i.height-48),this.confetti=new uF(this.container,i.width,i.height)}createWindows(){const l=this.heroStatus.skills,c=this.inventory.inventory,f=this.app.view;this.textWindow=new QR(560,32,298,640,20),this.turnWindow=new eF(0,16,480,48,this.turn),this.valueWindow=new iF(874,296,180,32,this.inventory),this.statusGauges=new nF(455,16,180,48,this.heroStatus),this.skillIcons=new G_(874,96,192,64,this.assets.itemIconsTexture,l,3),this.itemIcons=new G_(874,176,192,128,this.assets.itemIconsTexture,c,6),this.messageWindow=new tF(874,f.height-128,400,96,20,this.heroLive2d),this.container.addChild(this.textWindow.container),this.container.addChild(this.turnWindow.container),this.container.addChild(this.valueWindow.container),this.container.addChild(this.statusGauges.container),this.container.addChild(this.itemIcons.container),this.container.addChild(this.skillIcons.container),this.container.addChild(this.messageWindow.container),this.heroStatus.setTextWindow(this.textWindow),this.tresures.setTextWindow(this.textWindow),this.monsters.setTextWindow(this.textWindow),this.inventory.setIconsWindow(this.itemIcons)}update(t){this.messageWindow&&(this.point.update(t),this.statusGauges.update(t),this.dungeonMap.update(t),this.turn.update(),this.turnWindow.update(t),this.valueWindow.update(t),this.heroLive2d.update(),this.messageWindow.update(),this.callingSpinner.update(t),this.confetti.update(t),this.textButton.update(),this.textWindow.update(t),this.updateInputAble())}updateInputAble(){const t=document.getElementById("textInput");this.turn.isBusy()?t.readOnly=!0:t.readOnly=!1}onClick(t,e){this.bgmButton.contains(t,e)&&this.handleBgmButtonClick(),this.textButton.contains(t,e)&&this.handleTextButtonClick(),this.textWindow.contains(t,e)&&(e<this.textWindow.y+this.textWindow.height/2?this.textWindow.scroll(-1):this.textWindow.scroll(1))}onMouse(t,e){this.skillIcons.contains(t,e)?this.skillIcons.onMouse(t,e):this.skillIcons.displayDescription(!1),this.itemIcons.contains(t,e)?this.itemIcons.onMouse(t,e):this.itemIcons.displayDescription(!1)}onSubmitText(t){const e=t.trim();e&&(this.textWindow.addLine(e),t&&(this.heroLive2d.expression("normal"),this.testControl(t)))}handleBgmButtonClick(){this.playButtonSe(),this.bgmPlaying?(ni.muteBgm(!0),this.bgmPlaying=!1):(ni.muteBgm(!1),this.bgmPlaying=!0),this.bgmButton.setswitching(this.bgmPlaying)}handleTextButtonClick(){this.playButtonSe(),this.textButton.setswitching(!0),this.turn.resultHistory()}playButtonSe(){ni.playSe("click")}testControl(t){const e=this.heroStatus;if(t===""&&this.inventory.getItem(102),t===""&&e.position.addCommand(()=>e.position.autoCorridor(!0)),t===""&&(e.position.addCommand(()=>e.position.step(6)),e.position.addCommand(()=>e.position.step(6)),e.position.addCommand(()=>e.position.step(6))),t===""&&e.useSkill(0),t===""&&e.useSkill(2),t===""){const i=this.monsters.monsters[0];i.position.turnDir(4),i.useSkill(0)}t===""&&(e.damageHp(20),this.heroLive2d.playMotion("Damage")),t===""&&(this.heroLive2d.expression("surprise"),this.heroLive2d.playMotion("Jump")),t===""&&this.heroLive2d.walkStart(),t===""&&this.heroLive2d.walkEnd(),t===""&&this.inventory.getItem(11),t===""&&this.inventory.useItem(1),t===""&&this.inventory.discardItem(1),t===""&&(this.textWindow.addLine(""),this.textWindow.addLine(""),this.textWindow.addLine(""),this.textWindow.addLine(""),this.textWindow.addLine("")),t===""&&this.confetti.startContinuous(),t===""&&this.heroPosition.turnToPoint({x:0,y:1})}}class FF{app;textForm;textInput;currentScene;constructor(t){this.app=t,this.currentScene=null,IF().then(e=>this.initWithAssets(e)).catch(e=>console.error(":",e)),this.textForm=document.getElementById("textForm"),this.textInput=document.getElementById("textInput")}initWithAssets(t){this.currentScene=new RF(this.app,t),this.app.stage.addChild(this.currentScene.container),this.setupInput()}setupInput(){const t=this,e=this.app.view;e.addEventListener("mousedown",function(i){if(!t.currentScene)return;const{x:r,y:n}=t.getMousePos(i);t.currentScene.onClick(r,n)}),e.addEventListener("mousemove",function(i){if(!t.currentScene)return;const{x:r,y:n}=t.getMousePos(i);t.currentScene.onMouse(r,n)}),e.addEventListener("wheel",function(i){if(!t.currentScene)return;const r=t.currentScene;r.textWindow&&r.textWindow.handleWheel(i.deltaY)}),this.textForm.addEventListener("submit",function(i){if(i.preventDefault(),!!t.currentScene){var r=t.textInput.value;t.currentScene.onSubmitText(r),t.textInput.value="",t.textInput.focus()}})}getMousePos(t){const i=this.app.view.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}update(t){this.currentScene?.update(t)}}function DF(){const s=new jy({width:1280,height:720,backgroundColor:0}),t=document.getElementById("app");if(!t)throw new Error("#app ");t.appendChild(s.view);const e=new FF(s);He.shared.add(r=>{e.update(r)})}DF();
